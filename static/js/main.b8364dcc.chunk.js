(this.webpackJsonpkana=this.webpackJsonpkana||[]).push([[0],{281:function(e,t,n){},282:function(e,t,n){},308:function(e,t,n){},311:function(e,t,n){},312:function(e,t,n){},313:function(e,t,n){},325:function(e,t,n){},326:function(e,t,n){},327:function(e,t,n){},328:function(e,t,n){},329:function(e,t,n){},330:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),c=n(25),i=n.n(c),l=(n(281),n(4)),r=n(22),o=n(5),d=(n(282),n(338)),j=n(49),u=n(136),h=n(79),b=n(43),O=n(3),p=n(20),m=d.J.create({className:"notifications",position:p.a.TOP_RIGHT,maxToasts:5}),x=n(0),f=Object(s.createContext)(null),v=function(e){var t=e.children,n=Object(s.useState)({format:null,files:null}),a=Object(o.a)(n,2),c=a[0],i=a[1],l=Object(s.useState)({qc:{"qc-nmads":3},fSelection:{"fsel-span":.3},pca:{"pca-npc":5,"pca-hvg":4e3},cluster:{"clus-k":10,"clus-res":.5,"clus-scheme":0,"clus-approx":!0,"clus-method":"snn_graph"},tsne:{"tsne-iter":500,"tsne-perp":30,animate:!1},umap:{"umap-nn":15,"umap-epochs":500,"umap-min_dist":.01,animate:!1},markerGene:{}}),r=Object(o.a)(l,2),d=r[0],j=r[1],u=Object(s.useState)(!1),h=Object(o.a)(u,2),b=h[0],O=h[1],p=Object(s.useState)(!1),v=Object(o.a)(p,2),g=v[0],y=v[1],w=Object(s.useState)("new"),F=Object(o.a)(w,2),N=F[0],C=F[1],k=Object(s.useState)(null),S=Object(o.a)(k,2),E=S[0],D=S[1],A=Object(s.useState)(null),M=Object(o.a)(A,2),I=M[0],T=M[1],L=Object(s.useState)(null),R=Object(o.a)(L,2),q=R[0],B=R[1],P=Object(s.useState)(null),_=Object(o.a)(P,2),G=_[0],W=_[1],V=Object(s.useState)("kana-"+String(Date.now()).slice(0,8)),z=Object(o.a)(V,2),H=z[0],U=z[1],K=Object(s.useState)(!1),Q=Object(o.a)(K,2),X=Q[0],Y=Q[1],J=Object(s.useState)(!1),Z=Object(o.a)(J,2),$=Z[0],ee=Z[1],te=Object(s.useState)(!1),ne=Object(o.a)(te,2),se=ne[0],ae=ne[1],ce=Object(s.useState)(!1),ie=Object(o.a)(ce,2),le=ie[0],re=ie[1],oe=Object(s.useState)(null),de=Object(o.a)(oe,2),je=de[0],ue=de[1],he=Object(s.useState)(null),be=Object(o.a)(he,2),Oe=be[0],pe=be[1],me=Object(s.useState)(null),xe=Object(o.a)(me,2),fe=xe[0],ve=xe[1],ge=Object(s.useState)(null),ye=Object(o.a)(ge,2),we=ye[0],Fe=ye[1],Ne=Object(s.useState)(null),Ce=Object(o.a)(Ne,2),ke=Ce[0],Se=Ce[1],Ee=Object(s.useState)("id"),De=Object(o.a)(Ee,2),Ae=De[0],Me=De[1],Ie=Object(s.useState)(null),Te=Object(o.a)(Ie,2),Le=Te[0],Re=Te[1],qe=Object(s.useState)(null),Be=Object(o.a)(qe,2),Pe=Be[0],_e=Be[1],Ge=Object(s.useState)(null),We=Object(o.a)(Ge,2),Ve=We[0],ze=We[1],He=Object(s.useState)([]),Ue=Object(o.a)(He,2),Ke=Ue[0],Qe=Ue[1],Xe=Object(s.useState)(null),Ye=Object(o.a)(Xe,2),Je=Ye[0],Ze=Ye[1],$e=Object(s.useState)(null),et=Object(o.a)($e,2),tt=et[0],nt=et[1],st=Object(s.useState)(null),at=Object(o.a)(st,2),ct=at[0],it=at[1],lt=Object(s.useState)(null),rt=Object(o.a)(lt,2),ot=rt[0],dt=rt[1],jt=Object(s.useState)([]),ut=Object(o.a)(jt,2),ht=ut[0],bt=ut[1],Ot=Object(s.useState)(null),pt=Object(o.a)(Ot,2),mt=pt[0],xt=pt[1],ft=Object(s.useState)(null),vt=Object(o.a)(ft,2),gt=vt[0],yt=vt[1],wt=Object(s.useState)({}),Ft=Object(o.a)(wt,2),Nt=Ft[0],Ct=Ft[1],kt=Object(s.useState)(null),St=Object(o.a)(kt,2),Et=St[0],Dt=St[1],At=Object(s.useState)(null),Mt=Object(o.a)(At,2),It=Mt[0],Tt=Mt[1],Lt=Object(s.useState)(null),Rt=Object(o.a)(Lt,2),qt=Rt[0],Bt=Rt[1],Pt=Object(s.useState)(!1),_t=Object(o.a)(Pt,2),Gt=_t[0],Wt=_t[1],Vt=Object(s.useState)(!1),zt=Object(o.a)(Vt,2),Ht=zt[0],Ut=zt[1],Kt=Object(s.useState)(null),Qt=Object(o.a)(Kt,2),Xt=Qt[0],Yt=Qt[1],Jt=Object(s.useState)(null),Zt=Object(o.a)(Jt,2),$t=Zt[0],en=Zt[1],tn=Object(s.useState)(null),nn=Object(o.a)(tn,2),sn=nn[0],an=nn[1],cn=Object(s.useState)(null),ln=Object(o.a)(cn,2),rn=ln[0],on=ln[1],dn=Object(s.useState)([]),jn=Object(o.a)(dn,2),un=jn[0],hn=jn[1],bn=Object(s.useState)([]),On=Object(o.a)(bn,2),pn=On[0],mn=On[1];return Object(s.useEffect)((function(){le&&null!=c.files&&!se&&("new"===N?window.scranWorker.postMessage({type:"RUN",payload:{files:c,params:d},msg:"not much to pass"}):"load"===N&&(null==q||(null===c||void 0===c?void 0:c.reset)?window.scranWorker.postMessage({type:"LOAD",payload:{files:c},msg:"not much to pass"}):window.scranWorker.postMessage({type:"RUN",payload:{files:c,params:d},msg:"not much to pass"}),ae(!0)))}),[c,d,le]),Object(s.useEffect)((function(){X?(window.scranWorker.postMessage({type:"EXPORT",payload:{files:c,params:d},msg:"not much to pass"}),m.show({icon:"download",intent:"primary",message:"Exporting analysis in the background"})):(null===c||void 0===c?void 0:c.files)&&m.show({icon:"download",intent:"primary",message:"Analysis saved. Please check your downloads directory!"})}),[X]),Object(s.useEffect)((function(){$?(window.scranWorker.postMessage({type:"SAVEKDB",payload:{files:c,params:d,id:H},msg:"not much to pass"}),m.show({icon:"floppy-disk",intent:"primary",message:"Saving analysis in the background. Note: analysis is saved within the browser!!"})):(null===c||void 0===c?void 0:c.files)&&m.show({icon:"floppy-disk",intent:"primary",message:"Analysis saved!"})}),[$]),Object(s.useEffect)((function(){I&&(window.scranWorker.postMessage({type:"REMOVEKDB",payload:{id:I},msg:"not much to pass"}),m.show({icon:"floppy-disk",intent:"danger",message:"Deleting Analysis in the background"}))}),[I]),Object(x.jsx)(f.Provider,{value:{inputFiles:c,setInputFiles:i,params:d,setParams:j,error:je,setError:ue,wasmInitialized:le,setWasmInitialized:re,pcaData:It,setPcaData:Tt,pcaVarExp:qt,setPcaVarExp:Bt,tsneData:Xt,setTsneData:Yt,umapData:$t,setUmapData:en,genesInfo:ke,setGenesInfo:Se,initDims:Oe,setInitDims:pe,qcDims:fe,setQcDims:ve,qcData:Le,setQcData:Re,qcThreshold:Pe,setQcThreshold:_e,fSelDims:we,setFSelDims:Fe,redDims:Ke,setRedDims:Qe,defaultRedDims:Je,setDefaultRedDims:Ze,plotRedDims:tt,setPlotRedDims:nt,clusterData:ct,setClusterData:it,fSelectionData:Ve,setFSelectionData:ze,logs:un,setLogs:hn,selectedCluster:ot,setSelectedCluster:dt,selectedClusterSummary:ht,setSelectedClusterSummary:bt,clusterRank:gt,setClusterRank:yt,gene:sn,setGene:an,clusterColors:mt,setClusterColors:xt,reqGene:rn,setReqGene:on,openInput:b,setOpenInput:O,customSelection:Nt,setCustomSelection:Ct,delCustomSelection:Et,setDelCustomSelection:Dt,showGame:g,setShowGame:y,exportState:X,setExportState:Y,datasetName:H,setDatasetName:U,tabSelected:N,setTabSelected:C,loadParams:q,setLoadParams:B,showAnimation:Gt,setShowAnimation:Wt,triggerAnimation:Ht,setTriggerAnimation:Ut,savedPlot:pn,setSavedPlot:mn,geneColSel:Ae,setGeneColSel:Me,indexedDBState:$,setIndexedDBState:ee,kanaIDBRecs:E,setKanaIDBRecs:D,initLoadState:se,setInitLoadState:ae,loadParamsFor:G,setLoadParamsFor:W,deletekdb:I,setDeletekdb:T},children:t})},g=a.a.memo(v),y=(n(308),["buttonText","includeFooter"]);var w=function(e){var t,n,a,c,i,r,j=e.buttonText,h=e.includeFooter,p=Object(b.a)(e,y),m=Object(s.useState)(!1),v=Object(o.a)(m,2),g=v[0],w=v[1],F=Object(s.useState)(1),N=Object(o.a)(F,2),C=N[0],k=N[1],S=Object(s.useCallback)((function(){return w(!g)}),[g]),E=Object(s.useCallback)((function(){return w(!1)}),[]),D=Object(s.useContext)(f),A=D.inputFiles,M=D.setInputFiles,I=D.params,T=D.setParams,L=D.openInput,R=D.tabSelected,q=D.setTabSelected,B=D.loadParams,P=D.kanaIDBRecs,_=D.setLoadParamsFor,G=D.loadParamsFor,W=D.setDeletekdb,V=D.setDatasetName,z=Object(s.useState)({gene:null,mtx:null,barcode:null}),H=Object(o.a)(z,2),U=H[0],K=H[1],Q=Object(s.useState)({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"}),X=Object(o.a)(Q,2),Y=X[0],J=X[1],Z=Object(s.useState)(!0),$=Object(o.a)(Z,2),ee=$[0],te=$[1],ne=Object(s.useState)("mtx"),se=Object(o.a)(ne,2),ae=se[0],ce=se[1],ie=Object(s.useState)("kana"),le=Object(o.a)(ie,2),re=le[0],oe=le[1],de=Object(s.useState)("new"==R?I:B),je=Object(o.a)(de,2),ue=je[0],he=je[1];function be(e,t){"mtx"===e?(K({gene:null,mtx:null,barcode:null}),J({mtx:"Choose Matrix Market file",gene:"Choose feature/gene annotation",barcode:"Choose barcode annotation"})):"tenx"===e?(K({file:null}),J({file:"Choose 10x v3 H5 file"})):"h5ad"===e&&(K({file:null}),J({file:"Choose H5ad file"})),he(I),ce(e)}return Object(s.useEffect)((function(){L&&w(!0)}),[L]),Object(s.useEffect)((function(){B&&"load"==R&&he(B)}),[B]),Object(s.useEffect)((function(){"load"==R&&"kanadb"==re&&null==(null===U||void 0===U?void 0:U.file)&&P&&K({file:P[0]})}),[P,re]),Object(s.useEffect)((function(){U&&("new"===R?"mtx"===ae?(null===U||void 0===U?void 0:U.mtx)&&!(null===Y||void 0===Y?void 0:Y.mtx.toLowerCase().endsWith("mtx"))&&!(null===Y||void 0===Y?void 0:Y.mtx.toLowerCase().endsWith("mtx.gz"))||(null===U||void 0===U?void 0:U.gene)&&!(null===Y||void 0===Y?void 0:Y.gene.toLowerCase().endsWith("tsv"))&&!(null===Y||void 0===Y?void 0:Y.gene.toLowerCase().endsWith("tsv.gz"))||(null===U||void 0===U?void 0:U.barcode)&&!(null===Y||void 0===Y?void 0:Y.barcode.toLowerCase().endsWith("tsv"))&&!(null===Y||void 0===Y?void 0:Y.barcode.toLowerCase().endsWith("tsv.gz"))?te(!1):te(!0):"tenx"!==ae&&"h5ad"!==ae||((null===U||void 0===U?void 0:U.file)&&!((null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("hdf5"))||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("h5"))||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("h5ad")))?te(!1):te(!0)):"load"===R&&(null===Y||void 0===Y?void 0:Y.file)&&("kana"!==re||null==(null===U||void 0===U?void 0:U.file)||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("kana"))||(null===Y||void 0===Y?void 0:Y.file.toLowerCase().endsWith("kana.gz"))?te(!0):te(!1)))}),[U]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.a,{onClick:S,icon:"social-media",intent:"primary",text:j}),Object(x.jsxs)(d.g,Object(l.a)(Object(l.a)({className:"analysis-dialog"},p),{},{isOpen:g,onClose:E,children:[Object(x.jsx)("div",{className:O.a.DIALOG_BODY,children:Object(x.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!1,onChange:function(e,t){"new"===e&&be(ae),q(e)},defaultSelectedTabId:R,children:[Object(x.jsx)(d.F,{id:"new",title:"Import new dataset",panel:Object(x.jsxs)("div",{className:"inputs-container",children:[Object(x.jsxs)("div",{className:"row-input",children:[Object(x.jsx)("div",{className:"col",style:{paddingBottom:"15px"},children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(1)},children:"Load input files"})]}),Object(x.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:be,defaultSelectedTabId:ae,children:[Object(x.jsx)(d.F,{id:"mtx",title:"Matrix Market file",panel:Object(x.jsxs)("div",{className:"row",children:[Object(x.jsx)(d.q,{className:"row-input",children:Object(x.jsx)(d.k,{text:Y.mtx,onInputChange:function(e){J(Object(l.a)(Object(l.a)({},Y),{},{mtx:e.target.files[0].name})),K(Object(l.a)(Object(l.a)({},U),{},{mtx:e.target.files}))}})}),Object(x.jsx)(d.q,{className:"row-input",children:Object(x.jsx)(d.k,{text:Y.gene,onInputChange:function(e){J(Object(l.a)(Object(l.a)({},Y),{},{gene:e.target.files[0].name})),K(Object(l.a)(Object(l.a)({},U),{},{gene:e.target.files}))}})})]})}),Object(x.jsx)(d.F,{id:"tenx",title:"10x v3 H5",panel:Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",children:"Choose 10x V3 H5 file"})}),Object(x.jsx)(d.k,{style:{marginTop:"5px"},text:Y.file,onInputChange:function(e){J(Object(l.a)(Object(l.a)({},Y),{},{file:e.target.files[0].name})),K(Object(l.a)(Object(l.a)({},U),{},{file:e.target.files}))}})]})})}),Object(x.jsx)(d.F,{id:"h5ad",title:"H5ad",panel:Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",children:"Choose H5ad file"})}),Object(x.jsx)(d.k,{style:{marginTop:"5px"},text:Y.file,onInputChange:function(e){J(Object(l.a)(Object(l.a)({},Y),{},{file:e.target.files[0].name})),K(Object(l.a)(Object(l.a)({},U),{},{file:e.target.files}))}})]})})})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"2"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(2)},children:"Quality control"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(2)},children:"Number of MADs"})}),Object(x.jsx)(d.x,{placeholder:"3",value:ue.qc["qc-nmads"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{qc:Object(l.a)(Object(l.a)({},ue.qc),{},{"qc-nmads":e})}))}})]})})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"3"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(3)},children:"Feature Selection"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(3)},children:"Lowess span"})}),Object(x.jsx)(d.x,{placeholder:"0.3",value:ue.fSelection["fsel-span"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{fSelection:Object(l.a)(Object(l.a)({},ue.fSelection),{},{"fsel-span":e})}))}})]})})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"4"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(4)},children:"Principal components analysis"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(4)},children:"Number of HVGs"})}),Object(x.jsx)(d.x,{placeholder:"2500",value:ue.pca["pca-hvg"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{pca:Object(l.a)(Object(l.a)({},ue.pca),{},{"pca-hvg":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(4)},children:"Number of PCs"})}),Object(x.jsx)(d.x,{placeholder:"25",value:ue.pca["pca-npc"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{pca:Object(l.a)(Object(l.a)({},ue.pca),{},{"pca-npc":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"5"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Clustering"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Method"})}),Object(x.jsx)(d.n,{defaultValue:ue.cluster["clus-method"],children:Object(x.jsx)("option",{children:ue.cluster["clus-method"]})})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"10",value:ue.cluster["clus-k"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-k":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Use ANN"})}),Object(x.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:ue.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Weighting scheme"})}),Object(x.jsxs)(d.n,{onChange:function(e,t){var n;return he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(x.jsx)("option",{children:"Rank"},"0"),Object(x.jsx)("option",{children:"Number"},"1"),Object(x.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Resolution"})}),Object(x.jsx)(d.x,{placeholder:"0.5",value:ue.cluster["clus-res"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-res":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"6"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(6)},children:"t-SNE"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(6)},children:"Perplexity"})}),Object(x.jsx)(d.x,{placeholder:"30",value:ue.tsne["tsne-perp"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{tsne:Object(l.a)(Object(l.a)({},ue.tsne),{},{"tsne-perp":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(6)},children:"Iterations"})}),Object(x.jsx)(d.x,{placeholder:"500",value:ue.tsne["tsne-iter"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{tsne:Object(l.a)(Object(l.a)({},ue.tsne),{},{"tsne-iter":e})}))}})]})]})]})}),Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"7"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"UMAP"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"15",value:ue.umap["umap-nn"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{umap:Object(l.a)(Object(l.a)({},ue.umap),{},{"umap-nn":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"Minimum distance"})}),Object(x.jsx)(d.x,{placeholder:"0.01",value:ue.umap["umap-min_dist"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{umap:Object(l.a)(Object(l.a)({},ue.umap),{},{"umap-min_dist":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"Epochs"})}),Object(x.jsx)(d.x,{placeholder:"500",value:ue.umap["umap-epoch"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{umap:Object(l.a)(Object(l.a)({},ue.umap),{},{"umap-epoch":e})}))}})]})]})]})})]}),Object(x.jsxs)("div",{className:"row-input-tooltips",children:[!ee&&Object(x.jsxs)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"},children:[Object(x.jsx)("p",{children:"Upload files that in one of these formats;"}),Object(x.jsxs)("ul",{children:[Object(x.jsxs)("li",{children:["Matrix Market - ",Object(x.jsx)("code",{children:"*.mtx"})," or ",Object(x.jsx)("code",{children:"*.mtx.gz"})]}),Object(x.jsxs)("li",{children:["features or genes, ",Object(x.jsx)("code",{children:"*.tsv"})," or ",Object(x.jsx)("code",{children:"*.tsv.gz"})]}),Object(x.jsxs)("li",{children:["HDF5 (10x or h5ad) - ",Object(x.jsx)("code",{children:"*.h5"})," or ",Object(x.jsx)("code",{children:"*.hdf5"})," or ",Object(x.jsx)("code",{children:"*.h5ad"})]})]})]}),1==C&&Object(x.jsx)(d.c,{intent:"primary",children:Object(x.jsxs)("p",{children:["We currently support files in the Cellranger format - namely, a Matrix Market file containing the count matrix. We also recommend supplying the feature annotation (",Object(x.jsx)("code",{children:"features.tsv.gz"})," or ",Object(x.jsx)("code",{children:"genes.tsv.gz"}),"). Users may also provide a TSV file containing the barcode annotations, if any."]})}),2==C&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"At this step, we compute per-cell quality control (QC) metrics such as the total count per cell, the total number of detected features and (if the feature annotation is supplied) the mitochondrial proportion in each cell."}),Object(x.jsx)("p",{children:"We remove low-quality cells based on these metrics - specifically, cells with low total counts/number of detected features or high mitochondrial proportions are filtered out."}),Object(x.jsx)("p",{children:"We use an outlier-based approach to define the filter threshold under the assumption that most cells in the dataset are of acceptable quality."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of MADs"}),": Number of median absolute deviations (MADs) from the median, used to define a filter threshold in the appropriate direction for each QC metric. Increasing this value will reduce the stringency of the filtering."]})]}),3==C&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Identify highly variable genes while accounting for the mean-variance relationship. We do so by fitting a mean-dependent trend to the variances, computed from the log-transformed normalized expression values. The residuals from the trend are then used to rank highly variable genes."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Lowess span"}),": The span of the LOWESS smoother for fitting the mean-variance trend. Larger values increase the smoothness of the global trend at the cost of decreasing sensitivity to local variations."]})]}),4==C&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Perform a principal components analysis (PCA) to obtain per-cell coordinates in a low-dimensional space. This is used to compact the data for faster downstream computation, as well as to remove uninteresting high-dimensional noise."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of HVGs"}),": Number of highly variable genes to use to perform the PCA. Larger values will capture more biological signal at the cost of increasing noise and computational work."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of PCs"}),": Number of principal components with the highest variance to retain in downstream analyses. Larger values will capture more biological signal at the cost of increasing noise and computational work."]})]}),5==C&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Cluster cells into discrete groupings based on their relative similarity in the low-dimensional space. The set of clusters serve as a summary of the cellular heterogeneity in the population, allowing us to easily perform further characterization on subpopulations of interest."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Method"}),": Clustering algorithm to use. Currently, we use multi-level community detection on an shared nearest neighbor (SNN) graph where cells are the nodes and edges are created between neighboring cells."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use to construct the shared nearest neighbor graph. Larger values result in broader clusters."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Use ANN ?"}),": Use an approximate method to speed up the nearest neighbor search. This sacrifices some accuracy for speed in larger datasets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Weighting scheme"}),": Weighting scheme to use for the edges of the shared nearest neighbor graph. The Rank approach derives a weight from the rank of the closest shared neighbor; the Number approach uses the number of shared neighbors; and the Jaccard approach uses the Jaccard index of the neighbor sets."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Resolution"}),": Resolution parameter for the multi-level clustering, used to adjust the modularity calculation during community optimization. Larger values yield more fine-grained clusters."]})]}),6==C&&Object(x.jsxs)(d.c,{intent:"primary",children:[Object(x.jsx)("p",{children:"Create a t-SNE plot to visualize cells in two dimensions, because our feeble human minds cannot interpret high-dimensional spaces. Cells that were neighbors in the original space are kept close together in the 2D embedding, while dissimilar cells are placed (arbitrarily) far away."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Perplexity"}),": Perplexity parameter, which determines the size of the neighborhood of each cell. Larger values will favor preservation of global structure in the 2D embedding."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Iterations"}),": Number of t-SNE iterations. Doesn't usually have much of an effect if you leave it as it is."]})]}),7==C&&Object(x.jsxs)(d.c,{title:"Visually important content",intent:"primary",children:[Object(x.jsx)("p",{children:"Create a UMAP plot to visualize cells in two dimensions. Like the t-SNE, this aims to map cells from a high-dimensional space into a 2D embedding, where neighboring cells are kept close together and dissimilar cells are placed far apart."}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Number of neighbors"}),": Number of neighbors to use when defining the size of the local neighborhood. Larger values will favor preservation of global structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Minimum distance"}),": Minimum distance between points. Smaller values result in more tightly packed embedding and favor local structure."]}),Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Epochs"}),": Number of epochs to use for convergence. This doesn't really change all too much."]})]})]})]})}),Object(x.jsx)(d.F,{id:"load",title:"Load saved analysis",panel:Object(x.jsxs)("div",{className:"inputs-container",children:[Object(x.jsxs)("div",{className:"row-input",children:[Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)(d.G,{animate:!0,renderActiveTabPanelOnly:!0,vertical:!0,onChange:function(e,t){"kana"===e?(K({file:null}),J({file:"Choose kana analysis file"})):"kanadb"===e&&(K({file:null}),te(!0)),B&&he(B),oe(e)},defaultSelectedTabId:re,children:[Object(x.jsx)(d.F,{id:"kana",title:"Load Analysis file",panel:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",children:"Load saved analysis file"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsx)(d.q,{className:"row-input",children:Object(x.jsx)(d.k,{text:Y.file,onInputChange:function(e){J(Object(l.a)(Object(l.a)({},Y),{},{file:e.target.files[0].name})),K(Object(l.a)(Object(l.a)({},U),{},{file:e.target.files}))}})})})]})}),Object(x.jsx)(d.F,{id:"kanadb",title:"Load from database",panel:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"1"}),Object(x.jsx)("span",{className:"row-tooltip",children:"Load analysis file"})]}),P?Object(x.jsx)("div",{className:"row",children:Object(x.jsx)(d.B,{label:"Choose an anlaysis",onChange:function(e){var t;K(Object(l.a)(Object(l.a)({},U),{},{file:null===(t=e.currentTarget)||void 0===t?void 0:t.value})),te(!0)},selectedValue:null===U||void 0===U?void 0:U.file,children:P.map((function(e,t){return Object(x.jsx)(d.A,{style:{display:"flex",flexDirection:"row",alignItems:"center"},label:e,value:e,children:Object(x.jsx)(d.o,{icon:"trash",size:"10",style:{alignSelf:"baseline",paddingTop:"4px",paddingLeft:"5px"},onClick:function(){W(e)}})},t)}))})}):Object(x.jsx)("div",{className:"row",children:Object(x.jsx)(d.q,{children:"No saved analysis found in the browser!!"})})]})})]})}),B&&G==re&&(null===U||void 0===U?void 0:U.file)===(null===A||void 0===A||null===(t=A.files)||void 0===t?void 0:t.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"2"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(2)},children:"Quality control"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(2)},children:"Number of MADs"})}),Object(x.jsx)(d.x,{placeholder:"3",value:ue.qc["qc-nmads"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{qc:Object(l.a)(Object(l.a)({},ue.qc),{},{"qc-nmads":e})}))}})]})})]})}):"",B&&G==re&&(null===U||void 0===U?void 0:U.file)===(null===A||void 0===A||null===(n=A.files)||void 0===n?void 0:n.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"3"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(3)},children:"Feature Selection"})]}),Object(x.jsx)("div",{className:"row",children:Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(3)},children:"Lowess span"})}),Object(x.jsx)(d.x,{placeholder:"0.3",value:ue.fSelection["fsel-span"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{fSelection:Object(l.a)(Object(l.a)({},ue.fSelection),{},{"fsel-span":e})}))}})]})})]})}):"",B&&G==re&&(null===U||void 0===U?void 0:U.file)===(null===A||void 0===A||null===(a=A.files)||void 0===a?void 0:a.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"4"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(4)},children:"Principal components analysis"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(4)},children:"Number of HVGs"})}),Object(x.jsx)(d.x,{placeholder:"2500",value:ue.pca["pca-hvg"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{pca:Object(l.a)(Object(l.a)({},ue.pca),{},{"pca-hvg":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(4)},children:"Number of PCs"})}),Object(x.jsx)(d.x,{placeholder:"25",value:ue.pca["pca-npc"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{pca:Object(l.a)(Object(l.a)({},ue.pca),{},{"pca-npc":e})}))}})]})]})]})}):"",B&&G==re&&(null===U||void 0===U?void 0:U.file)===(null===A||void 0===A||null===(c=A.files)||void 0===c?void 0:c.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"5"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Clustering"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Method"})}),Object(x.jsx)(d.n,{defaultValue:ue.cluster["clus-method"],children:Object(x.jsx)("option",{children:ue.cluster["clus-method"]})})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"10",value:ue.cluster["clus-k"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-k":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Use ANN"})}),Object(x.jsx)(d.E,{style:{marginTop:"10px"},large:!0,checked:ue.cluster["clus-approx"],innerLabelChecked:"true",innerLabel:"false",onChange:function(e){he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-approx":e.target.checked})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Weighting scheme"})}),Object(x.jsxs)(d.n,{onChange:function(e,t){var n;return he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-scheme":parseInt(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)})}))},children:[Object(x.jsx)("option",{children:"Rank"},"0"),Object(x.jsx)("option",{children:"Number"},"1"),Object(x.jsx)("option",{children:"Jaccard"},"2")]})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(5)},children:"Resolution"})}),Object(x.jsx)(d.x,{placeholder:"0.5",value:ue.cluster["clus-res"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{cluster:Object(l.a)(Object(l.a)({},ue.cluster),{},{"clus-res":e})}))}})]})]})]})}):"",B&&G==re&&(null===U||void 0===U?void 0:U.file)===(null===A||void 0===A||null===(i=A.files)||void 0===i?void 0:i.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"6"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(6)},children:"t-SNE"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(6)},children:"Perplexity"})}),Object(x.jsx)(d.x,{placeholder:"30",value:ue.tsne["tsne-perp"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{tsne:Object(l.a)(Object(l.a)({},ue.tsne),{},{"tsne-perp":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(6)},children:"Iterations"})}),Object(x.jsx)(d.x,{placeholder:"500",value:ue.tsne["tsne-iter"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{tsne:Object(l.a)(Object(l.a)({},ue.tsne),{},{"tsne-iter":e})}))}})]})]})]})}):"",B&&G==re&&(null===U||void 0===U?void 0:U.file)===(null===A||void 0===A||null===(r=A.files)||void 0===r?void 0:r.file)?Object(x.jsx)("div",{className:"col",children:Object(x.jsxs)("div",{children:[Object(x.jsxs)(d.m,{children:[Object(x.jsx)(d.H,{round:!0,children:"7"}),Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"UMAP"})]}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"Number of neighbors"})}),Object(x.jsx)(d.x,{placeholder:"15",value:ue.umap["umap-nn"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{umap:Object(l.a)(Object(l.a)({},ue.umap),{},{"umap-nn":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"Minimum distance"})}),Object(x.jsx)(d.x,{placeholder:"0.01",value:ue.umap["umap-min_dist"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{umap:Object(l.a)(Object(l.a)({},ue.umap),{},{"umap-min_dist":e})}))}})]}),Object(x.jsxs)(d.q,{className:"row-input",children:[Object(x.jsx)(d.I,{className:"text-100",children:Object(x.jsx)("span",{className:"row-tooltip",onMouseEnter:function(){return k(7)},children:"Epochs"})}),Object(x.jsx)(d.x,{placeholder:"500",value:ue.umap["umap-epoch"],onValueChange:function(e,t){he(Object(l.a)(Object(l.a)({},ue),{},{umap:Object(l.a)(Object(l.a)({},ue.umap),{},{"umap-epoch":e})}))}})]})]})]})}):""]}),Object(x.jsxs)("div",{className:"row-input-tooltips",children:[!ee&&Object(x.jsx)(d.c,{intent:"danger",title:"Incorrect file format",style:{marginBottom:"10px"}}),Object(x.jsxs)(d.c,{intent:"primary",children:["Import a saved analysis from ",Object(x.jsx)("strong",{children:"kana"}),". These files are gzipped and are stored as ",Object(x.jsx)("strong",{children:Object(x.jsx)("code",{children:"*.kana.gz"})}),"."]})]})]})})]})}),h?Object(x.jsx)("div",{className:O.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:O.a.DIALOG_FOOTER_ACTIONS,children:Object(x.jsx)(u.a,{content:"Run Analysis",children:Object(x.jsx)(d.a,{disabled:!ee,icon:"function",onClick:function(){var e,t,n;T(ue),"load"==R&&V("kanadb"===re?null===U||void 0===U?void 0:U.file:null===U||void 0===U||null===(t=U.file)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.name.split(".")[0]),M({format:"new"==R?ae:re,files:U,reset:"new"!=R&&(null===U||void 0===U?void 0:U.file)!==(null===A||void 0===A||null===(e=A.files)||void 0===e?void 0:e.file)}),_("new"==R?ae:re),E()},children:"Analyze"})})})}):Object(x.jsx)("div",{style:{margin:"0 20px"}})]}))]})},F=function(){var e=Object(s.useContext)(f),t=e.initDims,n=e.qcDims;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("span",{children:[": ",t?"".concat(t):" ???",n?" (after QC: ".concat(n,")"):""]})})},N=function(){var e=Object(s.useContext)(f).logs,t=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,hasBackdrop:!0,isOpen:!1,position:p.a.RIGHT,size:void 0,usePortal:!0}),n=Object(o.a)(t,2),a=n[0],c=n[1];return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.a,{onClick:function(){return c({isOpen:!0})},icon:"wrench",outlined:!0,intent:"warning"}),Object(x.jsx)(d.i,Object(l.a)(Object(l.a)({icon:"info-sign",onClose:function(){return c({isOpen:!1})},title:"What's happening ?"},a),{},{children:Object(x.jsx)("div",{className:O.a.DRAWER_BODY,children:Object(x.jsx)("div",{className:O.a.DIALOG_BODY,children:Object(x.jsx)("ul",{className:"list",children:e.map((function(e,t){return Object(x.jsx)("li",{children:e},t)}))})})})}))]})},C=n(34),k=["buttonText","includeFooter"];var S=function(e){e.buttonText,e.includeFooter;var t=Object(b.a)(e,k),n=Object(s.useContext)(f).setOpenInput,a=Object(s.useState)(!0),c=Object(o.a)(a,2),i=c[0],r=c[1],j=Object(s.useState)(!1),h=Object(o.a)(j,2),p=h[0],m=h[1],v=Object(s.useCallback)((function(){r(!i),m(!0)}),[i]),g=Object(s.useCallback)((function(){return r(!1)}),[]);return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.a,{onClick:v,icon:"info-sign",intent:"primary",text:""}),Object(x.jsxs)(d.g,Object(l.a)(Object(l.a)({},t),{},{isOpen:i,onClose:g,children:[Object(x.jsx)("div",{className:O.a.DIALOG_BODY,children:Object(x.jsxs)(d.d,{elevation:C.a.ZERO,children:[Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"kana"})," performs a standard scRNA-seq data analysis directly inside the browser."]}),Object(x.jsxs)("p",{children:["With just a few clicks, you can get a UMAP/t-SNE and marker genes in an intuitive interface for further exploration. No need to transfer data, no need to install software, no need to configure a backend server - just point to a Matrix Market file and we'll analyze ",Object(x.jsx)("em",{children:"your"})," data on ",Object(x.jsx)("em",{children:"your"})," computer, no questions asked."]}),Object(x.jsxs)("p",{children:["Check out our ",Object(x.jsx)("a",{href:"https://github.com/jkanche/scran.js.app",target:"_blank",children:"GitHub page"})," for more details. Or you could just play around with the app to see what it can do - after all, it's totally free!"]}),Object(x.jsx)(d.m,{children:"Authors"}),"Jayaram Kancherla (",Object(x.jsx)("a",{href:"https://github.com/jkanche",target:"_blank",children:Object(x.jsx)("strong",{children:"@jkanche"})}),"), Aaron Lun (",Object(x.jsx)("a",{href:"https://github.com/LTLA",target:"_blank",children:Object(x.jsx)("strong",{children:"@LTLA"})}),")"]})}),Object(x.jsx)("div",{className:O.a.DIALOG_FOOTER,children:Object(x.jsx)("div",{className:O.a.DIALOG_FOOTER_ACTIONS,children:p?Object(x.jsx)(d.a,{icon:"cross",onClick:g,children:"Close"}):Object(x.jsx)(u.a,{content:"\u884c\u304f\u305e!",children:Object(x.jsx)(d.a,{icon:"bring-data",onClick:function(){n(!0),g()},children:"Get started"})})})})]}))]})},E=function(){var e=Object(s.useState)({autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!1,enforceFocus:!0,shouldReturnFocusOnClose:!0}),t=Object(o.a)(e,1)[0],n=Object(s.useContext)(f),a=n.setExportState,c=n.datasetName,i=n.setDatasetName,r=n.setIndexedDBState;return Object(x.jsx)(x.Fragment,{children:Object(x.jsx)(d.t,{className:"bp3-dark",children:Object(x.jsxs)(d.v,{className:"navbar-group",align:j.a.LEFT,children:[Object(x.jsx)(d.w,{children:"kana"}),Object(x.jsx)(d.u,{}),Object(x.jsx)("span",{children:"Single cell RNA-seq analysis in the browser"}),Object(x.jsx)(d.u,{}),Object(x.jsx)(w,Object(l.a)({icon:"document",title:"Import dataset & update parameters (mouseover for info)",buttonText:"Start Analysis",includeFooter:!0},t)),Object(x.jsx)(d.u,{}),Object(x.jsx)(u.a,{content:"Modify dataset title",children:Object(x.jsx)(d.j,{value:c,intent:"primary",onConfirm:function(e){i(e)}})}),Object(x.jsx)(F,{}),Object(x.jsx)(d.u,{}),Object(x.jsx)(d.b,{children:Object(x.jsx)(h.a,{content:Object(x.jsxs)(d.r,{children:[Object(x.jsx)(d.s,{text:"Save",icon:"floppy-disk",onClick:function(){r(!0)}}),Object(x.jsx)(d.s,{text:"Download",icon:"download",onClick:function(){a(!0)}})]}),placement:"bottom-start",children:Object(x.jsx)(d.a,{intent:"warning",rightIcon:"caret-down",text:"Export"})})}),Object(x.jsx)(d.u,{}),Object(x.jsx)(N,{}),Object(x.jsx)(d.u,{}),Object(x.jsx)(S,Object(l.a)({icon:"document",title:"Single-cell RNA-seq analysis in the browser",isOpen:!0},t))]})})})},D=a.a.memo(E),A=n(11),M=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.ymax;if(c||(c=Math.max.apply(Math,Object(r.a)(n.map((function(e){return e.value}))))),s||(s=325),a||(a="#00B3A4"),!n)return"";var i=t.current;i.innerHTML="";var l=10,o=30,d=30,j=40,u=s-j-o,h=200-l-d,b=A.o(i).append("svg").attr("width",u+j+o).attr("height",h+l+d).append("g").attr("transform","translate(".concat(j,",").concat(l,")")),O=A.l().range([0,u]).domain(n.map((function(e){return e.key}))).padding(.2);b.append("g").attr("transform","translate(0,"+h+")").call(A.b(O)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var p=A.m().domain([0,c]).range([h,0]);b.append("g").call(A.c(p)),b.selectAll("bars").data(n).enter().append("rect").attr("x",(function(e){return O(e.key)})).attr("y",(function(e){return p(e.value)})).attr("width",O.bandwidth()).attr("height",(function(e){return h-p(e.value)})).attr("fill",(function(e,t){return Array.isArray(a)?a[t]:a}))}),[]),Object(x.jsx)("div",{ref:t})},I=a.a.memo(M),T=function(e){var t,n,s=null===e||void 0===e||null===(t=e.pca)||void 0===t?void 0:t.var_exp;if(!s)return"";var a=[];return null===(n=Object.values(s))||void 0===n||n.forEach((function(e,t){a.push({key:t+1,value:100*e})})),Object(x.jsx)(I,{data:a})},L=a.a.memo(T),R=n(63),q=function(e){var t,n,a=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.clusters,c=Object(s.useContext)(f),i=c.clusterColors,l=c.setClusterColors;Object(s.useEffect)((function(){var e=Math.max.apply(Math,Object(r.a)(a))+1,t=null;t=e>Object.keys(o).length?Object(R.randomColor)({luminosity:"dark",count:e+1}):o[e.toString()],l(t)}),[]);for(var o={1:["#1b9e77"],2:["#1b9e77","#d95f02"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},d={},j=0;j<(null===a||void 0===a?void 0:a.length);j++){var u=a[j];"CLUS_"+u in d?d["CLUS_"+u]++:d["CLUS_"+u]=0}var h=[];return null===(n=Object.values(d))||void 0===n||n.forEach((function(e,t){h.push({key:t+1,value:e})})),i&&Object(x.jsx)(I,{data:h,color:i})},B=a.a.memo(q),P=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.rdata,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color;if(s||(s=200),a||(a="#00B3A4"),!n)return"";var c=t.current;c.innerHTML="";var i=10,l=30,r=30,o=40,d=s-o-l,j=200-i-r,u=A.o(c).append("svg").attr("width",d+o+l).attr("height",j+i+r).append("g").attr("transform","translate(".concat(o,",").concat(i,")")),h=A.m().domain(null===e||void 0===e?void 0:e.range).range([j,0]).nice();u.append("g").call(A.c(h).tickFormat((function(t){return"log"===(null===e||void 0===e?void 0:e.transform)?A.g(".2s")(Math.pow(2,t)):A.g(".2s")(100*t)})));var b=A.l().range([0,d]).domain([null===e||void 0===e?void 0:e.showLabel]).padding(.05);u.append("g").attr("transform","translate(0,"+j+")").call(A.b(b));var O=A.d().domain(h.domain()).thresholds(h.ticks(10)).value((function(e){return e}))(n),p=A.k(O,(function(e){return e.length})),m=A.m().range([0,b.bandwidth()]).domain([-1,1]);u.selectAll("violins").data([null===e||void 0===e?void 0:e.label]).enter().append("g").attr("transform",(function(e){return"translate("+b(e)+" ,0)"})).append("path").datum((function(){return O})).style("stroke","none").style("fill",a).attr("d",A.a().x0((function(e){return m(-e.length/p)})).x1((function(e){return m(e.length/p)})).y((function(e){return h(e.x0)})).curve(A.e)),u.selectAll("threshold").data([null===e||void 0===e?void 0:e.threshold]).enter().append("line").attr("transform",(function(){return"translate("+b(null===e||void 0===e?void 0:e.label)+" ,0)"})).attr("class","threshold").attr("x1",5).attr("y1",(function(e){return h(e)})).attr("x2",b.bandwidth()-5).attr("y2",(function(e){return h(e)})).attr("stroke-width",2).attr("stroke","Orange").on("mouseover",(function(){var e=A.o(this);e.attr("stroke","black"),e.attr("stroke-width","8")})).on("mouseout",(function(){var e=A.o(this);e.attr("stroke","Orange"),e.attr("stroke-width","5")}))}),[]),Object(x.jsx)("div",{ref:t})},_=a.a.memo(P),G=(n(311),function(e){var t=e.data;return Object(x.jsx)("div",{className:"qc-plots",children:["sums","detected","proportion"].map((function(e){var n,s,a,c,i,r,o={threshold:"proportion"!==e?Math.log2(null===t||void 0===t||null===(n=t.thresholds)||void 0===n?void 0:n[e]):100*(null===t||void 0===t||null===(s=t.thresholds)||void 0===s?void 0:s[e]),range:"proportion"!==e?null===t||void 0===t||null===(a=t.ranges)||void 0===a?void 0:a[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(c=t.ranges)||void 0===c?void 0:c[e].map((function(e){return 100*e})),label:e,transform:"proportion"!==e?"log":"perc",showLabel:e,rdata:"proportion"!==e?null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i[e].map((function(e){return Math.log2(e+1)})):null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r[e].map((function(e){return 100*e}))};return Object(x.jsx)("div",{children:Object(x.jsx)(_,Object(l.a)({},o))},e)}))})}),W=a.a.memo(G),V=(n(312),n(313),function(e){var t=Object(s.useRef)(),n=Object(s.useState)(null),a=Object(o.a)(n,2),c=a[0],i=a[1],l=Object(s.useContext)(f),r=l.genesInfo,j=l.selectedClusterSummary,u=l.geneColSel,h=null===e||void 0===e?void 0:e.data,b=null===e||void 0===e?void 0:e.width,O=null===e||void 0===e?void 0:e.height,p=null===e||void 0===e?void 0:e.color;return b||(b=325),O||(O=200),p||(p="#00B3A4"),Object(s.useEffect)((function(){var e=t.current;if(e){var n,s,a;if(null===h||void 0===h?void 0:h.image){var c=e.getContext("2d"),l=new Image;l.onload=function(){c.drawImage(l,0,0,b,O)},l.src=null===h||void 0===h?void 0:h.image}var o,d,p,m=" ".concat(null===h||void 0===h||null===(n=h.config)||void 0===n?void 0:n.embedding," ");if(null===h||void 0===h||null===(s=h.config)||void 0===s?void 0:s.gene)m+="\u2283 ".concat(r[u][null===j||void 0===j||null===(o=j[null===h||void 0===h||null===(d=h.config)||void 0===d?void 0:d.gene])||void 0===o?void 0:o.row]," ");if(null===h||void 0===h||null===(a=h.config)||void 0===a?void 0:a.highlight)m+="\u2283 Cluster ".concat(parseInt((null===h||void 0===h||null===(p=h.config)||void 0===p?void 0:p.highlight)+1)," ");i(m)}}),[]),Object(x.jsxs)("div",{className:"imgplot-container",children:[Object(x.jsx)("h5",{children:c}),Object(x.jsx)(d.a,{small:!0,className:"imgplot-save",icon:"download",onClick:function(){var e=document.createElement("a");e.href=null===h||void 0===h?void 0:h.image,e.download="".concat(c.replace("\u2283","").split(" ").join("_"),".png"),e.click()},children:"Save"}),Object(x.jsx)("canvas",{className:"imgplot-canvas",width:b,height:O,ref:t})]})}),z=function(){var e=Object(s.useContext)(f),t=e.pcaVarExp,n=e.qcData,a=e.clusterData,c=e.savedPlot;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("div",{className:"gallery-cont",children:[n&&(null===n||void 0===n?void 0:n.thresholds)?Object(x.jsxs)(d.d,{className:"gallery-elem",elevation:C.a.ONE,children:[Object(x.jsx)("h5",{children:"QC Statistics"}),Object(x.jsx)(W,{data:n})]}):"",t?Object(x.jsxs)(d.d,{className:"gallery-elem",elevation:C.a.ONE,children:[Object(x.jsx)("h5",{children:"PCA (% variance explained)"}),Object(x.jsx)(L,{pca:t})]}):"",a?Object(x.jsxs)(d.d,{className:"gallery-elem",elevation:C.a.ONE,children:[Object(x.jsx)("h5",{children:"# of cells per cluster"}),Object(x.jsx)(B,{data:a})]}):"",c?c.map((function(e,t){return Object(x.jsx)(d.d,{className:"gallery-elem",elevation:C.a.ONE,children:Object(x.jsx)(V,{data:e})},t)})):""]})})},H=a.a.memo(z),U=n(78),K=function(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE;return e.forEach((function(e){t<e&&(t=e),n>e&&(n=e)})),[n,t]};function Q(){var e=null,t=0,n=100,s=["ff0000","ffff00","00ff00","0000ff"];function a(a){if(a.length<2)throw new Error("Rainbow must have two or more colours.");var c=(n-t)/(a.length-1),i=new X;i.setGradient(a[0],a[1]),i.setNumberRange(t,t+c),e=[i];for(var l=1;l<a.length-1;l++){var r=new X;r.setGradient(a[l],a[l+1]),r.setNumberRange(t+c*l,t+c*(l+1)),e[l]=r}s=a}a(s),this.setSpectrum=function(){return a(arguments),this},this.setSpectrumByArray=function(e){return a(e),this},this.colourAt=function(s){if(isNaN(s))throw new TypeError(s+" is not a number");if(1===e.length)return e[0].colourAt(s);var a=(n-t)/e.length,c=Math.min(Math.floor((Math.max(s,t)-t)/a),e.length-1);return e[c].colourAt(s)},this.colorAt=this.colourAt,this.setNumberRange=function(e,c){if(!(c>e))throw new RangeError("maxNumber ("+c+") is not greater than minNumber ("+e+")");return t=e,n=c,a(s),this}}function X(){var e="ff0000",t="0000ff",n=0,s=100;function a(e,t,a){var c=e;c<n&&(c=n),c>s&&(c=s);var i,l=s-n,r=parseInt(t,16),o=(parseInt(a,16)-r)/l,d=Math.round(o*(c-n)+r);return 1===(i=d.toString(16)).length?"0"+i:i}function c(e){if(function(e){return/^#?[0-9a-fA-F]{6}$/i.test(e)}(e))return e.substring(e.length-6,e.length);var t=e.toLowerCase();if(i.hasOwnProperty(t))return i[t];throw new Error(e+" is not a valid colour.")}this.setGradient=function(n,s){e=c(n),t=c(s)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,s=t},this.colourAt=function(n){return a(n,e.substring(0,2),t.substring(0,2))+a(n,e.substring(2,4),t.substring(2,4))+a(n,e.substring(4,6),t.substring(4,6))};var i={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}n(325);var Y=function(){var e,t,n=Object(s.useRef)(),a=Object(s.useState)(null),c=Object(o.a)(a,2),i=c[0],j=c[1],h=Object(s.useState)(null),b=Object(o.a)(h,2),O=b[0],p=b[1],m=Object(s.useState)(!1),v=Object(o.a)(m,2),g=v[0],y=v[1],w=Object(s.useState)(null),F=Object(o.a)(w,2),N=F[0],C=F[1],k=Object(s.useState)(N),S=Object(o.a)(k,2),E=S[0],D=S[1],A=Object(s.useState)(null),M=Object(o.a)(A,2),I=M[0],T=M[1],L=Object(s.useState)(!0),q=Object(o.a)(L,2),B=q[0],P=q[1],_=Object(s.useContext)(f),G=(_.plotRedDims,_.redDims),W=_.defaultRedDims,V=_.setDefaultRedDims,z=_.clusterData,H=_.tsneData,X=_.umapData,Y=(_.setPlotRedDims,_.clusterColors),J=_.setClusterColors,Z=_.gene,$=_.selectedClusterSummary,ee=_.customSelection,te=_.setCustomSelection,ne=_.setDelCustomSelection,se=_.showAnimation,ae=_.setTriggerAnimation,ce=_.savedPlot,ie=_.setSavedPlot,le=_.selectedCluster,re=Object(s.useState)(null),oe=Object(o.a)(re,2),de=oe[0],je=oe[1],ue=Object(s.useState)("PAN"),he=Object(o.a)(ue,2),be=he[0],Oe=he[1],pe=Math.max.apply(Math,Object(r.a)(null===z||void 0===z?void 0:z.clusters));Object(s.useEffect)((function(){var e;if(null===Z&&(y(!1),T(null)),null===$||void 0===$||null===(e=$[Z])||void 0===e?void 0:e.expr){var t,n=K(null===$||void 0===$||null===(t=$[Z])||void 0===t?void 0:t.expr),s=0===n[1]?.01:n[1],a=new Q;a.setSpectrum("#F5F8FA","#2965CC"),a.setNumberRange(0,s),y(!0),T(a),D([0,s]),C([0,s])}}),[null===$||void 0===$||null===(e=$[Z])||void 0===e?void 0:e.expr],Z),Object(s.useEffect)((function(){if(Array.isArray(E)){var e=new Q;e.setSpectrum("#F5F8FA","#2965CC"),e.setNumberRange.apply(e,Object(r.a)(E)),T(e),y(!0)}}),[E]),Object(s.useEffect)((function(){if(n.current){var e=i;if(!e){var t=n.current;t.style.width="95%",t.style.height="95%",e=new U.ScatterGL(t,{onSelect:function(e){0!==e.length&&je(e)},orbitControls:{zoomSpeed:1.25},styles:{point:{scaleDefault:1,scaleSelected:1.25,scaleHover:1.25}}}),e.setPanMode(),j(e)}var s=null;if("TSNE"===W?s=H:"UMAP"===W&&(s=X),s){var a=null===z||void 0===z?void 0:z.clusters,c=Y,l=[];s.x.forEach((function(e,t){l.push([e,s.y[t]])}));var r={clusters:a},o=new U.ScatterGL.Dataset(l,r);B?(e.render(o),P(!1)):e.updateDataset(o),e.setPointColorer((function(e,t,n){var s,i,l;if(t.has(e))return"#30404D";if(null!=O)if(String(O).startsWith("cs")){if(!ee[O].includes(e))return"#D3D3D3"}else if(O!==a[e])return"#D3D3D3";if(null!==Z&&Array.isArray(null===$||void 0===$||null===(s=$[Z])||void 0===s?void 0:s.expr))return"#"+I.colorAt(null===$||void 0===$||null===(i=$[Z])||void 0===i||null===(l=i.expr)||void 0===l?void 0:l[e]);if(null!=O&&String(O).startsWith("cs")){var r=parseInt(O.replace("cs",""));return c[pe+r]}return c[a[e]]}))}}}),[H,X,W,I,O]);var me=function(e){"SELECT"===e?(i.setSelectMode(),Oe("SELECT")):(i.setPanMode(),Oe("PAN"))};return Object(x.jsxs)("div",{className:"scatter-plot",children:[Object(x.jsxs)(d.b,{style:{minWidth:75,minHeight:150},fill:!1,large:!1,minimal:!1,vertical:!0,className:"left-sidebar",children:[Object(x.jsxs)(d.a,{className:"dim-button",disabled:-1===G.indexOf("TSNE"),onClick:function(){return V("TSNE")},intent:"TSNE"===W?"primary":"",children:[Object(x.jsx)(d.o,{icon:"heatmap"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"TSNE"})]}),Object(x.jsxs)(d.a,{className:"dim-button",disabled:-1===G.indexOf("UMAP"),onClick:function(){return V("UMAP")},intent:"UMAP"===W?"primary":"",children:[Object(x.jsx)(d.o,{icon:"heatmap"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"UMAP"})]}),Object(x.jsxs)(d.a,{className:"dim-button",disabled:!0,children:[Object(x.jsx)(d.o,{icon:"heat-grid"}),Object(x.jsx)("br",{}),Object(x.jsx)("span",{children:"HEATMAP (coming soon)"})]})]}),Object(x.jsxs)("div",{className:"top-header",children:[Object(x.jsxs)(d.f,{fill:!1,vertical:!1,style:{marginRight:"4px"},children:[Object(x.jsx)(u.a,{content:"Interactively visualize embeddings",children:Object(x.jsx)(d.a,{icon:"play",onClick:function(){return ae(!0)},children:"Animate"})}),Object(x.jsx)(u.a,{content:"Save this embedding",children:Object(x.jsx)(d.a,{icon:"inheritance",onClick:function(){if(console.log("handleSaveEmbedding"),n.current){i.renderScatterPlot();var e=i.scatterPlot.renderer.domElement.toDataURL(),t=Object(r.a)(ce);t.push({image:e,config:{cluster:le,gene:Z,highlight:O,embedding:W}}),ie(t)}},children:"Save"})})]}),Object(x.jsxs)(d.f,{fill:!1,vertical:!1,children:[Object(x.jsx)(d.a,{active:"PAN"==be,intent:"PAN"===be?"primary":"none",icon:"hand-up",onClick:function(e){return me("PAN")},children:"Pan"}),Object(x.jsx)(d.a,{active:"SELECT"==be,intent:"SELECT"===be?"primary":"none",icon:"widget",onClick:function(e){return me("SELECT")},children:"Selection"})]})]}),se?Object(x.jsxs)(d.q,{className:"iter",children:["Iteration: ","TSNE"===W?null===H||void 0===H?void 0:H.iteration:null===X||void 0===X?void 0:X.iteration]}):"",Object(x.jsx)("div",{className:"dim-plot",children:W?Object(x.jsx)("div",{ref:n}):"Choose an Embedding... or Embeddings are being computed..."}),Object(x.jsx)("div",{className:"right-sidebar",children:Object(x.jsxs)("div",{style:{width:"100%"},children:[Object(x.jsxs)("div",{className:"right-sidebar-cluster",children:[Object(x.jsxs)(d.c,{title:"CLUSTERS",children:[Object(x.jsx)("ul",{children:null===Y||void 0===Y?void 0:Y.map((function(e,t){return t<Y.length-Object.keys(ee).length?Object(x.jsxs)("li",{className:O==t?"legend-highlight":"",style:{color:e},onClick:function(){p(t===O?null:t)},children:[" Cluster ",t+1," "]},t):""}))}),Object.keys(ee).length>0?Object(x.jsxs)("div",{style:{paddingTop:"5px"},children:[Object(x.jsxs)("span",{children:["Custom Selection \xa0",Object(x.jsx)(u.a,{content:"Custom selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{icon:"help"})})]}),Object(x.jsx)("ul",{children:null===(t=Object.keys(ee))||void 0===t?void 0:t.map((function(e,t){return Object(x.jsx)("li",{className:O==e?"legend-highlight":"",style:{color:Y[Math.max.apply(Math,Object(r.a)(null===z||void 0===z?void 0:z.clusters))+1+t]},children:Object(x.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",flexDirection:"row"},children:[Object(x.jsxs)("span",{style:{alignSelf:"center"},onClick:function(){p(e===O?null:e)},children:["Custom Selection ",e.replace("cs","")]}),Object(x.jsx)(d.o,{size:12,icon:"trash",style:{paddingLeft:"2px"},onClick:function(){var t=Object(l.a)({},ee);delete t[e],te(t);var n=Object(r.a)(Y);n=n.slice(0,n.length-1),J(n),ne(e),O===e&&p(null)}})]})},e)}))})]}):""]}),de&&de.length>0?Object(x.jsxs)("div",{children:[Object(x.jsx)(d.h,{}),Object(x.jsxs)("span",{children:["Selection \xa0",Object(x.jsx)(u.a,{content:"save this selection of cells",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"selection-container",children:[Object(x.jsxs)("span",{children:[de.length," cells selected"]}),Object(x.jsxs)("div",{className:"selection-button-container",children:[Object(x.jsx)(d.a,{small:!0,intent:"primary",onClick:function(){var e=Object(R.randomColor)({luminosity:"dark",count:1}),t=Object(r.a)(Y);t.push(e[0]),J(t);var n=Object.keys(ee).length,s=Object(l.a)({},ee);s["cs".concat(n+1)]=de,te(s),je(null),i.select(null)},children:"Save"}),Object(x.jsx)(d.a,{small:!0,onClick:function(){je(null),i.select(null)},children:"Clear"})]})]})]}):""]}),g?Object(x.jsxs)("div",{className:"right-sidebar-slider",children:[Object(x.jsx)(d.h,{}),Object(x.jsxs)(d.c,{children:[Object(x.jsxs)("span",{children:["Customize Gradient \xa0",Object(x.jsx)(u.a,{content:"Use the slider to adjust the color gradient of the plot. Useful when data is skewed by either a few lowly or highly expressed cells",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{icon:"help"})})]}),Object(x.jsxs)("div",{className:"dim-slider-container",children:[Object(x.jsxs)("div",{className:"dim-slider-gradient",children:[Object(x.jsx)("span",{children:Math.round(N[0])}),"\xa0",Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA ".concat(100*(E[0]-N[0])/(N[1]-N[0]),"%, ").concat(100*(E[1]+E[0]-2*N[0])/(2*(N[1]-N[0])),"%, #2965CC ").concat(100-100*(N[1]-E[1])/(N[1]-N[0]),"%)"),width:"175px",height:"15px"}}),"\xa0",Object(x.jsx)("span",{children:Math.round(N[1])})]}),Object(x.jsx)("div",{className:"dim-range-slider",children:Object(x.jsx)(d.C,{min:Math.round(N[0]),max:Math.round(N[1]),stepSize:Math.round(N[1]-N[0])/25,onChange:function(e){D(e)},value:[Math.round(E[0]),Math.round(E[1])],vertical:!1})})]})]})]}):""]})})]})},J=a.a.memo(Y),Z=n(135),$=function(e){var t=Object(s.useRef)();return Object(s.useEffect)((function(){var n=null===e||void 0===e?void 0:e.data,s=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.color,c=null===e||void 0===e?void 0:e.clusters,i=null===e||void 0===e?void 0:e.clusterlabel;if(s||(s=325),a||(a="#00B3A4"),!n)return"";var l=t.current;l.innerHTML="";var r=10,o=30,d=30,j=40,u=s-j-o,h=150-r-d,b=A.o(l).append("svg").attr("width",u+j+o).attr("height",h+r+d).append("g").attr("transform","translate(".concat(j,",").concat(r,")")),O=A.m().domain(A.f(n)).range([0,u]);b.append("g").attr("transform","translate(0, ".concat(h/2,")")).call(A.b(O).ticks(5).tickValues(A.f(n)));var p=A.d().value((function(e){return e})).domain(O.domain()).thresholds(A.p),m=(p(n),p(n.filter((function(e,t){return 0===(null===c||void 0===c?void 0:c[t])})))),x=p(n.filter((function(e,t){return 1===(null===c||void 0===c?void 0:c[t])}))),f=A.k(m,(function(e){return e.length})),v=A.k(x,(function(e){return e.length})),g=A.m().range([h,0]).domain([-1,1]);b.selectAll("rectAll").data(m).join("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0)," , ").concat(g(0),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return g(-e.length/f)-h/2})).style("fill","#D3D3D3").style("opacity",.6),b.selectAll("rectCluster").data(x).enter().append("rect").attr("x",1).attr("transform",(function(e){return"translate(".concat(O(e.x0),", ").concat(g(e.length/v),")")})).attr("width",(function(e){return O(e.x1)-O(e.x0)-1})).attr("height",(function(e){return h/2-g(e.length/v)})).style("fill",a).style("opacity",.6),b.append("text").attr("x",u-20).attr("y",g(-.5)).text("other cells").style("font-size","10px").attr("alignment-baseline","middle"),b.append("text").attr("x",u-20).attr("y",g(.5)).text(i).style("font-size","10px").attr("alignment-baseline","middle").style("fill",a)}),[]),Object(x.jsx)("div",{ref:t})},ee=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.minmax,c=null===e||void 0===e?void 0:e.score,i=null===e||void 0===e?void 0:e.colorscale,l=null===e||void 0===e?void 0:e.colorscore,r=null===e||void 0===e?void 0:e.color,o=(c-a[0])/(a[1]-a[0]);return n||(n="100%"),r||(r="#00B3A4"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center"},children:i?Object(x.jsx)("div",{style:{width:"".concat(100*l,"%"),backgroundColor:i(l),height:"100%"}}):Object(x.jsx)("div",{style:{width:"".concat(100*o,"%"),backgroundColor:r,height:"100%"}})})},te=function(e){var t=Object(s.useRef)(),n=null===e||void 0===e?void 0:e.width,a=null===e||void 0===e?void 0:e.score,c=null===e||void 0===e?void 0:e.minmax,i=A.n(A.j).domain([c[1],c[0]]);return n||(n="100%"),Object(x.jsx)("div",{ref:t,style:{width:n,height:"15px",margin:"5px",border:"1px solid gainsboro",alignItems:"center",backgroundColor:i(a)},children:Object(x.jsx)("div",{style:{width:"100%",backgroundColor:i(a),height:"100%"}})})},ne=(n(326),["children"]),se=function(){var e=Object(s.useContext)(f),t=e.genesInfo,n=e.clusterData,a=e.selectedClusterSummary,c=e.setSelectedClusterSummary,i=e.selectedCluster,j=e.setSelectedCluster,p=e.setClusterRank,m=e.setReqGene,v=e.clusterColors,g=e.gene,y=e.setGene,w=e.customSelection,F=e.geneColSel,N=e.setGeneColSel,k=Object(s.useState)(null),S=Object(o.a)(k,2),E=S[0],D=S[1],M=Object(s.useState)(null),I=Object(o.a)(M,2),T=I[0],L=I[1],R=Object(s.useState)(null),q=Object(o.a)(R,2),B=q[0],P=q[1],_=Object(s.useState)(null),G=Object(o.a)(_,2),W=G[0],V=G[1],z=Object(s.useState)(null),H=Object(o.a)(z,2),U=H[0],K=H[1],Q=Object(s.useState)(null),X=Object(o.a)(Q,2),Y=X[0],J=X[1],se=Object(s.useState)(null),ae=Object(o.a)(se,2),ce=ae[0],ie=ae[1],le=Object(s.useState)(null),re=Object(o.a)(le,2),oe=re[0],de=re[1],je=Object(s.useState)(null),ue=Object(o.a)(je,2),he=(ue[0],ue[1]),be=Object(s.useState)(null),Oe=Object(o.a)(be,2),pe=(Oe[0],Oe[1]),me=Object(s.useState)(null),xe=Object(o.a)(me,2),fe=(xe[0],xe[1]),ve=Object(s.useState)(null),ge=Object(o.a)(ve,2),ye=(ge[0],ge[1]),we=Object(s.useState)({}),Fe=Object(o.a)(we,2),Ne=Fe[0],Ce=Fe[1],ke=Object(s.useState)(null),Se=Object(o.a)(ke,2),Ee=Se[0],De=Se[1],Ae=A.j;Object(s.useEffect)((function(){if(!a)return a;var e=a;if(0===e.length)return e;var t=e.map((function(e){return null===e||void 0===e?void 0:e.mean})),n=A.f(t),s=0===n[1]?.01:n[1];V([parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))]),he(t);var c=e.map((function(e){return null===e||void 0===e?void 0:e.delta})),i=A.f(c),l=0===i[1]?.01:i[1];K([parseFloat(i[0].toFixed(2)),parseFloat(l.toFixed(2))]),pe(c);var o=e.map((function(e){return null===e||void 0===e?void 0:e.lfc})),d=A.f(o),j=0===d[1]?.01:d[1];J([parseFloat(d[0].toFixed(2)),parseFloat(j.toFixed(2))]),fe(o);var u=e.map((function(e){return null===e||void 0===e?void 0:e.detected})),h=A.f(u),b=0===h[1]?.01:h[1];ie([parseFloat(h[0].toFixed(2)),parseFloat(b.toFixed(2))]),ye(u),de({lfc:[parseFloat(d[0].toFixed(2)),parseFloat(j.toFixed(2))],mean:[parseFloat(n[0].toFixed(2)),parseFloat(s.toFixed(2))],detected:[parseFloat(h[0].toFixed(2)),parseFloat(b.toFixed(2))],delta:[parseFloat(i[0].toFixed(2)),parseFloat(l.toFixed(2))]});var O=Object(r.a)(e);Ce({lfc:[0,parseFloat(j.toFixed(2))],delta:[0,parseFloat(l.toFixed(2))]}),De(O)}),[a]);var Me=Object(s.useMemo)((function(){if(!Ee)return[];var e=Ee;if(Ne){var n=function(t){var n=Ne[t];if(n[0]==oe[t][0]&&n[1]==oe[t][1])return"continue";e=e.filter((function(e){return e[t]>=n[0]&&e[t]<=n[1]}))};for(var s in Ne)n(s)}return B&&""!==B?e=e.filter((function(e){return-1!==t[F][e.row].toLowerCase().indexOf(B.toLowerCase())})):e}),[Ee,B,Ne]);Object(s.useEffect)((function(){if(null===n||void 0===n?void 0:n.clusters){for(var e=Math.max.apply(Math,Object(r.a)(n.clusters)),t=[],s=0;s<e+1;s++)t.push(s+1);t=t.concat(Object.keys(w)),D(t),null==i&&j(0)}}),[n,w,i]),Object(s.useEffect)((function(){var e,t,s=[];String(i).startsWith("cs")?null===n||void 0===n||null===(e=n.clusters)||void 0===e||e.forEach((function(e,t){return w[i].includes(t)?s.push(1):s.push(0)})):null===n||void 0===n||null===(t=n.clusters)||void 0===t||t.forEach((function(e){return e===i?s.push(1):s.push(0)}));L(s)}),[i]);var Ie=function(e,t){var n=Object(l.a)({},Ne);n[t]=e,Ce(n)};return Object(x.jsxs)("div",{className:"marker-container",children:[Object(x.jsx)(d.l,{children:"Marker Genes"}),E?Object(x.jsx)(d.n,{onChange:function(e){var t;y(null);var n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;n.startsWith("Cluster")?n=parseInt(n.replace("Cluster ",""))-1:n.startsWith("Custom")&&(n=n.replace("Custom Selection ","")),j(n),Ce({}),y(null)},children:E.map((function(e,t){return Object(x.jsxs)("option",{children:[String(e).startsWith("cs")?"Custom Selection":"Cluster"," ",e]},t)}))}):"",a?Object(x.jsxs)("div",{className:"marker-table",children:[Object(x.jsxs)("div",{className:"marker-header",children:[Object(x.jsx)(d.p,{leftIcon:"search",small:!0,placeholder:"Search gene...",type:"text",onChange:function(e){return P(e.target.value)}}),Object(x.jsxs)("span",{children:[Object(x.jsx)(d.o,{icon:"sort",style:{paddingRight:"5px"}}),Object(x.jsxs)(d.n,{onChange:function(e){p(e.currentTarget.value)},defaultValue:"cohen-min-rank",children:[Object(x.jsx)("option",{children:"cohen-min"}),Object(x.jsx)("option",{children:"cohen-mean"}),Object(x.jsx)("option",{children:"cohen-min-rank"}),Object(x.jsx)("option",{children:"auc-min"}),Object(x.jsx)("option",{children:"auc-mean"}),Object(x.jsx)("option",{children:"auc-min-rank"}),Object(x.jsx)("option",{children:"lfc-min"}),Object(x.jsx)("option",{children:"lfc-mean"}),Object(x.jsx)("option",{children:"lfc-min-rank"}),Object(x.jsx)("option",{children:"delta-d-min"}),Object(x.jsx)("option",{children:"delta-d-mean"}),Object(x.jsx)("option",{children:"delta-d-min-rank"})]})]})]}),Object(x.jsx)(Z.a,{components:{Item:function(e){var t=e.children,n=Object(b.a)(e,ne);return Object(x.jsx)("div",Object(l.a)(Object(l.a)({className:"row-card"},n),{},{children:t}))},Header:function(){return Object(x.jsxs)("div",{className:"row-container row-header",children:[Object(x.jsx)("span",{children:Object(x.jsx)(d.n,{large:!1,minimal:!0,defaultValue:F,onChange:function(e,t){var n;return N(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.value)},children:Object.keys(t).map((function(e,t){return Object(x.jsx)("option",{children:e},t)}))})}),Object(x.jsx)("span",{children:"Log-FC"}),Object(x.jsx)("span",{children:"\u0394-detected"}),Object(x.jsxs)("span",{children:["Expression \xa0",Object(x.jsx)(u.a,{content:"bar represents the mean expression of the gene and the color gradient represents detected.",openOnTargetFocus:!1,children:Object(x.jsx)(d.o,{size:12,icon:"help"})})]}),Object(x.jsx)("span",{})]})}},className:"marker-list",totalCount:Me.length,itemContent:function(e){var s=Me[e],l=s.expanded,o=s.expr;return Object(x.jsxs)("div",{children:[Object(x.jsxs)("div",{className:"row-container",children:[Object(x.jsx)("span",{className:"marker-gene-title",children:t[F][s.row]}),Object(x.jsx)(h.a,{popoverClassName:O.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(d.d,{elevation:C.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[F][s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Y[0].toFixed(2),", ",Y[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ce[0].toFixed(2),", ",ce[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",W[0].toFixed(2),", ",W[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(te,{minmax:Y,colorscale:A.i,score:s.lfc})}),Object(x.jsx)(h.a,{popoverClassName:O.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(d.d,{elevation:C.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[F][s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ce[0].toFixed(2),", ",ce[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Y[0].toFixed(2),", ",Y[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",W[0].toFixed(2),", ",W[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(te,{minmax:U,colorscale:A.i,score:s.delta})}),Object(x.jsx)(h.a,{popoverClassName:O.a.POPOVER2_CONTENT_SIZING,hasBackdrop:!1,interactionKind:"hover",placement:"auto",hoverOpenDelay:500,modifiers:{arrow:{enabled:!0},flip:{enabled:!0},preventOverflow:{enabled:!0}},content:Object(x.jsx)(d.d,{elevation:C.a.ZERO,children:Object(x.jsxs)("table",{children:[Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{}),Object(x.jsx)("th",{scope:"col",children:t[F][s.row]}),Object(x.jsx)("th",{scope:"col",children:"This cluster"})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Expression"}),Object(x.jsx)("td",{children:s.mean.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",W[0].toFixed(2),", ",W[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Log-FC"}),Object(x.jsx)("td",{children:s.lfc.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",Y[0].toFixed(2),", ",Y[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"\u0394-detected"}),Object(x.jsx)("td",{children:s.delta.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",U[0].toFixed(2),", ",U[1].toFixed(2),"]"]})]}),Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{scope:"row",children:"Detected"}),Object(x.jsx)("td",{children:s.detected.toFixed(2)}),Object(x.jsxs)("td",{style:{fontStyle:"italic"},children:["\u2208 [",ce[0].toFixed(2),", ",ce[1].toFixed(2),"]"]})]})]})}),children:Object(x.jsx)(ee,{minmax:W,colorscale:Ae,score:s.mean,colorscore:s.detected})}),Object(x.jsxs)("div",{className:"row-action",children:[Object(x.jsx)(d.a,{icon:l?"minus":"plus",small:!0,fill:!1,className:"row-action",onClick:function(){var e=Object(r.a)(a);e[s.index].expanded=!e[s.index].expanded,c(e),o||m(s.row)}}),Object(x.jsx)(d.a,{small:!0,fill:!1,className:"row-action",onClick:function(){s.index===g?y(null):(y(s.index),o||m(s.row))},children:Object(x.jsx)(d.o,{icon:"tint",color:s.index===g?String(i).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(i.replace("cs",""))]:v[i]:""})})]})]}),Object(x.jsx)(d.e,{isOpen:l,children:o&&Object(x.jsx)($,{data:o,color:String(i).startsWith("cs")?v[Math.max.apply(Math,Object(r.a)(null===n||void 0===n?void 0:n.clusters))+parseInt(i.replace("cs",""))]:v[i],clusterlabel:String(i).startsWith("cs")?"Custom Selection ".concat(i):"Cluster ".concat(parseInt(i+1)),clusters:T})})]})}}),Object(x.jsxs)("div",{className:"marker-footer",children:[Object(x.jsx)(d.m,{className:"marker-footer-title",children:"Filter Markers"}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Log-FC"}),Y&&Object(x.jsxs)("div",{className:"marker-slider-container",children:[Object(x.jsxs)("div",{className:"marker-filter-gradient",children:[Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, blue 33%, yellow 50%, red 100%)",width:"100%",height:"5px"}}),"\xa0"]}),Object(x.jsx)(d.C,{className:"marker-filter-slider",min:Y[0],max:Y[1],labelValues:Y,stepSize:parseFloat((Math.abs(Y[1]-Y[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"lfc")},value:(null===Ne||void 0===Ne?void 0:Ne.lfc)?null===Ne||void 0===Ne?void 0:Ne.lfc:[0,Y[1]],vertical:!1})]})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"\u0394-detected"}),U&&Object(x.jsxs)("div",{className:"marker-slider-container",children:[Object(x.jsxs)("div",{className:"marker-filter-gradient",children:[Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, blue 33%, yellow 50%, red 100%)",width:"100%",height:"5px"}}),"\xa0"]}),Object(x.jsx)(d.C,{className:"marker-filter-slider",min:U[0],max:U[1],labelValues:U,stepSize:parseFloat((Math.abs(U[1]-U[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"delta")},value:(null===Ne||void 0===Ne?void 0:Ne.delta)?null===Ne||void 0===Ne?void 0:Ne.delta:[0,U[1]],vertical:!1})]})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Mean"}),W&&Object(x.jsxs)("div",{className:"marker-slider-container",children:[Object(x.jsxs)("div",{className:"marker-filter-gradient",children:[Object(x.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, #F5F8FA, #2965CC)",width:"100%",height:"5px"}}),"\xa0"]}),Object(x.jsx)(d.C,{className:"marker-filter-slider",min:W[0],max:W[1],labelValues:W,stepSize:parseFloat((Math.abs(W[1]-W[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"mean")},value:(null===Ne||void 0===Ne?void 0:Ne.mean)?null===Ne||void 0===Ne?void 0:Ne.mean:W,vertical:!1})]})]}),Object(x.jsxs)("div",{className:"marker-filter-container",children:[Object(x.jsx)(d.H,{className:"marker-filter-container-tag",minimal:!0,intent:"primary",children:"Detected"}),ce&&Object(x.jsx)("div",{className:"marker-slider-container",children:Object(x.jsx)(d.C,{className:"marker-filter-slider",min:ce[0],max:ce[1],labelValues:ce,stepSize:parseFloat((Math.abs(ce[1]-ce[0])/20).toFixed(2)),onChange:function(e){return Ie(e,"detected")},value:(null===Ne||void 0===Ne?void 0:Ne.detected)?null===Ne||void 0===Ne?void 0:Ne.detected:ce,vertical:!1})})]})]})]}):""]})},ae=a.a.memo(se),ce=(n(327),n(328),function(){var e=Object(s.useRef)();return Object(s.useEffect)((function(){var t=e.current,n=0,s=1,a=2,c=3,i=4,l=[5,5,3,3,2],r=["#1abc9c","#2ecc71","#3498db","#e74c3c","#9b59b6"],o={new:function(e){return{width:18,height:18,x:this.canvas.width/2-9,y:this.canvas.height/2-9,moveX:n,moveY:n,speed:e||9}}},d={new:function(e){return{width:18,height:70,x:"left"===e?150:this.canvas.width-150,y:this.canvas.height/2-35,score:0,move:n,speed:10}}},j={initialize:function(){this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1400,this.canvas.height=1e3,this.canvas.style.width=this.canvas.width/2+"px",this.canvas.style.height=this.canvas.height/2+"px",this.player=d.new.call(this,"left"),this.paddle=d.new.call(this,"right"),this.ball=o.new.call(this),this.paddle.speed=8,this.running=this.over=!1,this.turn=this.paddle,this.timer=this.round=0,this.color="#2c3e50",u.menu(),u.listen()},endGameMenu:function(e){u.context.font="50px Courier New",u.context.fillStyle=this.color,u.context.fillRect(u.canvas.width/2-350,u.canvas.height/2-48,700,100),u.context.fillStyle="#ffffff",u.context.fillText(e,u.canvas.width/2,u.canvas.height/2+15),setTimeout((function(){(u=Object.assign({},j)).initialize()}),3e3)},menu:function(){u.draw(),this.context.font="50px Courier New",this.context.fillStyle=this.color,this.context.fillRect(this.canvas.width/2-350,this.canvas.height/2-48,700,100),this.context.fillStyle="#ffffff",this.context.fillText("Press any key to begin",this.canvas.width/2,this.canvas.height/2+15)},update:function(){this.over||(this.ball.x<=0&&u._resetTurn.call(this,this.paddle,this.player),this.ball.x>=this.canvas.width-this.ball.width&&u._resetTurn.call(this,this.player,this.paddle),this.ball.y<=0&&(this.ball.moveY=a),this.ball.y>=this.canvas.height-this.ball.height&&(this.ball.moveY=s),this.player.move===s?this.player.y-=this.player.speed:this.player.move===a&&(this.player.y+=this.player.speed),u._turnDelayIsOver.call(this)&&this.turn&&(this.ball.moveX=this.turn===this.player?c:i,this.ball.moveY=[s,a][Math.round(Math.random())],this.ball.y=Math.floor(Math.random()*this.canvas.height-200)+200,this.turn=null),this.player.y<=0?this.player.y=0:this.player.y>=this.canvas.height-this.player.height&&(this.player.y=this.canvas.height-this.player.height),this.ball.moveY===s?this.ball.y-=this.ball.speed/1.5:this.ball.moveY===a&&(this.ball.y+=this.ball.speed/1.5),this.ball.moveX===c?this.ball.x-=this.ball.speed:this.ball.moveX===i&&(this.ball.x+=this.ball.speed),this.paddle.y>this.ball.y-this.paddle.height/2&&(this.ball.moveX===i?this.paddle.y-=this.paddle.speed/1.5:this.paddle.y-=this.paddle.speed/4),this.paddle.y<this.ball.y-this.paddle.height/2&&(this.ball.moveX===i?this.paddle.y+=this.paddle.speed/1.5:this.paddle.y+=this.paddle.speed/4),this.paddle.y>=this.canvas.height-this.paddle.height?this.paddle.y=this.canvas.height-this.paddle.height:this.paddle.y<=0&&(this.paddle.y=0),this.ball.x-this.ball.width<=this.player.x&&this.ball.x>=this.player.x-this.player.width&&this.ball.y<=this.player.y+this.player.height&&this.ball.y+this.ball.height>=this.player.y&&(this.ball.x=this.player.x+this.ball.width,this.ball.moveX=i),this.ball.x-this.ball.width<=this.paddle.x&&this.ball.x>=this.paddle.x-this.paddle.width&&this.ball.y<=this.paddle.y+this.paddle.height&&this.ball.y+this.ball.height>=this.paddle.y&&(this.ball.x=this.paddle.x-this.ball.width,this.ball.moveX=c)),this.player.score===l[this.round]?l[this.round+1]?(this.color=this._generateRoundColor(),this.player.score=this.paddle.score=0,this.player.speed+=.5,this.paddle.speed+=1,this.ball.speed+=1,this.round+=1):(this.over=!0,setTimeout((function(){u.endGameMenu("Winner!")}),1e3)):this.paddle.score===l[this.round]&&(this.over=!0,setTimeout((function(){u.endGameMenu("Game Over!")}),1e3))},draw:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.context.fillRect(this.paddle.x,this.paddle.y,this.paddle.width,this.paddle.height),u._turnDelayIsOver.call(this)&&this.context.fillRect(this.ball.x,this.ball.y,this.ball.width,this.ball.height),this.context.beginPath(),this.context.setLineDash([7,15]),this.context.moveTo(this.canvas.width/2,this.canvas.height-140),this.context.lineTo(this.canvas.width/2,140),this.context.lineWidth=10,this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.font="100px Courier New",this.context.textAlign="center",this.context.fillText(this.player.score.toString(),this.canvas.width/2-300,200),this.context.fillText(this.paddle.score.toString(),this.canvas.width/2+300,200),this.context.font="30px Courier New",this.context.fillText("Round "+(u.round+1),this.canvas.width/2,35),this.context.font="40px Courier",this.context.fillText(l[u.round]?l[u.round]:l[u.round-1],this.canvas.width/2,100)},loop:function(){u.update(),u.draw(),u.over||requestAnimationFrame(u.loop)},listen:function(){document.addEventListener("keydown",(function(e){!1===u.running&&(u.running=!0,window.requestAnimationFrame(u.loop)),38!==e.keyCode&&87!==e.keyCode||(u.player.move=s),40!==e.keyCode&&83!==e.keyCode||(u.player.move=a)})),document.addEventListener("keyup",(function(e){u.player.move=n}))},_resetTurn:function(e,t){this.ball=o.new.call(this,this.ball.speed),this.turn=t,this.timer=(new Date).getTime(),e.score++},_turnDelayIsOver:function(){return(new Date).getTime()-this.timer>=1e3},_generateRoundColor:function(){var e=r[Math.floor(Math.random()*r.length)];return e===this.color?u._generateRoundColor():e}},u=Object.assign({},j);u.initialize()}),[]),Object(x.jsxs)("div",{ref:e,className:"pong-container",children:[Object(x.jsx)("canvas",{}),Object(x.jsxs)("p",{className:"credit",children:["Game Credits ",Object(x.jsx)("a",{href:"https://codepen.io/gdube/pen/JybxxZ",target:"_blank",children:"Pong Game"})]})]})}),ie=(n(329),function(){return Object(x.jsx)("div",{className:"dots-bars-5"})});function le(){var e=Object(s.useState)(!0),t=Object(o.a)(e,2),n=t[0],a=t[1],c=Object(s.useContext)(f),i=c.setWasmInitialized,j=c.setTsneData,u=c.setRedDims,h=c.redDims,b=c.setGenesInfo,O=c.setInitDims,p=c.setQcDims,m=c.defaultRedDims,v=c.setDefaultRedDims,g=c.setQcData,y=c.qcData,w=c.setClusterData,F=c.setFSelectionData,N=c.setUmapData,C=c.setPcaVarExp,k=c.logs,S=c.setLogs,E=c.selectedCluster,A=c.clusterRank,M=c.selectedClusterSummary,I=c.setSelectedClusterSummary,T=c.reqGene,L=c.customSelection,R=c.clusterData,q=c.delCustomSelection,B=c.setDelCustomSelection,P=c.setSelectedCluster,_=c.setShowGame,G=c.showGame,W=c.datasetName,V=c.setExportState,z=c.setShowAnimation,U=c.triggerAnimation,K=c.setTriggerAnimation,Q=c.params,X=c.setGeneColSel,Y=c.setKanaIDBRecs,Z=c.setLoadParams,$=c.setInitLoadState,ee=c.setIndexedDBState;return Object(s.useEffect)((function(){window.scranWorker.postMessage({type:"INIT",msg:"Initial Load"})}),[]),Object(s.useEffect)((function(){if(null!==E){var e=String(E).startsWith("cs")?"getMarkersForSelection":"getMarkersForCluster";window.scranWorker.postMessage({type:e,payload:{cluster:E,rank_type:A}})}}),[E,A]),Object(s.useEffect)((function(){if(null!==L&&Object.keys(L).length>0){var e="cs".concat(Object.keys(L).length),t=L[e];window.scranWorker.postMessage({type:"computeCustomMarkers",payload:{selection:t,id:e}})}}),[L]),Object(s.useEffect)((function(){null!==q&&(window.scranWorker.postMessage({type:"removeCustomMarkers",payload:{id:q}}),B(null))}),[q]),Object(s.useEffect)((function(){null!==T&&window.scranWorker.postMessage({type:"getGeneExpression",payload:{gene:T}})}),[T]),Object(s.useEffect)((function(){U&&m&&window.scranWorker.postMessage({type:"animate"+m,payload:{params:Q[m.toLowerCase()]}})}),[U]),window.scranWorker.onmessage=function(e){var t=e.data;if(null===t||void 0===t?void 0:t.msg){var n=Object(r.a)(k),s=new Date;n.push("".concat(s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()," - ").concat(null===t||void 0===t?void 0:t.type," - ").concat(null===t||void 0===t?void 0:t.msg)),S(n)}if("INIT"===t.type)a(!1),i(!0);else if("KanaDB_store"===t.type){var c=t.resp;c.length>0&&Y(c),ee(!1)}else if("inputs_DATA"===t.type)O("".concat(t.resp.dimensions.num_genes," genes, ").concat(t.resp.dimensions.num_cells," cells")),b(t.resp.genes),X(Object.keys(t.resp.genes)[0]);else if("quality_control_metrics_DATA"===t.type){var o=t.resp;g(o)}else if("quality_control_thresholds_DATA"===t.type){var d=t.resp,x=Object(l.a)({},y);x.thresholds=d,g(x)}else if("quality_control_filtered_DATA"===t.type)p("".concat(t.resp.retained," cells"));else if("feature_selection_DATA"===t.type){var f=t.resp;F(f)}else if("pca_DATA"===t.type){var E=t.resp;C(E)}else if("snn_cluster_graph_DATA"===t.type){var D=t.resp;w(D),P(0)}else if("tsne_DATA"===t.type||"tsne_iter"===t.type){var A=t.resp;if(j(A),z(!0),"tsne_DATA"===t.type){var T=Object(r.a)(h);T.push("TSNE"),m||v("TSNE"),u(T),_(!1),z(!1),K(!1)}}else if("umap_DATA"===t.type||"umap_iter"===t.type){var L=t.resp;if(N(L),z(!0),"umap_DATA"===t.type){var R=Object(r.a)(h);R.push("UMAP"),u(R),z(!1),K(!1)}}else if("markerGene_DATA"===t.type);else if("setMarkersForCluster"===t.type||"setMarkersForCustomSelection"===t.type){var q=t.resp,B=[];q.means.forEach((function(e,t){var n,s,a,c;B.push({index:t,row:null===q||void 0===q||null===(n=q.ordering)||void 0===n?void 0:n[t],mean:e,delta:null===q||void 0===q||null===(s=q.delta_detected)||void 0===s?void 0:s[t],lfc:null===q||void 0===q||null===(a=q.lfc)||void 0===a?void 0:a[t],detected:null===q||void 0===q||null===(c=q.detected)||void 0===c?void 0:c[t],expanded:!1,expr:null})})),I(B)}else if("setGeneExpression"===t.type){for(var G=t.resp,H=Object(r.a)(M),U=0;U<H.length;U++)if(G.gene===H[U].row){H[U].expr=Object.values(G.expr);break}I(H)}else if("exportState"===t.type){var Q=t.resp,J=document.createElement("a"),te=new Blob([Q],{type:"text/plain"});J.href=URL.createObjectURL(te),J.download=W.split(" ").join("_")+".kana.gz",J.click(),V(!1)}else if("KanaDB"===t.type)ee(!1);else if("loadedParameters"===t.type){var ne=t.resp;Z(ne.params),setTimeout((function(){$(!1)}),1e3)}},Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(D,{}),Object(x.jsxs)("div",{className:"App-content",children:[Object(x.jsx)("div",{className:"plot",children:m?Object(x.jsx)(J,{}):G?Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(d.a,{onClick:function(){_(!1)},children:"I'm good, go back"}),Object(x.jsx)(ce,{})]}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"50px"},children:[Object(x.jsx)(ie,{}),Object(x.jsx)(d.q,{children:"Get some coffee or play pong while you wait for the analysis to finish.."}),Object(x.jsx)(d.a,{onClick:function(){_(!0)},children:"Play Pong"})]})}),Object(x.jsx)("div",{className:"marker",children:R?Object(x.jsx)(ae,{}):Object(x.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(x.jsx)(ie,{}),Object(x.jsx)(d.q,{children:"Generating nearest neighbor graph to compute clusters...."})]})}),Object(x.jsx)("div",{className:"analysis",children:Object(x.jsx)(H,{})})]}),Object(x.jsx)(d.y,Object(l.a)(Object(l.a)({isOpen:n},{autoFocus:!0,canEscapeKeyClose:!1,canOutsideClickClose:!1,enforceFocus:!0,hasBackdrop:!0,usePortal:!0,useTallContent:!1}),{},{children:Object(x.jsxs)("div",{className:"spinner",children:[Object(x.jsx)(d.D,{size:100}),Object(x.jsx)("p",{children:"Initializing kana"})]})}))]})}var re=a.a.memo(le),oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,339)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),s(e),a(e),c(e),i(e)}))};i.a.render(Object(x.jsx)(g,{children:Object(x.jsx)(re,{})}),document.getElementById("root")),oe()}},[[330,1,2]]]);
//# sourceMappingURL=main.b8364dcc.chunk.js.map