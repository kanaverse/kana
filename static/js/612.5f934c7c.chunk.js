!function(){"use strict";var e={9612:function(e,t,n){var r,a=n(4165),s=n(5861),o=n(3324),c=n(7762),i=n(797),u=n(5831),l=null;function f(){var e=r.result.transaction(["analysis_meta"],"readonly").objectStore("analysis_meta").getAll();return new Promise((function(t,n){e.onsuccess=function(n){var r=e.result;r.forEach((function(e){delete e.files})),t(r)},e.onerror=function(e){n(new Error("failed to query the analysis store in KanaDB: ".concat(e.target.errorCode)))}}))}function p(){return d.apply(this,arguments)}function d(){return(d=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return e.abrupt("return",f());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return h.apply(this,arguments)}function h(){return(h=(0,s.Z)((0,a.Z)().mark((function e(t,n){var s,o,c,i,u,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return s=r.result.transaction(["file","file_meta"],"readwrite"),o=new Promise((function(e,n){s.oncomplete=function(t){e(null)},s.onerror=function(e){n(new Error("transaction error when saving file ".concat(t," in DownloadsDB: ").concat(e.target.errorCode)))}})),c=s.objectStore("file"),i=s.objectStore("file_meta"),u=i.get(t),f=new Promise((function(e,r){u.onsuccess=function(r){var a=u.result;"undefined"===typeof a?a={count:1,id:t}:a.count++;var s=new Promise((function(e,r){var a=c.put({id:t,payload:n.buffer});a.onsuccess=function(t){e(!0)},a.onerror=function(e){r(new Error("failed to save file ".concat(t," in KanaDB: ").concat(e.target.errorCode)))}})),o=new Promise((function(e,n){var r=i.put(a);r.onsuccess=function(t){e(!0)},r.onerror=function(e){n(new Error("failed to save metadata for file ".concat(t," in KanaDB: ").concat(e.target.errorCode)))}}));e(Promise.all([s,o]))},u.onerror=function(e){r(new Error("failed to retrieve metadata ".concat(t," in KanaDB: ").concat(e.target.errorCode)))}})),e.next=10,o;case 10:return e.next=12,f;case 12:return e.abrupt("return");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,n,r){return y.apply(this,arguments)}function y(){return(y=(0,s.Z)((0,a.Z)().mark((function e(t,n,s,o){var c,i,u,f,p,d,m,h;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return c=r.result.transaction(["analysis","analysis_meta"],"readwrite"),i=new Promise((function(e,n){c.oncomplete=function(t){e(null)},c.onerror=function(e){n(new Error("transaction error when saving analysis ".concat(t," in DownloadsDB: ").concat(e.target.errorCode)))}})),u=c.objectStore("analysis"),f=c.objectStore("analysis_meta"),p=function(e){var t=new Promise((function(t,r){var a=u.put({id:e,payload:n.buffer});a.onsuccess=function(e){t(!0)},a.onerror=function(t){r(new Error("failed to save analysis file ".concat(e," in KanaDB: ").concat(t.target.errorCode)))}})),r=new Promise((function(t,n){var r=f.put({id:e,files:s,time:Number(new Date),title:o});r.onsuccess=function(e){t(!0)},r.onerror=function(t){n(new Error("failed to save analysis metadata ".concat(e," in KanaDB: ").concat(t.target.errorCode)))}}));return[e,t,r]},null===t?(m=f.getAll(),d=new Promise((function(e,t){m.onsuccess=function(t){e(p(String(m.result.length)))},m.onerror=function(e){t(new Error("failed to list existing analysis store in KanaDB: ".concat(e.target.errorCode)))}}))):d=p(t),e.next=10,d;case 10:return h=e.sent,e.next=13,i;case 13:return e.abrupt("return",h[0]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=(0,s.Z)((0,a.Z)().mark((function e(t){var n,s,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return n=r.result.transaction(["file"],"readonly").objectStore("file"),s=new Promise((function(e,r){var a=n.get(t);a.onsuccess=function(t){e(void 0!==a.result?a.result:null)},a.onerror=function(e){r(new Error("failed to retrieve file ".concat(t," from KanaDB: ").concat(e.target.errorCode)))}})),e.next=6,s;case 6:return null!==(o=e.sent)&&(o=new Uint8Array(o.payload)),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return _.apply(this,arguments)}function _(){return(_=(0,s.Z)((0,a.Z)().mark((function e(t){var n,s,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return n=r.result.transaction(["analysis"],"readonly").objectStore("analysis"),s=new Promise((function(e,r){var a=n.get(t);a.onsuccess=function(t){e(void 0!==a.result?a.result:null)},a.onerror=function(e){r(new Error("failed to retrieve analysis ".concat(t," from KanaDB: ").concat(e.target.errorCode)))}})),e.next=6,s;case 6:return null!==(o=e.sent)&&(o=new Uint8Array(o.payload)),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return(k=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,o,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(!((n=e.sent)instanceof Array)){e.next=26;break}r=[],s=(0,c.Z)(n),e.prev=6,s.s();case 8:if((o=s.n()).done){e.next=17;break}return i=o.value,e.t0=r,e.next=13,x(i);case 13:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t2=e.catch(6),s.e(e.t2);case 22:return e.prev=22,s.f(),e.finish(22);case 25:n=r;case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}}),e,null,[[6,19,22,25]])})))).apply(this,arguments)}function S(e,t,n){var r=n.get(e);return new Promise((function(a,s){r.onsuccess=function(s){var o=r.result,c=o.count-1,i=[];0===c?(i.push(new Promise((function(n,r){var a=t.delete(e);a.onsuccess=function(e){n(!0)},a.onerror=function(t){r(new Error("failed to remove file ".concat(e," from KanaDB: ").concat(t.target.errorCode)))}}))),i.push(new Promise((function(t,r){var a=n.delete(e);a.onsuccess=function(e){t(!0)},a.onerror=function(t){r(new Error("failed to remove file metadata ".concat(e," from KanaDB: ").concat(t.target.errorCode)))}})))):i.push(new Promise((function(t,r){o.count=c;var a=n.put(o);a.onsuccess=function(e){t(!0)},a.onerror=function(t){r(new Error("failed to update file metadata ".concat(e," in KanaDB: ").concat(t.target.errorCode)))}}))),a(i)},r.onerror=function(t){console.log(t),s(new Error("failed to retrieve file metadata ".concat(e," from KanaDB: ").concat(t.target.errorCode)))}}))}function Z(){return(Z=(0,s.Z)((0,a.Z)().mark((function e(t){var n,s,o,i,u,f,p,d,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return n=r.result.transaction(["analysis","analysis_meta","file","file_meta"],"readwrite"),s=new Promise((function(e,r){n.oncomplete=function(t){e(null)},n.onerror=function(e){r(new Error("transaction error when removing analysis ".concat(t," in DownloadsDB: ").concat(e.target.errorCode)))}})),o=n.objectStore("analysis"),i=n.objectStore("analysis_meta"),u=n.objectStore("file"),f=n.objectStore("file_meta"),p=new Promise((function(e,n){var r=o.delete(t);r.onsuccess=function(t){e(!0)},r.onerror=function(e){n(new Error("failed to delete analysis ".concat(t," from KanaDB: ").concat(e.target.errorCode)))}})),d=i.get(t),m=new Promise((function(e,n){d.onsuccess=function(n){for(var r=d.result,a=[],s=0,o=Object.values(r.files.datasets);s<o.length;s++){var l,p=o[s],m=(0,c.Z)(p.files);try{for(m.s();!(l=m.n()).done;){var h=l.value;a.push(S(h.id,u,f))}}catch(y){m.e(y)}finally{m.f()}}var v=new Promise((function(e,n){var r=i.delete(t);r.onsuccess=function(t){e(!0)},r.onerror=function(e){n(new Error("failed to delete analysis metadata ".concat(t," from KanaDB: ").concat(e.target.errorCode)))}}));a.push(v),e(a)},d.onerror=function(e){n(new Error("failed to retrieve analysis metadata ".concat(t," from KanaDB: ").concat(e.target.errorCode)))}})),e.next=13,p;case 13:return e.next=15,x(m);case 15:return e.next=17,s;case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O,E=n(7325),R=n(8109),C=n(105),A=null;function D(e){return P.apply(this,arguments)}function P(){return P=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,o,c,i,u,l,f,p,d,m,h,v=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.length>1&&void 0!==v[1]?v[1]:null,r=v.length>2&&void 0!==v[2]&&v[2],e.next=4,A;case 4:if(r){e.next=13;break}return s=O.result.transaction(["downloads"],"readonly"),o=s.objectStore("downloads"),c=new Promise((function(e,n){var r=o.get(t);r.onsuccess=function(t){void 0!==r.result?e(r.result.payload):e(null)},r.onerror=function(e){n("failed to query DownloadsDB for ".concat(t,": ").concat(e.target.errorCode))}})),e.next=10,c;case 10:if(null===(i=e.sent)){e.next=13;break}return e.abrupt("return",i);case 13:return u=null==n?fetch(t):fetch(t,n),e.next=16,u;case 16:if((l=e.sent).ok){e.next=19;break}throw new Error("failed to download '"+t+"' ("+l.status+")");case 19:return e.next=21,l.arrayBuffer();case 21:return f=e.sent,p=O.result.transaction(["downloads"],"readwrite"),d=new Promise((function(e,n){p.oncomplete=function(t){e(null)},p.onerror=function(e){n(new Error("transaction error for saving ".concat(t," in DownloadsDB: ").concat(e.target.errorCode)))}})),m=p.objectStore("downloads"),h=new Promise((function(e,n){var r=m.put({url:t,payload:f});r.onsuccess=function(t){e(!0)},r.onerror=function(e){n(new Error("failed to cache ".concat(t," in DownloadsDB: ").concat(e.target.errorCode)))}})),e.next=28,h;case 28:return e.next=30,d;case 30:return e.abrupt("return",f);case 31:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}var j=n(5587),M=n.n(j);var T=n(9062),B="https://cors-proxy.aaron-lun.workers.dev";function N(e){return F.apply(this,arguments)}function F(){return(F=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(B+"/"+encodeURIComponent(t));case 2:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){if(e)if(Array.isArray(e)){var n,r=(0,c.Z)(e);try{for(r.s();!(n=r.n()).done;){I(n.value,t)}}catch(u){r.e(u)}finally{r.f()}}else if(e.constructor==Object)for(var a=0,s=Object.entries(e);a<s.length;a++){var i=(0,o.Z)(s[a],2);i[0];I(i[1],t)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";t.push(e.buffer)}}function K(e){postMessage({type:"".concat(e,"_START")})}function L(e,t){if("undefined"==typeof t)postMessage({type:"".concat(e,"_CACHE")});else{var n=[];I(t,n),postMessage({type:"".concat(e,"_DATA"),resp:t},n)}}function z(e,t,n){postMessage({type:"".concat(e,"_ERROR"),resp:{reason:t.toString(),fatal:n}})}function U(e,t,n){for(var r={},a=n.slice(),s=0;s<t.length;s++){for(var c={},i=0,u=Object.entries(e);i<u.length;i++){var l=(0,o.Z)(u[i],2),f=l[0],p=l[1];c[f]=p.slice().filter((function(e,t){return a[t]==s}))}r[t[s]]=c}return r}function V(e,t){var n,r={},a=(0,c.Z)(t);try{for(a.s();!(n=a.n()).done;){r[n.value]={}}}catch(d){a.e(d)}finally{a.f()}for(var s=0,i=Object.entries(e);s<i.length;s++)for(var u=(0,o.Z)(i[s],2),l=u[0],f=u[1],p=0;p<t.length;p++)r[t[p]][l]=f[p];return r}function H(e,t){return G.apply(this,arguments)}function G(){return(G=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,s,i,u,l,f,p,d,m,h,v,y,b,w,g,_,x,k,S,Z,O,E,R,C,A,D,P,j,M,T,B,N,F,I,K,L,z,H,G,Y,X,Q,$,W,ee,te,ne,re,ae,se,oe,ce,ie;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t[n].changed){e.next=2;break}return e.abrupt("return",void 0);case 2:if("inputs"!==n){e.next=18;break}({}),s={},i=(0,c.Z)(t[n].fetchCountMatrix().available());try{for(i.s();!(u=i.n()).done;)l=u.value,s[l]=t[n].fetchCountMatrix().get(l).numberOfRows()}catch(a){i.e(a)}finally{i.f()}for(f={},p=0,d=Object.entries(t[n].fetchFeatureAnnotations());p<d.length;p++){m=(0,o.Z)(d[p],2),h=m[0],v=m[1],y={},b=(0,c.Z)(v.columnNames());try{for(b.s();!(w=b.n()).done;)g=w.value,_=v.column(g),Array.isArray(_)&&(y[g]=_)}catch(a){b.e(a)}finally{b.f()}Array.isArray(v.rowNames())&&(y.rownames=v.rowNames()),f[h]=y}x={},k=(0,c.Z)(t[n].fetchCellAnnotations().columnNames());try{for(k.s();!(S=k.n()).done;)Z=S.value,J(O=t[n].fetchCellAnnotations().column(Z))&&(E=q(O,{all:!1,unique:!0,colname:Z}),x[Z]=E)}catch(a){k.e(a)}finally{k.f()}return null!==(R=t[n].fetchBlockLevels())&&J(C=t[n].fetchBlock().slice())&&(A=q(C,{all:!1,unique:!0,colname:"__batch__"}),x.__batch__=A),r={num_cells:t[n].fetchCountMatrix().numberOfColumns(),num_genes:s,genes:f,annotations:x},e.abrupt("return",r);case 18:if("rna_quality_control"!==n){e.next=28;break}return D={sums:t[n].fetchMetrics().sums(),detected:t[n].fetchMetrics().detected(),proportion:t[n].fetchMetrics().subsetProportions(0)},P={},null===(R=t.inputs.fetchBlockLevels())?(R=["default"],P.data={default:D}):(j=t.inputs.fetchBlock(),P.data=U(D,R,j)),M={sums:t[n].fetchFilters().thresholdsSums(),detected:t[n].fetchFilters().thresholdsDetected(),proportion:t[n].fetchFilters().thresholdsSubsetProportions(0)},P.thresholds=V(M,R),e.abrupt("return",P);case 28:if("adt_quality_control"!==n){e.next=39;break}for(T={sums:t[n].fetchMetrics().sums(),detected:t[n].fetchMetrics().detected(),proportion:t[n].fetchMetrics().subsetTotals(0)},B={},null===(R=t.inputs.fetchBlockLevels())?(R=["default"],B.data={default:T}):(N=t.inputs.fetchBlock(),B.data=U(T,R,N)),F={detected:t[n].fetchFilters().thresholdsDetected(),proportion:t[n].fetchFilters().thresholdsSubsetTotals(0)},B.thresholds=V(F,R),I=0,K=Object.entries(B.thresholds);I<K.length;I++)L=(0,o.Z)(K[I],2),L[0],L[1].sums=NaN;return e.abrupt("return",B);case 39:if("crispr_quality_control"!==n){e.next=49;break}return z={sums:t[n].fetchMetrics().sums(),detected:t[n].fetchMetrics().detected(),proportion:t[n].fetchMetrics().maxProportions()},H={},null===(R=t.inputs.fetchBlockLevels())?(R=["default"],H.data={default:z}):(G=t.inputs.fetchBlock(),H.data=U(z,R,G)),Y={count:t[n].fetchFilters().thresholdsMaxCount(0)},H.thresholds=V(Y,R),e.abrupt("return",H);case 49:if("cell_filtering"!==n){e.next=57;break}return X=0,Q=null,($=t[n].fetchDiscards())?($.forEach((function(e){X+=0==e})),Q=$.slice()):X=t.inputs.fetchCountMatrix().numberOfColumns(),W={retained:X,discard:Q},e.abrupt("return",W);case 57:if("rna_normalization"!==n){e.next=61;break}return e.abrupt("return",{});case 61:if("adt_normalization"!==n){e.next=65;break}return e.abrupt("return",{});case 65:if("crispr_normalization"!==n){e.next=69;break}return e.abrupt("return",{});case 69:if("feature_selection"!==n){e.next=74;break}return ee={means:t[n].fetchResults().means(),vars:t[n].fetchResults().variances(),fitted:t[n].fetchResults().fitted(),resids:t[n].fetchResults().residuals()},e.abrupt("return",ee);case 74:if("rna_pca"!==n&&"adt_pca"!==n&&"crispr_pca"!==n){e.next=82;break}return te=t[n].fetchPCs(),ne=te.varianceExplained(),re=te.totalVariance(),ne.forEach((function(e,t){ne[t]=e/re})),e.abrupt("return",{var_exp:ne});case 82:if("combine_embeddings"!==n){e.next=86;break}return e.abrupt("return",{});case 86:if("batch_correction"!==n){e.next=90;break}return e.abrupt("return",{});case 90:if("neighbor_index"!==n){e.next=94;break}return e.abrupt("return",{});case 94:if("tsne"!==n&&"umap"!==n){e.next=100;break}return e.next=97,t[n].fetchResults();case 97:return e.abrupt("return",e.sent);case 100:if("kmeans_cluster"!==n){e.next=104;break}return e.abrupt("return",{});case 104:if("snn_graph_cluster"!==n){e.next=108;break}return e.abrupt("return",{});case 108:if("choose_clustering"!==n){e.next=113;break}return ae=t[n].fetchClusters(),e.abrupt("return",{clusters:ae.slice()});case 113:if("marker_detection"!==n){e.next=117;break}return e.abrupt("return",{});case 117:if("cell_labelling"!==n){e.next=127;break}if(!("RNA"in(se=t.marker_detection.fetchResults()))){e.next=124;break}return oe=t[n].computeLabels(se.RNA),e.abrupt("return",oe);case 124:return e.abrupt("return",{per_reference:{}});case 125:e.next=135;break;case 127:if("custom_selections"!==n){e.next=131;break}return e.abrupt("return",{});case 131:if("feature_set_enrichment"!==n){e.next=135;break}return ce=t.feature_set_enrichment.fetchCollectionDetails(),ie=t.feature_set_enrichment.fetchSetDetails(),e.abrupt("return",{collections:ce,sets:{names:ie.names,descriptions:ie.descriptions,sizes:ie.sizes.slice(),collections:ie.collections.slice()}});case 135:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function q(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.all,a=void 0!==r&&r,s=n.unique,o=void 0!==s&&s,c=n.colname,u=void 0===c?null:c;if(J(e)){t=i.Qr(e);var l=new Set(e);t.num_unique=l.size,l.size<=50&o&&(t.values=(0,T.Z)(l).sort()),a&&(t._all_=e),"continuous"===t.type&&l.size<=50&&(t.type="both"),("string"===typeof u||u instanceof String)&&(t.name=u)}return t}i.ES.setDownload(N),E.b5(N),i.E4.setDownload(N),E.ao(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var s,o,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=E.XZ()+"/"+t,o=B+"/"+encodeURIComponent(s),null!=n||null!=r){e.next=9;break}return e.next=5,D(o);case 5:return c=e.sent,e.abrupt("return",new Response(c));case 9:return e.abrupt("return",fetch(o+"?start="+String(n)+"&end="+String(r)));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),E.d9(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=E.Kk()+"/"+t,e.next=3,D(B+"/"+encodeURIComponent(n));case 3:return r=e.sent,e.abrupt("return",new Response(r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),C.M.setDownloadFun(N),i.cO.ExperimentHub=C.M;n(3841);var Y="K@\ud835\udf02a#$c3ll";"".concat(Y,"::CLUSTERS"),"".concat(Y,"::SELECTION");var X="".concat(Y,"::CLUSTERS"),Q="".concat(Y,"::SELECTION"),$=null,W={},ee={},te=null,ne={};function re(e){if("10X"===e.format)return new i.By(e.h5,e.options?e.options:{});if("MatrixMarket"===e.format)return new i.en(e.mtx,e.genes||null,e.annotations||null,e.options?e.options:{});if("H5AD"===e.format)return new i.Fl(e.h5,e.options?e.options:{});if("SummarizedExperiment"===e.format)return new i.H$(e.rds,e.options?e.options:{});if("ZippedADB"===e.format)return new i.cj(e.zipname,e.zipfile,e.options?e.options:{});if("ExperimentHub"===e.format)return new C.M(e.id,e.options?e.options:{});throw new Error("unknown format '"+e.format+"'")}function ae(e,t){var n,r={},a=(0,c.Z)(e.cells.columnNames());try{for(a.s();!(n=a.n()).done;){var s=n.value,i=e.cells.column(s);J(i)&&(r[s]=q(i,{all:!0,unique:!0,colname:s}))}}catch(T){a.e(T)}finally{a.f()}var u={cells:{columns:r,numberOfCells:e.cells.numberOfRows()}};if("H5AD"===t.format){u.all_features={};var l,f={},p=(0,c.Z)(e.all_features.columnNames());try{for(p.s();!(l=p.n()).done;){var d=l.value,m=e.all_features.column(d);J(m)&&(f[d]=q(m,{all:!0,unique:!0,colname:d}))}}catch(T){p.e(T)}finally{p.f()}u.all_features={columns:f,numberOfFeatures:e.all_features.numberOfRows(),rownames:Array.isArray(e.all_features.rowNames())}}else if("SummarizedExperiment"===t.format){if(u.modality_features={},"modality_features"in e)for(var h=0,v=Object.entries(e.modality_features);h<v.length;h++){var y,b=(0,o.Z)(v[h],2),w=b[0],g=b[1],_={},x=(0,c.Z)(g.columnNames());try{for(x.s();!(y=x.n()).done;){var k=y.value,S=g.column(k);J(S)&&(_[k]=q(S,{all:!0,unique:!0,colname:k}))}}catch(T){x.e(T)}finally{x.f()}u.modality_features[w]={columns:_,numberOfFeatures:g.numberOfRows(),rownames:Array.isArray(g.rowNames())}}}else if(u.modality_features={},"modality_features"in e)for(var Z=0,O=Object.entries(e.modality_features);Z<O.length;Z++){var E,R=(0,o.Z)(O[Z],2),C=R[0],A=R[1],D={},P=(0,c.Z)(A.columnNames());try{for(P.s();!(E=P.n()).done;){var j=E.value,M=A.column(j);J(M)&&(D[j]=q(M,{all:!0,unique:!0,colname:j}))}}catch(T){P.e(T)}finally{P.f()}u.modality_features[C]={columns:D,numberOfFeatures:A.numberOfRows(),rownames:Array.isArray(A.rowNames())}}return"H5AD"===t.format?u.all_assay_names=e.all_assay_names:"SummarizedExperiment"!==t.format&&"ZippedADB"!==t.format||(u.modality_assay_names=e.modality_assay_names),u}function se(e){return oe.apply(this,arguments)}function oe(){return(oe=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H($,t);case 3:n=e.sent,L(t,n),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),z(t,e.t0,!0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function ce(e,t){var n;return e in ne||((n=new i.J6(le(),t.ids.slice())).computeAll(),ne[e]=n),ne[e]}i.$p((function(e,t,n,r){postMessage({type:e+"_iter",x:t,y:n,iteration:r},[t.buffer,n.buffer])})),i.ED(b);var ie,ue=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("__batch__"===e)t=$.inputs.fetchBlock().slice();else if(e.startsWith("".concat(Y,"::QC::"))){var r=e.replace("".concat(Y,"::QC::"),"").split("_"),a=$["".concat(r[0].toLowerCase(),"_quality_control")].fetchMetrics();"sums"===r[1]?t=a.sums():"detected"===r[1]?t=a.detected():"proportion"===r[1]&&("rna"===r[0].toLowerCase()?t=a.subsetProportions(0):"adt"===r[0].toLowerCase()?t=a.subsetTotals(0):"crispr"===r[0].toLowerCase()&&(t=a.maxProportions(0)))}else t=$.inputs.fetchCellAnnotations().column(e);return n||(t=$.cell_filtering.applyFilter(t)),t.slice()},le=function(){if(null===te){te=new u.VU;for(var e=0,t=Object.entries({RNA:"rna_normalization",ADT:"adt_normalization",CRISPR:"crispr_normalization"});e<t.length;e++){var n=(0,o.Z)(t[e],2),r=n[0],a=n[1],s=$[a];s.valid()&&te.add(r,s.fetchNormalizedMatrix())}}return te};onmessage=function(e){var t=e.data,n=t.type,d=t.payload,h=!1;if("INIT"===n){h=!0;var y=Math.round(2*navigator.hardwareConcurrency/3),w=i.j2({numberOfThreads:y}),_=w.then((function(){return i.TN()}));_.then((function(e){$=e,postMessage({type:n,msg:"Success: analysis state created"})}));var x=l=new Promise((function(e){(r=indexedDB.open("KanaDB",2)).onupgradeneeded=function(e){var t=e.target.result;try{t.deleteObjectStore("analysis")}catch(e){}try{t.deleteObjectStore("analysis_meta")}catch(e){}try{t.deleteObjectStore("file")}catch(e){}try{t.deleteObjectStore("file_meta")}catch(e){}t.createObjectStore("analysis",{keyPath:"id"}),t.createObjectStore("analysis_meta",{keyPath:"id"}),t.createObjectStore("file",{keyPath:"id"}),t.createObjectStore("file_meta",{keyPath:"id"})},r.onsuccess=function(){e(f())},r.onerror=function(){e(null)}}));x.then((function(e){null!==e&&postMessage({type:"KanaDB_store",resp:e,msg:"Success: KanaDB initialized"})})).catch((function(e){console.error(e),postMessage({type:"KanaDB_ERROR",msg:"Error: Cannot initialize KanaDB"})}));var k=(null===A&&(A=new Promise((function(e,t){(O=indexedDB.open("DownloadsDB",3)).onupgradeneeded=function(e){var t=e.target.result;try{t.deleteObjectStore("downloads")}catch(e){}t.createObjectStore("downloads",{keyPath:"url"})},O.onsuccess=function(){e(null)},O.onerror=function(){t("failed to initialize DownloadsDB")}}))),A);k.then((function(e){postMessage({type:"DownloadsDB_store",resp:e,msg:"Success: DownloadsDB initialized"})})).catch((function(e){console.error(e),postMessage({type:"DownloadsDB_ERROR",msg:"Error: Cannot initialize DownloadsDB"})}));try{var S=C.M.availableDatasets();postMessage({type:"ExperimentHub_store",resp:S,msg:"Success: ExperimentHub initialized"})}catch(V){console.error(V),postMessage({type:"ExperimentHub_ERROR",msg:"Error: Cannot access datasets in ExperimentHub"})}(ie=Promise.all([w,x,k,_])).then((function(){postMessage({type:n,msg:"Success: bakana initialized"})})).catch((function(e){console.error(e),z(n,e,h)}))}else if("RUN"===n)h=!0,ie.then((function(e){var t=d.inputs,r=t.files;if(null!==r){for(var a={},s=0,c=Object.entries(r);s<c.length;s++){var u=(0,o.Z)(c[s],2),l=u[0],f=u[1];"uid"in f&&f.uid in W?a[l]=W[f.uid]:a[l]=re(f),a[l].setOptions(f.options)}for(var p=0,m=Object.entries(W);p<m.length;p++){var v=(0,o.Z)(m[p],2),y=v[0];v[1].clear(),delete W[y]}r=a}!function(){for(var e=0,t=Object.entries(ne);e<t.length;e++){var n=(0,o.Z)(t[e],2);n[0],n[1].free()}ne={}}();var b=function(e,t){var n=t,r=function(e,t,r){if("undefined"==typeof r)throw new Error("cannot assign undefined parameter to '"+e+"."+t+"'");if(!(e in n))throw new Error("unknown analysis step '"+e+"'");var a=n[e];if(!(t in a))throw new Error("unknown analysis parameter '"+t+"' for step '"+e+"'");a[t]=r};return r("inputs","block_factor",e.batch),r("inputs","subset",e.subset),i.TD(n,t.batch_correction.method),i.bN(n,t.neighbor_index.approximate),null!==n.combine_embeddings.weights&&new Set([n.combine_embeddings.rna_weight,n.combine_embeddings.adt_weight,n.combine_embeddings.crispr_weight]).size<=1&&(n.combine_embeddings.weights=null),n}(t,d.params);i.x6($,r,b,{startFun:K,finishFun:se}).catch((function(e){console.error(e),z(n,e,h)}))})).catch((function(e){console.error(e),z(n,e,h)}));else if("LOAD"===n){h=!0;var D=d.inputs.files;if("kana"===D[Object.keys(D)[0]].format){var P=D[Object.keys(D)[0]].file;ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,c,u,l,f,p,d,m,h,v,y,b,w,g,_,x,k,S,Z,O,R,C,A;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new FileReaderSync,r=n.readAsArrayBuffer(P),e.next=4,M().loadAsync(r);case 4:return s=e.sent,e.t0=JSON,e.next=8,s.file("config.json").async("string");case 8:e.t1=e.sent,c=e.t0.parse.call(e.t0,e.t1),u={},e.t2=(0,a.Z)().keys(s.files);case 12:if((e.t3=e.t2()).done){e.next=21;break}if(!(l=e.t3.value).startsWith("datasets/")){e.next=19;break}return e.next=17,s.files[l].async("uint8array");case 17:f=e.sent,u[l.split("/")[1]]=f;case 19:e.next=12;break;case 21:return e.next=23,i.j5(c,(function(e){return u[e]}),{state:$,startFun:K,finishFun:se});case 23:$=e.sent,p={custom_selections:$.custom_selections.fetchSelections()},d=[],I(c.parameters,d),postMessage({type:"loadedParameters",resp:{parameters:c.parameters,other:p}},d),m={},h={},v=$.inputs.fetchDatasets(),y=0,b=Object.entries(v);case 32:if(!(y<b.length)){e.next=41;break}return w=(0,o.Z)(b[y],2),w[0],g=w[1],e.next=36,g.previewPrimaryIds({cache:!0});case 36:for(_=e.sent,x=0,k=["RNA","ADT","CRISPR"];x<k.length;x++)(S=k[x])in _&&(m[S]?m[S].push(_[S]):m[S]=[_[S]]);case 38:y++,e.next=32;break;case 41:for(Z=0,O=Object.entries(m);Z<O.length;Z++)R=(0,o.Z)(O[Z],2),C=R[0],A=R[1],h[C]=E.wf(A).length;postMessage({type:"PREFLIGHT_OPTIONS_DATA",resp:h,msg:"Success: PREFLIGHT_OPTIONS done"});case 43:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}))}else"kanadb"===D[Object.keys(D)[0]].format&&ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=D[Object.keys(D)[0]].file,e.next=3,g(n);case 3:return r=e.sent,s=new TextDecoder,o=JSON.parse(s.decode(r)),e.next=8,i.j5(o,b,{state:$,startFun:K,finishFun:se});case 8:$=e.sent;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}))}else if("EXPORT"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,o,c,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=function(e,t,r){var a=String(n.length);return n.push(r.buffer()),a},e.next=4,i.JZ($,r);case 4:for(s=e.sent,(o=new(M())).file("config.json",JSON.stringify(s)),c=0;c<n.length;c++)o.file("datasets/"+String(c),n[c]);return e.next=10,o.generateAsync({type:"uint8array"});case 10:u=e.sent,postMessage({type:"exportState",resp:u,msg:"Success: application state exported"},[u.buffer]);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}));else if("EXPORT_RDS"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,o,u,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.lC($,"sce",{forceBuffer:!0});case 2:return n=e.sent,e.next=5,i.bL($,"",{forceBuffer:!0});case 5:r=e.sent,s=(0,c.Z)(r);try{for(s.s();!(o=s.n()).done;)u=o.value,n.push(u)}catch(V){s.e(V)}finally{s.f()}return e.next=10,i.o2(n);case 10:l=e.sent,postMessage({type:"exportRDSState",resp:l,msg:"Success: application state exported"},[l.buffer]);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}));else if("SAVEKDB"===n){var j=d.title;ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,o,c,u,l,f,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],o=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,s,o){var c,i,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=o.buffer(),e.next=3,R.FB(c);case 3:return i=e.sent,u=n+"_"+o.name()+"_"+c.length+"_"+i,e.next=7,m(u,c);case 7:return r.push(u),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),e.next=4,i.JZ($,o);case 4:return c=e.sent,u=new TextEncoder,l=u.encode(JSON.stringify(c)),e.next=9,v(null,l,c,j);case 9:return f=e.sent,e.next=12,p();case 12:d=e.sent,postMessage({type:"KanaDB_store",resp:d,msg:"Success: Saved analysis to browser (".concat(f,")")});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}))}else if("REMOVEKDB"===n){var T=d.id;(function(e){return Z.apply(this,arguments)})(T).then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:n=e.sent,postMessage({type:"KanaDB_store",resp:n,msg:"Success: Removed file from cache (".concat(T,")")});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}))}else if("PREFLIGHT_OPTIONS"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,c,i,u,l,f,p,m,h,v,y,b,w,g,_;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},e.prev=1,r=0,s={},c=0,i=Object.entries(d.inputs.files);case 5:if(!(c<i.length)){e.next=19;break}if(u=(0,o.Z)(i[c],2),u[0],!("uid"in(l=u[1]))){e.next=15;break}if(f=W[l.uid],!(Array.isArray(d.options)&&d.options.length>r)){e.next=15;break}return f.setOptions(d.options[r]),e.next=13,f.previewPrimaryIds({cache:!0});case 13:for(p=e.sent,m=0,h=["RNA","ADT","CRISPR"];m<h.length;m++)(v=h[m])in p&&(s[v]?s[v].push(p[v]):s[v]=[p[v]]);case 15:r++;case 16:c++,e.next=5;break;case 19:for(y=0,b=Object.entries(s);y<b.length;y++)w=(0,o.Z)(b[y],2),g=w[0],(_=w[1]).length!==d.options.length?n[g]=0:n[g]=E.wf(_).length;e.next=27;break;case 22:e.prev=22,e.t0=e.catch(1),console.error(e.t0),n.status="ERROR",n.reason=e.t0.toString();case 27:postMessage({type:"PREFLIGHT_OPTIONS_DATA",resp:n,msg:"Success: PREFLIGHT_OPTIONS done"});case 28:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t){return e.apply(this,arguments)}}());else if("PREFLIGHT_INPUT"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,c,i,u,l,f,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},e.prev=1,r={},s={},c=0,i=Object.entries(d.inputs.files);case 5:if(!(c<i.length)){e.next=28;break}if(u=(0,o.Z)(i[c],2),l=u[0],!("uid"in(f=u[1]))){e.next=17;break}if(f.uid in W){e.next=13;break}return W[f.uid]=re(f),e.next=12,W[f.uid].summary({cache:!0});case 12:ee[f.uid]=e.sent;case 13:r[l]=W[f.uid],s[l]=ae(ee[f.uid],f),e.next=25;break;case 17:return p=re(f),r[l]=p,e.t0=ae,e.next=22,r[l].summary({cache:!0});case 22:e.t1=e.sent,e.t2=f,s[l]=(0,e.t0)(e.t1,e.t2);case 25:c++,e.next=5;break;case 28:n.status="SUCCESS",n.details=s,e.next=37;break;case 32:e.prev=32,e.t3=e.catch(1),console.error(e.t3),n.status="ERROR",n.reason=e.t3.toString();case 37:postMessage({type:"PREFLIGHT_INPUT_DATA",resp:n,msg:"Success: PREFLIGHT_INPUT done"});case 38:case"end":return e.stop()}}),e,null,[[1,32]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}));else if("computeVersusClusters"===n)ie.then((function(e){var t,n,r=d.rank_type,a=d.modality,s=d.annotation;if(X===s)n=$.marker_detection.computeVersus(d.left,d.right),t=i.jJ(n.results[a],n.left,r);else{var o=u.Yh(ue(s));n=ce(s,o).computeVersus(o.levels.indexOf(d.left),o.levels.indexOf(d.right)),t=i.jJ(n.results[a],n.left,r)}var c=[];I(t,c),postMessage({type:"computeVersusClusters",resp:t,msg:"Success: COMPUTE_VERSUS_CLUSTERS done"},c)})).catch((function(e){console.error(e),z(n,e,h)}));else if("computeVersusSelections"===n)ie.then((function(e){var t=d.rank_type,n=$.custom_selections.computeVersus(d.left,d.right),r=i.jJ(n.results[d.modality],n.left,t),a=[];I(r,a),postMessage({type:"computeVersusSelections",resp:r,msg:"Success: COMPUTE_VERSUS_SELECTIONS done"},a)})).catch((function(e){console.error(e),z(n,e,h)}));else if("getMarkersForCluster"===n)ie.then((function(e){var t,n,r=d.cluster,a=d.rank_type,s=d.modality,o=d.annotation;if(X===o)n=$.marker_detection.fetchResults()[s],t=i.jJ(n,r,a);else{var c=u.Yh(ue(o));n=ce(o,c).fetchResults()[s],t=i.jJ(n,c.levels.indexOf(r),a)}var l=[];I(t,l),postMessage({type:"setMarkersForCluster",resp:t,msg:"Success: GET_MARKERS_FOR_CLUSTER done"},l)})).catch((function(e){console.error(e),z(n,e,h)}));else if("getGeneExpression"===n)ie.then((function(e){var t,n=d.gene,r=d.modality,a=le(r);if("RNA"===r)t=a.get(r).row(n);else if("ADT"===r)t=a.get(r).row(n);else{if("CRISPR"!==r)throw new Error("unknown feature type '"+r+"'");t=a.get(r).row(n)}postMessage({type:"setGeneExpression",resp:{gene:n,expr:t},msg:"Success: GET_GENE_EXPRESSION done"},[t.buffer])})).catch((function(e){console.error(e),z(n,e,h)}));else if("computeCustomMarkers"===n)ie.then((function(e){$.custom_selections.addSelection(d.id,d.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})).catch((function(e){console.error(e),z(n,e,h)}));else if("getMarkersForSelection"===n)ie.then((function(e){var t=$.custom_selections.fetchResults(d.cluster)[d.modality],n=i.jJ(t,1,d.rank_type),r=[];I(n,r),postMessage({type:"setMarkersForCustomSelection",resp:n,msg:"Success: GET_MARKERS_FOR_SELECTION done"},r)})).catch((function(e){console.error(e),z(n,e,h)}));else if("removeCustomMarkers"===n)ie.then((function(e){$.custom_selections.removeSelection(d.id)})).catch((function(e){console.error(e),z(n,e,h)}));else if("animateTSNE"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.tsne.animate();case 2:return e.t0=L,e.next=5,$.tsne.fetchResults();case 5:e.t1=e.sent,(0,e.t0)("tsne",e.t1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}));else if("animateUMAP"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.umap.animate();case 2:return e.t0=L,e.next=5,$.umap.fetchResults();case 5:e.t1=e.sent,(0,e.t0)("umap",e.t1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}));else if("getAnnotation"===n)ie.then((function(e){var t,n,r=d.annotation;if(t=ue(r,!!d.unfiltered),ArrayBuffer.isView(t))n={type:"array",values:t.slice()};else{var a=[],s={},o=new Int32Array(t.length);t.map((function(e,t){e in s||(s[e]=a.length,a.push(e)),o[t]=s[e]})),n={type:"factor",index:o,levels:a}}var c=[];I(n,c),postMessage({type:"setAnnotation",resp:{annotation:r,values:n},msg:"Success: GET_ANNOTATION done"},c)})).catch((function(e){console.error(e),z(n,e,h)}));else if("computeFeaturesetSummary"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,o,c,i,l,f,p,m,h,v,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=d.annotation,r=d.rank_type,s=d.cluster,o=r.indexOf("-"),X===n?L("computeFeaturesetSummary",$.feature_set_enrichment.computeEnrichment($.marker_detection.fetchResults().RNA,s,r.slice(0,o),r.slice(o+1))):Q===n?(c=$.custom_selections.fetchSelectionIndices(s),i=$.cell_filtering.fetchFilteredMatrix().numberOfColumns(),l=new Uint8Array(i),c.map((function(e){return l.set([1],e)})),f=u.Yh(l),p=ce(n,f),m=p.fetchResults().RNA,L("computeFeaturesetSummary",$.feature_set_enrichment.computeEnrichment(m,f.levels.indexOf(1),r.slice(0,o),r.slice(o+1)))):(h=u.Yh(ue(n)),v=ce(n,h),y=v.fetchResults().RNA,L("computeFeaturesetSummary",$.feature_set_enrichment.computeEnrichment(y,h.levels.indexOf(s),r.slice(0,o),r.slice(o+1))));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}));else if("computeFeaturesetVSSummary"===n)ie.then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,s,o,c,i,l,f,p,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=d.annotation,r=d.rank_type,s=d.left,o=d.right,c=r.indexOf("-"),X===n?(i=$.marker_detection.computeVersus(s,o),L("computeFeaturesetVSSummary",$.feature_set_enrichment.computeEnrichment(i.results.RNA,i.left,r.slice(0,c),r.slice(c+1)))):Q===n?(l=$.custom_selections.computeVersus(s,o),L("computeFeaturesetVSSummary",$.feature_set_enrichment.computeEnrichment(l.results.RNA,0,r.slice(0,c),r.slice(c+1)))):(f=u.Yh(ue(n)),p=ce(n,f),m=p.computeVersus(f.levels.indexOf(d.left),f.levels.indexOf(d.right)),L("computeFeaturesetVSSummary",$.feature_set_enrichment.computeEnrichment(m.results.RNA,m.left,r.slice(0,c),r.slice(c+1))));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),z(n,e,h)}));else if("getFeatureScores"===n)ie.then((function(e){var t=d.index;L("setFeatureScores",$.feature_set_enrichment.computePerCellScores(t))})).catch((function(e){console.error(e),z(n,e,h)}));else if("getFeatureGeneIndices"===n)ie.then((function(e){var t,n,r=d.index,a=d.cluster,s=d.annotation,c=d.modality,l=d.rank_type,f=$.feature_set_enrichment.fetchFeatureSetIndices(r);if(X===s)t=$.marker_detection.fetchResults()[c],n=i.jJ(t,a,l);else if(Q===s)t=$.custom_selections.fetchResults(d.cluster)[d.modality],n=i.jJ(t,1,d.rank_type);else{var p=u.Yh(ue(s));t=ce(s,p).fetchResults()[c],n=i.jJ(t,p.levels.indexOf(a),l)}for(var m=n.ordering.map((function(e,t){return f.includes(e)?t:-100})).filter((function(e){return-100!==e})),h={},v=0,y=Object.entries(n);v<y.length;v++){var b=(0,o.Z)(y[v],2),w=b[0],g=b[1];h[w]=g.map((function(e,t){return m.includes(t)?e:-100})).filter((function(e){return-100!==e}))}L("setFeatureGeneIndices",h)})).catch((function(e){console.error(e),z(n,e,h)}));else if("computeCellAnnotation"===n){var B=d.annotation,N=d.cluster,F={per_reference:{}},U=null;if(X===B)U=$.marker_detection.fetchResults();else if(Q===B)U=$.custom_selections.fetchResults(N);else{U=ce(B,u.Yh(ue(B))).fetchResults()}null!==U&&"RNA"in U&&(F=$.cell_labelling.computeLabels(U.RNA)),L("computeCellAnnotation",F)}else console.error("Type: ".concat(n," not defined")),z(n,"Type: ".concat(n," not defined"),h)}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=e,n.x=function(){var e=n.O(void 0,[660,316,797],(function(){return n(9612)}));return e=n.O(e)},function(){var e=[];n.O=function(t,r,a,s){if(!r){var o=1/0;for(l=0;l<e.length;l++){r=e[l][0],a=e[l][1],s=e[l][2];for(var c=!0,i=0;i<r.length;i++)(!1&s||o>=s)&&Object.keys(n.O).every((function(e){return n.O[e](r[i])}))?r.splice(i--,1):(c=!1,s<o&&(o=s));if(c){e.splice(l--,1);var u=a();void 0!==u&&(t=u)}}return t}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[r,a,s]}}(),n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+"."+{316:"eb84e2a6",484:"b47e056c",660:"a06ab819",797:"2ea1277f",909:"ae8cc874",933:"0a47656f"}[e]+".chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/kana/",function(){n.b=self.location+"/../../../";var e={612:1};n.f.i=function(t,r){e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkkana=self.webpackChunkkana||[],r=t.push.bind(t);t.push=function(t){var a=t[0],s=t[1],o=t[2];for(var c in s)n.o(s,c)&&(n.m[c]=s[c]);for(o&&o(n);a.length;)e[a.pop()]=1;r(t)}}(),function(){var e=n.x;n.x=function(){return Promise.all([660,316,797].map(n.e,n)).then(e)}}();n.x()}();
//# sourceMappingURL=612.5f934c7c.chunk.js.map