/*! For license information please see 978.92a21f88.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkkana=self.webpackChunkkana||[]).push([[522,978],{141:(e,t,n)=>{n.d(t,{F6:()=>i.F,Fp:()=>r.F,Pm:()=>l.Pm,VM:()=>h.V,Z8:()=>o.Z,dn:()=>s.d,f8:()=>a.f,hp:()=>u.hp,kA:()=>c.kA,s5:()=>o.s,uw:()=>f,we:()=>u.we});var r=n(8142),i=n(7967),a=n(2814),s=n(7265),l=(n(5660),n(8002)),o=n(2779),c=n(7633),u=n(6774),h=n(6164);const f={"10X":r.F,MatrixMarket:a.f,H5AD:i.F,SummarizedExperiment:s.d,"ArtifactDB-zipped":l.Pm}},507:(e,t,n)=>{n.d(t,{Ag:()=>f,KE:()=>d,_i:()=>u,ll:()=>A});var r=n(3619),i=n(4418),a=n(6873),s=n(5406),l=n(4717),o=n(7961),c=n(5361);async function u(e,t){let n=await t.get((0,c.uJ)(e,"OBJECT"),{asBuffer:!0});try{let e=new TextDecoder;return JSON.parse(e.decode(n))}finally{await t.clean(n)}}const h={};async function f(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null==t&&(t=await u(e,n));let c=t.type;if(c in h)return h[c](e,t,n,r);{const u={simple_list:i.L,data_frame:a.K,summarized_experiment:s.B,ranged_summarized_experiment:l.I,single_cell_experiment:o.u};if(c in u)return u[c](e,t,n,r);throw new Error("type '"+c+"' is not supported")}}const d=[];async function A(e,t,n){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var u=d.length;u>0;u--){const[r,i]=d[u-1];if(e instanceof r)return void await i(e,t,n,c)}const h=[[r.ky,o.J],[r.eV,l.R],[r.HH,s.e],[r.CP,a.F],[r.B8,i.A]];for(const[r,i]of h)if(e instanceof r)return void await i(e,t,n,c);throw new Error("object of type '"+e.constructor.name+"' is not supported")}},713:(e,t,n)=>{n.d(t,{OD:()=>f,nL:()=>u});n(2697),n(1653),n(5817),n(4935),n(4201),n(6292),n(3819),n(8833),n(5305);var r=n(8042),i=n(9894),a=n(1520),s=n(4468),l=n(6629),o=n(5869);n(945),n(928),n(3571),n(1040),n(6302),n(7465),n(2925),n(6747),n(8829);const c=[r.P,i.P,a.P];function u(e,t){let n,r;if("mnn"==t)n=t,r="project";else if("regress"==t)n="none",r=t;else{if("none"!=t)throw new Error("unknown correction method '"+t+"'");n=t,r=t}e[l.P].method=n;for(const i of c)e[i].block_method=r;return e}const h=[l.P,s.P,o.P];function f(e,t){for(const n of h)e[n].approximate=t;return e}},1522:(e,t,n)=>{n.d(t,{A1:()=>i.A1,DV:()=>l.D,F6:()=>s.F6,Fp:()=>s.Fp,JH:()=>l.J,Jk:()=>h.Jk,OD:()=>r.OD,Pm:()=>s.Pm,SR:()=>a.SR,Ug:()=>u.Ug,VM:()=>s.VM,Z8:()=>s.Z8,Zx:()=>c.Z,cf:()=>o.cf,dn:()=>s.dn,f8:()=>s.f8,fc:()=>i.fc,hO:()=>a.hO,hp:()=>s.hp,kA:()=>s.kA,nL:()=>r.nL,n_:()=>d,s5:()=>s.s5,uw:()=>s.uw,v9:()=>i.v9});var r=n(713),i=n(9830),a=n(7212),s=n(141),l=n(7709),o=n(9692),c=(n(3983),n(1653)),u=n(8829),h=(n(6747),n(7465)),f=(n(2925),n(7990));function d(){let{numberOfThreads:e=1,localFile:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=f.n_({numberOfThreads:e,localFile:t});return o.Cr.localFile=t,n.then(e=>null)}},1576:(e,t,n)=>{n.d(t,{Ag:()=>r.Ag,KE:()=>r.KE,YG:()=>i.Y,_i:()=>r._i,dm:()=>a.d,ll:()=>r.ll,m9:()=>a.m,uJ:()=>s.uJ});n(6873),n(4717),n(7961);var r=n(507),i=n(852),a=n(545),s=n(5361)},1989:(e,t,n)=>{n.d(t,{z7:()=>p});var r=n(5149),i=n(8458),a=n(4558),s=n(7990),l=n(1576),o=n(2416);function c(e,t){let n=null;if("maxStringLength"in t&&(n=t.maxStringLength),null==n){if(null==e)throw new Error("'maxStringLength' must be supplied if 'data' is null");n=s.l6(e,null)}return new s.BB("UTF-8",n)}var u=new WeakMap;class h extends l.dm{constructor(e){super(),(0,r.A)(this,u,void 0),(0,a.A)(u,this,e)}writeAttribute(e,t,n,r){"String"==t&&(t=c(r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{})),(0,i.A)(u,this).writeAttribute(e,t,n,r)}open(e){let t=(0,i.A)(u,this).open(e);return t instanceof s.dm?new h(t):new d(t)}children(){return(0,i.A)(u,this).children}createGroup(e){return new h((0,i.A)(u,this).createGroup(e))}createDataSet(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return"data"in r?("String"==t&&(t=c(r.data,r)),new d((0,i.A)(u,this).writeDataSet(e,t,n,r.data))):("String"==t&&(t=c(null,r)),new d((0,i.A)(u,this).createDataSet(e,t,n)))}close(){}}var f=new WeakMap;class d extends l.m9{constructor(e){super(),(0,r.A)(this,f,void 0),(0,a.A)(f,this,e)}writeAttribute(e,t,n,r){"String"==t&&(t=c(r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{})),(0,i.A)(f,this).writeAttribute(e,t,n,r)}write(e){(0,i.A)(f,this).write(e)}close(){}}var A=new WeakMap,m=new WeakMap;class p extends l.YG{constructor(e,t){super(),(0,r.A)(this,A,void 0),(0,r.A)(this,m,void 0),(0,a.A)(A,this,e),(0,a.A)(m,this,t)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!==(0,i.A)(A,this)){const{asBuffer:n=!0}=t;return o.LF((0,i.A)(A,this),e,n)}return(0,i.A)(m,this)[e]}clean(e){}async write(e,t){null!==(0,i.A)(A,this)?await o.M9((0,i.A)(A,this),e,t):(0,i.A)(m,this)[e]=t}async mkdir(e){null!==(0,i.A)(A,this)&&await o.Ck((0,i.A)(A,this),e)}async copy(e,t){null!==(0,i.A)(A,this)?await o.C((0,i.A)(A,this),e,t):(0,i.A)(m,this)[t]=(0,i.A)(m,this)[e]}h5create(e){if(null!==(0,i.A)(A,this)){let t=l.uJ((0,i.A)(A,this),e),n=s.S$(t),r=new h(n);return r._path=t,r}{let t=s.So(),n=s.S$(t),r=new h(n);return r._path=t,r._intended=e,r}}h5finish(e,t){null===(0,i.A)(A,this)&&(t||this.write(e._intended,s.TA(e._path)),s.nM(e._path))}}},2416:(e,t,n)=>{function r(){return!1}function i(e,t,n){throw new Error("read() is not supported in a web context")}function a(e,t,n){throw new Error("write() is not supported in a web context")}function s(e,t){throw new Error("mkdir() is not supported in a web context")}function l(e,t,n){throw new Error("copy() is not supported in a web context")}n.d(t,{C:()=>l,Ck:()=>s,LF:()=>i,M9:()=>a,sy:()=>r})},2697:(e,t,n)=>{n.d(t,{P4:()=>f,Xj:()=>y,v9:()=>C});var r=n(9379),i=n(9790),a=n(5149),s=n(6562),l=n(8458),o=n(4558),c=n(7990),u=n(3619),h=n(1276);n(141);const f="inputs",d="raw_subset_indices";var A=new WeakMap,m=new WeakMap,p=new WeakMap,w=new WeakMap,g=new WeakSet;class y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,i.A)(this,g),(0,a.A)(this,A,void 0),(0,a.A)(this,m,void 0),(0,a.A)(this,p,void 0),(0,a.A)(this,w,void 0),(0,o.A)(A,this,null===e?{}:e),(0,o.A)(m,this,null===t?{}:t),(0,o.A)(p,this,null===n?{}:n),(0,o.A)(w,this,!1),this.changed=!1}free(){h.xr((0,l.A)(m,this).matrix),h.xr((0,l.A)(m,this).raw_matrix),h.xr((0,l.A)(m,this).block_ids),h.xr((0,l.A)(m,this).raw_block_ids),h.xr((0,l.A)(m,this).multi_block_ids)}fetchCountMatrix(){return(0,l.A)(m,this).matrix}fetchFeatureAnnotations(){return(0,l.A)(m,this).genes}fetchCellAnnotations(){return(0,l.A)(m,this).annotations}fetchBlock(){return(0,l.A)(m,this).block_ids}fetchBlockLevels(){return(0,l.A)(m,this).block_levels}fetchParameters(){var e;let t=(0,r.A)({},(0,l.A)(A,this));return t.subset=(0,s.A)(y,e=this.constructor,_).call(e,t.subset),t}fetchDatasets(){return(0,l.A)(m,this).datasets}fetchDirectSubset(){let{copy:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(d in(0,l.A)(m,this)){let t=(0,l.A)(m,this)[d];return e?t.slice():t}return null}guessRnaFeatureTypes(){return"RNA"in(0,l.A)(m,this).genes?("inferred_rna_types"in(0,l.A)(m,this)||((0,l.A)(m,this).inferred_rna_types=h.RA((0,l.A)(m,this).genes.RNA)),(0,l.A)(m,this).inferred_rna_types):null}static defaults(){return{block_factor:null,subset:null}}enableDatasetCache(e){(0,o.A)(w,this,e)}async compute(e,t){if(t=h.wn(t,y.defaults()),this.changed=!1,null!==e){let t={};for(const[n,r]of Object.entries(e))t[n]={format:r.constructor.format(),details:r.abbreviate()};h.PG(t,(0,l.A)(p,this))&&(await async function(e,t,n){h.xr(t.raw_matrix),h.xr(t.matrix),h.xr(t.multi_block_ids);let r=await async function(e,t){let n=Object.keys(e);n.sort();let r,i=[];try{for(const r of n)i.push(await e[r].load({cache:t}))}catch(a){for(const e of i)c.t9(e.matrix);throw a}if(1==n.length)try{r=function(e){if(0==e.matrix.available().length)throw new Error("no available modalities");let t={matrix:new c.P_,features:{}};try{for(const n of b)e.matrix.has(n)&&(t.matrix.add(n,e.matrix.get(n)),t.features[n]=e.features[n])}catch(a){throw c.t9(t.matrix),a}return t.cells=e.cells,t.block_ids=null,t.block_levels=null,t}(i[0])}catch(a){throw c.t9(i[0].matrix),a}else try{r=function(e,t){let n,r=[];for(const a of b){let e=!0;for(const n of t)if(!n.matrix.has(a)){e=!1;break}e&&r.push(a)}if(0==r.length)throw new Error("failed to find common modalities across all datasets");let i={matrix:new c.P_,features:{}};try{for(const e of r){let n=E(e,t);i.matrix.add(e,n.matrix),i.features[e]=n.features}let a=t.map(e=>e.cells);i.cells=u.I4(a);let s=new Array(t.length);t.forEach((e,t)=>{s[t]=e.matrix.numberOfColumns()}),n=c.D_(s),i.block_ids=n,i.block_levels=e;let l=new Array(n.length);n.forEach((t,n)=>{l[n]=e[t]}),i.cells.$setColumn("__batch__",l)}catch(a){throw h.xr(n),h.xr(i.matrix),a}return i}(n,i)}finally{for(const e of i)c.t9(e.matrix)}return r}(e,n);t.raw_matrix=r.matrix,t.raw_annotations=r.cells,t.multi_block_ids=r.block_ids,t.multi_block_levels=r.block_levels,t.genes=r.features}(e,(0,l.A)(m,this),(0,l.A)(w,this)),(0,o.A)(p,this,t),(0,l.A)(m,this).datasets=(0,r.A)({},e),delete(0,l.A)(m,this).inferred_rna_types,this.changed=!0)}(this.changed||(0,l.A)(A,this).block_factor!==t.block_factor)&&(!function(e,t){h.xr(t.raw_block_ids);let n=null,r=null;if(null!==e)try{let i=t.raw_annotations.column(e);if(i.length!=t.raw_matrix.numberOfColumns())throw new Error("length of blocking factor '"+e+"' should be equal to the number of cells");let a=c.K$(i,{action:"none",placeholder:x});n=a.ids,r=a.levels}catch(i){throw h.xr(n),i}else n=null!==t.multi_block_ids?t.multi_block_ids.view():null,r=t.multi_block_levels;t.raw_block_ids=n,t.raw_block_levels=r}(t.block_factor,(0,l.A)(m,this)),this.changed=!0),(this.changed||!(d in(0,l.A)(m,this))&&h.PG(t.subset,(0,l.A)(A,this).subset)||!("matrix"in(0,l.A)(m,this)))&&(B(t.subset,(0,l.A)(m,this)),this.changed=!0),(0,o.A)(A,this,t),(0,l.A)(A,this).subset=_.call(y,(0,l.A)(A,this).subset)}undoSubset(e){if("matrix"in(0,l.A)(m,this)){let t=this.fetchCountMatrix().numberOfColumns();for(const n of e)if(n<0||n>=t)throw new Error("entries of 'indices' should be less than the number of cells in the dataset")}let t=null;"subset"in(0,l.A)(A,this)&&(t=(0,l.A)(A,this).subset);let n=I(t,(0,l.A)(m,this));null!==n&&e.forEach((t,r)=>{e[r]=n[t]})}setDirectSubset(e){let{copy:t=!0,onOriginal:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!==e?(0,l.A)(m,this)[d]=(0,s.A)(g,this,v).call(this,e,t,n):delete(0,l.A)(m,this)[d],c.t9((0,l.A)(m,this).matrix),delete(0,l.A)(m,this).matrix}createDirectSubset(e){let{copy:t=!0,onOriginal:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={};r[d]=(0,s.A)(g,this,v).call(this,e,t,n),r.raw_matrix=(0,l.A)(m,this).raw_matrix.clone();for(const a of["multi_block_ids","raw_block_ids"])a in(0,l.A)(m,this)&&(null===(0,l.A)(m,this)[a]?r[a]=null:r[a]=(0,l.A)(m,this)[a].clone());for(const a of["raw_annotations","genes","multi_block_levels","raw_block_levels"])a in(0,l.A)(m,this)&&(r[a]=(0,l.A)(m,this)[a]);B(null,r);let i=this.fetchParameters();return i.subset=null,new y(i,r,(0,l.A)(p,this))}}function _(e){if(null==e)return e;let t=(0,r.A)({},e);return"values"in t&&(t.values=t.values.slice()),"ranges"in t&&(t.ranges=t.ranges.map(e=>e.slice())),t}function v(e,t,n){return h.O_(e,null),t&&(e=e.slice()),n||this.undoSubset(e),e}const b=["RNA","ADT","CRISPR"];function E(e,t){let n={};try{let i=[],a=[];for(var r=0;r<t.length;r++){a.push(t[r].matrix.get(e));let n=t[r].primary_ids[e];if(null==n)throw new Error("modality '"+e+"' lacks a primary identifier for dataset "+String(r));i.push(n)}let s=c.RZ(a,i);n.matrix=s.matrix,n.features=u.$9(t[0].features[e],s.indices)}catch(i){throw h.xr(n.matrix),i}return n}const x=-1;function I(e,t){let n;if(d in t)n=t[d];else if(null==e)n=null;else{if(!t.raw_annotations.hasColumn(e.field))throw new Error("failed to find '"+e.field+"' in the column annotations");let r=t.raw_annotations.column(e.field);if(n=[],"values"in e){let t=new Set(e.values);r.forEach((e,r)=>{t.has(e)&&n.push(r)})}else r.forEach((t,r)=>{for(const i of e.ranges)if(t>=i[0]&&t<=i[1])return void n.push(r)})}if("raw_block_ids"in t&&null!==t.raw_block_ids){let e=t.raw_block_ids.array(),i=[];if(null!==n)for(const t of n)e[t]!==x&&i.push(t);else for(var r=0;r<e.length;r++)e[r]!==x&&i.push(r);n=i}return n}function B(e,t){h.xr(t.matrix),h.xr(t.block_ids);let n,r,i,a,s=I(e,t);try{if(null===s)n=t.raw_annotations,r=t.raw_matrix.clone(),null!==t.raw_block_ids?(i=t.raw_block_ids.view(),a=t.raw_block_levels):(i=null,a=null);else{if(n=u.$9(t.raw_annotations,s),null!==t.raw_block_ids){let e=c.Wo({ids:t.raw_block_ids,levels:t.raw_block_levels},s);i=e.ids,a=e.levels}else i=null,a=null;r=new c.P_;for(const e of t.raw_matrix.available()){let n=t.raw_matrix.get(e);r.add(e,c._r(n,s))}}}catch(l){throw h.xr(r),h.xr(i),l}t.annotations=n,t.block_levels=a,t.block_ids=i,t.matrix=r}var S=null;function C(e){let t=S;return S=e,t}},2779:(e,t,n)=>{n.d(t,{Z:()=>V,s:()=>z});var r=n(9379),i=n(9790),a=n(6562),s=n(5149),l=n(8458),o=n(4558),c=n(7990),u=n(3619),h=(n(6774),n(4736)),f=(n(6164),n(1576)),d=new WeakMap,A=new WeakMap;class m extends f.dm{constructor(e,t){super(),(0,s.A)(this,d,void 0),(0,s.A)(this,A,void 0),(0,o.A)(d,this,e),(0,o.A)(A,this,t)}attributes(){return(0,l.A)(d,this).attributes}readAttribute(e){let t=(0,l.A)(d,this).readAttribute(e);return{values:t.values,shape:t.shape}}children(){return Array.from(Object.keys((0,l.A)(d,this).children))}open(e){let t=(0,l.A)(d,this).open(e);return t instanceof c.dm?new m(t):new w(t)}close(){}_flush(){(0,l.A)(A,this).call(this)}}var p=new WeakMap;class w extends f.m9{constructor(e){super(),(0,s.A)(this,p,void 0),(0,o.A)(p,this,e)}attributes(){return(0,l.A)(p,this).attributes}readAttribute(e){let t=(0,l.A)(p,this).readAttribute(e);return{values:t.values,shape:t.shape}}type(){let e=(0,l.A)(p,this).type;return e instanceof c.BB?"String":e instanceof c.z4?e.members:e}shape(){return(0,l.A)(p,this).shape}values(){return(0,l.A)(p,this).values}close(){}}var g=new WeakMap;class y extends f.YG{constructor(e){super(),(0,s.A)(this,g,void 0),(0,o.A)(g,this,e)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{asBuffer:n=!1}=t;return(0,l.A)(g,this).get(e,n)}exists(e){return(0,l.A)(g,this).exists(e)}clean(e){(0,l.A)(g,this).clean(e)}async h5open(e){let t=c.He(await this.get(e));try{return new m(new c.CE(t.path),t.flush)}catch(n){throw t.flush(),n}}h5close(e){e._flush()}}var _=new WeakMap,v=new WeakMap,b=new WeakMap;class E{constructor(e,t,n){(0,s.A)(this,_,void 0),(0,s.A)(this,v,void 0),(0,s.A)(this,b,void 0),(0,o.A)(_,this,e),(0,o.A)(v,this,t),(0,o.A)(b,this,n)}_bioconductor_NUMBER_OF_ROWS(){return(0,l.A)(_,this)}_bioconductor_NUMBER_OF_COLUMNS(){return(0,l.A)(v,this)}async realize(e,t,n){let r=await f._i((0,l.A)(b,this),e);if("delayed_array"!=r.type)return x((0,l.A)(b,this),r,e,t,n);{let r=await e.get(f.uJ((0,l.A)(b,this),"array.h5"));try{let i=c.He(r);try{let r=new c.CE(i.path),a=await I(r.open("delayed_array"),(0,l.A)(b,this),e,t,n);if(null==a)throw new Error("currently only supporting bakana-generated log-counts for delayed arrays");return a}finally{i.flush()}}finally{await e.clean(r)}}}}async function x(e,t,n,r,i){if("compressed_sparse_matrix"==t.type){let t=await n.get(f.uJ(e,"matrix.h5"));try{let e=c.He(t);try{let t=new c.CE(e.path);const n="compressed_sparse_matrix";let i=t.open(n);const a=i.open("shape").values,s=i.readAttribute("layout").values[0];return c.KR(e.path,n,a[0],a[1],"CSR"==s,{forceInteger:r})}finally{e.flush()}}finally{await n.clean(t)}}else{if("dense_array"!=t.type)throw new Error("unknown matrix type '"+t.type+"'");{let t=await n.get(f.uJ(e,"array.h5"));try{let e=c.He(t);try{let t=new c.CE(e.path);const n="dense_array";let a=t.open(n),s=!1;if(a.attributes.indexOf("transposed")>=0){s=0!=a.readAttribute("transposed").values[0]}return c.fR(e.path,n+"/data",{transposed:s,forceInteger:r,forceSparse:i})}finally{e.flush()}}finally{await n.clean(t)}}}}async function I(e,t,n,r,i){const a=e.readAttribute("delayed_type").values[0];if("operation"===a){let a=e.readAttribute("delayed_operation").values[0];if("unary arithmetic"===a){const a=await I(e.open("seed"),t,n,r,i),s=e.open("value");let l=s.values,o="row";return 0==s.shape.length?l=l[0]:o=0===e.open("along").values[0]?"row":"column",c.$$(a,e.open("method").values[0],l,{right:"right"===e.open("side").values[0],along:o,inPlace:!0})}if("unary math"===a){const a=await I(e.open("seed"),t,n,r,i),s=e.open("method").values[0];let l=null;return"log"==s&&"base"in e.children&&(l=e.open("base").values[0]),c.rS(a,s,{logBase:l,inPlace:!0})}if("transpose"==a){const a=await I(e.open("seed"),t,n,r,i),s=e.open("permutation").values;if(1==s[0]&&0==s[1])return c.mg(a,{inPlace:!0});if(0==s[0]&&1==s[1])return a;throw new Error("invalid permutation for transposition operation at '"+t+"'")}if("subset"==a){let a=await I(e.open("seed"),t,n,r,i);const s=e.open("index");return"0"in s.children&&(a=c._b(a,s.open("0").values,{inPlace:!0})),"1"in s.children&&(a=c._r(a,s.open("1").values,{inPlace:!0})),a}if("combine"!=a)throw new Error("unsupported delayed operation '"+a+"'");{const a=e.open("seeds");let l=[];try{const o=Object.keys(a.childen).length;for(var s=0;s<o;s++)l.push(await I(a.open(String(s)),t,n,r,i));return 0==e.open("along").values[0]?c.k(l):c.x6(l)}finally{for(const e of l)c.t9(e)}}}else{if("array"!==a)throw new Error("unsupported delayed type '"+a+"'");{let a=e.readAttribute("delayed_array").values[0];if("custom takane seed array"!==a){if("dense array"==a){let t=0!=e.open("native").values[0];return c.fR(e.file,e.name+"/data",{transposed:!t,forceInteger:r,forceSparse:i})}if("sparse matrix"==a){const t=e.open("shape").values,n=0==e.open("by_column").values[0];return c.KR(e.file,e.name,t[0],t[1],n,{forceInteger:r})}throw new Error("unsupported delayed array '"+a+"'")}{let a,s=e.open("index").values[0],l=f.uJ(t,"seeds",String(s)),o=await f._i(l,n);try{return await x(l,o,n,r,i)}finally{c.t9(a)}}}}}function B(e,t,n,r,i,a){return new E(e,t,n)}function S(e,t,n,r,i){return new E(e,2,t)}function C(e,t){let n="",r=e instanceof u.ky;r&&null!==e.mainExperimentName()&&(n=e.mainExperimentName());let i={};if(i[n]=t(e),r)for(const a of e.alternativeExperimentNames())a!==n&&(i[a]=t(e.alternativeExperiment(a)));return i}function k(e){return C(e,e=>e.rowData())}function N(e){return C(e,e=>e.assayNames())}function D(e){for(const t of e.columnNames()){let n=e.column(t);n instanceof u.B8&&e.setColumn(t,n.toArray(),{inPlace:!0})}return null}var O=new WeakMap,R=new WeakMap,Q=new WeakMap,F=new WeakSet;class z{constructor(e){(0,i.A)(this,F),(0,s.A)(this,O,void 0),(0,s.A)(this,R,void 0),(0,s.A)(this,Q,void 0),(0,o.A)(O,this,e),(0,o.A)(Q,this,z.defaults()),(0,o.A)(R,this,null)}static defaults(){return{rnaCountAssay:0,adtCountAssay:0,crisprCountAssay:0,rnaExperiment:"",adtExperiment:"Antibody Capture",crisprExperiment:"CRISPR Guide Capture",primaryRnaFeatureIdColumn:null,primaryAdtFeatureIdColumn:null,primaryCrisprFeatureIdColumn:null}}options(){return(0,r.A)({},(0,l.A)(Q,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,l.A)(Q,this)[t]=n}clear(){(0,o.A)(R,this,null)}async summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,a.A)(F,this,M).call(this);let t={modality_features:k((0,l.A)(R,this)),cells:(0,l.A)(R,this).columnData(),modality_assay_names:N((0,l.A)(R,this))};return e||this.clear(),t}async previewPrimaryIds(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,a.A)(F,this,M).call(this);let t={RNA:(0,l.A)(Q,this).rnaExperiment,ADT:(0,l.A)(Q,this).adtExperiment,CRISPR:(0,l.A)(Q,this).crisprExperiment},n=k((0,l.A)(R,this)),r=[];(0,l.A)(R,this)instanceof u.ky&&(r=(0,l.A)(R,this).alternativeExperimentNames());let i=h.q(n,r,t,(0,a.A)(F,this,J).call(this));return e||this.clear(),i}async load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,a.A)(F,this,M).call(this);let t={matrix:new c.P_,features:{},cells:(0,l.A)(R,this).columnData()},n={RNA:{exp:(0,l.A)(Q,this).rnaExperiment,assay:(0,l.A)(Q,this).rnaCountAssay},ADT:{exp:(0,l.A)(Q,this).adtExperiment,assay:(0,l.A)(Q,this).adtCountAssay},CRISPR:{exp:(0,l.A)(Q,this).crisprExperiment,assay:(0,l.A)(Q,this).crisprCountAssay}},r=C((0,l.A)(R,this),e=>e);try{for(const[e,i]of Object.entries(n)){if(null===i.exp||!(i.exp in r))continue;let n=r[i.exp],s=await n.assay(i.assay).realize((0,a.A)(F,this,P).call(this),!0,!0);t.matrix.add(e,s),t.features[e]=n.rowData()}t.primary_ids=h.gu(t.features,(0,a.A)(F,this,J).call(this))}catch(i){throw c.t9(t.matrix),i}return e||this.clear(),t}}function P(){return new y((0,l.A)(O,this))}async function M(){null===(0,l.A)(R,this)&&((0,o.A)(R,this,await f.Ag(".",null,(0,a.A)(F,this,P).call(this),{DataFrame_readNested:!1,DataFrame_readMetadata:!1,SummarizedExperiment_readAssay:B,SummarizedExperiment_readMetadata:!1,SingleCellExperiment_readReducedDimension:!1})),D((0,l.A)(R,this).columnData()),C((0,l.A)(R,this),e=>D(e.rowData())))}function J(){return{RNA:(0,l.A)(Q,this).primaryRnaFeatureIdColumn,ADT:(0,l.A)(Q,this).primaryAdtFeatureIdColumn,CRISPR:(0,l.A)(Q,this).primaryCrisprFeatureIdColumn}}var q=new WeakMap,W=new WeakMap,U=new WeakMap,T=new WeakSet;class V{constructor(e){(0,i.A)(this,T),(0,s.A)(this,q,void 0),(0,s.A)(this,W,void 0),(0,s.A)(this,U,void 0),(0,o.A)(q,this,e),(0,o.A)(U,this,V.defaults()),(0,o.A)(W,this,null)}static defaults(){return{primaryAssay:0,isPrimaryNormalized:!0,reducedDimensionNames:null}}options(){return(0,r.A)({},(0,l.A)(U,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,l.A)(U,this)[t]=u.UC(n)}clear(){(0,o.A)(W,this,null)}async summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,a.A)(T,this,G).call(this);let t={modality_features:k((0,l.A)(W,this)),cells:(0,l.A)(W,this).columnData(),modality_assay_names:N((0,l.A)(W,this)),reduced_dimension_names:[]};return(0,l.A)(W,this)instanceof u.ky&&(t.reduced_dimension_names=(0,l.A)(W,this).reducedDimensionNames()),e||this.clear(),t}async load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,a.A)(T,this,G).call(this);let t={matrix:new c.P_,features:{},cells:(0,l.A)(W,this).columnData(),reduced_dimensions:{}};if((0,l.A)(W,this)instanceof u.ky){let e=(0,l.A)(U,this).reducedDimensionNames;null===e&&(e=(0,l.A)(W,this).reducedDimensionNames());for(const r of e){let e=await(0,l.A)(W,this).reducedDimension(r).realize((0,a.A)(T,this,j).call(this),!1,!1);try{let i=[],a=e.numberOfColumns();for(var n=0;n<a;n++)i.push(e.column(n));t.reduced_dimensions[r]=i}finally{c.t9(e)}}}const r=C((0,l.A)(W,this),e=>e);try{for(const[e,n]of Object.entries(r)){let r=(0,l.A)(U,this).primaryAssay;if("object"==typeof r){if(!(e in r))continue;r=r[e]}let i=(0,l.A)(U,this).isPrimaryNormalized;"object"==typeof i&&(i=!(e in i)||i[e]);let s=await n.assay(r).realize((0,a.A)(T,this,j).call(this),!i,!0);if(t.matrix.add(e,s),!i){let n=c.mM(s,{allowZeros:!0});t.matrix.add(e,n)}t.features[e]=n.rowData()}}catch(i){throw c.t9(t.matrix),i}return e||this.clear(),t}}function j(){return new y((0,l.A)(q,this))}async function G(){null===(0,l.A)(W,this)&&((0,o.A)(W,this,await f.Ag(".",null,(0,a.A)(T,this,j).call(this),{DataFrame_readNested:!1,DataFrame_readMetadata:!1,SummarizedExperiment_readAssay:B,SummarizedExperiment_readMetadata:!1,SingleCellExperiment_readReducedDimension:S})),D((0,l.A)(W,this).columnData()),C((0,l.A)(W,this),e=>D(e.rowData())))}},2925:(e,t,n)=>{n.d(t,{P4:()=>m,el:()=>x});var r=n(5149),i=n(8458),a=n(4558),s=n(9790),l=n(6562),o=n(7990),c=n(1276),u=n(3983),h=n(4201),f=n(6292),d=n(3819),A=n(8833);const m="custom_selections";var p=new WeakSet;class w{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,s.A)(this,p),this._selections=null==e?{}:e,this._cache=null==t?{results:{}}:t}free(){c.xr(this._cache.buffer),delete this._cache.buffer;for(const e of Object.keys(this._cache.results))(0,l.A)(p,this,g).call(this,e);this._cache.results={},u.T9(this._cache.versus),delete this._cache.versus}addSelection(e,t,n,r,i,a,s,u){let h=r(n[0]).numberOfColumns();c.O_(t,h);var f=c.RK(h,"Int32Array",this._cache);f.fill(0);var d=f.array();t.forEach(e=>{d[e]=1});let A={};for(const l of n){let e=r(l);A[l]=o.Kq(e,f,{block:i,threshold:s,computeAuc:u})}e in this._cache.results&&(0,l.A)(p,this,g).call(this,e),this._cache.results[e]={raw:A},a&&(t=t.slice()),this._selections[e]=t}removeSelection(e){(0,l.A)(p,this,g).call(this,e),delete this._cache.results[e],delete this._selections[e]}fetchResults(e){return this._cache.results[e].raw}fetchSelectionIndices(e){let{copy:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._selections[e];return t&&(n=n.slice()),n}fetchSelections(){let{copy:e=!0,force:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={};for(const[r,i]of Object.entries(this._selections)){let a=i,s=e;null!==t&&("Array"==t?i instanceof Array||(a=Array.from(i),s=!1):"Int32Array"==t&&(i instanceof Int32Array||(a=new Int32Array(i),s=!1))),s&&(a=a.slice()),n[r]=a}return n}computeVersus(e,t,n,r,i,a,s){"versus"in this._cache||(this._cache.versus={});let l=this._cache.versus,c=u.Ni(e,t,l),h=c.left_small?0:1,f=c.left_small?1:0;if(c.run){let l=new o.P_;for(const e of n)l.add(e,r(e));let d=this._selections;if(!(e in d)||!(t in d))throw new Error("invalid selection ID requested in versus mode");let A=d[e],m=d[t];if(0==A.length||0==m.length)throw new Error("non-zero entries should be present for both requested selections in versus mode");let p=[];A.forEach(e=>{p.push({index:e,cluster:h})}),m.forEach(e=>{p.push({index:e,cluster:f})}),p.sort((e,t)=>e.index-t.index);let w=p.map(e=>e.index),g=p.map(e=>e.cluster);u.gK(l,g,i,w,c.cached,a,s)}return{results:c.cached,left:h,right:f}}}function g(e){for(const[t,n]of Object.entries(this._cache.results[e].raw))n.free()}var y=new WeakMap,_=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakSet;class x{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.A)(this,E),(0,r.A)(this,y,void 0),(0,r.A)(this,_,void 0),(0,r.A)(this,v,void 0),(0,r.A)(this,b,void 0),!(e instanceof h._))throw new Error("'filter' should be a CellFilteringState object");if((0,a.A)(y,this,e),!(t.RNA instanceof f.A))throw new Error("'norm_states.RNA' should be an RnaNormalizationState object");if(!(t.ADT instanceof d.K))throw new Error("'norm_states.ADT' should be an AdtNormalizationState object");if(!(t.CRISPR instanceof A.S))throw new Error("'norm_states.CRISPR' should be an CrisprNormalizationState object");(0,a.A)(_,this,t);let l=null;null!==n&&"selections"in n&&(l=n.selections),(0,a.A)(v,this,new w(l,i)),(0,a.A)(b,this,{}),this.changed=!1}free(){(0,i.A)(v,this).free()}fetchParameters(){return{lfc_threshold:(0,i.A)(b,this).lfc_threshold,compute_auc:(0,i.A)(b,this).compute_auc}}addSelection(e,t){let{copy:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,l.A)(E,this,I).call(this,e,t,n,(0,i.A)(b,this).lfc_threshold,(0,i.A)(b,this).compute_auc)}removeSelection(e){(0,i.A)(v,this).removeSelection(e)}fetchResults(e){return(0,i.A)(v,this).fetchResults(e)}fetchSelectionIndices(e){let{copy:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.A)(v,this).fetchSelectionIndices(e,{copy:t})}fetchSelections(){let{copy:e=!0,force:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.A)(v,this).fetchSelections({copy:e,force:t})}compute(e){if(e=c.wn(e,x.defaults()),this.changed=!1,(0,i.A)(y,this).changed&&((0,i.A)(v,this).free(),(0,a.A)(v,this,new w),this.changed=!0),e.lfc_threshold!==(0,i.A)(b,this).lfc_threshold||e.compute_auc!=(0,i.A)(b,this).compute_auc){for(const[t,n]of Object.entries((0,i.A)(v,this)._selections))(0,l.A)(E,this,I).call(this,t,n,!1,e.lfc_threshold,e.compute_auc);(0,i.A)(b,this).lfc_threshold=e.lfc_threshold,(0,i.A)(b,this).compute_auc=e.compute_auc,this.changed=!0}}static defaults(){return{lfc_threshold:0,compute_auc:!0}}computeVersus(e,t){let n=c.Rj((0,i.A)(_,this));return(0,i.A)(v,this).computeVersus(e,t,n,e=>(0,i.A)(_,this)[e].fetchNormalizedMatrix(),(0,i.A)(y,this).fetchFilteredBlock(),(0,i.A)(b,this).lfc_threshold,(0,i.A)(b,this).compute_auc)}}function I(e,t,n,r,a){let s=c.Rj((0,i.A)(_,this));(0,i.A)(v,this).addSelection(e,t,s,e=>(0,i.A)(_,this)[e].fetchNormalizedMatrix(),(0,i.A)(y,this).fetchFilteredBlock(),n,r,a)}},2952:(e,t,n)=>{n.d(t,{k:()=>c});var r=n(4467),i=n(6662),a=n(6508),s=n(8675),l=n(1430),o=n(9462);class c extends a.e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)return void super();let{reducedDimensions:n={},reducedDimensionOrder:r=null,alternativeExperiments:a={},alternativeExperimentOrder:l=null,rowRanges:c=null,mainExperimentName:u=null}=t;super(e,c,t);let h=this.numberOfColumns();try{this._reducedDimensions=new o.w(n,r)}catch(f){throw new Error("failed to initialize reduced dimension list for this "+this.constructor.className+"; "+f.message,{cause:f})}for(const s of this._reducedDimensions.names()){let e=this._reducedDimensions.entry(s);if(i.eQ(e)!==h)throw new Error("number of rows for reduced dimension '"+s+"' is not equal to number of columns for this "+this.constructor.className)}try{this._alternativeExperiments=new o.w(a,l)}catch(f){throw new Error("failed to initialize alternative experiment list for this "+this.constructor.className+"; "+f.message,{cause:f})}for(const i of this._alternativeExperiments.names()){let e=this._alternativeExperiments.entry(i);if(!(e instanceof s.H))throw new Error("alternative experiment '"+i+"' is not a SummarizedExperiment");if(e.numberOfColumns(e)!==h)throw new Error("number of columns for alternative experiment '"+i+"' is not equal to number of columns for this "+this.constructor.className)}this._mainExperimentName=u}reducedDimensionNames(){return this._reducedDimensions.names()}reducedDimension(e){let t;try{t=this._reducedDimensions.entry(e)}catch(n){throw new Error("failed to retrieve the specified reduced dimension from this "+this.constructor.className+"; "+n.message,{cause:n})}return t}reducedDimensions(){return this._reducedDimensions.entries()}alternativeExperimentNames(){return this._alternativeExperiments.names()}alternativeExperiment(e){let t;try{t=this._alternativeExperiments.entry(e)}catch(n){throw new Error("failed to retrieve the specified alternative experiment from this "+this.constructor.className+"; "+n.message,{cause:n})}return t}alternativeExperiments(){return this._alternativeExperiments.entries()}mainExperimentName(){return this._mainExperimentName}removeReducedDimension(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._reducedDimensions=n._reducedDimensions.delete(e,{inPlace:t})}catch(r){throw new Error("failed to remove the specified reduced dimension from this "+this.constructor.className+"; "+r.message,{cause:r})}return n}$removeReducedDimension(e){return this.removeReducedDimension(e,{inPlace:!0})}setReducedDimension(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i.eQ(t)!=this.numberOfColumns())throw new Error("number of rows of 'value' should be the same as the number of columns of this SingleCellExperiment");let r=l.z(this,n);return r._reducedDimensions=r._reducedDimensions.set(e,t,{inPlace:n}),r}$setReducedDimension(e,t){return this.setReducedDimension(e,t,{inPlace:!0})}setReducedDimensionNames(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._reducedDimensions=n._reducedDimensions.setNames(e,{inPlace:t})}catch(r){throw new Error("failed to set the reduced dimension names for this "+this.constructor.className+"; "+r.message,{cause:r})}return n}$setReducedDimensionNames(e){return this.setReducedDimensionNames(e,{inPlace:!0})}setReducedDimensions(e){let{inPlace:t=!1,newOrder:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=l.z(this,t);!1===n?n=r._reducedDimensions.names():1==n&&(n=null);try{r._reducedDimensions=new o.w(e,n)}catch(s){throw new Error("failed to replace reduced dimension list for this SingleCellExperiment; "+s.message,{cause:s})}let a=r.numberOfColumns();for(const l of r._reducedDimensions.names()){let e=r._reducedDimensions.entry(l);if(i.eQ(e)!==a)throw new Error("mismatch in the number of rows for reduced dimension '"+l+"' compared to the number of columns in the SingleCellExperiment")}return r}$setReducedDimensions(e){let{newOrder:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setReducedDimensions(e,{inPlace:!0,newOrder:t})}sliceReducedDimensions(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._reducedDimensions=this._reducedDimensions.slice(e,{inPlace:t})}catch(r){throw new Error("failed to slice the reduced dimensions for this "+this.constructor.className+"; "+r.message,{cause:r})}return n}$sliceReducedDimensions(e){return this.sliceReducedDimensions(e,{inPlace:!0})}removeAlternativeExperiment(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._alternativeExperiments=n._alternativeExperiments.delete(e,{inPlace:t})}catch(r){throw new Error("failed to remove the specified alternative experiment from this "+this.constructor.className+"; "+r.message,{cause:r})}return n}$removeAlternativeExperiment(e){return this.removeAlternativeExperiment(e,{inPlace:!0})}setAlternativeExperiment(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(t instanceof s.H)||i.IV(t)!=this.numberOfColumns())throw new Error("'value' should be a SummarizedExperiment with the same number of columns as this SingleCellExperiment");let r=l.z(this,n);return r._alternativeExperiments=r._alternativeExperiments.set(e,t,{inPlace:n}),r}$setAlternativeExperiment(e,t){return this.setAlternativeExperiment(e,t,{inPlace:!0})}setAlternativeExperimentNames(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._alternativeExperiments=n._alternativeExperiments.setNames(e,{inPlace:t})}catch(r){throw new Error("failed to set the alternative experiment names for this "+this.constructor.className+"; "+r.message,{cause:r})}return n}$setAlternativeExperimentNames(e){return this.setAlternativeExperimentNames(e,{inPlace:!0})}setAlternativeExperiments(e){let{inPlace:t=!1,newOrder:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=l.z(this,t);!1===n?n=r._alternativeExperiments.names():1==n&&(n=null);try{r._alternativeExperiments=new o.w(e,n)}catch(s){throw new Error("failed to replace alternative experiment list for this SingleCellExperiment; "+s.message,{cause:s})}let a=r.numberOfColumns();for(const l of r._alternativeExperiments.names()){let e=r._alternativeExperiments.entry(l);if(i.IV(e)!==a)throw new Error("mismatch in the number of columns for alternative experiment '"+l+"' compared to the SingleCellExperiment")}return r}$setAlternativeExperiments(e){let{newOrder:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setAlternativeExperiments(e,{inPlace:!0,newOrder:t})}sliceAlternativeExperiments(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._alternativeExperiments=this._alternativeExperiments.slice(e,{inPlace:t})}catch(r){throw new Error("failed to slice the alternative experiments for this "+this.constructor.className+"; "+r.message,{cause:r})}return n}$sliceAlternativeExperiments(e){return this.sliceAlternativeExperiments(e,{inPlace:!0})}setMainExperimentName(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);return n._mainExperimentName=e,n}$setMainExperimentName(e){return this.setMainExperimentName(e,{inPlace:!0})}_bioconductor_SLICE_2D(e,t,n){let{allowView:r=!1}=n,a=super._bioconductor_SLICE_2D(e,t,{allowView:r});return null!==t?(a._reducedDimensions=this._reducedDimensions.apply(e=>i.Uf(e,t,null,{allowView:r})),a._alternativeExperiments=this._alternativeExperiments.apply(e=>i.Uf(e,null,t,{allowView:r}))):(a._reducedDimensions=this._reducedDimensions,a._alternativeExperiments=this._alternativeExperiments),a._mainExperimentName=this._mainExperimentName,a}_bioconductor_COMBINE_ROWS(e){let t=super._bioconductor_COMBINE_ROWS(e);return t._reducedDimensions=this._reducedDimensions,t._alternativeExperiments=this._alternativeExperiments,t._mainExperimentName=this._mainExperimentName,t}_bioconductor_COMBINE_COLUMNS(e){let t=super._bioconductor_COMBINE_COLUMNS(e),n=[this._reducedDimensions],r=[this._alternativeExperiments];for(const i of e)n.push(i._reducedDimensions),r.push(i._alternativeExperiments);try{t._reducedDimensions=o.w.parallelCombine(n,i.C7)}catch(a){throw new Error("failed to combine reduced dimensions for "+this.constructor.className+" objects; "+a.message,{cause:a})}try{t._alternativeExperiments=o.w.parallelCombine(r,i.St)}catch(a){throw new Error("failed to combine alternative experiments for "+this.constructor.className+" objects; "+a.message,{cause:a})}return t._mainExperimentName=this._mainExperimentName,t}_bioconductor_CLONE(e){let{deepCopy:t}=e,n=super._bioconductor_CLONE({deepCopy:t});return n._reducedDimensions=l.k(this._reducedDimensions,t),n._alternativeExperiments=l.k(this._alternativeExperiments,t),n._mainExperimentName=this._mainExperimentName,n}}(0,r.A)(c,"className","SingleCellExperiment")},3021:(e,t,n)=>{n.d(t,{Mu:()=>c,Uz:()=>A,ph:()=>f,rt:()=>d});var r=n(5149),i=n(8458),a=n(4558),s=n(7990),l=n(1576),o=new WeakMap;class c{constructor(e){(0,r.A)(this,o,void 0),(0,a.A)(o,this,e)}_bioconductor_NUMBER_OF_ROWS(){return(0,i.A)(o,this).numberOfRows()}_bioconductor_NUMBER_OF_COLUMNS(){return(0,i.A)(o,this).numberOfColumns()}get matrix(){return(0,i.A)(o,this)}}var u=new WeakMap,h=new WeakMap;class f{constructor(e,t){(0,r.A)(this,u,void 0),(0,r.A)(this,h,void 0),(0,a.A)(u,this,e),(0,a.A)(h,this,t)}_bioconductor_NUMBER_OF_ROWS(){return(0,i.A)(u,this).numberOfRows()}_bioconductor_NUMBER_OF_COLUMNS(){return(0,i.A)(u,this).numberOfColumns()}get matrix(){return(0,i.A)(u,this)}get sf(){return(0,i.A)(h,this)}}async function d(e,t,n,r){if("external_Matrix_store"in r)for(const[s,c]of r.external_Matrix_store)if(s===e.matrix){for(const e of["OBJECT","matrix.h5"])await n.copy(l.uJ(c,e),l.uJ(t,e));return}await n.mkdir(t);let i=await n.h5create(l.uJ(t,"matrix.h5")),a=[i],o=!1;try{s.Th(e.matrix,i._path,"compressed_sparse_matrix",{format:"tenx_matrix",saveShape:!1,overwrite:!1}),i.children().compressed_sparse_matrix="Group";let t=i.open("compressed_sparse_matrix");a.push(t),t.createDataSet("shape","Uint32",[2],{data:[e.matrix.numberOfRows(),e.matrix.numberOfColumns()]}).close(),t.writeAttribute("layout","String",[],["CSC"]),t.writeAttribute("type","String",[],["integer"]),o=!0}finally{for(const e of a.reverse())e.close();await n.h5finish(i,!o)}await n.write(l.uJ(t,"OBJECT"),JSON.stringify({type:"compressed_sparse_matrix",compressed_sparse_matrix:{version:"1.0"}})),"external_Matrix_store"in r&&r.external_Matrix_store.push([e.matrix,t])}async function A(e,t,n,r){await n.mkdir(t);let i=await n.h5create(l.uJ(t,"array.h5")),a=[i],s=!1;try{let o=i.createGroup("delayed_array");a.push(o),o.writeAttribute("delayed_type","String",[],["operation"]),o.writeAttribute("delayed_operation","String",[],["unary arithmetic"]),o.writeAttribute("delayed_version","String",[],["1.1"]);let u=o.createDataSet("value","Float64",[],{data:[Math.log(2)]});u.writeAttribute("type","String",[],["FLOAT"]),a.push(u),o.createDataSet("method","String",[],{data:["/"]}).close(),o.createDataSet("side","String",[],{data:["right"]}).close();let h=o.createGroup("seed");a.push(h),h.writeAttribute("delayed_type","String",[],["operation"]),h.writeAttribute("delayed_operation","String",[],["unary math"]),h.createDataSet("method","String",[],{data:["log1p"]}).close();let f=h.createGroup("seed");a.push(f),f.writeAttribute("delayed_type","String",[],["operation"]),f.writeAttribute("delayed_operation","String",[],["unary arithmetic"]),u=f.createDataSet("value","Float64",[e.sf.length],{data:e.sf}),u.writeAttribute("type","String",[],["FLOAT"]),a.push(u),f.createDataSet("method","String",[],{data:["/"]}).close(),f.createDataSet("side","String",[],{data:["right"]}).close(),f.createDataSet("along","Uint8",[],{data:[1]}).close();let A=f.createGroup("seed");a.push(A),A.writeAttribute("delayed_type","String",[],["array"]),A.writeAttribute("delayed_array","String",[],["custom takane seed array"]),A.createDataSet("dimensions","Uint64",[2],{data:[e.matrix.numberOfRows(),e.matrix.numberOfColumns()]}).close(),A.createDataSet("type","String",[],{data:["INTEGER"]}).close(),A.createDataSet("index","Uint8",[],{data:[0]}).close();let m=l.uJ(t,"seeds");await n.mkdir(m),await d(new c(e.matrix),l.uJ(m,"0"),n,r),s=!0}finally{for(const e of a.reverse())e.close();await n.h5finish(i,!s)}await n.write(l.uJ(t,"OBJECT"),JSON.stringify({type:"delayed_array",delayed_array:{version:"1.0"}}))}},3046:(e,t,n)=>{n.d(t,{e:()=>h,t:()=>f});var r=n(5149),i=n(8458),a=n(4558),s=n(1576),l=n(3619),o=new WeakMap,c=new WeakMap,u=new WeakMap;class h{constructor(e,t,n){(0,r.A)(this,o,void 0),(0,r.A)(this,c,void 0),(0,r.A)(this,u,void 0),(0,a.A)(c,this,e),(0,a.A)(u,this,t),(0,a.A)(o,this,n)}_bioconductor_NUMBER_OF_ROWS(){return(0,i.A)(c,this)}_bioconductor_NUMBER_OF_COLUMNS(){return(0,i.A)(u,this)}get values(){return(0,i.A)(o,this)}}async function f(e,t,n,r){await n.mkdir(t);let i=await n.h5create(s.uJ(t,"array.h5")),a=[i],o=!1;try{let t=i.createGroup("dense_array");a.push(t),t.createDataSet("data","Float64",[l.IV(e),l.eQ(e)],{data:e.values}),t.writeAttribute("type","String",[],["number"]),t.writeAttribute("transposed","Int8",[],[1]),o=!0}finally{for(const e of a.reverse())e.close();await n.h5finish(i,!o)}await n.write(s.uJ(t,"OBJECT"),JSON.stringify({type:"dense_array",dense_array:{version:"1.0"}}))}},3619:(e,t,n)=>{n.d(t,{$9:()=>o.$9,B8:()=>r.B8,Bm:()=>r.Bm,CP:()=>i.C,HH:()=>a.H,I4:()=>i.I,IV:()=>o.IV,JP:()=>o.JP,UC:()=>o.UC,a4:()=>r.a4,cI:()=>o.cI,eQ:()=>o.eQ,eV:()=>s.e,eg:()=>r.eg,ky:()=>l.k,pz:()=>r.pz,zJ:()=>c.z});var r=n(8743),i=n(2294),a=(n(5570),n(3968),n(8686),n(4793),n(8675)),s=n(6508),l=n(2952),o=n(6662),c=n(903)},4418:(e,t,n)=>{n.d(t,{A:()=>A,L:()=>u});var r=n(9495),i=n(3619),a=n(507),s=n(5361);function l(e){return"NaN"===e?Number.NaN:"Inf"===e?Number.POSITIVE_INFINITY:"-Inf"===e?Number.NEGATIVE_INFINITY:e}function o(e,t,n,r){let i=e.values,a=!1;i instanceof Array||(i=[i],a=!0);let s=t(i);if("names"in e)s.setNames(e.names,{inPlace:!0});else if(a){if("List_toScalar"in n&&n.List_toScalar)return s.get(0)}else if(null!==r&&s.toArray().every(e=>null!==e)&&"List_toTypedArray"in n&&n.List_toTypedArray)return new r(s.toArray());return s._jaspalite_scalar=a,s}async function c(e,t,n,r){if("list"==e.type){let a=[];for(const i of e.values)a.push(await c(i,t,n,r));let s=new i.B8(a);return"names"in e&&s.setNames(e.names,{inPlace:!0}),s}if("integer"==e.type)return o(e,e=>new i.Bm(e),r,Int32Array);if("number"==e.type)return o(e,e=>new i.eg(e.map(l)),r,Float64Array);if("string"==e.type)return o(e,e=>new i.a4(e),r,null);if("boolean"==e.type)return o(e,e=>new i.pz(e),r,null);if("factor"==e.type)return o(e,t=>{let n=t.slice();for(var r=0;r<n.length;r++)null!==n[r]&&(n[r]=e.levels[n[r]]);return new i.a4(n)},r,null);if("nothing"==e.type)return null;if("external"==e.type)return(0,a.Ag)((0,s.uJ)(t,"other_contents",String(e.index)),null,n,r);throw new Error("unknown JSON list type '"+e.type+"'")}async function u(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("json.gz"!==t.simple_list.format)throw new Error("list formats other than 'json.gz' are currently not supported");let a=await n.get((0,s.uJ)(e,"list_contents.json.gz"),{asBuffer:!0});const l=new Blob([a]).stream().pipeThrough(new DecompressionStream("gzip"));let o=[],u=0;var h,f=!1,d=!1;try{for(var A,m=(0,r.A)(l);f=!(A=await m.next()).done;f=!1){const e=A.value;o.push(e),u+=e.length}}catch(g){d=!0,h=g}finally{try{f&&null!=m.return&&await m.return()}finally{if(d)throw h}}let p=new Uint8Array(u);u=0;for(const r of o)p.set(r,u),u+=r.length;let w=(new TextDecoder).decode(p);return c(JSON.parse(w),e,n,i)}function h(e){let t=Array.from(e);for(var n=0;n<t.length;n++){let e=t[n];Number.isNaN(e)?t[n]="NaN":e==Number.POSITIVE_INFINITY?t[n]="Inf":e==Number.NEGATIVE_INFINITY&&(t[n]="-Inf")}return t}function f(e){let t=e.toArray();return 1==t.length&&"_jaspagate_scalar"in e&&e._jaspagate_scalar?t[0]:t}async function d(e,t,n,r,l){if(e instanceof Array){let i={type:"list",values:[]};if(e.length){let a=!0,s=!0,o=!0;for(const t of e)null!==t&&("string"!==typeof t&&(a=!1),"boolean"!==typeof t&&(s=!1),"number"!==typeof t&&(o=!1));if(a)i.type="string",i.values=e;else if(s)i.type="boolean",i.values=e;else if(o)i.type="number",i.values=h(e);else for(const c of e)i.values.push(await d(c,t,n,r,l))}return i}if(e instanceof i.B8){let a={type:"list",values:[]};if(e instanceof i.Bm)a.type=(0,s.Ox)(e)?"number":"integer",a.values=f(e);else if(e instanceof i.eg)a.type="number",a.values=f(e);else if(e instanceof i.a4)a.type="string",a.values=f(e);else if(e instanceof i.pz)a.type="boolean",a.values=f(e);else for(const i of e)a.values.push(await d(i,t,n,r,l));return null!==e.names()&&(a.names=e.names()),a}if(null===e)return{type:"nothing"};if(e.constructor===Object){let i={type:"list",values:[],names:[]};for(const[a,s]of Object.entries(e))i.names.push(a),i.values.push(await d(s,t,n,r,l));return i}if(e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint16Array)return{type:"integer",values:Array.from(e)};if(e instanceof Uint32Array||e instanceof BigInt64Array||e instanceof BigUint64Array)return{type:"number",values:Array.from(e).map(e=>Number(e))};if(e instanceof Float64Array||e instanceof Float32Array)return{type:"number",values:h(e)};if("number"==typeof e)return{type:"number",values:e};if("string"==typeof e)return{type:"string",values:e};if("boolean"==typeof e)return{type:"boolean",values:e};{if("List_saveOther"in r){let t=r.List_saveOther(e);if(null!==t)return t}let i=(0,s.uJ)(t,"other_contents");await n.exists(i)||await n.mkdir(i);let o=l.index;return await(0,a.ll)(e,(0,s.uJ)(i,String(o)),n,r),l.index++,{type:"external",index:o}}}async function A(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};await n.mkdir(t);await n.write((0,s.uJ)(t,"OBJECT"),(0,s.Z0)({type:"simple_list",simple_list:{version:"1.1",format:"json.gz"}}));let a=await d(e,t,n,i,{index:0}),l=JSON.stringify(a);const o=new Blob([l]).stream().pipeThrough(new CompressionStream("gzip"));let c=[],u=0;var h,f=!1,A=!1;try{for(var m,p=(0,r.A)(o);f=!(m=await p.next()).done;f=!1){const e=m.value;c.push(e),u+=e.length}}catch(g){A=!0,h=g}finally{try{f&&null!=p.return&&await p.return()}finally{if(A)throw h}}let w=new Uint8Array(u);u=0;for(const r of c)w.set(r,u),u+=r.length;await n.write((0,s.uJ)(t,"list_contents.json.gz"),w)}},4441:(e,t,n)=>{n.d(t,{Fx:()=>C});var r;function i(e,t,n,r){return new(n||(n=Promise))(function(i,a){function s(e){try{o(r.next(e))}catch(t){a(t)}}function l(e){try{o(r.throw(e))}catch(t){a(t)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,l)}o((r=r.apply(e,t||[])).next())})}"function"===typeof SuppressedError&&SuppressedError;class a{constructor(){this.mutex=Promise.resolve()}lock(){let e=()=>{};return this.mutex=this.mutex.then(()=>new Promise(e)),new Promise(t=>{e=t})}dispatch(e){return i(this,void 0,void 0,function*(){const t=yield this.lock();try{return yield Promise.resolve(e())}finally{t()}})}}const s="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:n.g,l=null!==(r=s.Buffer)&&void 0!==r?r:null,o=s.TextEncoder?new s.TextEncoder:null;function c(e,t){return(15&e)+(e>>6|e>>3&8)<<4|(15&t)+(t>>6|t>>3&8)}function u(e,t){const n=t.length>>1;for(let r=0;r<n;r++){const n=r<<1;e[r]=c(t.charCodeAt(n),t.charCodeAt(n+1))}}const h="a".charCodeAt(0)-10,f="0".charCodeAt(0);function d(e,t,n){let r=0;for(let i=0;i<n;i++){let n=t[i]>>>4;e[r++]=n>9?n+h:n+f,n=15&t[i],e[r++]=n>9?n+h:n+f}return String.fromCharCode.apply(null,e)}const A=null!==l?e=>{if("string"===typeof e){const t=l.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(l.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if("string"===typeof e)return o.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=new Uint8Array(256);for(let k=0;k<64;k++)p[m.charCodeAt(k)]=k;function w(e){let t=Math.floor(.75*e.length);const n=e.length;return"="===e[n-1]&&(t-=1,"="===e[n-2]&&(t-=1)),t}function g(e){const t=w(e),n=e.length,r=new Uint8Array(t);let i=0;for(let a=0;a<n;a+=4){const t=p[e.charCodeAt(a)],n=p[e.charCodeAt(a+1)],s=p[e.charCodeAt(a+2)],l=p[e.charCodeAt(a+3)];r[i]=t<<2|n>>4,i+=1,r[i]=(15&n)<<4|s>>2,i+=1,r[i]=(3&s)<<6|63&l,i+=1}return r}const y=16384,_=4,v=new a,b=new Map;function E(e,t){return i(this,void 0,void 0,function*(){let n=null,r=null,a=!1;if("undefined"===typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const s=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),l=v.dispatch(()=>i(this,void 0,void 0,function*(){if(!b.has(e.name)){const t=g(e.data),n=WebAssembly.compile(t);b.set(e.name,n)}const t=yield b.get(e.name);n=yield WebAssembly.instantiate(t,{})})),o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a=!0,n.exports.Hash_Init(e)},h=e=>{if(!a)throw new Error("update() called before init()");(e=>{let t=0;for(;t<e.length;){const i=e.subarray(t,t+y);t+=i.length,r.set(i),n.exports.Hash_Update(i.length)}})(A(e))},f=new Uint8Array(2*t),m=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!a)throw new Error("digest() called before init()");return a=!1,n.exports.Hash_Final(i),"binary"===e?r.slice(0,t):d(f,r,t)},p=e=>"string"===typeof e?e.length<y/4:e.byteLength<y;let w=p;switch(e.name){case"argon2":case"scrypt":w=()=>!0;break;case"blake2b":case"blake2s":w=(e,t)=>t<=512&&p(e);break;case"blake3":w=(e,t)=>0===t&&p(e);break;case"xxhash64":case"xxhash3":case"xxhash128":case"crc64":w=()=>!1}return yield(()=>i(this,void 0,void 0,function*(){n||(yield l);const e=n.exports.Hash_GetBuffer(),t=n.exports.memory.buffer;r=new Uint8Array(t,e,y)}))(),{getMemory:()=>r,writeMemory:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r.set(e,t)},getExports:()=>n.exports,setMemorySize:e=>{n.exports.Hash_SetMemorySize(e);const t=n.exports.Hash_GetBuffer(),i=n.exports.memory.buffer;r=new Uint8Array(i,t,e)},init:o,update:h,digest:m,save:()=>{if(!a)throw new Error("save() can only be called after init() and before digest()");const t=n.exports.Hash_GetState(),r=s(),i=n.exports.memory.buffer,l=new Uint8Array(i,t,r),o=new Uint8Array(_+r);return u(o,e.hash),o.set(l,_),o},load:t=>{if(!(t instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const r=n.exports.Hash_GetState(),i=s(),l=_+i,o=n.exports.memory.buffer;if(t.length!==l)throw new Error("Bad state length (expected ".concat(l," bytes, got ").concat(t.length,")"));if(!function(e,t){if(e.length!==2*t.length)return!1;for(let n=0;n<t.length;n++){const r=n<<1;if(t[n]!==c(e.charCodeAt(r),e.charCodeAt(r+1)))return!1}return!0}(e.hash,t.subarray(0,_)))throw new Error("This state was written by an incompatible hash implementation");const u=t.subarray(_);new Uint8Array(o,r,i).set(u),a=!0},calculate:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!w(e,i))return o(i),h(e),m("hex",a);const s=A(e);return r.set(s),n.exports.Hash_Calculate(s.length,i,a),d(f,r,t)},hashLength:t}})}function x(e,t,n){return i(this,void 0,void 0,function*(){const r=yield e.lock(),i=yield E(t,n);return r(),i})}new a;new a;new DataView(new ArrayBuffer(4));new a;new a;new a;new a;new Uint8Array(8);new a;var I={name:"md5",data:"AGFzbQEAAAABEgRgAAF/YAAAYAF/AGACf38BfwMIBwABAgMBAAIFBAEBAgIGDgJ/AUGgigULfwBBgAgLB3AIBm1lbW9yeQIADkhhc2hfR2V0QnVmZmVyAAAJSGFzaF9Jbml0AAELSGFzaF9VcGRhdGUAAgpIYXNoX0ZpbmFsAAQNSGFzaF9HZXRTdGF0ZQAFDkhhc2hfQ2FsY3VsYXRlAAYKU1RBVEVfU0laRQMBCoMaBwUAQYAJCy0AQQBC/rnrxemOlZkQNwKQiQFBAEKBxpS6lvHq5m83AoiJAUEAQgA3AoCJAQu+BQEHf0EAQQAoAoCJASIBIABqQf////8BcSICNgKAiQFBAEEAKAKEiQEgAiABSWogAEEddmo2AoSJAQJAAkACQAJAAkACQCABQT9xIgMNAEGACSEEDAELIABBwAAgA2siBUkNASAFQQNxIQZBACEBAkAgA0E/c0EDSQ0AIANBgIkBaiEEIAVB/ABxIQdBACEBA0AgBCABaiICQRhqIAFBgAlqLQAAOgAAIAJBGWogAUGBCWotAAA6AAAgAkEaaiABQYIJai0AADoAACACQRtqIAFBgwlqLQAAOgAAIAcgAUEEaiIBRw0ACwsCQCAGRQ0AIANBmIkBaiECA0AgAiABaiABQYAJai0AADoAACABQQFqIQEgBkF/aiIGDQALC0GYiQFBwAAQAxogACAFayEAIAVBgAlqIQQLIABBwABPDQEgACECDAILIABFDQIgAEEDcSEGQQAhAQJAIABBBEkNACADQYCJAWohBCAAQXxxIQBBACEBA0AgBCABaiICQRhqIAFBgAlqLQAAOgAAIAJBGWogAUGBCWotAAA6AAAgAkEaaiABQYIJai0AADoAACACQRtqIAFBgwlqLQAAOgAAIAAgAUEEaiIBRw0ACwsgBkUNAiADQZiJAWohAgNAIAIgAWogAUGACWotAAA6AAAgAUEBaiEBIAZBf2oiBg0ADAMLCyAAQT9xIQIgBCAAQUBxEAMhBAsgAkUNACACQQNxIQZBACEBAkAgAkEESQ0AIAJBPHEhAEEAIQEDQCABQZiJAWogBCABaiICLQAAOgAAIAFBmYkBaiACQQFqLQAAOgAAIAFBmokBaiACQQJqLQAAOgAAIAFBm4kBaiACQQNqLQAAOgAAIAAgAUEEaiIBRw0ACwsgBkUNAANAIAFBmIkBaiAEIAFqLQAAOgAAIAFBAWohASAGQX9qIgYNAAsLC4cQARl/QQAoApSJASECQQAoApCJASEDQQAoAoyJASEEQQAoAoiJASEFA0AgACgCCCIGIAAoAhgiByAAKAIoIgggACgCOCIJIAAoAjwiCiAAKAIMIgsgACgCHCIMIAAoAiwiDSAMIAsgCiANIAkgCCAHIAMgBmogAiAAKAIEIg5qIAUgBCACIANzcSACc2ogACgCACIPakH4yKq7fWpBB3cgBGoiECAEIANzcSADc2pB1u6exn5qQQx3IBBqIhEgECAEc3EgBHNqQdvhgaECakERdyARaiISaiAAKAIUIhMgEWogACgCECIUIBBqIAQgC2ogEiARIBBzcSAQc2pB7p33jXxqQRZ3IBJqIhAgEiARc3EgEXNqQa+f8Kt/akEHdyAQaiIRIBAgEnNxIBJzakGqjJ+8BGpBDHcgEWoiEiARIBBzcSAQc2pBk4zBwXpqQRF3IBJqIhVqIAAoAiQiFiASaiAAKAIgIhcgEWogDCAQaiAVIBIgEXNxIBFzakGBqppqakEWdyAVaiIQIBUgEnNxIBJzakHYsYLMBmpBB3cgEGoiESAQIBVzcSAVc2pBr++T2nhqQQx3IBFqIhIgESAQc3EgEHNqQbG3fWpBEXcgEmoiFWogACgCNCIYIBJqIAAoAjAiGSARaiANIBBqIBUgEiARc3EgEXNqQb6v88p4akEWdyAVaiIQIBUgEnNxIBJzakGiosDcBmpBB3cgEGoiESAQIBVzcSAVc2pBk+PhbGpBDHcgEWoiFSARIBBzcSAQc2pBjofls3pqQRF3IBVqIhJqIAcgFWogDiARaiAKIBBqIBIgFSARc3EgEXNqQaGQ0M0EakEWdyASaiIQIBJzIBVxIBJzakHiyviwf2pBBXcgEGoiESAQcyAScSAQc2pBwOaCgnxqQQl3IBFqIhIgEXMgEHEgEXNqQdG0+bICakEOdyASaiIVaiAIIBJqIBMgEWogDyAQaiAVIBJzIBFxIBJzakGqj9vNfmpBFHcgFWoiECAVcyAScSAVc2pB3aC8sX1qQQV3IBBqIhEgEHMgFXEgEHNqQdOokBJqQQl3IBFqIhIgEXMgEHEgEXNqQYHNh8V9akEOdyASaiIVaiAJIBJqIBYgEWogFCAQaiAVIBJzIBFxIBJzakHI98++fmpBFHcgFWoiECAVcyAScSAVc2pB5puHjwJqQQV3IBBqIhEgEHMgFXEgEHNqQdaP3Jl8akEJdyARaiISIBFzIBBxIBFzakGHm9Smf2pBDncgEmoiFWogBiASaiAYIBFqIBcgEGogFSAScyARcSASc2pB7anoqgRqQRR3IBVqIhAgFXMgEnEgFXNqQYXSj896akEFdyAQaiIRIBBzIBVxIBBzakH4x75nakEJdyARaiISIBFzIBBxIBFzakHZhby7BmpBDncgEmoiFWogFyASaiATIBFqIBkgEGogFSAScyARcSASc2pBipmp6XhqQRR3IBVqIhAgFXMiFSASc2pBwvJoakEEdyAQaiIRIBVzakGB7ce7eGpBC3cgEWoiEiARcyIaIBBzakGiwvXsBmpBEHcgEmoiFWogFCASaiAOIBFqIAkgEGogFSAac2pBjPCUb2pBF3cgFWoiECAVcyIVIBJzakHE1PulempBBHcgEGoiESAVc2pBqZ/73gRqQQt3IBFqIhIgEXMiCSAQc2pB4JbttX9qQRB3IBJqIhVqIA8gEmogGCARaiAIIBBqIBUgCXNqQfD4/vV7akEXdyAVaiIQIBVzIhUgEnNqQcb97cQCakEEdyAQaiIRIBVzakH6z4TVfmpBC3cgEWoiEiARcyIIIBBzakGF4bynfWpBEHcgEmoiFWogGSASaiAWIBFqIAcgEGogFSAIc2pBhbqgJGpBF3cgFWoiESAVcyIQIBJzakG5oNPOfWpBBHcgEWoiEiAQc2pB5bPutn5qQQt3IBJqIhUgEnMiByARc2pB+PmJ/QFqQRB3IBVqIhBqIAwgFWogDyASaiAGIBFqIBAgB3NqQeWssaV8akEXdyAQaiIRIBVBf3NyIBBzakHExKShf2pBBncgEWoiEiAQQX9zciARc2pBl/+rmQRqQQp3IBJqIhAgEUF/c3IgEnNqQafH0Nx6akEPdyAQaiIVaiALIBBqIBkgEmogEyARaiAVIBJBf3NyIBBzakG5wM5kakEVdyAVaiIRIBBBf3NyIBVzakHDs+2qBmpBBncgEWoiECAVQX9zciARc2pBkpmz+HhqQQp3IBBqIhIgEUF/c3IgEHNqQf3ov39qQQ93IBJqIhVqIAogEmogFyAQaiAOIBFqIBUgEEF/c3IgEnNqQdG7kax4akEVdyAVaiIQIBJBf3NyIBVzakHP/KH9BmpBBncgEGoiESAVQX9zciAQc2pB4M2zcWpBCncgEWoiEiAQQX9zciARc2pBlIaFmHpqQQ93IBJqIhVqIA0gEmogFCARaiAYIBBqIBUgEUF/c3IgEnNqQaGjoPAEakEVdyAVaiIQIBJBf3NyIBVzakGC/c26f2pBBncgEGoiESAVQX9zciAQc2pBteTr6XtqQQp3IBFqIhIgEEF/c3IgEXNqQbul39YCakEPdyASaiIVIARqIBYgEGogFSARQX9zciASc2pBkaeb3H5qQRV3aiEEIBUgA2ohAyASIAJqIQIgESAFaiEFIABBwABqIQAgAUFAaiIBDQALQQAgAjYClIkBQQAgAzYCkIkBQQAgBDYCjIkBQQAgBTYCiIkBIAALyAMBBX9BACgCgIkBQT9xIgBBmIkBakGAAToAACAAQQFqIQECQAJAAkACQCAAQT9zIgJBB0sNACACRQ0BIAFBmIkBakEAOgAAIAJBAUYNASAAQZqJAWpBADoAACACQQJGDQEgAEGbiQFqQQA6AAAgAkEDRg0BIABBnIkBakEAOgAAIAJBBEYNASAAQZ2JAWpBADoAACACQQVGDQEgAEGeiQFqQQA6AAAgAkEGRg0BIABBn4kBakEAOgAADAELIAJBCEYNAkE2IABrIgMhBAJAIAJBA3EiAEUNAEEAIABrIQRBACEAA0AgAEHPiQFqQQA6AAAgBCAAQX9qIgBHDQALIAMgAGohBAsgA0EDSQ0CDAELQZiJAUHAABADGkEAIQFBNyEECyABQYCJAWohAEF/IQIDQCAAIARqQRVqQQA2AAAgAEF8aiEAIAQgAkEEaiICRw0ACwtBAEEAKAKEiQE2AtSJAUEAQQAoAoCJASIAQRV2OgDTiQFBACAAQQ12OgDSiQFBACAAQQV2OgDRiQFBACAAQQN0IgA6ANCJAUEAIAA2AoCJAUGYiQFBwAAQAxpBAEEAKQKIiQE3A4AJQQBBACkCkIkBNwOICQsGAEGAiQELMwBBAEL+uevF6Y6VmRA3ApCJAUEAQoHGlLqW8ermbzcCiIkBQQBCADcCgIkBIAAQAhAECwsLAQBBgAgLBJgAAAA=",hash:"e6508e4b"};const B=new a;let S=null;function C(e){if(null===S)return x(B,I,16).then(t=>(S=t,S.calculate(e)));try{const t=S.calculate(e);return Promise.resolve(t)}catch(t){return Promise.reject(t)}}new a;new a;new a;new a;new a;new a;new a;new a;new a;new Uint8Array(8);new a;new Uint8Array(8);new a;new Uint8Array(8);new a;new a;new a},4678:(e,t,n)=>{n.d(t,{Hp:()=>s,To:()=>a,k5:()=>l});var r=n(3619);n(6919);const i={lfc:"deltaMean",delta_detected:"deltaDetected",auc:"auc",cohen:"cohensD"};function a(e,t){const n={min:"minimum",mean:"mean",min_rank:"min-rank"},a=e.marker_detection.fetchParameters().compute_auc;let s=e.inputs.fetchFeatureAnnotations(),l={};for(const[c,u]of Object.entries(t)){let t=e.marker_detection.fetchResults()[c],h=t.numberOfGroups(),f=s[c].numberOfRows();for(var o=0;o<h;o++){let e=new r.CP({},{numberOfRows:f,rowNames:u});for(const n of["mean","detected"])e.setColumn(n,t[n](o,{copy:"view"}),{inPlace:!0});for(const[r,s]of Object.entries(i))if("auc"!=r||a)for(const[i,a]of Object.entries(n))e.setColumn(r+"-"+i,t[s](o,{summary:a}),{inPlace:!0});l[c+"/"+String(o+1)]=e}}return l}function s(e,t){const n=e.custom_selections.fetchParameters().compute_auc;let a=e.custom_selections.fetchSelections(),s=e.inputs.fetchFeatureAnnotations(),l={};for(const[o,c]of Object.entries(t)){let t=s[o].numberOfRows();for(const s of Object.keys(a)){let a=e.custom_selections.fetchResults(s)[o],u=new r.CP({},{numberOfRows:t,rowNames:c});for(const e of["mean","detected"])u.setColumn(e,a[e](1,{copy:"view"}),{inPlace:!0});for(const[e,t]of Object.entries(i))("auc"!=e||n)&&u.setColumn(e,a[t](1,{copy:"view"}),{inPlace:!0});l[o+"/"+s]=u}}return l}function l(e,t){let n=e.feature_selection.fetchResults();return new r.CP({mean:n.means({copy:"view"}),variance:n.variances({copy:"view"}),fitted:n.fitted({copy:"view"}),residual:n.residuals({copy:"view"})},{columnOrder:["mean","variance","fitted","residual"],rowNames:t})}},4717:(e,t,n)=>{n.d(t,{I:()=>l,R:()=>o});var r=n(3619),i=n(507),a=n(5406),s=n(5361);async function l(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=await(0,a.B)(e,t,n,i);return new r.eV(s.assays(),null,{assayOrder:s.assayNames(),rowData:s.rowData(),columnData:s.columnData(),rowNames:s.rowNames(),columnNames:s.columnNames(),metadata:s.metadata()})}async function o(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};await(0,a.e)(e,t,n,r);const l=await(0,i._i)(t,n);l.type="ranged_summarized_experiment",l.ranged_summarized_experiment={version:"1.0"},await n.write((0,s.uJ)(t,"OBJECT"),(0,s.Z0)(l))}},5361:(e,t,n)=>{function r(){let e=arguments.length<=0?void 0:arguments[0];for(var t=1;t<arguments.length;t++){let n=t<0||arguments.length<=t?void 0:arguments[t];"."==e?e=n:"."!=n&&(e+="/"+n)}return e}function i(e){const t=2**31,n=-t;for(const r of e)if(null!==r&&(r<n||r>=t))return!0;return!1}function a(e,t,n){let r=new n(e.length);return e.forEach((e,n)=>{r[n]=null===e?t:e}),r}function s(e){let t=e.some(e=>null==e);if(i(e)){let n=null;return t&&(n=Number.NaN,e=a(e,n,Float64Array)),{integer:!1,data:e,placeholder:n}}if(!t)return{integer:!0,data:e,placeholder:null};let n={integer:!0,data:null,placeholder:null};const r=2**31,s=-r;for(const i of[s,r-1,0])if(!e.some(e=>e==i)){n.placeholder=i;break}if(null===n.placeholder){let t=new Set(e);for(var l=s+1;l<r-1;l++)if(!t.has(l)){n.placeholder=l;break}}return null===n.placeholder&&(n.integer=!1,n.placeholder=Number.NaN),n.data=a(e,n.placeholder,Int32Array),n}function l(e){if(!e.some(e=>null==e))return{data:e,placeholder:null};if(!e.some(Number.isNaN))return{data:a(e,Number.NaN,Float64Array),placeholder:Number.NaN};for(const i of[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.MAX_VALUE,-Number.MAX_VALUE,0])if(!e.some(e=>e==i))return{data:a(e,i,Float64Array),placeholder:i};let t,n=-Number.MAX_VALUE,r=new Float64Array(e.filter(Number.isFinite)).sort();for(const i of r){let e=n+(i-n)/2;if(e!=n&&e!=i){t=e;break}n=i}return{data:a(e,t,Float64Array),placeholder:t}}function o(e){if(!e.some(e=>null==e))return{data:e,placeholder:null};let t="NA";if(e.some(e=>"NA"==e)){let n=new Set(e);for(t+="_";n.has(t);)t+="_"}return{data:e.map(e=>null==e?t:e),placeholder:t}}function c(e){return{data:a(e,2,Uint8Array),placeholder:e.some(e=>null==e)?2:null}}function u(e){const t=JSON.stringify(e);return(new TextEncoder).encode(t)}n.d(t,{Ox:()=>i,Sv:()=>o,XW:()=>c,Z0:()=>u,ZA:()=>s,uJ:()=>r,yb:()=>l})},5406:(e,t,n)=>{n.d(t,{B:()=>l,e:()=>o});var r=n(3619),i=n(507),a=n(5361),s=n(9215);async function l(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=null;"SummarizedExperiment_readAssay"in l&&(o=l.SummarizedExperiment_readAssay);const c={},u={},h=(0,a.uJ)(e,"assays/names.json");if(await n.exists(h)){let r=await n.get(h,{asBuffer:!0});const s=new TextDecoder,f=JSON.parse(s.decode(r));c.assayOrder=f;for(const[c,h]of Object.entries(f)){let r=(0,a.uJ)(e,"assays",String(c)),s=await(0,i._i)(r,n);u[h]=null===o?await(0,i.Ag)(r,s,n,l):await o(t.summarized_experiment.dimensions[0],t.summarized_experiment.dimensions[1],r,s,n,l)}}if(await n.exists((0,a.uJ)(e,"column_data/OBJECT"))){let t=await(0,i.Ag)((0,a.uJ)(e,"column_data"),null,n,l);c.columnData=t,c.columnNames=t.rowNames()}else 0==Object.keys(u).length&&(c.columnData=new r.CP({},{numberOfRows:0}));if(await n.exists((0,a.uJ)(e,"row_data/OBJECT"))){let t=await(0,i.Ag)((0,a.uJ)(e,"row_data"),null,n,l);c.rowData=t,c.rowNames=t.rowNames()}else 0==Object.keys(u).length&&(c.rowData=new r.CP({},{numberOfRows:0}));return c.metadata=await(0,s.m)((0,a.uJ)(e,"other_data"),n,l,"SummarizedExperiment_readMetadata"),new r.HH(u,c)}async function o(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};await n.mkdir(t),await n.write((0,a.uJ)(t,"OBJECT"),(0,a.Z0)({type:"summarized_experiment",summarized_experiment:{version:"1.0",dimensions:[e.numberOfRows(),e.numberOfColumns()]}}));const l=e.assayNames();if(l.length>0){const s=(0,a.uJ)(t,"assays");await n.mkdir(s),await n.write((0,a.uJ)(s,"names.json"),(0,a.Z0)(l));for(const[t,o]of Object.entries(l))await(0,i.ll)(e.assay(o),(0,a.uJ)(s,String(t)),n,r)}if(e.columnData().numberOfColumns()>0||null!==e.columnNames()){const s=e.columnData().setRowNames(e.columnNames());await(0,i.ll)(s,(0,a.uJ)(t,"column_data"),n,r)}if(e.rowData().numberOfColumns()>0||null!==e.rowNames()){const s=e.rowData().setRowNames(e.rowNames());await(0,i.ll)(s,(0,a.uJ)(t,"row_data"),n,r)}await(0,s.r)(e.metadata(),(0,a.uJ)(t,"other_data"),n,r)}},5600:(e,t,n)=>{n.d(t,{l:()=>i});n(4106);var r=n(3726);async function i(e,t){let{types:n=null,ignoreCase:i=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===n&&(n=["entrez","ensembl","symbol"]);let a=[];for(const u of n)a.push((0,r.B)(e,u,{lowerCase:i}));let s=await Promise.all(a),l=[];for(var o=0;o<t.length;o++){let e=t[o];if(0==e.length){l.push([]);continue}i&&(e=e.toLowerCase());let r=[];for(var c=0;c<n.length;c++){let t=s[c].get(e);if("undefined"!==typeof t)for(const e of t)r.push(e)}l.push(r)}return l}},6535:(e,t,n)=>{n.d(t,{$c:()=>l,Az:()=>s,Iy:()=>d,RI:()=>m,iC:()=>f,lq:()=>A,nz:()=>h,oc:()=>u,uN:()=>o,y$:()=>p});var r=n(932),i=(e,t,n,r)=>{let i=e+"/"+t;return null==n||null==r?fetch(i):fetch(i,{headers:{Range:"bytes="+String(n)+"-"+String(r)}})},a="https://github.com/LTLA/gesel-feedstock/releases/download/indices-v0.2.2";function s(e){if("undefined"==typeof e)return a;return a}var l=function(e){return i(a,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)};function o(e){let t=l;return"undefined"!==typeof e&&(l=e),t}var c="https://github.com/LTLA/gesel-feedstock/releases/download/genes-v1.0.0";function u(e){if("undefined"==typeof e)return c;return c}var h=e=>i(c,e,null,null);function f(e){let t=h;return"undefined"!==typeof e&&(h=e),t}function d(e){return f(e)}function A(e){var t=r.UD(new Uint8Array(e));var n=(new TextDecoder).decode(t).split("\n");return""==n[n.length-1]?n.slice(0,n.length-1):n}function m(e){var t=[];if(""!==e){var n=0;e.split("\t").forEach(e=>{var r=Number(e)+n;t.push(r),n=r})}return new Uint32Array(t)}function p(e){if(0==e.length)return[];if(1==e.length)return e[0];let t=new Set(e[0]);for(var n=1;n<e.length;n++){let r=new Set;for(const i of e[n])t.has(i)&&r.add(i);t=r}return Array.from(t)}},6554:(e,t,n)=>{n.d(t,{V:()=>l});var r=n(3619),i=n(6919),a=n(3021),s=n(3046);async function l(e){let{reportOneIndex:t=!1,storeModalityColumnData:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=e.inputs.fetchFeatureAnnotations(),o=Object.keys(l),c="RNA";c in l||(c=o[0]);let u={};for(const i of o)u[i]=new r.B8;let h=i.g(e,o,c,u,n),f={};for(const i of o){let t,n=e.cell_filtering.fetchFilteredMatrix().get(i),o={counts:new a.Mu(n)},c={};t=i in u?u[i]:new r.B8;let d=null;switch(i){case"RNA":d=e.rna_normalization;break;case"ADT":d=e.adt_normalization;break;case"CRISPR":d=e.crispr_normalization}if(null!==d){let e=d.fetchSizeFactors();o.logcounts=new a.ph(n,e)}switch(d=null,i){case"RNA":d=e.rna_pca;break;case"ADT":d=e.adt_pca;break;case"CRISPR":d=e.crispr_pca}if(null!==d){let e=d.fetchPCs();c.pca=new s.e(e.numberOfCells(),e.numberOfPCs(),e.principalComponents({copy:"view"}));let n=e.totalVariance();t.set("pca",{variance_explained:e.varianceExplained({copy:"view"}).map(e=>e/n)},{inPlace:!0})}f[i]=new r.ky(o,{rowData:l[i],rowNames:l[i].rowNames(),columnData:h[i],columnNames:h[i].rowNames(),metadata:t,reducedDimensions:c})}for(const r of["tsne","umap"]){let t=await e[r].fetchResults({copy:!1}),n=new Float64Array(2*t.x.length);n.set(t.x),n.set(t.y,t.x.length),f[c].setReducedDimension(r,new s.e(t.x.length,2,n),{inPlace:!0})}{let n=e.custom_selections.fetchSelections({copy:!0,force:"Int32Array"});if(t)for(const[e,t]of Object.entries(n))t.forEach((e,n)=>{t[n]=e+1});let r=f[c].metadata();r.set("custom_selections",n,{inPlace:!0}),f[c].setMetadata(r,{inPlace:!0})}let d=f[c];for(const r of o)r!==c&&d.setAlternativeExperiment(r,f[r],{inPlace:!0});return d}},6747:(e,t,n)=>{n.d(t,{P4:()=>p,VX:()=>C});var r=n(9379),i=n(9790),a=n(5149),s=n(6562),l=n(8458),o=n(4558),c=n(7990),u=n(3619),h=n(8166),f=n(1276),d=(n(3983),n(141),n(2697)),A=n(4201),m=n(6292);n(7465);const p="feature_set_enrichment";var w=new WeakMap,g=new WeakSet;class y{constructor(){(0,i.A)(this,g),(0,a.A)(this,w,void 0),(0,o.A)(w,this,{})}free(){f.xr((0,l.A)(w,this).set_buffer),(0,o.A)(w,this,{})}static flush(){}static setDownload(e){console.warn("'FeatureSetState.setDownload' is a no-op, uses 'gesel.setReferenceDownload' and 'gesel.setGeneDownload' instead")}async buildCollections(e,t,n,r,i,a,l){if(t!==e.guess_ids||!t&&(e.gene_id_column!==r||e.gene_id_type!==i||f.PG(e.species,n))){let e=r,o=i,c=n;if(t){let t=function(e){let t=null,n={type:"symbol",species:"9606",confidence:0};if("row_names"in e){let t=e.row_names;t.confidence>n.confidence&&(n=t)}for(const[r,i]of Object.entries(e.columns))i.confidence>n.confidence&&(n=i,t=r);return{gene_id_column:t,gene_id_type:n.type.toUpperCase(),species:[n.species]}}(l());e=t.gene_id_column,o=t.gene_id_type,c=t.species}return await(0,s.A)(g,this,_).call(this,a(),c,e,o),!0}return!1}fetchCollectionDetails(){return(0,l.A)(w,this).collections}fetchSetDetails(){return{names:(0,l.A)(w,this).sets.names,descriptions:(0,l.A)(w,this).sets.descriptions,sizes:(0,l.A)(w,this).sets.sizes,collections:(0,l.A)(w,this).sets.collections}}fetchUniverseSize(){return(0,l.A)(w,this).universe.length}computeEnrichment(e,t,n,r,i){"delta_detected"==t?t="deltaDetected":"cohen"==t?t="cohensD":"lfc"==t&&(t="deltaDetected"),"min_rank"==n&&(n="min-rank");let a=!0,s=null;"min-rank"==n?a=!1:s="auc"==t?.5:0;let o=r[t](e,{summary:n,copy:!1}),f=c.M2(u.$9(o,(0,l.A)(w,this).universe),i,{useLargest:a,threshold:s});f.forEach((e,t)=>{let n=(0,l.A)(w,this).universe[e];f[t]=(0,l.A)(w,this).mapping_to_sets[n]});let d=h.QR(f),A=new Int32Array(d.length),m=new Int32Array(d.length),p=new Int32Array(d.length),g=new Int32Array(d.length);for(var y=0;y<d.length;y++){g[y]=y;let e=d[y];A[y]=e.id,m[y]=e.count,p[y]=(0,l.A)(w,this).sets.sizes[e.id]}let _=f.length,v=c.Qc(m,_,p,(0,l.A)(w,this).universe.length);return g.sort((e,t)=>v[e]-v[t]),{set_ids:u.$9(A,g),counts:u.$9(m,g),pvalues:u.$9(v,g),num_markers:_}}fetchFeatureSetIndices(e){return(0,l.A)(w,this).sets.sets[e]}computePerCellScores(e,t,n){let r=this.fetchFeatureSetIndices(e),i=f.RK(t.numberOfRows(),"Uint8Array",(0,l.A)(w,this),"set_buffer");i.fill(0);let a=i.array();return r.forEach(e=>{a[e]=1}),c.e2(t,i,{block:n})}}async function _(e,t,n,r){let i;null==n?(i=e.rowNames(),null==i&&(t=[])):i=e.column(n);let a={types:[r.toLowerCase()]},s=0,o=[[]],c=[[]],f=[[]],d=0,A=[[]],m=[[]],p=[[]],g=[new Int32Array],y=[new Int32Array],_=new Set,v=new Array(e.numberOfRows());for(var b=0;b<v.length;b++)v[b]=[];for(const l of t){let e=await h.lU(l,i,a);for(var E=0;E<e.length;E++)e[E].length>0&&_.add(E);let t=await h.i_(l),n=h.b5(e,t),r=await h.xD(l),u=r.length,w=new Array(u),b=new Array(u),I=new Int32Array(u),B=new Int32Array(u);for(E=0;E<u;E++){let e=r[E];w[E]=e.name,b[E]=e.description,B[E]=e.collection+s,I[E]=n[E].length}A.push(w),m.push(b),p.push(n),g.push(I),y.push(B);let S=await h.Ec(l),C=h.zs(e,S);for(E=0;E<e.length;E++){let e=C[E];for(var x=0;x<e.length;x++)e[x]+=d;v[E].push(e)}let k=await h.hv(l),N=k.length,D=new Array(N),O=new Array(N),R=new Array(N);for(E=0;E<N;E++)D[E]=k[E].title,O[E]=k[E].description,R[E]=l;o.push(D),c.push(O),f.push(R),d+=u,s+=N}if((0,l.A)(w,this).universe=new Int32Array(_).sort(),(0,l.A)(w,this).sets={names:u.cI(A),descriptions:u.cI(m),sets:u.cI(p),sizes:u.cI(g),collections:u.cI(y)},(0,l.A)(w,this).collections={names:u.cI(o),descriptions:u.cI(c),species:u.cI(f)},t.length>0)for(b=0;b<v.length;b++)v[b]=u.cI(v[b]);else for(b=0;b<v.length;b++)v[b]=new Uint32Array;(0,l.A)(w,this).mapping_to_sets=v}function v(e){return e.species=u.UC(e.species),e}function b(e){let t=(0,r.A)({},e);return t.species=u.UC(t.species),t}var E=new WeakMap,x=new WeakMap,I=new WeakMap,B=new WeakMap,S=new WeakMap;class C{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,a.A)(this,E,void 0),(0,a.A)(this,x,void 0),(0,a.A)(this,I,void 0),(0,a.A)(this,B,void 0),(0,a.A)(this,S,void 0),!(e instanceof d.Xj))throw new Error("'inputs' should be a State object from './inputs.js'");if((0,o.A)(E,this,e),!(t instanceof A._))throw new Error("'filter' should be a CellFilteringState object");if((0,o.A)(x,this,t),!(n instanceof m.A))throw new Error("'normalized' should be a RnaNormalizationState object from './rna_normalization.js'");(0,o.A)(I,this,n),(0,o.A)(B,this,null===i?{}:i),(0,o.A)(S,this,new y),this.changed=!1}free(){(0,l.A)(S,this).free()}valid(){return(0,l.A)(E,this).fetchCountMatrix().has("RNA")}fetchCollectionDetails(){return(0,l.A)(S,this).fetchCollectionDetails()}fetchSetDetails(){return(0,l.A)(S,this).fetchSetDetails()}fetchUniverseSize(){return(0,l.A)(S,this).fetchUniverseSize()}computeEnrichment(e,t,n,r){return(0,l.A)(S,this).computeEnrichment(t,n,r,e,(0,l.A)(B,this).top_markers)}fetchFeatureSetIndices(e){return(0,l.A)(S,this).fetchFeatureSetIndices(e)}computePerCellScores(e){return(0,l.A)(S,this).computePerCellScores(e,(0,l.A)(I,this).fetchNormalizedMatrix(),(0,l.A)(x,this).fetchFilteredBlock())}fetchPerCellScores(e,t){return this.computePerCellScores(e,t)}fetchParameters(){return b((0,l.A)(B,this))}static flush(){}static setDownload(e){return y.setDownload(e)}static defaults(){return{skip:!1,guess_ids:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL",top_markers:100}}async compute(e){if(e=f.wn(e,C.defaults()),this.changed=!1,(0,l.A)(E,this).changed&&(this.changed=!0),e.skip!==(0,l.A)(B,this).skip&&(this.changed=!0),this.valid()&&!e.skip){this.changed&&(0,o.A)(B,this,{}),await(0,l.A)(S,this).buildCollections((0,l.A)(B,this),e.guess_ids,e.species,e.gene_id_column,e.gene_id_type,()=>(0,l.A)(E,this).fetchFeatureAnnotations().RNA,()=>(0,l.A)(E,this).guessRnaFeatureTypes())&&(this.changed=!0),e.top_markers!==(0,l.A)(B,this).top_markers&&(this.changed=!0)}(0,o.A)(B,this,v(e))}}},6873:(e,t,n)=>{n.d(t,{F:()=>c,K:()=>o});var r=n(3619),i=n(545),a=n(507),s=n(5361),l=n(9215);async function o(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=!0;"DataFrame_readNested"in o&&(c=o.DataFrame_readNested);let u=!0;"DataFrame_toTypedArray"in o&&(u=o.DataFrame_toTypedArray);let h=await n.h5open((0,s.uJ)(e,"basic_columns.h5")),f=[h];try{let t=h.open("data_frame");f.push(t);let d=t.open("data");f.push(d);let A=t.open("column_names");f.push(A);let m=Number(t.readAttribute("row-count").values[0]),p=A.values();A.close(),f.pop();let w={},g=!1,y=d.children();for(const[l,h]of Object.entries(p)){let t=String(l);if(y.indexOf(t)<0){if(!1!==c){let r=(0,s.uJ)(e,"other_columns",t),i=await(0,a._i)(r,n);w[h]=!0===c?await(0,a.Ag)(r,i,n,o):await c(m,r,i,n,o)}else g=!0;continue}let A=d.open(t);if(f.push(A),A instanceof i.m){let t,n,i=A.values(),a=A.readAttribute("type").values[0],s=A.attributes().indexOf("missing-value-placeholder")>=0;if(s&&(n=A.readAttribute("missing-value-placeholder").values[0]),"number"==a)if(s||!u){if(t=Array.from(i),Number.isNaN(n))for(let e=0;e<t.length;e++)Number.isNaN(t[e])&&(t[e]=null);else for(let e=0;e<t.length;e++)t[e]==n&&(t[e]=null);t=new r.eg(t)}else t=new Float64Array(i);else if("boolean"==a){if(t=new Array(i.length),s)for(let e=0;e<i.length;e++)i[e]==n?t[e]=null:t[e]=0!=i[e];else for(let e=0;e<i.length;e++)t[e]=0!=i[e];t=new r.pz(t)}else if("integer"==a)if(s||!u){t=Array.from(i);for(let e=0;e<t.length;e++)t[e]==n&&(t[e]=null);t=new r.Bm(t)}else t=new Int32Array(i);else{if("string"!=a)throw new Error("unknown type '"+a+"' in column '"+h+"' of a DataFrame at '"+e+"'");if(t=i.slice(),s)for(let e=0;e<t.length;e++)t[e]==n&&(t[e]=null);t=new r.a4(t)}w[h]=t}else{if(!(A instanceof i.d))throw new Error("unknown type for column '"+h+"' at path '"+e+"'");{let t=A.readAttribute("type").values[0];if("factor"==t){let e=A.open("levels");f.push(e);let t=e.values();e.close(),f.pop();let n=A.open("codes");f.push(n);let i=n.values(),a=n.attributes(),s=Array(i.length);if(a.indexOf("missing-value-placeholder")>=0){let e=n.readAttribute("missing-value-placeholder").values[0];for(let n=0;n<i.length;n++)i[n]==e?s[n]=null:s[n]=t[i[n]]}else for(let r=0;r<i.length;r++)s[r]=t[i[r]];w[h]=new r.a4(s),n.close(),f.pop()}else{if("vls"!=t)throw new Error("unknown type '"+t+"' in column '"+h+"' of a DataFrame at '"+e+"'");{let e=A.open("heap");f.push(e);let t=e.values();e.close(),f.pop();let n=A.open("pointers");f.push(n);let i=n.values(),a=n.attributes(),s=new Array(i.length),l=new TextDecoder;for(let r=0;r<i.length;r++){const{offset:e,length:n}=i[r];let a=t.slice(Number(e),Number(e+n)),o=a.indexOf(0);o>=0&&(a=a.slice(0,o)),s[r]=l.decode(a)}if(a.indexOf("missing-value-placeholder")>=0){let e=n.readAttribute("missing-value-placeholder").values[0];for(let t=0;t<s.length;t++)s[t]==e&&(s[t]=null)}w[h]=new r.a4(s),n.close(),f.pop()}}}}A.close(),f.pop()}let _=null;if(t.children().indexOf("row_names")>=0){let e=t.open("row_names");f.push(e),_=e.values(),e.close(),f.pop()}if(g){let e=[];for(const t of p)t in w&&e.push(t);p=e}let v=await(0,l.m)((0,s.uJ)(e,"other_annotations"),n,o,"DataFrame_readMetadata");return new r.CP(w,{columnOrder:p,numberOfRows:m,rowNames:_,metadata:v})}finally{for(const e of f.toReversed())e.close();await n.h5close(h)}}async function c(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};await n.mkdir(t),await n.write((0,s.uJ)(t,"OBJECT"),(0,s.Z0)({type:"data_frame",data_frame:{version:"1.1"}}));let o={},c=!1,u=await n.h5create((0,s.uJ)(t,"basic_columns.h5")),h=[u];try{let t=u.createGroup("data_frame");h.push(t),t.writeAttribute("row-count","Uint64",[],[e.numberOfRows()]),t.createDataSet("column_names","String",[e.numberOfColumns()],{data:e.columnNames()}).close(),null!=e.rowNames()&&t.createDataSet("row_names","String",[e.numberOfRows()],{data:e.rowNames()}).close();let n=t.createGroup("data");for(const[a,l]of Object.entries(e.columnNames())){let t=String(a),c=e.column(l);if(c instanceof Uint8Array){let e=n.createDataSet(t,"Uint8",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["integer"]),e.close(),h.pop()}else if(c instanceof Int8Array){let e=n.createDataSet(t,"Int8",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["integer"]),e.close(),h.pop()}else if(c instanceof Uint16Array){let e=n.createDataSet(t,"Uint16",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["integer"]),e.close(),h.pop()}else if(c instanceof Int16Array){let e=n.createDataSet(t,"Int16",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["integer"]),e.close(),h.pop()}else if(c instanceof Uint32Array){let e=n.createDataSet(t,"Uint32",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["number"]),e.close(),h.pop()}else if(c instanceof Int32Array){let e=n.createDataSet(t,"Int32",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["integer"]),e.close(),h.pop()}else if(c instanceof BigUint64Array){let e=n.createDataSet(t,"Float64",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["number"]),e.close(),h.pop()}else if(c instanceof BigInt64Array){let e=n.createDataSet(t,"Float64",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["number"]),e.close(),h.pop()}else if(c instanceof Float32Array){let e=n.createDataSet(t,"Float32",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["number"]),e.close(),h.pop()}else if(c instanceof Float64Array){let e=n.createDataSet(t,"Float64",[c.length],{data:c});h.push(e),e.writeAttribute("type","String",[],["number"]),e.close(),h.pop()}else if(c instanceof r.Bm){let e,r,i=(0,s.ZA)(c.toArray());i.integer?(e="integer",r="Int32"):(e="number",r="Float64");let a=n.createDataSet(t,r,[i.data.length],{data:i.data});h.push(a),a.writeAttribute("type","String",[],[e]),null!==i.placeholder&&a.writeAttribute("missing-value-placeholder",r,[],[i.placeholder]),a.close(),h.pop()}else if(c instanceof r.eg){let e=(0,s.yb)(c.toArray()),r=n.createDataSet(t,"Float64",[e.data.length],{data:e.data});h.push(r),r.writeAttribute("type","String",[],["number"]),null!==e.placeholder&&r.writeAttribute("missing-value-placeholder","Float64",[],[e.placeholder]),r.close(),h.pop()}else if(c instanceof r.a4){let e=(0,s.Sv)(c.toArray()),r=n.createDataSet(t,"String",[e.data.length],{data:e.data});h.push(r),r.writeAttribute("type","String",[],["string"]),null!==e.placeholder&&r.writeAttribute("missing-value-placeholder","String",[],[e.placeholder]),r.close(),h.pop()}else if(c instanceof r.pz){let e=(0,s.XW)(c.toArray()),r=n.createDataSet(t,"Int8",[e.data.length],{data:e.data});h.push(r),r.writeAttribute("type","String",[],["boolean"]),null!==e.placeholder&&r.writeAttribute("missing-value-placeholder","Int8",[],[e.placeholder]),r.close(),h.pop()}else if(c instanceof Array){let e=new Set,i=!1;for(const t of c)null==t?i=!0:e.add(typeof t);let a=!1;if(0==e.size){let e=n.createDataSet(t,"Uint8",[df.numberOfRows()],{data:new Uint8Array(df.numberOfRows())});h.push(e),e.writeAttribute("type","String",[],["boolean"]),e.close(),h.pop(),a=!0}else if(1==e.size)if(e.has("number")){let e=(0,s.yb)(c),r=n.createDataSet(t,"Float64",[c.length],{data:e.data});h.push(r),r.writeAttribute("type","String",[],["number"]),null!==e.placeholder&&r.writeAttribute("missing-value-placeholder","Float64",[],[e.placeholder]),r.close(),h.pop(),a=!0}else if(e.has("boolean")){let e=(0,s.XW)(c),r=n.createDataSet(t,"Uint8",[c.length],{data:e.data});h.push(r),r.writeAttribute("type","String",[],["boolean"]),null!==e.placeholder&&r.writeAttribute("missing-value-placeholder","Uint8",[],[e.placeholder]),r.close(),h.pop(),a=!0}else if(e.has("string")){let e=(0,s.Sv)(c),r=n.createDataSet(t,"String",[c.length],{data:e.data});h.push(r),r.writeAttribute("type","String",[],["string"]),i&&r.writeAttribute("missing-value-placeholder","String",[],[e.placeholder]),r.close(),h.pop(),a=!0}a||(o[t]=new r.B8(c))}else{let e=!1;"DataFrame_saveOther"in i&&(e=i.DataFrame_saveOther(c,n,t)),e||(o[t]=c)}}c=!0}finally{for(const e of h.toReversed())e.close();await n.h5finish(u,!c)}let f=Object.entries(o);if(f.length>0){let e=(0,s.uJ)(t,"other_columns");await n.mkdir(e);for(const[t,r]of f)await(0,a.ll)(r,(0,s.uJ)(e,t),n,i)}await(0,l.r)(e.metadata(),(0,s.uJ)(t,"other_annotations"),n,i)}},6919:(e,t,n)=>{n.d(t,{g:()=>a});var r=n(9165),i=n(3619);function a(e,t,n,r,a){let s=e.cell_filtering.fetchKeep(),l=[];null!==s&&s.forEach((e,t)=>{e&&l.push(t)});let o={};{let r=e.inputs.fetchCellAnnotations();o[n]=null===s?r:i.$9(r,l);let a=o[n].numberOfRows();for(const e of t)e!==n&&(o[e]=new i.CP({},{numberOfRows:a}))}if(e.rna_quality_control.valid()){let t=a?"kana::quality_control":"kana::RNA::quality_control",i=a?"RNA":n,s=o[i];s=s.setColumn(t+"::sums",e.cell_filtering.applyFilter(e.rna_quality_control.fetchMetrics().sum({copy:!1}))),s=s.setColumn(t+"::detected",e.cell_filtering.applyFilter(e.rna_quality_control.fetchMetrics().detected({copy:!1}))),s=s.setColumn(t+"::proportions",e.cell_filtering.applyFilter(e.rna_quality_control.fetchMetrics().subsetProportion(0,{copy:!1}))),o[i]=s,r[i].set(t,{filters:{sums:e.rna_quality_control.fetchFilters().sum(),detected:e.rna_quality_control.fetchFilters().detected(),proportions:e.rna_quality_control.fetchFilters().subsetProportion(0)}},{inPlace:!0})}if(e.adt_quality_control.valid()){let t=a?"kana::quality_control":"kana::ADT::quality_control",i=a?"ADT":n,s=o[i];s=s.setColumn(t+"::sums",e.cell_filtering.applyFilter(e.adt_quality_control.fetchMetrics().sum({copy:!1}))),s=s.setColumn(t+"::detected",e.cell_filtering.applyFilter(e.adt_quality_control.fetchMetrics().detected({copy:!1}))),s=s.setColumn(t+"::igg_totals",e.cell_filtering.applyFilter(e.adt_quality_control.fetchMetrics().subsetSum(0,{copy:!1}))),o[i]=s,r[i].set(t,{filters:{detected:e.adt_quality_control.fetchFilters().detected(),igg_totals:e.adt_quality_control.fetchFilters().subsetSum(0)}},{inPlace:!0})}if(e.crispr_quality_control.valid()){let t=a?"kana::quality_control":"kana::CRISPR::quality_control",i=a?"CRISPR":n,s=o[i];s=s.setColumn(t+"::sums",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().sum({copy:!1}))),s=s.setColumn(t+"::detected",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().detected({copy:!1}))),s=s.setColumn(t+"::max_proportion",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().maxProportion({copy:!1}))),s=s.setColumn(t+"::max_index",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().maxIndex({copy:!1}))),o[i]=s,r[i].set(t,{filters:{max_count:e.crispr_quality_control.fetchFilters().maxValue()}},{inPlace:!0})}if(null!==s&&(o[n]=o[n].setColumn("kana::quality_control::retained_indices",l)),e.rna_normalization.valid()){let t=a?"kana::size_factors":"kana::RNA::size_factors",r=a?"RNA":n;o[r]=o[r].setColumn(t,e.rna_normalization.fetchSizeFactors())}if(e.adt_normalization.valid()){let t=a?"kana::size_factors":"kana::ADT::size_factors",r=a?"ADT":n;o[r]=o[r].setColumn(t,e.adt_normalization.fetchSizeFactors())}if(e.crispr_normalization.valid()){let t=a?"kana::size_factors":"kana::CRISPR::size_factors",r=a?"CRISPR":n;o[r]=o[r].setColumn(t,e.crispr_normalization.fetchSizeFactors())}{let t=e.choose_clustering.fetchClusters().map(e=>e+1);o[n]=o[n].setColumn("kana::clusters",t)}{let t=e.cell_filtering.fetchFilteredBlock();if(null!==t){let r=new Array(t.length),i=e.inputs.fetchBlockLevels();t.forEach((e,t)=>{r[t]=i[e]}),o[n]=o[n].setColumn("kana::block",r)}}{let t=e.custom_selections.fetchSelections({copy:!1}),r=o[n].numberOfRows();for(const[e,i]of Object.entries(t)){let t=new Array(r);t.fill(!1),i.forEach(e=>{t[e]=!0}),o[n]=o[n].setColumn("kana::custom_selections::"+e,t)}}return o}r._A.prototype._bioconductor_LENGTH=function(){return this.length},r.Os.prototype._bioconductor_LENGTH=function(){return this.length},r.WI.prototype._bioconductor_LENGTH=function(){return this.length}},7001:(e,t,n)=>{n.d(t,{Q:()=>r});n(2152),n(2777);function r(e){var t=new Map;for(const r of e)for(const e of r){let n=t.get(e);"undefined"==typeof n?t.set(e,1):t.set(e,n+1)}let n=[];for(const[r,i]of t){let e={id:Number(r),count:i};n.push(e)}return n}},7212:(e,t,n)=>{n.d(t,{SR:()=>l,hO:()=>s});var r=n(141),i=n(9830),a=n(9526);async function s(e,t){let n=i.jD(e),r=await async function(e,t){let n={};for(const[r,i]of Object.entries(e)){let e=i.constructor.format(),{files:a,options:s}=await i.serialize(),l={format:e,options:s,files:[]};for(const n of a)l.files.push({type:n.type,name:n.file.name(),id:await t(r,e,n.file)});n[r]=l}return n}(e.inputs.fetchDatasets(),t),s=e.inputs.fetchDirectSubset({copy:!1});return null!==s&&(s=Array.from(s)),{version:a.e,parameters:n,datasets:r,other:{inputs:{direct_subset:s},custom_selections:{selections:e.custom_selections.fetchSelections({force:"Array"})}}}}async function l(e,t){let{state:n=null,startFun:a=null,finishFun:s=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===n&&(n=await i.fc()),"other"in e&&"inputs"in e.other&&"direct_subset"in e.other.inputs&&null!==e.other.inputs.direct_subset&&n.inputs.setDirectSubset(new Int32Array(e.other.inputs.direct_subset));let l=await async function(e,t){let n={},i=r.uw;for(const[a,s]of Object.entries(e)){if(!(s.format in i))throw new Error("unknown dataset format '"+s.format+"'");let e=r.uw[s.format],l=[];for(const n of s.files){let e=await t(n.id),i=new r.VM(e,{name:n.name});l.push({type:n.type,file:i})}n[a]=await e.unserialize(l,s.options)}return n}(e.datasets,t);if(await i.A1(n,l,e.parameters,{startFun:a,finishFun:s}),"other"in e&&"custom_selections"in e.other&&"selections"in e.other.custom_selections)for(const[r,i]of Object.entries(e.other.custom_selections.selections))n.custom_selections.addSelection(r,new Int32Array(i),{copy:!1});return n}},7265:(e,t,n)=>{n.d(t,{d:()=>F});var r=n(9379),i=n(9790),a=n(5149),s=n(6562),l=n(4558),o=n(8458),c=n(7990),u=n(3619),h=n(6164),f=(n(6774),n(4736));function d(e){let t,n,r=e.findAttribute("names");if(r<0)return null;try{t=e.attribute(r),n=t.values()}catch(i){throw new Error("failed to load listData names; "+i.message)}finally{c.t9(t)}if(n.length!=e.length())throw new Error("expected names to have same length as listData");return n}const A={DFrame:"S4Vectors"};function m(e){w(e,A,"DFrame");let t,n,r={},i=[];try{if(t=e.attribute("listData"),!(t instanceof c.G1))throw new Error("listData slot should be a generic list");if(i=d(t),null==i)throw new Error("expected the listData list to be named");for(var a=0;a<t.length();a++){let e;try{if(e=t.load(a),e instanceof c.pv&&!(e instanceof c.G1)){let t=e.values();if(e.findAttribute("class")>=0){let n,r;try{if(n=e.attribute("class"),n.values().indexOf("factor")>=0&&e.findAttribute("levels")>=0){r=e.attribute("levels");let n=t.slice();n.forEach((e,t)=>{n[t]=e-1}),t=u.$9(r.values(),n)}}finally{c.t9(n),c.t9(r)}}r[i[a]]=t}else e instanceof c.ac&&p(e,A)&&(r[i[a]]=m(e))}finally{c.t9(e)}}}catch(o){throw new Error("failed to retrieve data from DataFrame's listData; "+o.message)}finally{c.t9(t)}let s=null;try{n=e.attribute("rownames"),n instanceof c.Kn&&(s=n.values())}catch(o){throw new Error("failed to retrieve row names from DataFrame; "+o.message)}finally{c.t9(n)}let l=null;if(0==i.length&&null==s){let t;try{if(t=e.attribute("nrows"),!(t instanceof c.X7))throw new Error("expected an integer vector as the 'nrows' slot");let n=t.values();if(1!=n.length)throw new Error("expected an integer vector of length 1 as the 'nrows' slot");l=n[0]}catch(o){throw new Error("failed to retrieve nrows from DataFrame; "+o.message)}finally{c.t9(t)}}return new u.CP(r,{columnOrder:i,rowNames:s,numberOfRows:l})}function p(e,t){for(const[n,r]of Object.entries(t))if(e.className()==n&&e.packageName()==r)return!0;return!1}function w(e,t,n){if(!(e instanceof c.ac))throw new Error("expected an S4 object as the data frame");if(!p(e,t))throw new Error("object is not a "+n+" or one of its recognized subclasses")}function g(e){let t,n=e.findAttribute("NAMES");if(n<0)return null;let r=null;try{t=e.attribute(n),t instanceof c.Kn&&(r=t.values())}catch(i){throw new Error("failed to extract NAMES; "+i.message)}finally{c.t9(t)}return r}function y(e){let t,n=null,r=e.findAttribute("rowRanges");if(r<0){let r;try{r=e.attribute("elementMetadata"),t=m(r)}catch(i){throw new Error("failed to extract features from the rowData; "+i.message)}finally{c.t9(r)}n=g(e)}else{let a;try{a=e.attribute(r);let s=a.attribute("elementMetadata");try{t=m(s)}catch(i){throw new Error("failed to extract mcols from the rowRanges; "+i.message)}finally{c.t9(s)}let l=a.findAttribute("partitioning");if(l<0){let e;try{e=a.attribute("ranges"),n=g(e)}catch(i){throw new Error("failed to extract names from the rowRanges; "+i.message)}finally{c.t9(e)}}else{let e;try{e=a.attribute(l),n=g(e)}catch(i){throw new Error("failed to extract names from the rowRanges; "+i.message)}finally{c.t9(e)}}}catch(i){throw new Error("failed to extract features from the rowRanges; "+i.message)}finally{c.t9(a)}}return null!==n&&t.$setRowNames(n),t}function _(e){let t,n,r,i;try{n=e.attribute("assays"),r=n.attribute("data"),i=r.attribute("listData"),t=d(i),null==t&&(t=new Array(i.length()),t.fill(""))}catch(a){throw new Error("failed to extract assay data; "+a.message)}finally{c.t9(n),c.t9(i),c.t9(r)}return t}function v(e,t,n){let r,i,a,s;try{i=e.attribute("assays"),a=i.attribute("data"),s=a.attribute("listData");let u,h=null;if("string"==typeof t){let e=d(s);if(null!==t&&null!=e)for(var l=0;l<e.length;l++)if(e[l]==t){h=l;break}if(null==h)throw new Error("no assay named '"+t+"'")}else{if(t>=s.length())throw new Error("assay index "+String(t)+" out of range");h=t}try{u=s.load(h),r=c.LX(u,{forceInteger:n})}catch(o){throw new Error("failed to initialize sparse matrix from assay; "+o.message)}finally{c.t9(u)}}catch(o){throw new Error("failed to extract assay data; "+o.message)}finally{c.t9(i),c.t9(s),c.t9(a)}return r}function b(e){let t,n,r;try{let i=e.findAttribute("int_metadata");if(i<0)return"";t=e.attribute(i);let a=t.findAttribute("names");if(a<0)return"";n=t.attribute(a);let s=n.values().indexOf("mainExpName");if(s<0)return"";r=t.load(s);let l=r.values();return 1!=l.length||"string"!==typeof l[0]?"":l[0]}finally{c.t9(t),c.t9(n),c.t9(r)}}function E(e){let t,n,r,i,a,s,l={handles:{},order:[]},o=e.findAttribute("int_colData");if(o<0)return l;try{t=e.attribute(o);let f=t.findAttribute("listData");if(f<0)return l;n=t.attribute(f);let d=n.findAttribute("names");if(d<0)return l;r=n.attribute(d);let A=r.values().indexOf("altExps");if(A<0)return l;i=n.load(A);let m=i.findAttribute("listData");if(m<0)return l;a=i.attribute(m);let p=a.findAttribute("names");if(p<0)return l;s=a.attribute(p);let w=s.values();for(var u=0;u<w.length;u++){let e;try{e=a.load(u);let t=e.attribute("se");l.handles[w[u]]=t,l.order.push(w[u]),x(t)}catch(h){throw new Error("failed to load alternative Experiment '"+w[u]+"'; "+h.message)}finally{c.t9(e)}}}catch(h){for(const e of Object.values(l.handles))c.t9(e);throw h}finally{c.t9(s),c.t9(a),c.t9(r),c.t9(n),c.t9(t)}return l}function x(e){w(e,{SummarizedExperiment:"SummarizedExperiment",RangedSummarizedExperiment:"SummarizedExperiment",SingleCellExperiment:"SingleCellExperiment",SpatialExperiment:"SpatialExperiment"},"SummarizedExperiment")}var I=new WeakMap,B=new WeakMap,S=new WeakMap,C=new WeakMap,k=new WeakMap,N=new WeakMap,D=new WeakMap,O=new WeakMap,R=new WeakMap,Q=new WeakSet;class F{constructor(e){(0,i.A)(this,Q),(0,a.A)(this,I,void 0),(0,a.A)(this,B,void 0),(0,a.A)(this,S,void 0),(0,a.A)(this,C,void 0),(0,a.A)(this,k,void 0),(0,a.A)(this,N,void 0),(0,a.A)(this,D,void 0),(0,a.A)(this,O,void 0),(0,a.A)(this,R,void 0),e instanceof h.V?(0,l.A)(I,this,e):(0,l.A)(I,this,new h.V(e)),(0,l.A)(R,this,F.defaults()),this.clear()}static defaults(){return{rnaCountAssay:0,adtCountAssay:0,crisprCountAssay:0,rnaExperiment:"Gene Expression",adtExperiment:"Antibody Capture",crisprExperiment:"CRISPR Guide Capture",primaryRnaFeatureIdColumn:null,primaryAdtFeatureIdColumn:null,primaryCrisprFeatureIdColumn:null}}options(){return(0,r.A)({},(0,o.A)(R,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,o.A)(R,this)[t]=n}clear(){if(c.t9((0,o.A)(S,this)),"undefined"!=typeof(0,o.A)(k,this)&&null!==(0,o.A)(k,this))for(const e of Object.values((0,o.A)(k,this)))c.t9(e);c.t9((0,o.A)(B,this)),(0,l.A)(S,this,null),(0,l.A)(k,this,null),(0,l.A)(B,this,null),(0,l.A)(D,this,null),(0,l.A)(O,this,null)}static format(){return"SummarizedExperiment"}abbreviate(){return(0,s.A)(Q,this,z).call(this,e=>({name:e.name(),size:e.size()}))}summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.A)(Q,this,P).call(this),(0,s.A)(Q,this,M).call(this),(0,s.A)(Q,this,J).call(this);let t={};t[(0,o.A)(C,this)]=_((0,o.A)(S,this));for(const[i,a]of Object.entries((0,o.A)(k,this)))if(!(i in t))try{t[i]=_(a)}catch(r){console.warn("failed to extract features for alternative Experiment '"+i+"'; "+r.message)}let n={modality_features:(0,o.A)(D,this),cells:(0,o.A)(O,this),modality_assay_names:t};return e||this.clear(),n}previewPrimaryIds(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.A)(Q,this,M).call(this);let t={RNA:(0,o.A)(R,this).rnaExperiment,ADT:(0,o.A)(R,this).adtExperiment,CRISPR:(0,o.A)(R,this).crisprExperiment},n=f.q((0,o.A)(D,this),(0,o.A)(N,this),t,(0,s.A)(Q,this,q).call(this));return e||this.clear(),n}load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.A)(Q,this,P).call(this),(0,s.A)(Q,this,M).call(this),(0,s.A)(Q,this,J).call(this);let t={matrix:new c.P_,features:{},cells:(0,o.A)(O,this)},n={RNA:{exp:(0,o.A)(R,this).rnaExperiment,assay:(0,o.A)(R,this).rnaCountAssay},ADT:{exp:(0,o.A)(R,this).adtExperiment,assay:(0,o.A)(R,this).adtCountAssay},CRISPR:{exp:(0,o.A)(R,this).crisprExperiment,assay:(0,o.A)(R,this).crisprCountAssay}};try{for(const[e,r]of Object.entries(n)){if(null===r.exp)continue;let n;if(r.exp===(0,o.A)(C,this))n=(0,o.A)(S,this);else{if(!(r.exp in(0,o.A)(k,this)))continue;n=(0,o.A)(k,this)[r.exp]}let i=v(n,r.assay,!0);t.matrix.add(e,i),t.features[e]=(0,o.A)(D,this)[r.exp]}t.primary_ids=f.gu(t.features,(0,s.A)(Q,this,q).call(this))}catch(r){throw c.t9(t.matrix),r}return e||this.clear(),t}serialize(){return(0,s.A)(Q,this,z).call(this,e=>e)}static async unserialize(e,t){if(1!=e.length||"rds"!=e[0].type)throw new Error("expected exactly one file of type 'rds' for SummarizedExperiment unserialization");let n=new F(e[0].file);return n.setOptions(t),n}}function z(e){return{files:[{type:"rds",file:e((0,o.A)(I,this))}],options:this.options()}}function P(){if(null===(0,o.A)(B,this)){(0,l.A)(B,this,c.vD((0,o.A)(I,this).content())),(0,l.A)(S,this,(0,o.A)(B,this).value());try{x((0,o.A)(S,this));const{handles:e,order:t}=E((0,o.A)(S,this));(0,l.A)(k,this,e),(0,l.A)(N,this,t),(0,l.A)(C,this,b((0,o.A)(S,this)))}catch(e){throw(0,o.A)(S,this).free(),(0,o.A)(B,this).free(),e}}}function M(){if(null===(0,o.A)(D,this)){(0,s.A)(Q,this,P).call(this),(0,l.A)(D,this,{}),(0,o.A)(D,this)[(0,o.A)(C,this)]=y((0,o.A)(S,this));for(const[t,n]of Object.entries((0,o.A)(k,this)))if(!(t in(0,o.A)(D,this)))try{(0,o.A)(D,this)[t]=y(n)}catch(e){console.warn("failed to extract features for alternative Experiment '"+t+"'; "+e.message)}}}function J(){if(null!==(0,o.A)(O,this))return;(0,s.A)(Q,this,P).call(this);let e=(0,o.A)(S,this).attribute("colData");try{(0,l.A)(O,this,m(e))}catch(t){throw new Error("failed to extract colData from a SummarizedExperiment; "+t.message)}finally{c.t9(e)}}function q(){return{RNA:(0,o.A)(R,this).primaryRnaFeatureIdColumn,ADT:(0,o.A)(R,this).primaryAdtFeatureIdColumn,CRISPR:(0,o.A)(R,this).primaryCrisprFeatureIdColumn}}},7633:(e,t,n)=>{n.d(t,{kA:()=>y});var r=n(9790),i=n(6562),a=n(5149),s=n(8458),l=n(4558),o=n(6159),c=n(1576),u=n(2779),h=n(6164),f=new WeakMap,d=new WeakMap,A=new WeakMap;class m{constructor(e,t,n){(0,a.A)(this,f,void 0),(0,a.A)(this,d,void 0),(0,a.A)(this,A,void 0),(0,l.A)(f,this,e),(0,l.A)(d,this,null),(0,l.A)(A,this,n)}async get(e,t){return null==(0,s.A)(d,this)&&(0,l.A)(d,this,await o.loadAsync((0,s.A)(f,this).buffer())),(0,s.A)(d,this).file(c.uJ((0,s.A)(A,this),e)).async("uint8array")}exists(e){return null!==(0,s.A)(d,this).file(c.uJ((0,s.A)(A,this),e))}clean(e){}}var p=new WeakMap,w=new WeakMap,g=new WeakSet;class y extends u.s{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=null;"existingHandle"in n?(i=n.existingHandle,delete n.existingHandle):t instanceof h.V||(t=new h.V(t)),super(new m(t,i,e)),(0,r.A)(this,g),(0,a.A)(this,p,void 0),(0,a.A)(this,w,void 0),(0,l.A)(p,this,t),(0,l.A)(w,this,e)}static format(){return"alabaster-zipped"}abbreviate(){return(0,i.A)(g,this,_).call(this,e=>({size:e.size(),name:e.name()}))}serialize(){return(0,i.A)(g,this,_).call(this,e=>e)}static unserialize(e,t){if(1!=e.length||"zip"!=e[0].type)throw new Error("expected exactly one file of type 'zip' for Zipped alabaster unserialization");let n=t.datasetPrefix;delete t.datasetPrefix;let r=new y(n,e[0].file);return r.setOptions(r),r}}function _(e){let t=[{type:"zip",file:e((0,s.A)(p,this))}],n=this.options();return n.datasetPrefix=(0,s.A)(w,this),{files:t,options:n}}u.Z},7709:(e,t,n)=>{n.d(t,{D:()=>d,J:()=>f});var r=n(6554),i=n(4678),a=n(3021),s=n(3046),l=n(2416),o=n(1989),c=n(1576),u=n(9165);function h(e,t,n){if(e instanceof u.WI){let r=t.createDataSet(n,"Float64",[e.length],{data:e});try{r.writeAttribute("type","String",[],["number"])}finally{r.close()}return!0}if(e instanceof u.Os){let r=t.createDataSet(n,"Int32",[e.length],{data:e});try{r.writeAttribute("type","String",[],["integer"])}finally{r.close()}return!0}if(e instanceof u._A){let r=t.createDataSet(n,"Uint8",[e.length],{data:e});try{r.writeAttribute("type","String",[],["boolean"])}finally{r.close()}return!0}return!1}async function f(e,t){let{reportOneIndex:n=!1,storeModalityColumnData:i=!1,directory:u=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=await r.V(e,{reportOneIndex:n,storeModalityColumnData:i});l.sy()||(u=null);let d={},A=new o.z7(u,d);c.KE.push([a.Mu,a.rt]),c.KE.push([a.ph,a.Uz]),c.KE.push([s.e,s.t]);try{await c.ll(f,t,A,{DataFrame_saveOther:h})}finally{c.KE.pop(),c.KE.pop(),c.KE.pop()}return null===u?d:null}async function d(e,t){let{includeMarkerDetection:n=!0,includeCustomSelections:r=!0,includeFeatureSelection:a=!0,directory:s=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u={},f=e.inputs.fetchFeatureAnnotations();for(const[i,l]of Object.entries(f)){let e=l.rowNames();null===e&&l.numberOfColumns()>0&&(e=l.column(0)),u[i]=e}l.sy()||(s=null);let d={},A=new o.z7(s,d);if(n){let n="marker_detection";null!==t&&(n=c.uJ(t,n));let r=i.To(e,u);for(const[e,t]of Object.entries(r))await c.ll(t,c.uJ(n,e),A,{DataFrame_saveOther:h})}if(r){let n="custom_selections";null!==t&&(n=c.uJ(t,n));let r=i.Hp(e,u);for(const[e,t]of Object.entries(r))await c.ll(t,c.uJ(n,e),A,{DataFrame_saveOther:h})}if(e.feature_selection.valid()&&a){let n="feature_selection";null!==t&&(n=c.uJ(t,n));let r=i.k5(e,u.RNA);await c.ll(r,n,A,{DataFrame_saveOther:h})}return null===s?d:null}},7961:(e,t,n)=>{n.d(t,{J:()=>o,u:()=>l});var r=n(3619),i=n(507),a=n(4717),s=n(5361);async function l(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=await(0,a.I)(e,t,n,l),c=new r.ky(o.assays(),{assayOrder:o.assayNames(),rowRanges:o.rowRanges(),rowData:o.rowData(),columnData:o.columnData(),rowNames:o.rowNames(),columnNames:o.columnNames(),metadata:o.metadata()});"main_experiment_name"in t.single_cell_experiment&&c.setMainExperimentName(t.single_cell_experiment.main_experiment_name,{inPlace:!0});let u=!0;if("SingleCellExperiment_readReducedDimension"in l&&(u=l.SingleCellExperiment_readReducedDimension),!1!==u){const t=(0,s.uJ)(e,"reduced_dimensions/names.json");if(await n.exists(t)){let r=await n.get(t,{asBuffer:!0});const a=new TextDecoder,o=JSON.parse(a.decode(r));for(const[t,h]of Object.entries(o)){let r,a=(0,s.uJ)(e,"reduced_dimensions",String(t)),o=await(0,i._i)(a,n);r=!0===u?await(0,i.Ag)(a,o,n,l):await u(c.numberOfColumns(),a,o,n,l),c.setReducedDimension(h,r,{inPlace:!0})}}}let h=!0;if("SingleCellExperiment_readAlternativeExperiment"in l&&(h=l.SingleCellExperiment_readAlternativeExperiment),!1!==h){const t=(0,s.uJ)(e,"alternative_experiments/names.json");if(await n.exists(t)){let r=await n.get(t,{asBuffer:!0});const a=new TextDecoder,o=JSON.parse(a.decode(r));for(const[t,u]of Object.entries(o)){let r,a=(0,s.uJ)(e,"alternative_experiments",String(t)),o=await(0,i._i)(a,n);r=!0===h?await(0,i.Ag)(a,o,n,l):await h(c.numberOfColumns(),a,o,n,l),c.setAlternativeExperiment(u,r,{inPlace:!0})}}}return c}async function o(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};await(0,a.R)(e,t,n,r);const l=await(0,i._i)(t,n);l.type="single_cell_experiment",l.single_cell_experiment={version:"1.0"};let o=e.mainExperimentName();null!==o&&(l.single_cell_experiment.main_experiment_name=o),await n.write((0,s.uJ)(t,"OBJECT"),(0,s.Z0)(l));const c=e.reducedDimensionNames();if(c.length>0){let a=(0,s.uJ)(t,"reduced_dimensions");await n.mkdir(a),await n.write((0,s.uJ)(a,"names.json"),(0,s.Z0)(c));for(const[t,l]of Object.entries(c))await(0,i.ll)(e.reducedDimension(l),(0,s.uJ)(a,String(t)),n,r)}const u=e.alternativeExperimentNames();if(u.length>0){let a=(0,s.uJ)(t,"alternative_experiments");await n.mkdir(a),await n.write((0,s.uJ)(a,"names.json"),(0,s.Z0)(u));for(const[t,l]of Object.entries(u))await(0,i.ll)(e.alternativeExperiment(l),(0,s.uJ)(a,String(t)),n,r)}}},7967:(e,t,n)=>{n.d(t,{F:()=>k});var r=n(9379),i=n(9790),a=n(5149),s=n(6562),l=n(4558),o=n(8458),c=n(7990),u=n(3619),h=n(6774),f=n(4736),d=n(6164);function A(e){if(e instanceof c.m9)return{rows:e.shape[0],columns:e.shape[1],sparse:!1};if(e instanceof c.dm){let t=e.readAttribute("shape"),n=e.readAttribute("encoding-type");return{rows:t.values[1],columns:t.values[0],sparse:!0,csc:"csr_matrix"==n.values[0]}}throw new Error("unknown type for a H5AD assay matrix")}function m(e,t){let n=[],r={};if("X"in e.children&&(n.push("X"),r.X=A(e.open("X"))),"layers"in e.children){let t=e.open("layers");if(!(t instanceof c.dm))throw new Error("expected a 'layers' group in a H5AD file");for(const e of Object.keys(t.children)){const i="layers/"+e;n.push(i),r[i]=A(t.open(e))}}if(0==n.length)throw new Error("failed to find any assay in the H5AD file");let i=r[n[0]];return{names:n,rows:i.rows,columns:i.columns,details:r}}function p(e){let t={};for(const[n,r]of Object.entries(e.children))if("DataSet"==r){let r=e.open(n,{load:!0});if("Enum"===r.type){let e=r.values,i=new Array(e.length),a=r.levels;e.forEach((e,t)=>{i[t]=a[e]}),t[n]=i}else"Other"!==r.type&&(t[n]=r.values)}else if("Group"==r){let r=e.open(n);if("categories"in r.children&&"codes"in r.children){let e=h.Fr(r,"categories"),i=r.open("codes",{load:!0}).values;t[n]=u.$9(e,i)}}if("__categories"in e.children&&"Group"==e.children.__categories){let n=e.open("__categories");for(const[e,r]of Object.entries(n.children))if(e in t){let r=h.Fr(n,e);if(!r){console.warn("ignoring invalid levels for nominally categorical key '".concat(e,"' in the H5AD reader"));continue}t[e]=u.$9(r,t[e])}}if(0==Object.keys(t).length)return null;{let e=null;return"_index"in t&&(e=t._index,delete t._index),new u.CP(t,{rowNames:e})}}function w(e){if("var"in e.children&&"Group"==e.children.var){return p(e.open("var"))}return null}function g(e){if("obs"in e.children&&"Group"==e.children.obs){return p(e.open("obs"))}return null}function y(e,t,n,r){return n.sparse?c.KR(e,t,n.rows,n.columns,!n.csc,r):c.vT(e,t,r)}var _=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakMap,x=new WeakMap,I=new WeakMap,B=new WeakMap,S=new WeakMap,C=new WeakSet;class k{constructor(e){(0,i.A)(this,C),(0,a.A)(this,_,void 0),(0,a.A)(this,v,void 0),(0,a.A)(this,b,void 0),(0,a.A)(this,E,void 0),(0,a.A)(this,x,void 0),(0,a.A)(this,I,void 0),(0,a.A)(this,B,void 0),(0,a.A)(this,S,void 0),e instanceof d.V?(0,l.A)(_,this,e):(0,l.A)(_,this,new d.V(e)),(0,l.A)(S,this,k.defaults()),this.clear()}static defaults(){return{countMatrixName:null,featureTypeColumnName:null,featureTypeRnaName:"Gene Expression",featureTypeAdtName:"Antibody Capture",featureTypeCrisprName:"CRISPR Guide Capture",primaryRnaFeatureIdColumn:null,primaryAdtFeatureIdColumn:null,primaryCrisprFeatureIdColumn:null}}options(){return(0,r.A)({},(0,o.A)(S,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,o.A)(S,this)[t]=n}clear(){"function"==typeof(0,o.A)(b,this)&&(0,o.A)(b,this).call(this),(0,l.A)(b,this,null),(0,l.A)(v,this,null),(0,l.A)(E,this,null),(0,l.A)(x,this,null),(0,l.A)(I,this,null),(0,l.A)(B,this,null)}static format(){return"H5AD"}abbreviate(){return(0,s.A)(C,this,N).call(this,e=>({name:e.name(),size:e.size()}))}summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.A)(C,this,R).call(this),(0,s.A)(C,this,Q).call(this),(0,s.A)(C,this,O).call(this);let t={all_features:(0,o.A)(x,this),cells:(0,o.A)(I,this),all_assay_names:(0,o.A)(B,this).names};return e||this.clear(),t}previewPrimaryIds(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.A)(C,this,R).call(this);let t=f.eZ((0,o.A)(x,this),(0,o.A)(S,this).featureTypeColumnName,(0,s.A)(C,this,F).call(this),"RNA",(0,s.A)(C,this,z).call(this));return e||this.clear(),t}load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.A)(C,this,R).call(this),(0,s.A)(C,this,Q).call(this),(0,s.A)(C,this,O).call(this);let t=(0,o.A)(S,this).countMatrixName;null==t&&(t=(0,o.A)(B,this).names[0]);let n=y((0,o.A)(v,this),t,(0,o.A)(B,this).details[t],{forceInteger:!0,layered:!0}),r=f.nu(n,(0,o.A)(x,this),(0,o.A)(S,this).featureTypeColumnName,(0,s.A)(C,this,F).call(this),"RNA");return r.cells=(0,o.A)(I,this),r.primary_ids=f.gu(r.features,(0,s.A)(C,this,z).call(this)),e||this.clear(),r}serialize(){return(0,s.A)(C,this,N).call(this,e=>e)}static async unserialize(e,t){if(1!=e.length||"h5"!=e[0].type)throw new Error("expected exactly one file of type 'h5' for H5AD unserialization");let n=new k(e[0].file);return n.setOptions(t),n}}function N(e){return{files:[{type:"h5",file:e((0,o.A)(_,this))}],options:this.options()}}function D(){if(null!=(0,o.A)(v,this))return;let e=c.He((0,o.A)(_,this).content());(0,l.A)(v,this,e.path),(0,l.A)(b,this,e.flush),(0,l.A)(E,this,new c.CE((0,o.A)(v,this)))}function O(){null===(0,o.A)(B,this)&&((0,s.A)(C,this,D).call(this),(0,l.A)(B,this,m((0,o.A)(E,this),(0,o.A)(v,this))))}function R(){if(null!==(0,o.A)(x,this))return;(0,s.A)(C,this,D).call(this);let e=w((0,o.A)(E,this));null==e&&((0,s.A)(C,this,O).call(this),e=new u.CP({},{numberOfRows:(0,o.A)(B,this).rows})),(0,l.A)(x,this,e)}function Q(){if(null!==(0,o.A)(I,this))return;(0,s.A)(C,this,D).call(this);let e=g((0,o.A)(E,this));null===e&&((0,s.A)(C,this,O).call(this),e=new u.CP({},{numberOfRows:(0,o.A)(B,this).columns})),(0,l.A)(I,this,e)}function F(){return{RNA:(0,o.A)(S,this).featureTypeRnaName,ADT:(0,o.A)(S,this).featureTypeAdtName,CRISPR:(0,o.A)(S,this).featureTypeCrisprName}}function z(){return{RNA:(0,o.A)(S,this).primaryRnaFeatureIdColumn,ADT:(0,o.A)(S,this).primaryAdtFeatureIdColumn,CRISPR:(0,o.A)(S,this).primaryCrisprFeatureIdColumn}}},7990:(e,t,n)=>{n.d(t,{$$:()=>g.$$,$Y:()=>s.$Y,$q:()=>N.$q,BB:()=>h.BB,CE:()=>h.CE,Cd:()=>M.Cd,Cx:()=>P.Cx,D0:()=>S.D,DA:()=>b.DA,D_:()=>A.W,G1:()=>c.G1,He:()=>T.H,Jp:()=>w.aN,K$:()=>m.K$,KB:()=>k.K,KR:()=>s.KR,K_:()=>b.K_,Kc:()=>y.K,Kn:()=>c.Kn,Kq:()=>P.Kq,LX:()=>l.L,Ls:()=>z.L,M2:()=>P.M2,M_:()=>o.M,O0:()=>O.O,OO:()=>v.O,Oi:()=>I.O,P_:()=>U.P,Qc:()=>q.Q,Qu:()=>W.Q,RJ:()=>E.RJ,RZ:()=>p.RZ,S$:()=>h.S$,So:()=>T.S,TA:()=>u.TA,Th:()=>f.T,Tv:()=>_.k,V0:()=>M.V0,VW:()=>m.VW,VZ:()=>a.VZ,Vn:()=>R.Vn,Wo:()=>m.Wo,X7:()=>c.X7,YA:()=>M.YA,YL:()=>x.YL,_b:()=>w._b,_r:()=>w._r,aI:()=>Q.a,ac:()=>c.ac,dm:()=>h.dm,e2:()=>J.e,eg:()=>i.eg,f9:()=>C.f,fR:()=>s.fR,fh:()=>x.fh,jw:()=>N.jw,k:()=>p.k,k3:()=>i.k3,kT:()=>E.kT,kl:()=>i.kl,l6:()=>h.l6,m9:()=>h.m9,mM:()=>S.m,mg:()=>g.mg,nB:()=>B.n,nM:()=>u.nM,n_:()=>r.n_,pn:()=>o.p,pv:()=>c.pv,rS:()=>g.rS,rj:()=>D.rj,sU:()=>F.s,t9:()=>i.t9,tp:()=>M.tp,vD:()=>c.O0,vT:()=>s.vT,x6:()=>p.x6,xF:()=>M.xF,xS:()=>d.x,z4:()=>h.z4});var r=n(6524),i=n(7031),a=n(7537),s=n(902),l=n(2680),o=n(9274),c=n(7241),u=n(34),h=n(209),f=n(8960),d=n(288),A=n(3911),m=n(6077),p=n(5784),w=n(5090),g=n(6876),y=(n(3378),n(6273)),_=n(6617),v=n(3261),b=n(6218),E=n(886),x=n(988),I=n(6497),B=n(3988),S=n(5025),C=n(5936),k=(n(5581),n(7919)),N=n(4718),D=n(3315),O=(n(2668),n(9673)),R=n(614),Q=n(6869),F=n(5503),z=n(1602),P=n(9841),M=n(3607),J=n(4985),q=n(7579),W=(n(2888),n(9723)),U=(n(3128),n(7778)),T=n(9846);n(9300)},8002:(e,t,n)=>{n.d(t,{Pm:()=>w});var r=n(9790),i=n(6562),a=n(5149),s=n(8458),l=n(4558),o=n(5660),c=n(6159),u=n(6164),h=new WeakMap,f=new WeakMap;class d{constructor(e,t){(0,a.A)(this,h,void 0),(0,a.A)(this,f,void 0),(0,l.A)(h,this,e),(0,l.A)(f,this,null)}async file(e){return null==(0,s.A)(f,this)&&(0,l.A)(f,this,await c.loadAsync((0,s.A)(h,this).buffer())),await(0,s.A)(f,this).file(e).async("uint8array")}async metadata(e){for(null==(0,s.A)(f,this)&&(0,l.A)(f,this,await c.loadAsync((0,s.A)(h,this).buffer()));;){e.endsWith(".json")||(e+=".json");let t=await(0,s.A)(f,this).file(e).async("string"),n=JSON.parse(t);if(!n.$schema.startsWith("redirection/"))return n;e=n.redirection.targets[0].location}}clear(){(0,l.A)(f,this,null)}}var A=new WeakMap,m=new WeakMap,p=new WeakSet;class w extends o.nP{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=null;"existingHandle"in n?(i=n.existingHandle,delete n.existingHandle):t instanceof u.V||(t=new u.V(t)),super(e,new d(t,i)),(0,r.A)(this,p),(0,a.A)(this,A,void 0),(0,a.A)(this,m,void 0),(0,l.A)(A,this,t),(0,l.A)(m,this,e)}static format(){return"ArtifactDB-zipped"}abbreviate(){return(0,i.A)(p,this,g).call(this,e=>({size:e.size(),name:e.name()}))}serialize(){return(0,i.A)(p,this,g).call(this,e=>e)}static unserialize(e,t){if(1!=e.length||"zip"!=e[0].type)throw new Error("expected exactly one file of type 'zip' for Zipped ArtifactDB unserialization");let n=t.datasetName;delete t.datasetName;let r=new w(n,e[0].file);return r.setOptions(r),r}}function g(e){let t=[{type:"zip",file:e((0,s.A)(A,this))}],n=this.options();return n.datasetName=(0,s.A)(m,this),{files:t,options:n}}o.ab},8166:(e,t,n)=>{n.d(t,{Az:()=>r.Az,Ec:()=>o.E,Iy:()=>r.Iy,QR:()=>c.Q,b5:()=>u.b,hv:()=>s.h,iC:()=>r.iC,i_:()=>l.i,lU:()=>i.l,oc:()=>r.oc,uN:()=>r.uN,xD:()=>a.x,y$:()=>r.y$,zs:()=>h.z});var r=n(6535),i=(n(4106),n(3726),n(5600)),a=n(4378),s=(n(2152),n(9318)),l=(n(1482),n(2983),n(3705)),o=(n(2777),n(7823)),c=(n(3825),n(7001)),u=n(3668),h=n(1642);n(8996)},8743:(e,t,n)=>{n.d(t,{B8:()=>c,Bm:()=>f,a4:()=>g,eg:()=>m,pz:()=>v});var r=n(9790),i=n(4467),a=n(6562),s=n(1430);class l{constructor(e){this._names=e,this._lookup=new Map}names(){return this._names}nameToIndexUncached(e){return this._lookup.has(e)?this._lookup.get(e):this._names.indexOf(e)}nameToIndex(e){let{error:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._lookup.has(e))return this._lookup.get(e);for(var n=this._lookup.size;n<this._names.length;n++){const t=this._names[n];if(!this._lookup.has(t)&&(this._lookup.set(t,n),this._names[n]==e))return n}if(t)throw new Error("no matching name for '"+e+"' in this "+this.constructor.className);return-1}indexToName(e){return this._names[e]}append(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.z(this,t);return t||(n._names=n._names.slice(),n._lookup=new Map),n._names.push(e),n}set(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=s.z(this,n);return n?r._lookup.size>e&&(r._lookup=new Map):(r._names=r._names.slice(),r._lookup=new Map),r._names[e]=t,r}delete(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.z(this,t);return t?n._lookup.size>e&&(n._lookup=new Map):(n._names=n._names.slice(),n._lookup=new Map),n._names.splice(e,1),n}_bioconductor_CLONE(e){let{deepCopy:t=!0}=e,n=new this.constructor;return n._names=s.k(this._names,t),n._lookup=s.k(this._lookup,t),n}}var o=new WeakSet;class c{constructor(e){let{names:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,r.A)(this,o),0==arguments.length)return this._values=[],void(this._names=null);if(e instanceof Array){if(null!==t){if(t.length!=e.length)throw new Error("'names' and 'values' should have the same length");for(const e of t)if("string"!=typeof e)throw new Error("'names' should be an array of strings");t=new l(t)}this._values=e,this._names=t}else if(e instanceof Map){let n=[];if(null==t){t=[];for(const[r,i]of e){if("string"!=typeof r)throw new Error("keys of 'values' should be strings");t.push(r),n.push(i)}}else{if(t.length!=e.size)throw new Error("size of 'values' should be equal to length of 'names'");for(const r of t){if("string"!=typeof r)throw new Error("'names' should be an array of strings");if(!e.has(r))throw new Error("missing name '"+r+"' in 'values'");n.push(e.get(r))}}this._values=n,this._names=new l(t)}else{let n=[];if(null==t){t=[];for(const[r,i]of Object.entries(e))t.push(r),n.push(i)}else{if(t.length!=Object.keys(e).length)throw new Error("size of 'values' should be equal to length of 'names'");for(const r of t){if("string"!=typeof r)throw new Error("'names' should be an array of strings");if(!(r in e))throw new Error("missing name '"+r+"' in 'values'");n.push(e[r])}}this._values=n,this._names=new l(t)}}names(){return null==this._names?null:this._names.names()}values(){return this._values}length(){return this._values.length}getByIndex(e){return(0,a.A)(o,this,u).call(this,e),this._values[e]}getByName(e){if(null===this._names)throw new Error("no available names in this "+this.constructor.className);let t=this._names.nameToIndex(e);return this._values[t]}get(e){return"number"==typeof e?this.getByIndex(e):this.getByName(e)}has(e){return this.nameToIndex(e)>=0}nameToIndex(e){return this._names.nameToIndex(e,{error:!1})}toArray(){return this._values}toMap(){if(null==this._names)throw new Error("no available names in this '"+this.constructor.className+"'");let e=new Map,t=this._names.names();for(var n=0;n<this._values.length;n++){const r=t[n];e.has(r)||e.set(r,this._values[n])}return e}toObject(){if(null==this._names)throw new Error("no available names in this '"+this.constructor.className+"'");let e={},t=this._names.names();for(var n=0;n<this._values.length;n++){const r=t[n];r in e||(e[r]=this._values[n])}return e}setByIndex(e,t){let{name:n=null,inPlace:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=s.z(this,r);if(r||(i._values=i._values.slice()),e<0||e>this._values.length)throw new Error(" index '"+String(e)+"' out of range for this "+this.constructor.className);if(e==i._values.length)if(i._values.push(t),null==n)null!=i._names&&(i._names=i._names.append("",{inPlace:r}));else{if("string"!=typeof n)throw new Error("'name' should be a string");if(null==i._names){const t=new Array(i._values.length).fill("");t[e]=n,i._names=new l(t)}else i._names=i._names.append(n,{inPlace:r})}else if(i._values[e]=t,null!==n)if(null===i._names){const t=new Array(i._values.length).fill("");t[e]=n,i._names=new l(t)}else i._names=i._names.set(e,n,{inPlace:r});return i}setByName(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=s.z(this,n);if(n||(r._values=r._values.slice()),null!==r._names){let i=r._names.nameToIndex(e,{error:!1});i<0?(r._values.push(t),r._names=r._names.append(e,{inPlace:n})):r._values[i]=t}else{const n=new Array(r._values.length).fill("");n.push(e),r._names=new l(n),r._values.push(t)}return r}set(e,t){let{name:n=null,inPlace:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"number"==typeof e?this.setByIndex(e,t,{name:n,inPlace:r}):this.setByName(e,t,{inPlace:r})}setNames(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.z(this,t);if(null!==e){if(e.length!=this._values.length)throw new Error("'names' and 'values' should have the same length");for(const t of e)if("string"!=typeof t)throw new Error("'names' should be an array of strings")}return n._names=new l(e),n}deleteByIndex(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.z(this,t);return t||(n._values=n._values.slice()),(0,a.A)(o,this,u).call(this,e),n._values.splice(e,1),null!==n._names&&(n._names=n._names.delete(e,{inPlace:t})),n}deleteByName(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s.z(this,t);if(t||(n._values=n._values.slice()),null==n._names)throw new Error("no available names in this "+this.constructor.className);let r=this._names.nameToIndexUncached(e);if(r<0)throw new Error("no matching name for '"+e+"' in this "+this.constructor.className);return n._values.splice(r,1),null!==n._names&&(n._names=n._names.delete(r,{inPlace:t})),n}delete(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"number"==typeof e?this.deleteByIndex(e,{inPlace:t}):this.deleteByName(e,{inPlace:t})}sliceRange(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=s.z(this,n);return r._values=r._values.slice(e,t),null!==this._names&&(r._names=new l(r._names.names().slice(e,t))),r}sliceIndices(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],r=[];for(let s of e){if("string"==typeof s){if(null==this._names)throw new Error("no available names in this "+this.constructor.className);s=this._names.nameToIndex(s)}else(0,a.A)(o,this,u).call(this,s);r.push(this._values[s]),null!==this._names&&n.push(this._names.indexToName(s))}let i=s.z(this,t);return i._values=r,null!==this._names&&(i._names=new l(n)),i._lookup=new Map,i}[Symbol.iterator](){let e=0,t=this._values;return{next:function(){if(e<t.length){let n=t[e];return e++,{done:!1,value:n}}return{done:!0}},[Symbol.iterator](){return this}}}_bioconductor_LENGTH(){return this.length()}_bioconductor_SLICE(e,t){let{allowView:n=!1}=t,r=this.sliceIndices(e),i=new this.constructor;return i._values=r._values,i._names=r._names,i}_bioconductor_CLONE(e){let{deepCopy:t=!0}=e,n=new this.constructor;return n._values=s.k(this._values,t),n._names=s.k(this._names,t),n}_bioconductor_COMBINE(e){let t=this._values.slice(),n=null;null!==this._names&&(n=this.names().slice());for(let i of e){i instanceof c||(i=new c(i));const e=i.values();for(const n of e)t.push(n);const r=i.names();if(null===r){if(null!==n)for(const t of e)n.push("")}else{null===n&&(n=new Array(t.length-e.length).fill(""));for(const e of r)n.push(e)}}let r=new this.constructor;return r._values=t,r._names=new l(n),r}}function u(e){if(e<0||e>=this._values.length)throw new Error(" index '"+String(e)+"' out of range for this "+this.constructor.className)}(0,i.A)(c,"className","List");var h=new WeakSet;class f extends c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,r.A)(this,h);else{super(e,t),(0,r.A)(this,h);for(const e of this._values)(0,a.A)(h,this,d).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,a.A)(h,this,d).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,a.A)(h,this,d).call(this,t),n)}}function d(e){if(null!==e&&!Number.isInteger(e))throw new Error("only integers or nulls can be stored in an IntegerList");return e}var A=new WeakSet;class m extends c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,r.A)(this,A);else{super(e,t),(0,r.A)(this,A);for(const e of this._values)(0,a.A)(A,this,p).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,a.A)(A,this,p).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,a.A)(A,this,p).call(this,t),n)}}function p(e){if(null!==e&&"number"!==typeof e)throw new Error("only numbers or nulls can be stored in a NumberList");return e}var w=new WeakSet;class g extends c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,r.A)(this,w);else{super(e,t),(0,r.A)(this,w);for(const e of this._values)(0,a.A)(w,this,y).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,a.A)(w,this,y).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,a.A)(w,this,y).call(this,t),n)}}function y(e){if(null!==e&&"string"!==typeof e)throw new Error("only strings or nulls can be stored in a StringList");return e}var _=new WeakSet;class v extends c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,r.A)(this,_);else{super(e,t),(0,r.A)(this,_);for(const e of this._values)(0,a.A)(_,this,b).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,a.A)(_,this,b).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,a.A)(_,this,b).call(this,t),n)}}function b(e){if(null!==e&&"boolean"!==typeof e)throw new Error("only booleans or nulls can be stored in a StringList");return e}},8829:(e,t,n)=>{n.d(t,{P4:()=>m,Ug:()=>F});var r=n(9790),i=n(6562),a=n(4467),s=n(5149),l=n(8458),o=n(4558),c=n(9379),u=n(7990),h=n(3619),f=n(1276),d=n(141),A=n(2697);n(6292);const m="cell_labelling";var p=f.WR;function w(e){let t=p;return p=e,t}async function g(e,t){let n=e+"_"+t,r=await p("https://github.com/kanaverse/singlepp-references/releases/download/2023-04-28/"+n);return new d.VM(r,{name:n})}const y={};function _(e){if("prepared"in e){for(const t of Object.values(e.prepared))t.built.raw.free();delete e.prepared}}async function v(e){let t=await d.we(e.content(),{compression:"gz"}),n=[];for(const r of t){let e=null;""!==r&&(e=r.split("\t"),1==e.length&&(e=e[0])),n.push(e)}return n}async function b(e,t){let n="genes_"+t.toLowerCase()+".csv.gz";if(e in y){let r=y[e],i=r.genes;return t in i||(i[t]=await v(await g(e,n))),r}const r=["labels_fine.csv.gz","label_names_fine.csv.gz","markers_fine.gmt.gz","matrix.csv.gz",n];let i,a,s=await Promise.all(r.map(t=>g(e,t)));try{i=u.YA(s[3].buffer(),s[2].buffer(),s[0].buffer()),a={raw:i,labels:await d.we(s[1].content(),{compression:"gz"}),genes:{}},a.genes[t]=await v(s[4]),y[e]=a}catch(l){throw f.xr(i),l}return a}function E(){for(const[e,t]of Object.entries(y))t.raw.free(),delete y[e]}const x={9606:["BlueprintEncode","DatabaseImmuneCellExpression","HumanPrimaryCellAtlas","MonacoImmune","NovershternHematopoietic"],10090:["ImmGen","MouseRNAseq"]};function I(e,t,n){let r,i;try{let a=y[e],s=a.raw;if(!(n in a.genes))throw new Error("unknown gene type '"+n+"'");let l=a.genes[n];r=u.xF(t,s,l),i={loaded:a,built:{features:l,raw:r}}}catch(a){throw f.xr(r),a}return i}async function B(e,t,n,r,i,a,s,l,o){if(n!==s.guess_ids||f.PG(t,s.references)||!n&&(r!==s.species||i!==s.gene_id_column||a!==s.gene_id_type)){let s=r,c=i,h=a;if(n){let e=F.configureFeatureParameters(o());s=e.species,c=e.gene_id_column,h=e.gene_id_type}let d=new Set;for(const e of s)e in x&&x[e].forEach(e=>{d.add(e)});let A=l(),m=null==c?A.rowNames():A.column(c);e.gene_ids=m;let p={};if(null!==m){null==t&&(t=Array.from(d));for(const e of t)d.has(e)&&(await b(e,h),p[e]=I(e,m,h))}_(e),e.prepared=p;let w=Object.keys(p);if(w.length>1){let t=Object.values(p),n=t.map(e=>e.loaded.raw),r=t.map(e=>e.built.features),i=t.map(e=>e.built.raw);f.xr(e.integrated),e.integrated=u.V0(m,n,r,i)}else f.xr(e.integrated),delete e.integrated;return e.used_refs=w,!0}return!1}function S(e){return e.references=h.UC(e.references),e.species=h.UC(e.species),e}function C(e){let t=(0,c.A)({},e);return t.references=h.UC(t.references),t.species=h.UC(t.species),t}function k(e,t,n){let r=t.numberOfCells(),i=e.length,a=new Array(r);for(var s=0;s<r;s++){let r={},o=t.scoreForCell(s);for(var l=0;l<i;l++)r[e[l]]=o[l];a[s]={best:e[n[s]],all:r}}return a}function N(e,t){let n,r=e;if(e instanceof u.Cx){let a=e.numberOfGroups();if(null===t.gene_ids)r=null;else{let s=t.gene_ids.length;n=u.k3(a*s);for(var i=0;i<a;i++){let t=e.mean(i,{copy:!1});if(t.length!==s)throw new Error("unexpected number of genes in marker results");n.array().set(t,i*s)}r=u.VZ(s,a,n,{columnMajor:!0})}}else if(null!==t.gene_ids&&e.numberOfRows()!==t.gene_ids.length)throw new Error("unexpected number of genes in the input matrix");let a=t.prepared,s={per_reference:{}},l={};for(const[o,c]of Object.entries(a)){let e=u.Cd(r,c.built.raw);l[o]=e,s.per_reference[o]=k(c.loaded.labels,e,e.predicted({copy:!1}))}if("integrated"in t){let e=[];for(const r of t.used_refs)e.push(l[r]);let n=u.tp(r,e,t.integrated);s.integrated=k(t.used_refs,n,n.predicted({copy:!1})),n.free()}for(const o of Object.values(l))o.free();return f.xr(undefined),f.xr(n),s}function D(e,t,n){if(null===t)return N(e,n);let r,i=[];try{let a=f.wW([t]);i.push(a.arrays[0].ids);let s=e;if(null!==a.retain){let t=u._r(e,a.retain);i.push(t),s=t}let l=u.Qu(s,a.arrays[0].ids,{average:!0});i.push(l);let o=l.allSums({asTypedArray:!1});i.push(o);let c=u.VZ(s.numberOfRows(),l.numberOfGroups(),o,{columnMajor:!0});i.push(c),r=N(c,n),r.groups=a.arrays[0].levels}finally{i.forEach(f.xr)}return r}var O=new WeakMap,R=new WeakMap,Q=new WeakMap;class F{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.A)(this,O,void 0),(0,s.A)(this,R,void 0),(0,s.A)(this,Q,void 0),!(e instanceof A.Xj))throw new Error("'inputs' should be a State object from './inputs.js'");(0,o.A)(O,this,e),(0,o.A)(R,this,null===t?{}:t),(0,o.A)(Q,this,null===n?{}:n),this.changed=!1}free(){_((0,l.A)(Q,this))}valid(){return(0,l.A)(O,this).fetchCountMatrix().has("RNA")}fetchParameters(){let e=(0,c.A)({},(0,l.A)(R,this));return e.references=h.UC(e.references),e.species=h.UC(e.species),e}fetchNumberOfSharedFeatures(){let e={};for(const t of(0,l.A)(Q,this).used_refs)e[t]=(0,l.A)(Q,this).prepared[t].built.raw.numberOfFeatures();return e}static defaults(){return{references:null,guess_ids:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL"}}static configureFeatureParameters(e){let t=null,n={type:"symbol",species:"9606",confidence:0};if("row_names"in e){let t=e.row_names;t.confidence>n.confidence&&(n=t)}for(const[r,i]of Object.entries(e.columns))i.confidence>n.confidence&&(n=i,t=r);return{gene_id_column:t,species:[n.species],gene_id_type:n.type.toUpperCase()}}fetchParameters(){return C((0,l.A)(R,this))}static flush(){E()}static setDownload(e){return w(e)}async compute(e){"references"in(e=f.wn(e,F.defaults()))||(e.guess_ids=!0),this.changed=!1,this.valid()&&(this.changed=await B((0,l.A)(Q,this),e.references,e.guess_ids,e.species,e.gene_id_column,e.gene_id_type,(0,l.A)(R,this),()=>(0,l.A)(O,this).fetchFeatureAnnotations().RNA,()=>(0,l.A)(O,this).guessRnaFeatureTypes())),(0,o.A)(R,this,S(e))}computeLabels(e){let{group:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return D(e,t,(0,l.A)(Q,this))}}(0,a.A)(F,"availableReferences",x);var z=new WeakMap,P=new WeakMap,M=new WeakMap,J=new WeakMap,q=new WeakMap,W=new WeakSet;class U{constructor(e){(0,r.A)(this,W),(0,s.A)(this,z,void 0),(0,s.A)(this,P,void 0),(0,s.A)(this,M,void 0),(0,s.A)(this,J,void 0),(0,s.A)(this,q,void 0),(0,o.A)(z,this,{}),(0,o.A)(q,this,U.defaults()),(0,o.A)(M,this,e),(0,o.A)(P,this,{}),(0,o.A)(J,this,null)}free(){_((0,l.A)(P,this))}static defaults(){return{references:null,guess_ids:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL"}}fetchParameters(){return C((0,l.A)(q,this))}static flush(){E()}static setDownload(e){return w(e)}setParameters(e){e=f.wn(e,U.defaults()),(0,o.A)(q,this,S(e))}async ready(){await B((0,l.A)(P,this),(0,l.A)(q,this).references,(0,l.A)(q,this).guess_ids,(0,l.A)(q,this).species,(0,l.A)(q,this).gene_id_column,(0,l.A)(q,this).gene_id_type,(0,l.A)(z,this),()=>(0,l.A)(M,this),()=>(0,i.A)(W,this,T).call(this)),(0,o.A)(z,this,(0,l.A)(q,this))}computeLabels(e){let{group:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return D(e,t,(0,l.A)(P,this))}}function T(){return null==(0,l.A)(J,this)&&(0,o.A)(J,this,f.RA((0,l.A)(M,this))),(0,l.A)(J,this)}(0,a.A)(U,"availableReferences",x)},8960:(e,t,n)=>{n.d(t,{T:()=>o});var r=n(45),i=n(209),a=n(6524),s=n(7031);const l=["format","forceInteger","saveShape","overwrite"];function o(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{format:c="tenx_matrix",forceInteger:u=!1,saveShape:h=!0,overwrite:f=!0}=o,d=(0,r.A)(o,l);s.PI(d);let A=!0;if("tenx_matrix"==c);else if("csc_matrix"==c)A=!1;else if("csr_matrix"!=c)throw new Error("unknown format '"+c+"'");if(a.T1(r=>r.write_sparse_matrix_to_hdf5(e.matrix,t,n,A,u,f)),h){let r=new i.dm(t,n),a=[e.numberOfRows(),e.numberOfColumns()];if("tenx_matrix"==c)r.writeDataSet("shape","Int32",null,a);else if("csr_matrix"==c)r.writeAttribute("encoding-type","String",null,"csr_matrix"),r.writeAttribute("shape","Int32",null,a.reverse());else{if("csc_matrix"!=c)throw new Error("unknown format '"+c+"'");r.writeAttribute("encoding-type","String",null,"csc_matrix"),r.writeAttribute("shape","Int32",null,a.reverse())}}}},9215:(e,t,n)=>{n.d(t,{m:()=>i,r:()=>a});var r=n(507);async function i(e,t,n,i){if(!await t.exists(e+"/OBJECT"))return{};if(i in n){let a=n[i];if(!1===a)return{};if(!0!==a){return a(e,await(0,r._i)(e,t),t,n)}}return(0,r.Ag)(e,null,t,n)}async function a(e,t,n,i){0!==e.length()&&await(0,r.ll)(e,t,n,i)}},9300:(e,t,n)=>{n(7031),n(6524)},9526:(e,t,n)=>{n.d(t,{e:()=>r});const r="3.1.3"},9692:(e,t,n)=>{n.d(t,{Cr:()=>l,DI:()=>m,RS:()=>A,UE:()=>d,cf:()=>s,h_:()=>o,n$:()=>p});var r=n(7990),i=(n(1276),n(1559)),a=(e,t,n)=>null;function s(e){let t=a;return a=e,t}var l={numberOfThreads:1};function o(e,t){var n=e.fetchIndex(),i={num_obs:n.numberOfCells()},a=null,s=null,l=null,o=null;try{a=r.jw(n,t),s=r.kl(a.numberOfCells()),l=r.kl(a.size()),o=r.k3(a.size()),a.serialize({runs:s,indices:l,distances:o}),i.size=a.size(),i.runs=s.array().slice(),i.indices=l.array().slice(),i.distances=o.array().slice()}finally{null!==a&&a.free(),null!==s&&s.free(),null!==l&&l.free(),null!==o&&o.free()}return i}const c=[],u=[];function h(e){return e.type}function f(e,t){"error"==h(t)?e.reject(t.error):e.resolve(t.data)}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=c[e],a=u[e];var s=a.counter,l=new Promise((e,t)=>{let n={resolve:e,reject:t};s in a.promises?(f(n,a.promises[s]),delete a.promises[s]):a.promises[s]=n});return a.counter++,t.id=s,i._z(r,t,n),l}function A(e,t){let n=c.length;c.push(e);let r={counter:0,promises:{}};return u.push(r),i.rq(e,e=>{var t=h(e.data);if(t.endsWith("_iter"))a(t.slice(0,-5),e.data.x,e.data.y,e.data.iteration);else{var n=e.data.id;n in r.promises?(f(r.promises[n],e.data),delete r.promises[n]):r.promises[n]=e.data}}),{worker_id:n,ready:d(n,{cmd:"INIT",scranOptions:t})}}async function m(e){await d(e,{cmd:"KILL"});let t=c[e];return c[e]=null,i.Qw(t)}function p(e,t,n){var r={cmd:"RUN",params:t},i=[];return null!==n&&(i=[n.runs.buffer,n.indices.buffer,n.distances.buffer],r.neighbors=n),d(e,r,i)}},9830:(e,t,n)=>{n.d(t,{A1:()=>ee,fc:()=>Z,jD:()=>te,v9:()=>r.v9});n(7990);var r=n(2697),i=n(1653),a=n(5817),s=n(4935),l=n(4201),o=n(6292),c=n(3819),u=n(8833),h=n(5305),f=n(8042),d=n(9894),A=n(1520),m=n(4468),p=n(6629),w=n(5869),g=n(6302),y=n(1040),_=n(945),v=n(928),b=n(3571),E=n(7465),x=n(8829),I=n(2925),B=n(6747);const S=r.P4,C=i.P,k=a.P,N=s.P,D=l.P,O=o.P,R=c.P,Q=u.P,F=h.P,z=f.P,P=d.P,M=A.P,J=m.P,q=p.P,W=w.P,U=v.P,T=b.P,V=y.P,j=_.P,G=g.P,L=E.P4,H=x.P4,X=I.P4,K=B.P4,Y="_loaded";async function Z(){return $(new r.Xj)}function $(e){let t={};t[S]=e,t[C]=new i.Z(t[S]),t[k]=new a.D(t[S]),t[N]=new s.d(t[S]);let n={RNA:t[C],ADT:t[k],CRISPR:t[N]};t[D]=new l._(t[S],n),t[O]=new o.A(t[C],t[D]),t[R]=new c.K(t[k],t[D]),t[Q]=new u.S(t[N],t[D]),t[F]=new h.G(t[D],t[O]),t[z]=new f.N(t[D],t[O],t[F]),t[P]=new d.d(t[D],t[R]),t[M]=new A.v(t[D],t[Q]);let r={RNA:t[z],ADT:t[P],CRISPR:t[M]};t[J]=new m.T(r),t[q]=new p.a(t[D],t[J]),t[W]=new w.Y(t[q]),t[U]=new v.s(t[W]),t[T]=new b.B(t[W]),t[V]=new y.d(t[q]),t[j]=new _.$(t[W]),t[G]=new g.j(t[j],t[V]);let Y={RNA:t[O],ADT:t[R],CRISPR:t[Q]};return t[L]=new E.Rr(t[D],Y,t[G]),t[H]=new x.Ug(t[S]),t[K]=new B.VX(t[S],t[D],t[O]),t[X]=new I.el(t[D],Y),Promise.all([t[U].ready(),t[T].ready()]).then(e=>t)}async function ee(e,t,n){let{startFun:r=null,finishFun:i=null}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=async e=>{null!==r&&await r(e)},s=async e=>{null!==i&&await i(e)},l=[],o=(t,n)=>{null!==i&&(n=e[t].changed?n.then(n=>i(t,e[t])):n.then(e=>i(t))),l.push(n)};await a(S),await e[S].compute(t,n[S]),await s(S),Y in e&&(e[S].changed=!0,delete e[Y]);let c=[C,k,N,D,O,R,Q,F,z,P,M,J,q,W];for(const f of c)await a(f),await e[f].compute(n[f]),await s(f);for(const f of[U,T]){await a(f),o(f,e[f].compute(n[f]))}let u=n[G].method;await a(V),e[V].compute("kmeans"==u,n[V]),await s(V),await a(j),e[j].compute("snn_graph"==u,n[j]),await s(j),await a(G),e[G].compute(n[G]),await s(G);let h=[L,H,X,K];for(const f of h)await a(f),await e[f].compute(n[f]),await s(f);return await Promise.all(l),null}function te(e){let t={};for(const[n,r]of Object.entries(e))n!=Y&&(t[n]=r.fetchParameters());return t}}}]);
//# sourceMappingURL=978.92a21f88.chunk.js.map