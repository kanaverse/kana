"use strict";(self.webpackChunkkana=self.webpackChunkkana||[]).push([[522],{141:(e,t,n)=>{n.d(t,{J9:()=>h.J9,U4:()=>i.U,VM:()=>c.V,Z8:()=>o.Z,hp:()=>u.hp,m0:()=>l.m0,o5:()=>a.o,s5:()=>o.s,uw:()=>d,we:()=>u.we});var s=n(8142),i=n(7967),r=n(2814),a=n(7265),l=(n(5660),n(8002)),o=n(2779),h=n(7633),u=n(6774),c=n(6164);const d={"10X":s.F,MatrixMarket:r.f,H5AD:i.F,SummarizedExperiment:a.d,"ArtifactDB-zipped":l.Pm}},507:(e,t,n)=>{n.d(t,{Ag:()=>c,_i:()=>h});n(3619);var s=n(4418),i=n(6873),r=n(5406),a=n(4717),l=n(7961),o=n(5361);async function h(e,t){let n=await t.get((0,o.uJ)(e,"OBJECT"),{asBuffer:!0});try{let e=new TextDecoder;return JSON.parse(e.decode(n))}finally{await t.clean(n)}}const u={};async function c(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null==t&&(t=await h(e,n));let c=t.type;if(c in u)return u[c](e,t,n,o);{const h={simple_list:s.L,data_frame:i.K,summarized_experiment:r.B,ranged_summarized_experiment:a.I,single_cell_experiment:l.u};if(c in h)return h[c](e,t,n,o);throw new Error("type '"+c+"' is not supported")}}},713:(e,t,n)=>{n(2697),n(1653),n(5817),n(4935),n(4201),n(6292),n(3819),n(8833),n(5305);var s=n(8042),i=n(9894),r=n(1520),a=n(4468),l=n(6629),o=n(5869);n(945),n(928),n(3571),n(1040),n(6302),n(7465),n(2925),n(6747),n(8829);s.P,i.P,r.P;l.P,a.P,o.P},1522:(e,t,n)=>{n.d(t,{J9:()=>i.J9,Jk:()=>h.Jk,U4:()=>i.U4,Ug:()=>l.Ug,VM:()=>i.VM,Z8:()=>i.Z8,Zx:()=>a.Z,fc:()=>s.fc,g0:()=>u.g0,hp:()=>i.hp,m0:()=>i.m0,n_:()=>d,o5:()=>i.o5,qJ:()=>l.qJ,s5:()=>i.s5,uw:()=>i.uw,z7:()=>o.z7});n(713);var s=n(9830),i=(n(7212),n(141)),r=(n(7709),n(9692)),a=(n(3983),n(1653)),l=n(8829),o=n(6747),h=n(7465),u=n(2925),c=n(7990);function d(){let{numberOfThreads:e=1,localFile:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=c.n_({numberOfThreads:e,localFile:t});return r.Cr.localFile=t,n.then(e=>null)}},1576:(e,t,n)=>{n.d(t,{Ag:()=>s.Ag,YG:()=>i.Y,_i:()=>s._i,dm:()=>r.d,m9:()=>r.m,uJ:()=>a.uJ});n(6873),n(4717),n(7961);var s=n(507),i=n(852),r=n(545),a=n(5361)},1989:(e,t,n)=>{n(5149),n(8458),n(4558),n(7990);var s=n(1576);n(2416);s.dm;s.m9;s.YG},2416:(e,t,n)=>{function s(e,t,n){throw new Error("read() is not supported in a web context")}function i(e,t,n){throw new Error("write() is not supported in a web context")}function r(e,t){throw new Error("mkdir() is not supported in a web context")}function a(e,t,n){throw new Error("copy() is not supported in a web context")}n.d(t,{C:()=>a,Ck:()=>r,LF:()=>s,M9:()=>i})},2697:(e,t,n)=>{n.d(t,{P4:()=>d,Xj:()=>v});var s=n(9379),i=n(9790),r=n(5149),a=n(6562),l=n(8458),o=n(4558),h=n(7990),u=n(3619),c=n(1276);n(141);const d="inputs",f="raw_subset_indices";var m=new WeakMap,A=new WeakMap,p=new WeakMap,w=new WeakMap,_=new WeakSet;class v{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,i.A)(this,_),(0,r.A)(this,m,void 0),(0,r.A)(this,A,void 0),(0,r.A)(this,p,void 0),(0,r.A)(this,w,void 0),(0,o.A)(m,this,null===e?{}:e),(0,o.A)(A,this,null===t?{}:t),(0,o.A)(p,this,null===n?{}:n),(0,o.A)(w,this,!1),this.changed=!1}free(){c.xr((0,l.A)(A,this).matrix),c.xr((0,l.A)(A,this).raw_matrix),c.xr((0,l.A)(A,this).block_ids),c.xr((0,l.A)(A,this).raw_block_ids),c.xr((0,l.A)(A,this).multi_block_ids)}fetchCountMatrix(){return(0,l.A)(A,this).matrix}fetchFeatureAnnotations(){return(0,l.A)(A,this).genes}fetchCellAnnotations(){return(0,l.A)(A,this).annotations}fetchBlock(){return(0,l.A)(A,this).block_ids}fetchBlockLevels(){return(0,l.A)(A,this).block_levels}fetchParameters(){var e;let t=(0,s.A)({},(0,l.A)(m,this));return t.subset=(0,a.A)(v,e=this.constructor,y).call(e,t.subset),t}fetchDatasets(){return(0,l.A)(A,this).datasets}fetchDirectSubset(){let{copy:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(f in(0,l.A)(A,this)){let t=(0,l.A)(A,this)[f];return e?t.slice():t}return null}guessRnaFeatureTypes(){return"RNA"in(0,l.A)(A,this).genes?("inferred_rna_types"in(0,l.A)(A,this)||((0,l.A)(A,this).inferred_rna_types=c.RA((0,l.A)(A,this).genes.RNA)),(0,l.A)(A,this).inferred_rna_types):null}static defaults(){return{block_factor:null,subset:null}}enableDatasetCache(e){(0,o.A)(w,this,e)}async compute(e,t){if(t=c.wn(t,v.defaults()),this.changed=!1,null!==e){let t={};for(const[n,s]of Object.entries(e))t[n]={format:s.constructor.format(),details:s.abbreviate()};c.PG(t,(0,l.A)(p,this))&&(await async function(e,t,n){c.xr(t.raw_matrix),c.xr(t.matrix),c.xr(t.multi_block_ids);let s=await async function(e,t){let n=Object.keys(e);n.sort();let s,i=[];try{for(const s of n)i.push(await e[s].load({cache:t}))}catch(r){for(const e of i)h.t9(e.matrix);throw r}if(1==n.length)try{s=function(e){if(0==e.matrix.available().length)throw new Error("no available modalities");let t={matrix:new h.P_,features:{}};try{for(const n of b)e.matrix.has(n)&&(t.matrix.add(n,e.matrix.get(n)),t.features[n]=e.features[n])}catch(r){throw h.t9(t.matrix),r}return t.cells=e.cells,t.block_ids=null,t.block_levels=null,t}(i[0])}catch(r){throw h.t9(i[0].matrix),r}else try{s=function(e,t){let n,s=[];for(const r of b){let e=!0;for(const n of t)if(!n.matrix.has(r)){e=!1;break}e&&s.push(r)}if(0==s.length)throw new Error("failed to find common modalities across all datasets");let i={matrix:new h.P_,features:{}};try{for(const e of s){let n=x(e,t);i.matrix.add(e,n.matrix),i.features[e]=n.features}let r=t.map(e=>e.cells);i.cells=u.I4(r);let a=new Array(t.length);t.forEach((e,t)=>{a[t]=e.matrix.numberOfColumns()}),n=h.D_(a),i.block_ids=n,i.block_levels=e;let l=new Array(n.length);n.forEach((t,n)=>{l[n]=e[t]}),i.cells.$setColumn("__batch__",l)}catch(r){throw c.xr(n),c.xr(i.matrix),r}return i}(n,i)}finally{for(const e of i)h.t9(e.matrix)}return s}(e,n);t.raw_matrix=s.matrix,t.raw_annotations=s.cells,t.multi_block_ids=s.block_ids,t.multi_block_levels=s.block_levels,t.genes=s.features}(e,(0,l.A)(A,this),(0,l.A)(w,this)),(0,o.A)(p,this,t),(0,l.A)(A,this).datasets=(0,s.A)({},e),delete(0,l.A)(A,this).inferred_rna_types,this.changed=!0)}(this.changed||(0,l.A)(m,this).block_factor!==t.block_factor)&&(!function(e,t){c.xr(t.raw_block_ids);let n=null,s=null;if(null!==e)try{let i=t.raw_annotations.column(e);if(i.length!=t.raw_matrix.numberOfColumns())throw new Error("length of blocking factor '"+e+"' should be equal to the number of cells");let r=h.K$(i,{action:"none",placeholder:E});n=r.ids,s=r.levels}catch(i){throw c.xr(n),i}else n=null!==t.multi_block_ids?t.multi_block_ids.view():null,s=t.multi_block_levels;t.raw_block_ids=n,t.raw_block_levels=s}(t.block_factor,(0,l.A)(A,this)),this.changed=!0),(this.changed||!(f in(0,l.A)(A,this))&&c.PG(t.subset,(0,l.A)(m,this).subset)||!("matrix"in(0,l.A)(A,this)))&&(N(t.subset,(0,l.A)(A,this)),this.changed=!0),(0,o.A)(m,this,t),(0,l.A)(m,this).subset=y.call(v,(0,l.A)(m,this).subset)}undoSubset(e){if("matrix"in(0,l.A)(A,this)){let t=this.fetchCountMatrix().numberOfColumns();for(const n of e)if(n<0||n>=t)throw new Error("entries of 'indices' should be less than the number of cells in the dataset")}let t=null;"subset"in(0,l.A)(m,this)&&(t=(0,l.A)(m,this).subset);let n=k(t,(0,l.A)(A,this));null!==n&&e.forEach((t,s)=>{e[s]=n[t]})}setDirectSubset(e){let{copy:t=!0,onOriginal:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!==e?(0,l.A)(A,this)[f]=(0,a.A)(_,this,g).call(this,e,t,n):delete(0,l.A)(A,this)[f],h.t9((0,l.A)(A,this).matrix),delete(0,l.A)(A,this).matrix}createDirectSubset(e){let{copy:t=!0,onOriginal:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={};s[f]=(0,a.A)(_,this,g).call(this,e,t,n),s.raw_matrix=(0,l.A)(A,this).raw_matrix.clone();for(const r of["multi_block_ids","raw_block_ids"])r in(0,l.A)(A,this)&&(null===(0,l.A)(A,this)[r]?s[r]=null:s[r]=(0,l.A)(A,this)[r].clone());for(const r of["raw_annotations","genes","multi_block_levels","raw_block_levels"])r in(0,l.A)(A,this)&&(s[r]=(0,l.A)(A,this)[r]);N(null,s);let i=this.fetchParameters();return i.subset=null,new v(i,s,(0,l.A)(p,this))}}function y(e){if(null==e)return e;let t=(0,s.A)({},e);return"values"in t&&(t.values=t.values.slice()),"ranges"in t&&(t.ranges=t.ranges.map(e=>e.slice())),t}function g(e,t,n){return c.O_(e,null),t&&(e=e.slice()),n||this.undoSubset(e),e}const b=["RNA","ADT","CRISPR"];function x(e,t){let n={};try{let i=[],r=[];for(var s=0;s<t.length;s++){r.push(t[s].matrix.get(e));let n=t[s].primary_ids[e];if(null==n)throw new Error("modality '"+e+"' lacks a primary identifier for dataset "+String(s));i.push(n)}let a=h.RZ(r,i);n.matrix=a.matrix,n.features=u.$9(t[0].features[e],a.indices)}catch(i){throw c.xr(n.matrix),i}return n}const E=-1;function k(e,t){let n;if(f in t)n=t[f];else if(null==e)n=null;else{if(!t.raw_annotations.hasColumn(e.field))throw new Error("failed to find '"+e.field+"' in the column annotations");let s=t.raw_annotations.column(e.field);if(n=[],"values"in e){let t=new Set(e.values);s.forEach((e,s)=>{t.has(e)&&n.push(s)})}else s.forEach((t,s)=>{for(const i of e.ranges)if(t>=i[0]&&t<=i[1])return void n.push(s)})}if("raw_block_ids"in t&&null!==t.raw_block_ids){let e=t.raw_block_ids.array(),i=[];if(null!==n)for(const t of n)e[t]!==E&&i.push(t);else for(var s=0;s<e.length;s++)e[s]!==E&&i.push(s);n=i}return n}function N(e,t){c.xr(t.matrix),c.xr(t.block_ids);let n,s,i,r,a=k(e,t);try{if(null===a)n=t.raw_annotations,s=t.raw_matrix.clone(),null!==t.raw_block_ids?(i=t.raw_block_ids.view(),r=t.raw_block_levels):(i=null,r=null);else{if(n=u.$9(t.raw_annotations,a),null!==t.raw_block_ids){let e=h.Wo({ids:t.raw_block_ids,levels:t.raw_block_levels},a);i=e.ids,r=e.levels}else i=null,r=null;s=new h.P_;for(const e of t.raw_matrix.available()){let n=t.raw_matrix.get(e);s.add(e,h._r(n,a))}}}catch(l){throw c.xr(s),c.xr(i),l}t.annotations=n,t.block_levels=r,t.block_ids=i,t.matrix=s}},2779:(e,t,n)=>{n.d(t,{Z:()=>U,s:()=>W});var s=n(9379),i=n(9790),r=n(6562),a=n(5149),l=n(8458),o=n(4558),h=n(7990),u=n(3619),c=(n(6774),n(4736)),d=(n(6164),n(1576)),f=new WeakMap,m=new WeakMap;class A extends d.dm{constructor(e,t){super(),(0,a.A)(this,f,void 0),(0,a.A)(this,m,void 0),(0,o.A)(f,this,e),(0,o.A)(m,this,t)}attributes(){return(0,l.A)(f,this).attributes}readAttribute(e){let t=(0,l.A)(f,this).readAttribute(e);return{values:t.values,shape:t.shape}}children(){return Array.from(Object.keys((0,l.A)(f,this).children))}open(e){let t=(0,l.A)(f,this).open(e);return t instanceof h.dm?new A(t):new w(t)}close(){}_flush(){(0,l.A)(m,this).call(this)}}var p=new WeakMap;class w extends d.m9{constructor(e){super(),(0,a.A)(this,p,void 0),(0,o.A)(p,this,e)}attributes(){return(0,l.A)(p,this).attributes}readAttribute(e){let t=(0,l.A)(p,this).readAttribute(e);return{values:t.values,shape:t.shape}}type(){let e=(0,l.A)(p,this).type;return e instanceof h.BB?"String":e instanceof h.z4?e.members:e}shape(){return(0,l.A)(p,this).shape}values(){return(0,l.A)(p,this).values}close(){}}var _=new WeakMap;class v extends d.YG{constructor(e){super(),(0,a.A)(this,_,void 0),(0,o.A)(_,this,e)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{asBuffer:n=!1}=t;return(0,l.A)(_,this).get(e,n)}exists(e){return(0,l.A)(_,this).exists(e)}clean(e){(0,l.A)(_,this).clean(e)}async h5open(e){let t=h.He(await this.get(e));try{return new A(new h.CE(t.path),t.flush)}catch(n){throw t.flush(),n}}h5close(e){e._flush()}}var y=new WeakMap,g=new WeakMap,b=new WeakMap;class x{constructor(e,t,n){(0,a.A)(this,y,void 0),(0,a.A)(this,g,void 0),(0,a.A)(this,b,void 0),(0,o.A)(y,this,e),(0,o.A)(g,this,t),(0,o.A)(b,this,n)}_bioconductor_NUMBER_OF_ROWS(){return(0,l.A)(y,this)}_bioconductor_NUMBER_OF_COLUMNS(){return(0,l.A)(g,this)}async realize(e,t,n){let s=await d._i((0,l.A)(b,this),e);if("delayed_array"!=s.type)return E((0,l.A)(b,this),s,e,t,n);{let s=await e.get(d.uJ((0,l.A)(b,this),"array.h5"));try{let i=h.He(s);try{let s=new h.CE(i.path),r=await k(s.open("delayed_array"),(0,l.A)(b,this),e,t,n);if(null==r)throw new Error("currently only supporting bakana-generated log-counts for delayed arrays");return r}finally{i.flush()}}finally{await e.clean(s)}}}}async function E(e,t,n,s,i){if("compressed_sparse_matrix"==t.type){let t=await n.get(d.uJ(e,"matrix.h5"));try{let e=h.He(t);try{let t=new h.CE(e.path);const n="compressed_sparse_matrix";let i=t.open(n);const r=i.open("shape").values,a=i.readAttribute("layout").values[0];return h.KR(e.path,n,r[0],r[1],"CSR"==a,{forceInteger:s})}finally{e.flush()}}finally{await n.clean(t)}}else{if("dense_array"!=t.type)throw new Error("unknown matrix type '"+t.type+"'");{let t=await n.get(d.uJ(e,"array.h5"));try{let e=h.He(t);try{let t=new h.CE(e.path);const n="dense_array";let r=t.open(n),a=!1;if(r.attributes.indexOf("transposed")>=0){a=0!=r.readAttribute("transposed").values[0]}return h.fR(e.path,n+"/data",{transposed:a,forceInteger:s,forceSparse:i})}finally{e.flush()}}finally{await n.clean(t)}}}}async function k(e,t,n,s,i){const r=e.readAttribute("delayed_type").values[0];if("operation"===r){let r=e.readAttribute("delayed_operation").values[0];if("unary arithmetic"===r){const r=await k(e.open("seed"),t,n,s,i),a=e.open("value");let l=a.values,o="row";return 0==a.shape.length?l=l[0]:o=0===e.open("along").values[0]?"row":"column",h.$$(r,e.open("method").values[0],l,{right:"right"===e.open("side").values[0],along:o,inPlace:!0})}if("unary math"===r){const r=await k(e.open("seed"),t,n,s,i),a=e.open("method").values[0];let l=null;return"log"==a&&"base"in e.children&&(l=e.open("base").values[0]),h.rS(r,a,{logBase:l,inPlace:!0})}if("transpose"==r){const r=await k(e.open("seed"),t,n,s,i),a=e.open("permutation").values;if(1==a[0]&&0==a[1])return h.mg(r,{inPlace:!0});if(0==a[0]&&1==a[1])return r;throw new Error("invalid permutation for transposition operation at '"+t+"'")}if("subset"==r){let r=await k(e.open("seed"),t,n,s,i);const a=e.open("index");return"0"in a.children&&(r=h._b(r,a.open("0").values,{inPlace:!0})),"1"in a.children&&(r=h._r(r,a.open("1").values,{inPlace:!0})),r}if("combine"!=r)throw new Error("unsupported delayed operation '"+r+"'");{const r=e.open("seeds");let l=[];try{const o=Object.keys(r.childen).length;for(var a=0;a<o;a++)l.push(await k(r.open(String(a)),t,n,s,i));return 0==e.open("along").values[0]?h.k(l):h.x6(l)}finally{for(const e of l)h.t9(e)}}}else{if("array"!==r)throw new Error("unsupported delayed type '"+r+"'");{let r=e.readAttribute("delayed_array").values[0];if("custom takane seed array"!==r){if("dense array"==r){let t=0!=e.open("native").values[0];return h.fR(e.file,e.name+"/data",{transposed:!t,forceInteger:s,forceSparse:i})}if("sparse matrix"==r){const t=e.open("shape").values,n=0==e.open("by_column").values[0];return h.KR(e.file,e.name,t[0],t[1],n,{forceInteger:s})}throw new Error("unsupported delayed array '"+r+"'")}{let r,a=e.open("index").values[0],l=d.uJ(t,"seeds",String(a)),o=await d._i(l,n);try{return await E(l,o,n,s,i)}finally{h.t9(r)}}}}}function N(e,t,n,s,i,r){return new x(e,t,n)}function C(e,t,n,s,i){return new x(e,2,t)}function D(e,t){let n="",s=e instanceof u.ky;s&&null!==e.mainExperimentName()&&(n=e.mainExperimentName());let i={};if(i[n]=t(e),s)for(const r of e.alternativeExperimentNames())r!==n&&(i[r]=t(e.alternativeExperiment(r)));return i}function S(e){return D(e,e=>e.rowData())}function P(e){return D(e,e=>e.assayNames())}function O(e){for(const t of e.columnNames()){let n=e.column(t);n instanceof u.B8&&e.setColumn(t,n.toArray(),{inPlace:!0})}return null}var M=new WeakMap,R=new WeakMap,I=new WeakMap,z=new WeakSet;class W{constructor(e){(0,i.A)(this,z),(0,a.A)(this,M,void 0),(0,a.A)(this,R,void 0),(0,a.A)(this,I,void 0),(0,o.A)(M,this,e),(0,o.A)(I,this,W.defaults()),(0,o.A)(R,this,null)}static defaults(){return{rnaCountAssay:0,adtCountAssay:0,crisprCountAssay:0,rnaExperiment:"",adtExperiment:"Antibody Capture",crisprExperiment:"CRISPR Guide Capture",primaryRnaFeatureIdColumn:null,primaryAdtFeatureIdColumn:null,primaryCrisprFeatureIdColumn:null}}options(){return(0,s.A)({},(0,l.A)(I,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,l.A)(I,this)[t]=n}clear(){(0,o.A)(R,this,null)}async summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,r.A)(z,this,B).call(this);let t={modality_features:S((0,l.A)(R,this)),cells:(0,l.A)(R,this).columnData(),modality_assay_names:P((0,l.A)(R,this))};return e||this.clear(),t}async previewPrimaryIds(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,r.A)(z,this,B).call(this);let t={RNA:(0,l.A)(I,this).rnaExperiment,ADT:(0,l.A)(I,this).adtExperiment,CRISPR:(0,l.A)(I,this).crisprExperiment},n=S((0,l.A)(R,this)),s=[];(0,l.A)(R,this)instanceof u.ky&&(s=(0,l.A)(R,this).alternativeExperimentNames());let i=c.q(n,s,t,(0,r.A)(z,this,T).call(this));return e||this.clear(),i}async load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,r.A)(z,this,B).call(this);let t={matrix:new h.P_,features:{},cells:(0,l.A)(R,this).columnData()},n={RNA:{exp:(0,l.A)(I,this).rnaExperiment,assay:(0,l.A)(I,this).rnaCountAssay},ADT:{exp:(0,l.A)(I,this).adtExperiment,assay:(0,l.A)(I,this).adtCountAssay},CRISPR:{exp:(0,l.A)(I,this).crisprExperiment,assay:(0,l.A)(I,this).crisprCountAssay}},s=D((0,l.A)(R,this),e=>e);try{for(const[e,i]of Object.entries(n)){if(null===i.exp||!(i.exp in s))continue;let n=s[i.exp],a=await n.assay(i.assay).realize((0,r.A)(z,this,j).call(this),!0,!0);t.matrix.add(e,a),t.features[e]=n.rowData()}t.primary_ids=c.gu(t.features,(0,r.A)(z,this,T).call(this))}catch(i){throw h.t9(t.matrix),i}return e||this.clear(),t}}function j(){return new v((0,l.A)(M,this))}async function B(){null===(0,l.A)(R,this)&&((0,o.A)(R,this,await d.Ag(".",null,(0,r.A)(z,this,j).call(this),{DataFrame_readNested:!1,DataFrame_readMetadata:!1,SummarizedExperiment_readAssay:N,SummarizedExperiment_readMetadata:!1,SingleCellExperiment_readReducedDimension:!1})),O((0,l.A)(R,this).columnData()),D((0,l.A)(R,this),e=>O(e.rowData())))}function T(){return{RNA:(0,l.A)(I,this).primaryRnaFeatureIdColumn,ADT:(0,l.A)(I,this).primaryAdtFeatureIdColumn,CRISPR:(0,l.A)(I,this).primaryCrisprFeatureIdColumn}}var F=new WeakMap,J=new WeakMap,L=new WeakMap,V=new WeakSet;class U{constructor(e){(0,i.A)(this,V),(0,a.A)(this,F,void 0),(0,a.A)(this,J,void 0),(0,a.A)(this,L,void 0),(0,o.A)(F,this,e),(0,o.A)(L,this,U.defaults()),(0,o.A)(J,this,null)}static defaults(){return{primaryAssay:0,isPrimaryNormalized:!0,reducedDimensionNames:null}}options(){return(0,s.A)({},(0,l.A)(L,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,l.A)(L,this)[t]=u.UC(n)}clear(){(0,o.A)(J,this,null)}async summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,r.A)(V,this,H).call(this);let t={modality_features:S((0,l.A)(J,this)),cells:(0,l.A)(J,this).columnData(),modality_assay_names:P((0,l.A)(J,this)),reduced_dimension_names:[]};return(0,l.A)(J,this)instanceof u.ky&&(t.reduced_dimension_names=(0,l.A)(J,this).reducedDimensionNames()),e||this.clear(),t}async load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await(0,r.A)(V,this,H).call(this);let t={matrix:new h.P_,features:{},cells:(0,l.A)(J,this).columnData(),reduced_dimensions:{}};if((0,l.A)(J,this)instanceof u.ky){let e=(0,l.A)(L,this).reducedDimensionNames;null===e&&(e=(0,l.A)(J,this).reducedDimensionNames());for(const s of e){let e=await(0,l.A)(J,this).reducedDimension(s).realize((0,r.A)(V,this,$).call(this),!1,!1);try{let i=[],r=e.numberOfColumns();for(var n=0;n<r;n++)i.push(e.column(n));t.reduced_dimensions[s]=i}finally{h.t9(e)}}}const s=D((0,l.A)(J,this),e=>e);try{for(const[e,n]of Object.entries(s)){let s=(0,l.A)(L,this).primaryAssay;if("object"==typeof s){if(!(e in s))continue;s=s[e]}let i=(0,l.A)(L,this).isPrimaryNormalized;"object"==typeof i&&(i=!(e in i)||i[e]);let a=await n.assay(s).realize((0,r.A)(V,this,$).call(this),!i,!0);if(t.matrix.add(e,a),!i){let n=h.mM(a,{allowZeros:!0});t.matrix.add(e,n)}t.features[e]=n.rowData()}}catch(i){throw h.t9(t.matrix),i}return e||this.clear(),t}}function $(){return new v((0,l.A)(F,this))}async function H(){null===(0,l.A)(J,this)&&((0,o.A)(J,this,await d.Ag(".",null,(0,r.A)(V,this,$).call(this),{DataFrame_readNested:!1,DataFrame_readMetadata:!1,SummarizedExperiment_readAssay:N,SummarizedExperiment_readMetadata:!1,SingleCellExperiment_readReducedDimension:C})),O((0,l.A)(J,this).columnData()),D((0,l.A)(J,this),e=>O(e.rowData())))}},2925:(e,t,n)=>{n.d(t,{P4:()=>A,el:()=>E,g0:()=>R});var s=n(5149),i=n(8458),r=n(4558),a=n(9790),l=n(6562),o=n(7990),h=n(1276),u=n(3983),c=n(4201),d=n(6292),f=n(3819),m=n(8833);const A="custom_selections";var p=new WeakSet;class w{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,a.A)(this,p),this._selections=null==e?{}:e,this._cache=null==t?{results:{}}:t}free(){h.xr(this._cache.buffer),delete this._cache.buffer;for(const e of Object.keys(this._cache.results))(0,l.A)(p,this,_).call(this,e);this._cache.results={},u.T9(this._cache.versus),delete this._cache.versus}addSelection(e,t,n,s,i,r,a,u){let c=s(n[0]).numberOfColumns();h.O_(t,c);var d=h.RK(c,"Int32Array",this._cache);d.fill(0);var f=d.array();t.forEach(e=>{f[e]=1});let m={};for(const l of n){let e=s(l);m[l]=o.Kq(e,d,{block:i,threshold:a,computeAuc:u})}e in this._cache.results&&(0,l.A)(p,this,_).call(this,e),this._cache.results[e]={raw:m},r&&(t=t.slice()),this._selections[e]=t}removeSelection(e){(0,l.A)(p,this,_).call(this,e),delete this._cache.results[e],delete this._selections[e]}fetchResults(e){return this._cache.results[e].raw}fetchSelectionIndices(e){let{copy:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._selections[e];return t&&(n=n.slice()),n}fetchSelections(){let{copy:e=!0,force:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={};for(const[s,i]of Object.entries(this._selections)){let r=i,a=e;null!==t&&("Array"==t?i instanceof Array||(r=Array.from(i),a=!1):"Int32Array"==t&&(i instanceof Int32Array||(r=new Int32Array(i),a=!1))),a&&(r=r.slice()),n[s]=r}return n}computeVersus(e,t,n,s,i,r,a){"versus"in this._cache||(this._cache.versus={});let l=this._cache.versus,h=u.Ni(e,t,l),c=h.left_small?0:1,d=h.left_small?1:0;if(h.run){let l=new o.P_;for(const e of n)l.add(e,s(e));let f=this._selections;if(!(e in f)||!(t in f))throw new Error("invalid selection ID requested in versus mode");let m=f[e],A=f[t];if(0==m.length||0==A.length)throw new Error("non-zero entries should be present for both requested selections in versus mode");let p=[];m.forEach(e=>{p.push({index:e,cluster:c})}),A.forEach(e=>{p.push({index:e,cluster:d})}),p.sort((e,t)=>e.index-t.index);let w=p.map(e=>e.index),_=p.map(e=>e.cluster);u.gK(l,_,i,w,h.cached,r,a)}return{results:h.cached,left:c,right:d}}}function _(e){for(const[t,n]of Object.entries(this._cache.results[e].raw))n.free()}var v=new WeakMap,y=new WeakMap,g=new WeakMap,b=new WeakMap,x=new WeakSet;class E{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,a.A)(this,x),(0,s.A)(this,v,void 0),(0,s.A)(this,y,void 0),(0,s.A)(this,g,void 0),(0,s.A)(this,b,void 0),!(e instanceof c._))throw new Error("'filter' should be a CellFilteringState object");if((0,r.A)(v,this,e),!(t.RNA instanceof d.A))throw new Error("'norm_states.RNA' should be an RnaNormalizationState object");if(!(t.ADT instanceof f.K))throw new Error("'norm_states.ADT' should be an AdtNormalizationState object");if(!(t.CRISPR instanceof m.S))throw new Error("'norm_states.CRISPR' should be an CrisprNormalizationState object");(0,r.A)(y,this,t);let l=null;null!==n&&"selections"in n&&(l=n.selections),(0,r.A)(g,this,new w(l,i)),(0,r.A)(b,this,{}),this.changed=!1}free(){(0,i.A)(g,this).free()}fetchParameters(){return{lfc_threshold:(0,i.A)(b,this).lfc_threshold,compute_auc:(0,i.A)(b,this).compute_auc}}addSelection(e,t){let{copy:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,l.A)(x,this,k).call(this,e,t,n,(0,i.A)(b,this).lfc_threshold,(0,i.A)(b,this).compute_auc)}removeSelection(e){(0,i.A)(g,this).removeSelection(e)}fetchResults(e){return(0,i.A)(g,this).fetchResults(e)}fetchSelectionIndices(e){let{copy:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.A)(g,this).fetchSelectionIndices(e,{copy:t})}fetchSelections(){let{copy:e=!0,force:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.A)(g,this).fetchSelections({copy:e,force:t})}compute(e){if(e=h.wn(e,E.defaults()),this.changed=!1,(0,i.A)(v,this).changed&&((0,i.A)(g,this).free(),(0,r.A)(g,this,new w),this.changed=!0),e.lfc_threshold!==(0,i.A)(b,this).lfc_threshold||e.compute_auc!=(0,i.A)(b,this).compute_auc){for(const[t,n]of Object.entries((0,i.A)(g,this)._selections))(0,l.A)(x,this,k).call(this,t,n,!1,e.lfc_threshold,e.compute_auc);(0,i.A)(b,this).lfc_threshold=e.lfc_threshold,(0,i.A)(b,this).compute_auc=e.compute_auc,this.changed=!0}}static defaults(){return{lfc_threshold:0,compute_auc:!0}}computeVersus(e,t){let n=h.Rj((0,i.A)(y,this));return(0,i.A)(g,this).computeVersus(e,t,n,e=>(0,i.A)(y,this)[e].fetchNormalizedMatrix(),(0,i.A)(v,this).fetchFilteredBlock(),(0,i.A)(b,this).lfc_threshold,(0,i.A)(b,this).compute_auc)}}function k(e,t,n,s,r){let a=h.Rj((0,i.A)(y,this));(0,i.A)(g,this).addSelection(e,t,a,e=>(0,i.A)(y,this)[e].fetchNormalizedMatrix(),(0,i.A)(v,this).fetchFilteredBlock(),n,s,r)}var N=new WeakMap,C=new WeakMap,D=new WeakMap,S=new WeakMap,P=new WeakMap,O=new WeakMap,M=new WeakSet;class R{constructor(e){let{block:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.A)(this,M),(0,s.A)(this,N,void 0),(0,s.A)(this,C,void 0),(0,s.A)(this,D,void 0),(0,s.A)(this,S,void 0),(0,s.A)(this,P,void 0),(0,s.A)(this,O,void 0);let n=null;for(const s of e.available()){let t=e.get(s).numberOfColumns();if(null!=n){if(t!=n)throw new Error("all matrices in 'normalized' should have the same number of columns as the length of 'groups'")}else n=t}if((0,r.A)(C,this,null),(0,r.A)(D,this,null),(0,r.A)(O,this,null),null!==t){if(t.length!=n)throw new Error("'block' should have the same length as the number of columns in each entry of 'normalized'");let s=h.wW([t]);if(null!==s.retain){let t=new Int32Array(n);t.fill(-1),s.retain.forEach((e,n)=>{t[e]=n}),(0,r.A)(O,this,{to:t,from:s.retain});let a=new o.P_,l=o.kl(s.retain.length);try{l.set(s.retain);for(const t of e.available())a.add(t,o._r(e.get(t),l))}catch(i){throw o.t9(a),i}finally{o.t9(l)}(0,r.A)(N,this,a)}else(0,r.A)(N,this,e.clone());(0,r.A)(C,this,s.arrays[0].ids),(0,r.A)(D,this,s.arrays[0].levels)}else(0,r.A)(N,this,e.clone());(0,r.A)(S,this,new w),(0,r.A)(P,this,E.defaults()),this.changed=!1}free(){o.t9((0,i.A)(N,this)),o.t9((0,i.A)(C,this)),(0,i.A)(S,this).free()}fetchParameters(){return{lfc_threshold:(0,i.A)(P,this).lfc_threshold,compute_auc:(0,i.A)(P,this).compute_auc}}fetchBlockLevels(){let{copy:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,i.A)(D,this);return e?t.slice():t}_peekMatrices(){return(0,i.A)(N,this)}_peekBlock(){return(0,i.A)(C,this)}static defaults(){return{lfc_threshold:0,compute_auc:!0}}setParameters(e){e=h.wn(e,R.defaults()),(0,i.A)(P,this).lfc_threshold===e.lfc_threshold&&(0,i.A)(P,this).compute_auc===e.compute_auc||(0,i.A)(S,this).free(),(0,r.A)(P,this,e)}addSelection(e,t){let{copy:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=t;if(null!==(0,i.A)(O,this)){let e=[],n=(0,i.A)(O,this).to;for(const s of t){let t=n[s];t>=0&&e.push(t)}s=e}(0,i.A)(S,this).addSelection(e,s,(0,i.A)(N,this).available(),e=>(0,i.A)(N,this).get(e),(0,i.A)(C,this),n,(0,i.A)(P,this).lfc_threshold,(0,i.A)(P,this).compute_auc)}removeSelection(e){(0,i.A)(S,this).removeSelection(e)}fetchResults(e){return(0,i.A)(S,this).fetchResults(e)}fetchSelectionIndices(e){let{copy:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,i.A)(S,this).fetchSelectionIndices(e,{copy:t});return(0,l.A)(M,this,I).call(this,n),n}fetchSelections(){let{copy:e=!0,force:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,i.A)(S,this).fetchSelections({copy:e,force:t});for(const[s,i]of Object.entries(n))(0,l.A)(M,this,I).call(this,i);return n}computeVersus(e,t){return(0,i.A)(S,this).computeVersus(e,t,(0,i.A)(N,this).available(),e=>(0,i.A)(N,this).get(e),(0,i.A)(C,this),(0,i.A)(P,this).lfc_threshold,(0,i.A)(P,this).compute_auc)}}function I(e){null!==(0,i.A)(O,this)&&e.forEach((t,n)=>{e[n]=(0,i.A)(O,this).from[t]})}},2952:(e,t,n)=>{n.d(t,{k:()=>h});var s=n(4467),i=n(6662),r=n(6508),a=n(8675),l=n(1430),o=n(9462);class h extends r.e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)return void super();let{reducedDimensions:n={},reducedDimensionOrder:s=null,alternativeExperiments:r={},alternativeExperimentOrder:l=null,rowRanges:h=null,mainExperimentName:u=null}=t;super(e,h,t);let c=this.numberOfColumns();try{this._reducedDimensions=new o.w(n,s)}catch(d){throw new Error("failed to initialize reduced dimension list for this "+this.constructor.className+"; "+d.message,{cause:d})}for(const a of this._reducedDimensions.names()){let e=this._reducedDimensions.entry(a);if(i.eQ(e)!==c)throw new Error("number of rows for reduced dimension '"+a+"' is not equal to number of columns for this "+this.constructor.className)}try{this._alternativeExperiments=new o.w(r,l)}catch(d){throw new Error("failed to initialize alternative experiment list for this "+this.constructor.className+"; "+d.message,{cause:d})}for(const i of this._alternativeExperiments.names()){let e=this._alternativeExperiments.entry(i);if(!(e instanceof a.H))throw new Error("alternative experiment '"+i+"' is not a SummarizedExperiment");if(e.numberOfColumns(e)!==c)throw new Error("number of columns for alternative experiment '"+i+"' is not equal to number of columns for this "+this.constructor.className)}this._mainExperimentName=u}reducedDimensionNames(){return this._reducedDimensions.names()}reducedDimension(e){let t;try{t=this._reducedDimensions.entry(e)}catch(n){throw new Error("failed to retrieve the specified reduced dimension from this "+this.constructor.className+"; "+n.message,{cause:n})}return t}reducedDimensions(){return this._reducedDimensions.entries()}alternativeExperimentNames(){return this._alternativeExperiments.names()}alternativeExperiment(e){let t;try{t=this._alternativeExperiments.entry(e)}catch(n){throw new Error("failed to retrieve the specified alternative experiment from this "+this.constructor.className+"; "+n.message,{cause:n})}return t}alternativeExperiments(){return this._alternativeExperiments.entries()}mainExperimentName(){return this._mainExperimentName}removeReducedDimension(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._reducedDimensions=n._reducedDimensions.delete(e,{inPlace:t})}catch(s){throw new Error("failed to remove the specified reduced dimension from this "+this.constructor.className+"; "+s.message,{cause:s})}return n}$removeReducedDimension(e){return this.removeReducedDimension(e,{inPlace:!0})}setReducedDimension(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i.eQ(t)!=this.numberOfColumns())throw new Error("number of rows of 'value' should be the same as the number of columns of this SingleCellExperiment");let s=l.z(this,n);return s._reducedDimensions=s._reducedDimensions.set(e,t,{inPlace:n}),s}$setReducedDimension(e,t){return this.setReducedDimension(e,t,{inPlace:!0})}setReducedDimensionNames(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._reducedDimensions=n._reducedDimensions.setNames(e,{inPlace:t})}catch(s){throw new Error("failed to set the reduced dimension names for this "+this.constructor.className+"; "+s.message,{cause:s})}return n}$setReducedDimensionNames(e){return this.setReducedDimensionNames(e,{inPlace:!0})}setReducedDimensions(e){let{inPlace:t=!1,newOrder:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=l.z(this,t);!1===n?n=s._reducedDimensions.names():1==n&&(n=null);try{s._reducedDimensions=new o.w(e,n)}catch(a){throw new Error("failed to replace reduced dimension list for this SingleCellExperiment; "+a.message,{cause:a})}let r=s.numberOfColumns();for(const l of s._reducedDimensions.names()){let e=s._reducedDimensions.entry(l);if(i.eQ(e)!==r)throw new Error("mismatch in the number of rows for reduced dimension '"+l+"' compared to the number of columns in the SingleCellExperiment")}return s}$setReducedDimensions(e){let{newOrder:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setReducedDimensions(e,{inPlace:!0,newOrder:t})}sliceReducedDimensions(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._reducedDimensions=this._reducedDimensions.slice(e,{inPlace:t})}catch(s){throw new Error("failed to slice the reduced dimensions for this "+this.constructor.className+"; "+s.message,{cause:s})}return n}$sliceReducedDimensions(e){return this.sliceReducedDimensions(e,{inPlace:!0})}removeAlternativeExperiment(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._alternativeExperiments=n._alternativeExperiments.delete(e,{inPlace:t})}catch(s){throw new Error("failed to remove the specified alternative experiment from this "+this.constructor.className+"; "+s.message,{cause:s})}return n}$removeAlternativeExperiment(e){return this.removeAlternativeExperiment(e,{inPlace:!0})}setAlternativeExperiment(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(t instanceof a.H)||i.IV(t)!=this.numberOfColumns())throw new Error("'value' should be a SummarizedExperiment with the same number of columns as this SingleCellExperiment");let s=l.z(this,n);return s._alternativeExperiments=s._alternativeExperiments.set(e,t,{inPlace:n}),s}$setAlternativeExperiment(e,t){return this.setAlternativeExperiment(e,t,{inPlace:!0})}setAlternativeExperimentNames(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._alternativeExperiments=n._alternativeExperiments.setNames(e,{inPlace:t})}catch(s){throw new Error("failed to set the alternative experiment names for this "+this.constructor.className+"; "+s.message,{cause:s})}return n}$setAlternativeExperimentNames(e){return this.setAlternativeExperimentNames(e,{inPlace:!0})}setAlternativeExperiments(e){let{inPlace:t=!1,newOrder:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=l.z(this,t);!1===n?n=s._alternativeExperiments.names():1==n&&(n=null);try{s._alternativeExperiments=new o.w(e,n)}catch(a){throw new Error("failed to replace alternative experiment list for this SingleCellExperiment; "+a.message,{cause:a})}let r=s.numberOfColumns();for(const l of s._alternativeExperiments.names()){let e=s._alternativeExperiments.entry(l);if(i.IV(e)!==r)throw new Error("mismatch in the number of columns for alternative experiment '"+l+"' compared to the SingleCellExperiment")}return s}$setAlternativeExperiments(e){let{newOrder:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setAlternativeExperiments(e,{inPlace:!0,newOrder:t})}sliceAlternativeExperiments(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);try{n._alternativeExperiments=this._alternativeExperiments.slice(e,{inPlace:t})}catch(s){throw new Error("failed to slice the alternative experiments for this "+this.constructor.className+"; "+s.message,{cause:s})}return n}$sliceAlternativeExperiments(e){return this.sliceAlternativeExperiments(e,{inPlace:!0})}setMainExperimentName(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l.z(this,t);return n._mainExperimentName=e,n}$setMainExperimentName(e){return this.setMainExperimentName(e,{inPlace:!0})}_bioconductor_SLICE_2D(e,t,n){let{allowView:s=!1}=n,r=super._bioconductor_SLICE_2D(e,t,{allowView:s});return null!==t?(r._reducedDimensions=this._reducedDimensions.apply(e=>i.Uf(e,t,null,{allowView:s})),r._alternativeExperiments=this._alternativeExperiments.apply(e=>i.Uf(e,null,t,{allowView:s}))):(r._reducedDimensions=this._reducedDimensions,r._alternativeExperiments=this._alternativeExperiments),r._mainExperimentName=this._mainExperimentName,r}_bioconductor_COMBINE_ROWS(e){let t=super._bioconductor_COMBINE_ROWS(e);return t._reducedDimensions=this._reducedDimensions,t._alternativeExperiments=this._alternativeExperiments,t._mainExperimentName=this._mainExperimentName,t}_bioconductor_COMBINE_COLUMNS(e){let t=super._bioconductor_COMBINE_COLUMNS(e),n=[this._reducedDimensions],s=[this._alternativeExperiments];for(const i of e)n.push(i._reducedDimensions),s.push(i._alternativeExperiments);try{t._reducedDimensions=o.w.parallelCombine(n,i.C7)}catch(r){throw new Error("failed to combine reduced dimensions for "+this.constructor.className+" objects; "+r.message,{cause:r})}try{t._alternativeExperiments=o.w.parallelCombine(s,i.St)}catch(r){throw new Error("failed to combine alternative experiments for "+this.constructor.className+" objects; "+r.message,{cause:r})}return t._mainExperimentName=this._mainExperimentName,t}_bioconductor_CLONE(e){let{deepCopy:t}=e,n=super._bioconductor_CLONE({deepCopy:t});return n._reducedDimensions=l.k(this._reducedDimensions,t),n._alternativeExperiments=l.k(this._alternativeExperiments,t),n._mainExperimentName=this._mainExperimentName,n}}(0,s.A)(h,"className","SingleCellExperiment")},3021:(e,t,n)=>{n(7990),n(1576)},3046:(e,t,n)=>{n(1576),n(3619)},3619:(e,t,n)=>{n.d(t,{$9:()=>o.$9,B8:()=>s.B8,Bm:()=>s.Bm,CP:()=>i.C,HH:()=>r.H,I4:()=>i.I,JP:()=>o.JP,UC:()=>o.UC,a4:()=>s.a4,cI:()=>o.cI,eV:()=>a.e,eg:()=>s.eg,ky:()=>l.k,pz:()=>s.pz,zJ:()=>h.z});var s=n(8743),i=n(2294),r=(n(5570),n(3968),n(8686),n(4793),n(8675)),a=n(6508),l=n(2952),o=n(6662),h=n(903)},4418:(e,t,n)=>{n.d(t,{L:()=>u});var s=n(9495),i=n(3619),r=n(507),a=n(5361);function l(e){return"NaN"===e?Number.NaN:"Inf"===e?Number.POSITIVE_INFINITY:"-Inf"===e?Number.NEGATIVE_INFINITY:e}function o(e,t,n,s){let i=e.values,r=!1;i instanceof Array||(i=[i],r=!0);let a=t(i);if("names"in e)a.setNames(e.names,{inPlace:!0});else if(r){if("List_toScalar"in n&&n.List_toScalar)return a.get(0)}else if(null!==s&&a.toArray().every(e=>null!==e)&&"List_toTypedArray"in n&&n.List_toTypedArray)return new s(a.toArray());return a._jaspalite_scalar=r,a}async function h(e,t,n,s){if("list"==e.type){let r=[];for(const i of e.values)r.push(await h(i,t,n,s));let a=new i.B8(r);return"names"in e&&a.setNames(e.names,{inPlace:!0}),a}if("integer"==e.type)return o(e,e=>new i.Bm(e),s,Int32Array);if("number"==e.type)return o(e,e=>new i.eg(e.map(l)),s,Float64Array);if("string"==e.type)return o(e,e=>new i.a4(e),s,null);if("boolean"==e.type)return o(e,e=>new i.pz(e),s,null);if("factor"==e.type)return o(e,t=>{let n=t.slice();for(var s=0;s<n.length;s++)null!==n[s]&&(n[s]=e.levels[n[s]]);return new i.a4(n)},s,null);if("nothing"==e.type)return null;if("external"==e.type)return(0,r.Ag)((0,a.uJ)(t,"other_contents",String(e.index)),null,n,s);throw new Error("unknown JSON list type '"+e.type+"'")}async function u(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("json.gz"!==t.simple_list.format)throw new Error("list formats other than 'json.gz' are currently not supported");let r=await n.get((0,a.uJ)(e,"list_contents.json.gz"),{asBuffer:!0});const l=new Blob([r]).stream().pipeThrough(new DecompressionStream("gzip"));let o=[],u=0;var c,d=!1,f=!1;try{for(var m,A=(0,s.A)(l);d=!(m=await A.next()).done;d=!1){const e=m.value;o.push(e),u+=e.length}}catch(_){f=!0,c=_}finally{try{d&&null!=A.return&&await A.return()}finally{if(f)throw c}}let p=new Uint8Array(u);u=0;for(const s of o)p.set(s,u),u+=s.length;let w=(new TextDecoder).decode(p);return h(JSON.parse(w),e,n,i)}},4678:(e,t,n)=>{n(3619),n(6919)},4717:(e,t,n)=>{n.d(t,{I:()=>r});var s=n(3619),i=(n(507),n(5406));async function r(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=await(0,i.B)(e,t,n,r);return new s.eV(a.assays(),null,{assayOrder:a.assayNames(),rowData:a.rowData(),columnData:a.columnData(),rowNames:a.rowNames(),columnNames:a.columnNames(),metadata:a.metadata()})}},5361:(e,t,n)=>{function s(){let e=arguments.length<=0?void 0:arguments[0];for(var t=1;t<arguments.length;t++){let n=t<0||arguments.length<=t?void 0:arguments[t];"."==e?e=n:"."!=n&&(e+="/"+n)}return e}n.d(t,{uJ:()=>s})},5406:(e,t,n)=>{n.d(t,{B:()=>l});var s=n(3619),i=n(507),r=n(5361),a=n(9215);async function l(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=null;"SummarizedExperiment_readAssay"in l&&(o=l.SummarizedExperiment_readAssay);const h={},u={},c=(0,r.uJ)(e,"assays/names.json");if(await n.exists(c)){let s=await n.get(c,{asBuffer:!0});const a=new TextDecoder,d=JSON.parse(a.decode(s));h.assayOrder=d;for(const[h,c]of Object.entries(d)){let s=(0,r.uJ)(e,"assays",String(h)),a=await(0,i._i)(s,n);u[c]=null===o?await(0,i.Ag)(s,a,n,l):await o(t.summarized_experiment.dimensions[0],t.summarized_experiment.dimensions[1],s,a,n,l)}}if(await n.exists((0,r.uJ)(e,"column_data/OBJECT"))){let t=await(0,i.Ag)((0,r.uJ)(e,"column_data"),null,n,l);h.columnData=t,h.columnNames=t.rowNames()}else 0==Object.keys(u).length&&(h.columnData=new s.CP({},{numberOfRows:0}));if(await n.exists((0,r.uJ)(e,"row_data/OBJECT"))){let t=await(0,i.Ag)((0,r.uJ)(e,"row_data"),null,n,l);h.rowData=t,h.rowNames=t.rowNames()}else 0==Object.keys(u).length&&(h.rowData=new s.CP({},{numberOfRows:0}));return h.metadata=await(0,a.m)((0,r.uJ)(e,"other_data"),n,l,"SummarizedExperiment_readMetadata"),new s.HH(u,h)}},5600:(e,t,n)=>{n.d(t,{l:()=>i});n(4106);var s=n(3726);async function i(e,t){let{types:n=null,ignoreCase:i=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===n&&(n=["entrez","ensembl","symbol"]);let r=[];for(const u of n)r.push((0,s.B)(e,u,{lowerCase:i}));let a=await Promise.all(r),l=[];for(var o=0;o<t.length;o++){let e=t[o];if(0==e.length){l.push([]);continue}i&&(e=e.toLowerCase());let s=[];for(var h=0;h<n.length;h++){let t=a[h].get(e);if("undefined"!==typeof t)for(const e of t)s.push(e)}l.push(s)}return l}},6535:(e,t,n)=>{n.d(t,{$c:()=>l,Az:()=>a,Iy:()=>f,RI:()=>A,iC:()=>d,lq:()=>m,nz:()=>c,oc:()=>u,uN:()=>o});var s=n(932),i=(e,t,n,s)=>{let i=e+"/"+t;return null==n||null==s?fetch(i):fetch(i,{headers:{Range:"bytes="+String(n)+"-"+String(s)}})},r="https://github.com/LTLA/gesel-feedstock/releases/download/indices-v0.2.2";function a(e){if("undefined"==typeof e)return r;return r}var l=function(e){return i(r,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)};function o(e){let t=l;return"undefined"!==typeof e&&(l=e),t}var h="https://github.com/LTLA/gesel-feedstock/releases/download/genes-v1.0.0";function u(e){if("undefined"==typeof e)return h;return h}var c=e=>i(h,e,null,null);function d(e){let t=c;return"undefined"!==typeof e&&(c=e),t}function f(e){return d(e)}function m(e){var t=s.UD(new Uint8Array(e));var n=(new TextDecoder).decode(t).split("\n");return""==n[n.length-1]?n.slice(0,n.length-1):n}function A(e){var t=[];if(""!==e){var n=0;e.split("\t").forEach(e=>{var s=Number(e)+n;t.push(s),n=s})}return new Uint32Array(t)}},6554:(e,t,n)=>{n(3619),n(6919),n(3021),n(3046)},6747:(e,t,n)=>{n.d(t,{P4:()=>p,VX:()=>D,z7:()=>B});var s=n(9379),i=n(9790),r=n(5149),a=n(6562),l=n(8458),o=n(4558),h=n(7990),u=n(3619),c=n(8166),d=n(1276),f=(n(3983),n(141),n(2697)),m=n(4201),A=n(6292);n(7465);const p="feature_set_enrichment";var w=new WeakMap,_=new WeakSet;class v{constructor(){(0,i.A)(this,_),(0,r.A)(this,w,void 0),(0,o.A)(w,this,{})}free(){d.xr((0,l.A)(w,this).set_buffer),(0,o.A)(w,this,{})}static flush(){}static setDownload(e){console.warn("'FeatureSetState.setDownload' is a no-op, uses 'gesel.setReferenceDownload' and 'gesel.setGeneDownload' instead")}async buildCollections(e,t,n,s,i,r,l){if(t!==e.guess_ids||!t&&(e.gene_id_column!==s||e.gene_id_type!==i||d.PG(e.species,n))){let e=s,o=i,h=n;if(t){let t=function(e){let t=null,n={type:"symbol",species:"9606",confidence:0};if("row_names"in e){let t=e.row_names;t.confidence>n.confidence&&(n=t)}for(const[s,i]of Object.entries(e.columns))i.confidence>n.confidence&&(n=i,t=s);return{gene_id_column:t,gene_id_type:n.type.toUpperCase(),species:[n.species]}}(l());e=t.gene_id_column,o=t.gene_id_type,h=t.species}return await(0,a.A)(_,this,y).call(this,r(),h,e,o),!0}return!1}fetchCollectionDetails(){return(0,l.A)(w,this).collections}fetchSetDetails(){return{names:(0,l.A)(w,this).sets.names,descriptions:(0,l.A)(w,this).sets.descriptions,sizes:(0,l.A)(w,this).sets.sizes,collections:(0,l.A)(w,this).sets.collections}}fetchUniverseSize(){return(0,l.A)(w,this).universe.length}computeEnrichment(e,t,n,s,i){"delta_detected"==t?t="deltaDetected":"cohen"==t?t="cohensD":"lfc"==t&&(t="deltaDetected"),"min_rank"==n&&(n="min-rank");let r=!0,a=null;"min-rank"==n?r=!1:a="auc"==t?.5:0;let o=s[t](e,{summary:n,copy:!1}),d=h.M2(u.$9(o,(0,l.A)(w,this).universe),i,{useLargest:r,threshold:a});d.forEach((e,t)=>{let n=(0,l.A)(w,this).universe[e];d[t]=(0,l.A)(w,this).mapping_to_sets[n]});let f=c.QR(d),m=new Int32Array(f.length),A=new Int32Array(f.length),p=new Int32Array(f.length),_=new Int32Array(f.length);for(var v=0;v<f.length;v++){_[v]=v;let e=f[v];m[v]=e.id,A[v]=e.count,p[v]=(0,l.A)(w,this).sets.sizes[e.id]}let y=d.length,g=h.Qc(A,y,p,(0,l.A)(w,this).universe.length);return _.sort((e,t)=>g[e]-g[t]),{set_ids:u.$9(m,_),counts:u.$9(A,_),pvalues:u.$9(g,_),num_markers:y}}fetchFeatureSetIndices(e){return(0,l.A)(w,this).sets.sets[e]}computePerCellScores(e,t,n){let s=this.fetchFeatureSetIndices(e),i=d.RK(t.numberOfRows(),"Uint8Array",(0,l.A)(w,this),"set_buffer");i.fill(0);let r=i.array();return s.forEach(e=>{r[e]=1}),h.e2(t,i,{block:n})}}async function y(e,t,n,s){let i;null==n?(i=e.rowNames(),null==i&&(t=[])):i=e.column(n);let r={types:[s.toLowerCase()]},a=0,o=[[]],h=[[]],d=[[]],f=0,m=[[]],A=[[]],p=[[]],_=[new Int32Array],v=[new Int32Array],y=new Set,g=new Array(e.numberOfRows());for(var b=0;b<g.length;b++)g[b]=[];for(const l of t){let e=await c.lU(l,i,r);for(var x=0;x<e.length;x++)e[x].length>0&&y.add(x);let t=await c.i_(l),n=c.b5(e,t),s=await c.xD(l),u=s.length,w=new Array(u),b=new Array(u),k=new Int32Array(u),N=new Int32Array(u);for(x=0;x<u;x++){let e=s[x];w[x]=e.name,b[x]=e.description,N[x]=e.collection+a,k[x]=n[x].length}m.push(w),A.push(b),p.push(n),_.push(k),v.push(N);let C=await c.Ec(l),D=c.zs(e,C);for(x=0;x<e.length;x++){let e=D[x];for(var E=0;E<e.length;E++)e[E]+=f;g[x].push(e)}let S=await c.hv(l),P=S.length,O=new Array(P),M=new Array(P),R=new Array(P);for(x=0;x<P;x++)O[x]=S[x].title,M[x]=S[x].description,R[x]=l;o.push(O),h.push(M),d.push(R),f+=u,a+=P}if((0,l.A)(w,this).universe=new Int32Array(y).sort(),(0,l.A)(w,this).sets={names:u.cI(m),descriptions:u.cI(A),sets:u.cI(p),sizes:u.cI(_),collections:u.cI(v)},(0,l.A)(w,this).collections={names:u.cI(o),descriptions:u.cI(h),species:u.cI(d)},t.length>0)for(b=0;b<g.length;b++)g[b]=u.cI(g[b]);else for(b=0;b<g.length;b++)g[b]=new Uint32Array;(0,l.A)(w,this).mapping_to_sets=g}function g(e){return e.species=u.UC(e.species),e}function b(e){let t=(0,s.A)({},e);return t.species=u.UC(t.species),t}var x=new WeakMap,E=new WeakMap,k=new WeakMap,N=new WeakMap,C=new WeakMap;class D{constructor(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,r.A)(this,x,void 0),(0,r.A)(this,E,void 0),(0,r.A)(this,k,void 0),(0,r.A)(this,N,void 0),(0,r.A)(this,C,void 0),!(e instanceof f.Xj))throw new Error("'inputs' should be a State object from './inputs.js'");if((0,o.A)(x,this,e),!(t instanceof m._))throw new Error("'filter' should be a CellFilteringState object");if((0,o.A)(E,this,t),!(n instanceof A.A))throw new Error("'normalized' should be a RnaNormalizationState object from './rna_normalization.js'");(0,o.A)(k,this,n),(0,o.A)(N,this,null===i?{}:i),(0,o.A)(C,this,new v),this.changed=!1}free(){(0,l.A)(C,this).free()}valid(){return(0,l.A)(x,this).fetchCountMatrix().has("RNA")}fetchCollectionDetails(){return(0,l.A)(C,this).fetchCollectionDetails()}fetchSetDetails(){return(0,l.A)(C,this).fetchSetDetails()}fetchUniverseSize(){return(0,l.A)(C,this).fetchUniverseSize()}computeEnrichment(e,t,n,s){return(0,l.A)(C,this).computeEnrichment(t,n,s,e,(0,l.A)(N,this).top_markers)}fetchFeatureSetIndices(e){return(0,l.A)(C,this).fetchFeatureSetIndices(e)}computePerCellScores(e){return(0,l.A)(C,this).computePerCellScores(e,(0,l.A)(k,this).fetchNormalizedMatrix(),(0,l.A)(E,this).fetchFilteredBlock())}fetchPerCellScores(e,t){return this.computePerCellScores(e,t)}fetchParameters(){return b((0,l.A)(N,this))}static flush(){}static setDownload(e){return v.setDownload(e)}static defaults(){return{skip:!1,guess_ids:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL",top_markers:100}}async compute(e){if(e=d.wn(e,D.defaults()),this.changed=!1,(0,l.A)(x,this).changed&&(this.changed=!0),e.skip!==(0,l.A)(N,this).skip&&(this.changed=!0),this.valid()&&!e.skip){this.changed&&(0,o.A)(N,this,{}),await(0,l.A)(C,this).buildCollections((0,l.A)(N,this),e.guess_ids,e.species,e.gene_id_column,e.gene_id_type,()=>(0,l.A)(x,this).fetchFeatureAnnotations().RNA,()=>(0,l.A)(x,this).guessRnaFeatureTypes())&&(this.changed=!0),e.top_markers!==(0,l.A)(N,this).top_markers&&(this.changed=!0)}(0,o.A)(N,this,g(e))}}var S=new WeakMap,P=new WeakMap,O=new WeakMap,M=new WeakMap,R=new WeakMap,I=new WeakMap,z=new WeakMap,W=new WeakMap,j=new WeakSet;class B{constructor(e){let{normalized:t=null,block:n=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,i.A)(this,j),(0,r.A)(this,S,void 0),(0,r.A)(this,P,void 0),(0,r.A)(this,O,void 0),(0,r.A)(this,M,void 0),(0,r.A)(this,R,void 0),(0,r.A)(this,I,void 0),(0,r.A)(this,z,void 0),(0,r.A)(this,W,void 0),(0,o.A)(S,this,e),(0,o.A)(P,this,null),(0,o.A)(O,this,null),(0,o.A)(M,this,null),(0,o.A)(R,this,null),null!==t){if(t.numberOfRows()!==(0,l.A)(S,this).numberOfRows())throw new Error("number of rows of 'annotations' and 'normalized' should be identical");if(null!==n){if(t.numberOfColumns()!==n.length)throw new Error("number of columns of 'normalized' should equal the length of 'block'");let e=d.wW([n]);null!==e.retain?((0,o.A)(O,this,h._r(t,e.retain)),(0,o.A)(R,this,e.retain)):(0,o.A)(O,this,t.clone()),(0,o.A)(M,this,e.arrays[0].ids)}else(0,o.A)(O,this,t.clone())}(0,o.A)(I,this,B.defaults()),(0,o.A)(z,this,{}),(0,o.A)(W,this,new v)}_peekMatrices(){return(0,l.A)(O,this)}_peekBlock(){return(0,l.A)(M,this)}free(){h.t9((0,l.A)(M,this)),h.t9((0,l.A)(O,this)),(0,l.A)(W,this).free()}static defaults(){return{skip:!1,guess_ids:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL",top_markers:100}}setParameters(e){"undefined"==typeof(e=d.wn(e,B.defaults(),["automatic"])).guess_ids&&(e.guess_ids=e.automatic),(0,o.A)(I,this,g(e))}async ready(){let{guess_ids:e,species:t,gene_id_column:n,gene_id_type:s,top_markers:i}=(0,l.A)(I,this);"undefined"==typeof e&&(e=parameters.automatic),await(0,l.A)(W,this).buildCollections((0,l.A)(z,this),e,t,n,s,()=>(0,l.A)(S,this),()=>(0,a.A)(j,this,T).call(this)),(0,o.A)(z,this,(0,l.A)(I,this))}fetchCollectionDetails(){return(0,l.A)(W,this).fetchCollectionDetails()}fetchSetDetails(){return(0,l.A)(W,this).fetchSetDetails()}fetchUniverseSize(){return(0,l.A)(W,this).fetchUniverseSize()}computeEnrichment(e,t,n,s){return(0,l.A)(W,this).computeEnrichment(t,n,s,e,(0,l.A)(z,this).top_markers)}fetchFeatureSetIndices(e){return(0,l.A)(W,this).fetchFeatureSetIndices(e)}fetchParameters(){return b((0,l.A)(I,this))}computePerCellScores(e){if(null==(0,l.A)(O,this))throw new Error("no normalized matrix supplied in constructor");let t=(0,l.A)(W,this).computePerCellScores(e,(0,l.A)(O,this),(0,l.A)(M,this));if(null!==(0,l.A)(R,this)){let e=new Float64Array(t.scores.length);e.fill(Number.NaN),(0,l.A)(R,this).forEach((n,s)=>{e[n]=t.scores[s]}),t.scores=e}return t}}function T(){return null==(0,l.A)(P,this)&&(0,o.A)(P,this,d.RA((0,l.A)(S,this))),(0,l.A)(P,this)}},6873:(e,t,n)=>{n.d(t,{K:()=>o});var s=n(3619),i=n(545),r=n(507),a=n(5361),l=n(9215);async function o(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},h=!0;"DataFrame_readNested"in o&&(h=o.DataFrame_readNested);let u=!0;"DataFrame_toTypedArray"in o&&(u=o.DataFrame_toTypedArray);let c=await n.h5open((0,a.uJ)(e,"basic_columns.h5")),d=[c];try{let t=c.open("data_frame");d.push(t);let f=t.open("data");d.push(f);let m=t.open("column_names");d.push(m);let A=Number(t.readAttribute("row-count").values[0]),p=m.values();m.close(),d.pop();let w={},_=!1,v=f.children();for(const[l,c]of Object.entries(p)){let t=String(l);if(v.indexOf(t)<0){if(!1!==h){let s=(0,a.uJ)(e,"other_columns",t),i=await(0,r._i)(s,n);w[c]=!0===h?await(0,r.Ag)(s,i,n,o):await h(A,s,i,n,o)}else _=!0;continue}let m=f.open(t);if(d.push(m),m instanceof i.m){let t,n,i=m.values(),r=m.readAttribute("type").values[0],a=m.attributes().indexOf("missing-value-placeholder")>=0;if(a&&(n=m.readAttribute("missing-value-placeholder").values[0]),"number"==r)if(a||!u){if(t=Array.from(i),Number.isNaN(n))for(let e=0;e<t.length;e++)Number.isNaN(t[e])&&(t[e]=null);else for(let e=0;e<t.length;e++)t[e]==n&&(t[e]=null);t=new s.eg(t)}else t=new Float64Array(i);else if("boolean"==r){if(t=new Array(i.length),a)for(let e=0;e<i.length;e++)i[e]==n?t[e]=null:t[e]=0!=i[e];else for(let e=0;e<i.length;e++)t[e]=0!=i[e];t=new s.pz(t)}else if("integer"==r)if(a||!u){t=Array.from(i);for(let e=0;e<t.length;e++)t[e]==n&&(t[e]=null);t=new s.Bm(t)}else t=new Int32Array(i);else{if("string"!=r)throw new Error("unknown type '"+r+"' in column '"+c+"' of a DataFrame at '"+e+"'");if(t=i.slice(),a)for(let e=0;e<t.length;e++)t[e]==n&&(t[e]=null);t=new s.a4(t)}w[c]=t}else{if(!(m instanceof i.d))throw new Error("unknown type for column '"+c+"' at path '"+e+"'");{let t=m.readAttribute("type").values[0];if("factor"==t){let e=m.open("levels");d.push(e);let t=e.values();e.close(),d.pop();let n=m.open("codes");d.push(n);let i=n.values(),r=n.attributes(),a=Array(i.length);if(r.indexOf("missing-value-placeholder")>=0){let e=n.readAttribute("missing-value-placeholder").values[0];for(let n=0;n<i.length;n++)i[n]==e?a[n]=null:a[n]=t[i[n]]}else for(let s=0;s<i.length;s++)a[s]=t[i[s]];w[c]=new s.a4(a),n.close(),d.pop()}else{if("vls"!=t)throw new Error("unknown type '"+t+"' in column '"+c+"' of a DataFrame at '"+e+"'");{let e=m.open("heap");d.push(e);let t=e.values();e.close(),d.pop();let n=m.open("pointers");d.push(n);let i=n.values(),r=n.attributes(),a=new Array(i.length),l=new TextDecoder;for(let s=0;s<i.length;s++){const{offset:e,length:n}=i[s];let r=t.slice(Number(e),Number(e+n)),o=r.indexOf(0);o>=0&&(r=r.slice(0,o)),a[s]=l.decode(r)}if(r.indexOf("missing-value-placeholder")>=0){let e=n.readAttribute("missing-value-placeholder").values[0];for(let t=0;t<a.length;t++)a[t]==e&&(a[t]=null)}w[c]=new s.a4(a),n.close(),d.pop()}}}}m.close(),d.pop()}let y=null;if(t.children().indexOf("row_names")>=0){let e=t.open("row_names");d.push(e),y=e.values(),e.close(),d.pop()}if(_){let e=[];for(const t of p)t in w&&e.push(t);p=e}let g=await(0,l.m)((0,a.uJ)(e,"other_annotations"),n,o,"DataFrame_readMetadata");return new s.CP(w,{columnOrder:p,numberOfRows:A,rowNames:y,metadata:g})}finally{for(const e of d.toReversed())e.close();await n.h5close(c)}}},6919:(e,t,n)=>{var s=n(9165);n(3619);s._A.prototype._bioconductor_LENGTH=function(){return this.length},s.Os.prototype._bioconductor_LENGTH=function(){return this.length},s.WI.prototype._bioconductor_LENGTH=function(){return this.length}},7001:(e,t,n)=>{n.d(t,{Q:()=>s});n(2152),n(2777);function s(e){var t=new Map;for(const s of e)for(const e of s){let n=t.get(e);"undefined"==typeof n?t.set(e,1):t.set(e,n+1)}let n=[];for(const[s,i]of t){let e={id:Number(s),count:i};n.push(e)}return n}},7212:(e,t,n)=>{n(141),n(9830)},7265:(e,t,n)=>{n.d(t,{d:()=>z,o:()=>Y});var s=n(9379),i=n(9790),r=n(5149),a=n(6562),l=n(4558),o=n(8458),h=n(7990),u=n(3619),c=n(6164),d=(n(6774),n(4736));function f(e){let t,n,s=e.findAttribute("names");if(s<0)return null;try{t=e.attribute(s),n=t.values()}catch(i){throw new Error("failed to load listData names; "+i.message)}finally{h.t9(t)}if(n.length!=e.length())throw new Error("expected names to have same length as listData");return n}const m={DFrame:"S4Vectors"};function A(e){w(e,m,"DFrame");let t,n,s={},i=[];try{if(t=e.attribute("listData"),!(t instanceof h.G1))throw new Error("listData slot should be a generic list");if(i=f(t),null==i)throw new Error("expected the listData list to be named");for(var r=0;r<t.length();r++){let e;try{if(e=t.load(r),e instanceof h.pv&&!(e instanceof h.G1)){let t=e.values();if(e.findAttribute("class")>=0){let n,s;try{if(n=e.attribute("class"),n.values().indexOf("factor")>=0&&e.findAttribute("levels")>=0){s=e.attribute("levels");let n=t.slice();n.forEach((e,t)=>{n[t]=e-1}),t=u.$9(s.values(),n)}}finally{h.t9(n),h.t9(s)}}s[i[r]]=t}else e instanceof h.ac&&p(e,m)&&(s[i[r]]=A(e))}finally{h.t9(e)}}}catch(o){throw new Error("failed to retrieve data from DataFrame's listData; "+o.message)}finally{h.t9(t)}let a=null;try{n=e.attribute("rownames"),n instanceof h.Kn&&(a=n.values())}catch(o){throw new Error("failed to retrieve row names from DataFrame; "+o.message)}finally{h.t9(n)}let l=null;if(0==i.length&&null==a){let t;try{if(t=e.attribute("nrows"),!(t instanceof h.X7))throw new Error("expected an integer vector as the 'nrows' slot");let n=t.values();if(1!=n.length)throw new Error("expected an integer vector of length 1 as the 'nrows' slot");l=n[0]}catch(o){throw new Error("failed to retrieve nrows from DataFrame; "+o.message)}finally{h.t9(t)}}return new u.CP(s,{columnOrder:i,rowNames:a,numberOfRows:l})}function p(e,t){for(const[n,s]of Object.entries(t))if(e.className()==n&&e.packageName()==s)return!0;return!1}function w(e,t,n){if(!(e instanceof h.ac))throw new Error("expected an S4 object as the data frame");if(!p(e,t))throw new Error("object is not a "+n+" or one of its recognized subclasses")}function _(e){let t,n=e.findAttribute("NAMES");if(n<0)return null;let s=null;try{t=e.attribute(n),t instanceof h.Kn&&(s=t.values())}catch(i){throw new Error("failed to extract NAMES; "+i.message)}finally{h.t9(t)}return s}function v(e){let t,n=null,s=e.findAttribute("rowRanges");if(s<0){let s;try{s=e.attribute("elementMetadata"),t=A(s)}catch(i){throw new Error("failed to extract features from the rowData; "+i.message)}finally{h.t9(s)}n=_(e)}else{let r;try{r=e.attribute(s);let a=r.attribute("elementMetadata");try{t=A(a)}catch(i){throw new Error("failed to extract mcols from the rowRanges; "+i.message)}finally{h.t9(a)}let l=r.findAttribute("partitioning");if(l<0){let e;try{e=r.attribute("ranges"),n=_(e)}catch(i){throw new Error("failed to extract names from the rowRanges; "+i.message)}finally{h.t9(e)}}else{let e;try{e=r.attribute(l),n=_(e)}catch(i){throw new Error("failed to extract names from the rowRanges; "+i.message)}finally{h.t9(e)}}}catch(i){throw new Error("failed to extract features from the rowRanges; "+i.message)}finally{h.t9(r)}}return null!==n&&t.$setRowNames(n),t}function y(e){let t,n,s,i;try{n=e.attribute("assays"),s=n.attribute("data"),i=s.attribute("listData"),t=f(i),null==t&&(t=new Array(i.length()),t.fill(""))}catch(r){throw new Error("failed to extract assay data; "+r.message)}finally{h.t9(n),h.t9(i),h.t9(s)}return t}function g(e,t,n){let s,i,r,a;try{i=e.attribute("assays"),r=i.attribute("data"),a=r.attribute("listData");let u,c=null;if("string"==typeof t){let e=f(a);if(null!==t&&null!=e)for(var l=0;l<e.length;l++)if(e[l]==t){c=l;break}if(null==c)throw new Error("no assay named '"+t+"'")}else{if(t>=a.length())throw new Error("assay index "+String(t)+" out of range");c=t}try{u=a.load(c),s=h.LX(u,{forceInteger:n})}catch(o){throw new Error("failed to initialize sparse matrix from assay; "+o.message)}finally{h.t9(u)}}catch(o){throw new Error("failed to extract assay data; "+o.message)}finally{h.t9(i),h.t9(a),h.t9(r)}return s}function b(e){let t,n,s;try{let i=e.findAttribute("int_metadata");if(i<0)return"";t=e.attribute(i);let r=t.findAttribute("names");if(r<0)return"";n=t.attribute(r);let a=n.values().indexOf("mainExpName");if(a<0)return"";s=t.load(a);let l=s.values();return 1!=l.length||"string"!==typeof l[0]?"":l[0]}finally{h.t9(t),h.t9(n),h.t9(s)}}function x(e){let t,n,s,i,r,a,l={handles:{},order:[]},o=e.findAttribute("int_colData");if(o<0)return l;try{t=e.attribute(o);let d=t.findAttribute("listData");if(d<0)return l;n=t.attribute(d);let f=n.findAttribute("names");if(f<0)return l;s=n.attribute(f);let m=s.values().indexOf("altExps");if(m<0)return l;i=n.load(m);let A=i.findAttribute("listData");if(A<0)return l;r=i.attribute(A);let p=r.findAttribute("names");if(p<0)return l;a=r.attribute(p);let w=a.values();for(var u=0;u<w.length;u++){let e;try{e=r.load(u);let t=e.attribute("se");l.handles[w[u]]=t,l.order.push(w[u]),E(t)}catch(c){throw new Error("failed to load alternative Experiment '"+w[u]+"'; "+c.message)}finally{h.t9(e)}}}catch(c){for(const e of Object.values(l.handles))h.t9(e);throw c}finally{h.t9(a),h.t9(r),h.t9(s),h.t9(n),h.t9(t)}return l}function E(e){w(e,{SummarizedExperiment:"SummarizedExperiment",RangedSummarizedExperiment:"SummarizedExperiment",SingleCellExperiment:"SingleCellExperiment",SpatialExperiment:"SpatialExperiment"},"SummarizedExperiment")}var k=new WeakMap,N=new WeakMap,C=new WeakMap,D=new WeakMap,S=new WeakMap,P=new WeakMap,O=new WeakMap,M=new WeakMap,R=new WeakMap,I=new WeakSet;class z{constructor(e){(0,i.A)(this,I),(0,r.A)(this,k,void 0),(0,r.A)(this,N,void 0),(0,r.A)(this,C,void 0),(0,r.A)(this,D,void 0),(0,r.A)(this,S,void 0),(0,r.A)(this,P,void 0),(0,r.A)(this,O,void 0),(0,r.A)(this,M,void 0),(0,r.A)(this,R,void 0),e instanceof c.V?(0,l.A)(k,this,e):(0,l.A)(k,this,new c.V(e)),(0,l.A)(R,this,z.defaults()),this.clear()}static defaults(){return{rnaCountAssay:0,adtCountAssay:0,crisprCountAssay:0,rnaExperiment:"Gene Expression",adtExperiment:"Antibody Capture",crisprExperiment:"CRISPR Guide Capture",primaryRnaFeatureIdColumn:null,primaryAdtFeatureIdColumn:null,primaryCrisprFeatureIdColumn:null}}options(){return(0,s.A)({},(0,o.A)(R,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,o.A)(R,this)[t]=n}clear(){if(h.t9((0,o.A)(C,this)),"undefined"!=typeof(0,o.A)(S,this)&&null!==(0,o.A)(S,this))for(const e of Object.values((0,o.A)(S,this)))h.t9(e);h.t9((0,o.A)(N,this)),(0,l.A)(C,this,null),(0,l.A)(S,this,null),(0,l.A)(N,this,null),(0,l.A)(O,this,null),(0,l.A)(M,this,null)}static format(){return"SummarizedExperiment"}abbreviate(){return(0,a.A)(I,this,W).call(this,e=>({name:e.name(),size:e.size()}))}summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(I,this,j).call(this),(0,a.A)(I,this,B).call(this),(0,a.A)(I,this,T).call(this);let t={};t[(0,o.A)(D,this)]=y((0,o.A)(C,this));for(const[i,r]of Object.entries((0,o.A)(S,this)))if(!(i in t))try{t[i]=y(r)}catch(s){console.warn("failed to extract features for alternative Experiment '"+i+"'; "+s.message)}let n={modality_features:(0,o.A)(O,this),cells:(0,o.A)(M,this),modality_assay_names:t};return e||this.clear(),n}previewPrimaryIds(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(I,this,B).call(this);let t={RNA:(0,o.A)(R,this).rnaExperiment,ADT:(0,o.A)(R,this).adtExperiment,CRISPR:(0,o.A)(R,this).crisprExperiment},n=d.q((0,o.A)(O,this),(0,o.A)(P,this),t,(0,a.A)(I,this,F).call(this));return e||this.clear(),n}load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(I,this,j).call(this),(0,a.A)(I,this,B).call(this),(0,a.A)(I,this,T).call(this);let t={matrix:new h.P_,features:{},cells:(0,o.A)(M,this)},n={RNA:{exp:(0,o.A)(R,this).rnaExperiment,assay:(0,o.A)(R,this).rnaCountAssay},ADT:{exp:(0,o.A)(R,this).adtExperiment,assay:(0,o.A)(R,this).adtCountAssay},CRISPR:{exp:(0,o.A)(R,this).crisprExperiment,assay:(0,o.A)(R,this).crisprCountAssay}};try{for(const[e,s]of Object.entries(n)){if(null===s.exp)continue;let n;if(s.exp===(0,o.A)(D,this))n=(0,o.A)(C,this);else{if(!(s.exp in(0,o.A)(S,this)))continue;n=(0,o.A)(S,this)[s.exp]}let i=g(n,s.assay,!0);t.matrix.add(e,i),t.features[e]=(0,o.A)(O,this)[s.exp]}t.primary_ids=d.gu(t.features,(0,a.A)(I,this,F).call(this))}catch(s){throw h.t9(t.matrix),s}return e||this.clear(),t}serialize(){return(0,a.A)(I,this,W).call(this,e=>e)}static async unserialize(e,t){if(1!=e.length||"rds"!=e[0].type)throw new Error("expected exactly one file of type 'rds' for SummarizedExperiment unserialization");let n=new z(e[0].file);return n.setOptions(t),n}}function W(e){return{files:[{type:"rds",file:e((0,o.A)(k,this))}],options:this.options()}}function j(){if(null===(0,o.A)(N,this)){(0,l.A)(N,this,h.vD((0,o.A)(k,this).content())),(0,l.A)(C,this,(0,o.A)(N,this).value());try{E((0,o.A)(C,this));const{handles:e,order:t}=x((0,o.A)(C,this));(0,l.A)(S,this,e),(0,l.A)(P,this,t),(0,l.A)(D,this,b((0,o.A)(C,this)))}catch(e){throw(0,o.A)(C,this).free(),(0,o.A)(N,this).free(),e}}}function B(){if(null===(0,o.A)(O,this)){(0,a.A)(I,this,j).call(this),(0,l.A)(O,this,{}),(0,o.A)(O,this)[(0,o.A)(D,this)]=v((0,o.A)(C,this));for(const[t,n]of Object.entries((0,o.A)(S,this)))if(!(t in(0,o.A)(O,this)))try{(0,o.A)(O,this)[t]=v(n)}catch(e){console.warn("failed to extract features for alternative Experiment '"+t+"'; "+e.message)}}}function T(){if(null!==(0,o.A)(M,this))return;(0,a.A)(I,this,j).call(this);let e=(0,o.A)(C,this).attribute("colData");try{(0,l.A)(M,this,A(e))}catch(t){throw new Error("failed to extract colData from a SummarizedExperiment; "+t.message)}finally{h.t9(e)}}function F(){return{RNA:(0,o.A)(R,this).primaryRnaFeatureIdColumn,ADT:(0,o.A)(R,this).primaryAdtFeatureIdColumn,CRISPR:(0,o.A)(R,this).primaryCrisprFeatureIdColumn}}var J=new WeakMap,L=new WeakMap,V=new WeakMap,U=new WeakMap,$=new WeakMap,H=new WeakMap,G=new WeakMap,K=new WeakMap,q=new WeakMap,Z=new WeakMap,X=new WeakMap,Q=new WeakSet;class Y{constructor(e){(0,i.A)(this,Q),(0,r.A)(this,J,void 0),(0,r.A)(this,L,void 0),(0,r.A)(this,V,void 0),(0,r.A)(this,U,void 0),(0,r.A)(this,$,void 0),(0,r.A)(this,H,void 0),(0,r.A)(this,G,void 0),(0,r.A)(this,K,void 0),(0,r.A)(this,q,void 0),(0,r.A)(this,Z,void 0),(0,r.A)(this,X,void 0),e instanceof c.V?(0,l.A)(J,this,e):(0,l.A)(J,this,new c.V(e)),(0,l.A)(X,this,Y.defaults()),this.clear()}static defaults(){return{primaryAssay:0,isPrimaryNormalized:!0,reducedDimensionNames:null}}options(){return(0,s.A)({},(0,o.A)(X,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,o.A)(X,this)[t]=u.UC(n)}clear(){if(h.t9((0,o.A)(V,this)),"undefined"!=typeof(0,o.A)($,this)&&null!==(0,o.A)($,this))for(const e of Object.values((0,o.A)($,this)))h.t9(e);if("undefined"!=typeof(0,o.A)(q,this)&&null!==(0,o.A)(q,this))for(const e of Object.values((0,o.A)(q,this)))h.t9(e.handle);h.t9((0,o.A)(L,this)),(0,l.A)(V,this,null),(0,l.A)($,this,null),(0,l.A)(L,this,null),(0,l.A)(G,this,null),(0,l.A)(K,this,null)}summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(Q,this,ee).call(this),(0,a.A)(Q,this,te).call(this),(0,a.A)(Q,this,ne).call(this);let t={};t[(0,o.A)(U,this)]=y((0,o.A)(V,this));for(const[i,r]of Object.entries((0,o.A)($,this)))if(!(i in t))try{t[i]=y(r)}catch(s){console.warn("failed to extract features for alternative Experiment '"+i+"'; "+s.message)}let n={modality_features:(0,o.A)(G,this),cells:(0,o.A)(K,this),modality_assay_names:t,reduced_dimension_names:(0,o.A)(Z,this)};return e||this.clear(),n}load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(Q,this,ee).call(this),(0,a.A)(Q,this,te).call(this),(0,a.A)(Q,this,ne).call(this);let t={matrix:new h.P_,features:{},cells:(0,o.A)(K,this),reduced_dimensions:{}},n=(0,o.A)(X,this).reducedDimensionNames;null==n&&(n=(0,o.A)(Z,this));for(const r of n){let e=(0,o.A)(q,this)[r],n=[],i=e.dimensions,a=e.handle.values();for(var s=0;s<i[1];s++)n.push(a.slice(s*i[0],(s+1)*i[0]));t.reduced_dimensions[r]=n}try{for(const[e,n]of Object.entries((0,o.A)(G,this))){let n=(0,o.A)(X,this).primaryAssay;if("object"==typeof n){if(!(e in n))continue;n=n[e]}let s,i=(0,o.A)(X,this).isPrimaryNormalized;"object"==typeof i&&(i=!(e in i)||i[e]),s=e===(0,o.A)(U,this)?(0,o.A)(V,this):(0,o.A)($,this)[e];let r=g(s,n,!i);if(t.matrix.add(e,r),!i){let n=h.mM(r,{allowZeros:!0});t.matrix.add(e,n)}t.features[e]=(0,o.A)(G,this)[e]}}catch(i){throw h.t9(t.matrix),i}return e||this.clear(),t}}function ee(){if(null===(0,o.A)(L,this)){(0,l.A)(L,this,h.vD((0,o.A)(J,this).content())),(0,l.A)(V,this,(0,o.A)(L,this).value());try{E((0,o.A)(V,this));{const{handles:e,order:t}=x((0,o.A)(V,this));(0,l.A)($,this,e),(0,l.A)(H,this,t),(0,l.A)(U,this,b((0,o.A)(V,this)))}{const{handles:e,order:t}=function(e){let t,n,s,i,r,a,l={handles:{},order:[]},o=e.findAttribute("int_colData");if(o<0)return l;try{t=e.attribute(o);let d=t.findAttribute("listData");if(d<0)return l;n=t.attribute(d);let f=n.findAttribute("names");if(f<0)return l;s=n.attribute(f);let m=s.values().indexOf("reducedDims");if(m<0)return l;i=n.load(m);let A=i.findAttribute("listData");if(A<0)return l;r=i.attribute(A);let p=r.findAttribute("names");if(p<0)return l;a=r.attribute(p);let w=a.values();for(var u=0;u<w.length;u++){let e;try{e=r.load(u);let t=!1;if("double"==e.type()&&e.findAttribute("dim")>=0){let n=e.attribute("dim");2==n.length()&&(l.handles[w[u]]={handle:e,dimensions:n.values()},l.order.push(w[u]),t=!0)}t||h.t9(e)}catch(c){throw new Error("failed to load reduced dimension '"+w[u]+"'; "+c.message)}}}catch(c){for(const e of Object.values(l.handles))h.t9(e.handle);throw c}finally{h.t9(a),h.t9(r),h.t9(s),h.t9(n),h.t9(t)}return l}((0,o.A)(V,this));(0,l.A)(q,this,e),(0,l.A)(Z,this,t)}}catch(e){throw(0,o.A)(V,this).free(),(0,o.A)(L,this).free(),e}}}function te(){if(null===(0,o.A)(G,this)){(0,a.A)(Q,this,ee).call(this),(0,l.A)(G,this,{}),(0,o.A)(G,this)[(0,o.A)(U,this)]=v((0,o.A)(V,this));for(const[t,n]of Object.entries((0,o.A)($,this)))if(!(t in(0,o.A)(G,this)))try{(0,o.A)(G,this)[t]=v(n)}catch(e){console.warn("failed to extract features for alternative Experiment '"+t+"'; "+e.message)}}}function ne(){if(null!==(0,o.A)(K,this))return;(0,a.A)(Q,this,ee).call(this);let e=(0,o.A)(V,this).attribute("colData");try{(0,l.A)(K,this,A(e))}catch(t){throw new Error("failed to extract colData from a SummarizedExperiment; "+t.message)}finally{h.t9(e)}}},7633:(e,t,n)=>{n.d(t,{J9:()=>m});n(9790),n(6562);var s=n(5149),i=n(8458),r=n(4558),a=n(6159),l=n(1576),o=n(2779),h=n(6164),u=new WeakMap,c=new WeakMap,d=new WeakMap;class f{constructor(e,t,n){(0,s.A)(this,u,void 0),(0,s.A)(this,c,void 0),(0,s.A)(this,d,void 0),(0,r.A)(u,this,e),(0,r.A)(c,this,null),(0,r.A)(d,this,n)}async get(e,t){return null==(0,i.A)(c,this)&&(0,r.A)(c,this,await a.loadAsync((0,i.A)(u,this).buffer())),(0,i.A)(c,this).file(l.uJ((0,i.A)(d,this),e)).async("uint8array")}exists(e){return null!==(0,i.A)(c,this).file(l.uJ((0,i.A)(d,this),e))}clean(e){}}o.s;class m extends o.Z{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=null;"existingHandle"in n?(s=n.existingHandle,delete n.existingHandle):t instanceof h.V||(t=new h.V(t)),super(new f(t,s,e))}}},7709:(e,t,n)=>{n(6554),n(4678),n(3021),n(3046),n(1989),n(1576),n(9165)},7961:(e,t,n)=>{n.d(t,{u:()=>l});var s=n(3619),i=n(507),r=n(4717),a=n(5361);async function l(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=await(0,r.I)(e,t,n,l),h=new s.ky(o.assays(),{assayOrder:o.assayNames(),rowRanges:o.rowRanges(),rowData:o.rowData(),columnData:o.columnData(),rowNames:o.rowNames(),columnNames:o.columnNames(),metadata:o.metadata()});"main_experiment_name"in t.single_cell_experiment&&h.setMainExperimentName(t.single_cell_experiment.main_experiment_name,{inPlace:!0});let u=!0;if("SingleCellExperiment_readReducedDimension"in l&&(u=l.SingleCellExperiment_readReducedDimension),!1!==u){const t=(0,a.uJ)(e,"reduced_dimensions/names.json");if(await n.exists(t)){let s=await n.get(t,{asBuffer:!0});const r=new TextDecoder,o=JSON.parse(r.decode(s));for(const[t,c]of Object.entries(o)){let s,r=(0,a.uJ)(e,"reduced_dimensions",String(t)),o=await(0,i._i)(r,n);s=!0===u?await(0,i.Ag)(r,o,n,l):await u(h.numberOfColumns(),r,o,n,l),h.setReducedDimension(c,s,{inPlace:!0})}}}let c=!0;if("SingleCellExperiment_readAlternativeExperiment"in l&&(c=l.SingleCellExperiment_readAlternativeExperiment),!1!==c){const t=(0,a.uJ)(e,"alternative_experiments/names.json");if(await n.exists(t)){let s=await n.get(t,{asBuffer:!0});const r=new TextDecoder,o=JSON.parse(r.decode(s));for(const[t,u]of Object.entries(o)){let s,r=(0,a.uJ)(e,"alternative_experiments",String(t)),o=await(0,i._i)(r,n);s=!0===c?await(0,i.Ag)(r,o,n,l):await c(h.numberOfColumns(),r,o,n,l),h.setAlternativeExperiment(u,s,{inPlace:!0})}}}return h}},7967:(e,t,n)=>{n.d(t,{F:()=>S,U:()=>G});var s=n(9379),i=n(9790),r=n(5149),a=n(6562),l=n(4558),o=n(8458),h=n(7990),u=n(3619),c=n(6774),d=n(4736),f=n(6164);function m(e){if(e instanceof h.m9)return{rows:e.shape[0],columns:e.shape[1],sparse:!1};if(e instanceof h.dm){let t=e.readAttribute("shape"),n=e.readAttribute("encoding-type");return{rows:t.values[1],columns:t.values[0],sparse:!0,csc:"csr_matrix"==n.values[0]}}throw new Error("unknown type for a H5AD assay matrix")}function A(e,t){let n=[],s={};if("X"in e.children&&(n.push("X"),s.X=m(e.open("X"))),"layers"in e.children){let t=e.open("layers");if(!(t instanceof h.dm))throw new Error("expected a 'layers' group in a H5AD file");for(const e of Object.keys(t.children)){const i="layers/"+e;n.push(i),s[i]=m(t.open(e))}}if(0==n.length)throw new Error("failed to find any assay in the H5AD file");let i=s[n[0]];return{names:n,rows:i.rows,columns:i.columns,details:s}}function p(e){let t={};for(const[n,s]of Object.entries(e.children))if("DataSet"==s){let s=e.open(n,{load:!0});if("Enum"===s.type){let e=s.values,i=new Array(e.length),r=s.levels;e.forEach((e,t)=>{i[t]=r[e]}),t[n]=i}else"Other"!==s.type&&(t[n]=s.values)}else if("Group"==s){let s=e.open(n);if("categories"in s.children&&"codes"in s.children){let e=c.Fr(s,"categories"),i=s.open("codes",{load:!0}).values;t[n]=u.$9(e,i)}}if("__categories"in e.children&&"Group"==e.children.__categories){let n=e.open("__categories");for(const[e,s]of Object.entries(n.children))if(e in t){let s=c.Fr(n,e);if(!s){console.warn("ignoring invalid levels for nominally categorical key '".concat(e,"' in the H5AD reader"));continue}t[e]=u.$9(s,t[e])}}if(0==Object.keys(t).length)return null;{let e=null;return"_index"in t&&(e=t._index,delete t._index),new u.CP(t,{rowNames:e})}}function w(e){if("var"in e.children&&"Group"==e.children.var){return p(e.open("var"))}return null}function _(e){if("obs"in e.children&&"Group"==e.children.obs){return p(e.open("obs"))}return null}function v(e,t,n,s){return n.sparse?h.KR(e,t,n.rows,n.columns,!n.csc,s):h.vT(e,t,s)}var y=new WeakMap,g=new WeakMap,b=new WeakMap,x=new WeakMap,E=new WeakMap,k=new WeakMap,N=new WeakMap,C=new WeakMap,D=new WeakSet;class S{constructor(e){(0,i.A)(this,D),(0,r.A)(this,y,void 0),(0,r.A)(this,g,void 0),(0,r.A)(this,b,void 0),(0,r.A)(this,x,void 0),(0,r.A)(this,E,void 0),(0,r.A)(this,k,void 0),(0,r.A)(this,N,void 0),(0,r.A)(this,C,void 0),e instanceof f.V?(0,l.A)(y,this,e):(0,l.A)(y,this,new f.V(e)),(0,l.A)(C,this,S.defaults()),this.clear()}static defaults(){return{countMatrixName:null,featureTypeColumnName:null,featureTypeRnaName:"Gene Expression",featureTypeAdtName:"Antibody Capture",featureTypeCrisprName:"CRISPR Guide Capture",primaryRnaFeatureIdColumn:null,primaryAdtFeatureIdColumn:null,primaryCrisprFeatureIdColumn:null}}options(){return(0,s.A)({},(0,o.A)(C,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,o.A)(C,this)[t]=n}clear(){"function"==typeof(0,o.A)(b,this)&&(0,o.A)(b,this).call(this),(0,l.A)(b,this,null),(0,l.A)(g,this,null),(0,l.A)(x,this,null),(0,l.A)(E,this,null),(0,l.A)(k,this,null),(0,l.A)(N,this,null)}static format(){return"H5AD"}abbreviate(){return(0,a.A)(D,this,P).call(this,e=>({name:e.name(),size:e.size()}))}summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(D,this,R).call(this),(0,a.A)(D,this,I).call(this),(0,a.A)(D,this,M).call(this);let t={all_features:(0,o.A)(E,this),cells:(0,o.A)(k,this),all_assay_names:(0,o.A)(N,this).names};return e||this.clear(),t}previewPrimaryIds(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(D,this,R).call(this);let t=d.eZ((0,o.A)(E,this),(0,o.A)(C,this).featureTypeColumnName,(0,a.A)(D,this,z).call(this),"RNA",(0,a.A)(D,this,W).call(this));return e||this.clear(),t}load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(D,this,R).call(this),(0,a.A)(D,this,I).call(this),(0,a.A)(D,this,M).call(this);let t=(0,o.A)(C,this).countMatrixName;null==t&&(t=(0,o.A)(N,this).names[0]);let n=v((0,o.A)(g,this),t,(0,o.A)(N,this).details[t],{forceInteger:!0,layered:!0}),s=d.nu(n,(0,o.A)(E,this),(0,o.A)(C,this).featureTypeColumnName,(0,a.A)(D,this,z).call(this),"RNA");return s.cells=(0,o.A)(k,this),s.primary_ids=d.gu(s.features,(0,a.A)(D,this,W).call(this)),e||this.clear(),s}serialize(){return(0,a.A)(D,this,P).call(this,e=>e)}static async unserialize(e,t){if(1!=e.length||"h5"!=e[0].type)throw new Error("expected exactly one file of type 'h5' for H5AD unserialization");let n=new S(e[0].file);return n.setOptions(t),n}}function P(e){return{files:[{type:"h5",file:e((0,o.A)(y,this))}],options:this.options()}}function O(){if(null!=(0,o.A)(g,this))return;let e=h.He((0,o.A)(y,this).content());(0,l.A)(g,this,e.path),(0,l.A)(b,this,e.flush),(0,l.A)(x,this,new h.CE((0,o.A)(g,this)))}function M(){null===(0,o.A)(N,this)&&((0,a.A)(D,this,O).call(this),(0,l.A)(N,this,A((0,o.A)(x,this),(0,o.A)(g,this))))}function R(){if(null!==(0,o.A)(E,this))return;(0,a.A)(D,this,O).call(this);let e=w((0,o.A)(x,this));null==e&&((0,a.A)(D,this,M).call(this),e=new u.CP({},{numberOfRows:(0,o.A)(N,this).rows})),(0,l.A)(E,this,e)}function I(){if(null!==(0,o.A)(k,this))return;(0,a.A)(D,this,O).call(this);let e=_((0,o.A)(x,this));null===e&&((0,a.A)(D,this,M).call(this),e=new u.CP({},{numberOfRows:(0,o.A)(N,this).columns})),(0,l.A)(k,this,e)}function z(){return{RNA:(0,o.A)(C,this).featureTypeRnaName,ADT:(0,o.A)(C,this).featureTypeAdtName,CRISPR:(0,o.A)(C,this).featureTypeCrisprName}}function W(){return{RNA:(0,o.A)(C,this).primaryRnaFeatureIdColumn,ADT:(0,o.A)(C,this).primaryAdtFeatureIdColumn,CRISPR:(0,o.A)(C,this).primaryCrisprFeatureIdColumn}}var j=new WeakMap,B=new WeakMap,T=new WeakMap,F=new WeakMap,J=new WeakMap,L=new WeakMap,V=new WeakMap,U=new WeakMap,$=new WeakMap,H=new WeakSet;class G{constructor(e){(0,i.A)(this,H),(0,r.A)(this,j,void 0),(0,r.A)(this,B,void 0),(0,r.A)(this,T,void 0),(0,r.A)(this,F,void 0),(0,r.A)(this,J,void 0),(0,r.A)(this,L,void 0),(0,r.A)(this,V,void 0),(0,r.A)(this,U,void 0),(0,r.A)(this,$,void 0),e instanceof f.V?(0,l.A)(j,this,e):(0,l.A)(j,this,new f.V(e)),(0,l.A)($,this,G.defaults()),this.clear()}static defaults(){return{primaryMatrixName:null,isPrimaryNormalized:!0,featureTypeColumnName:null,reducedDimensionNames:null}}options(){return(0,s.A)({},(0,o.A)($,this))}setOptions(e){for(const[t,n]of Object.entries(e))(0,o.A)($,this)[t]="reducedDimensionNames"==t?u.UC(n):n}clear(){"function"==typeof(0,o.A)(T,this)&&(0,o.A)(T,this).call(this),(0,l.A)(T,this,null),(0,l.A)(B,this,null),(0,l.A)(F,this,null),(0,l.A)(J,this,null),(0,l.A)(L,this,null),(0,l.A)(V,this,null),(0,l.A)(U,this,null)}summary(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(H,this,Z).call(this),(0,a.A)(H,this,X).call(this),(0,a.A)(H,this,q).call(this),(0,a.A)(H,this,Q).call(this);let t={all_features:(0,o.A)(J,this),cells:(0,o.A)(L,this),all_assay_names:(0,o.A)(V,this).names,reduced_dimension_names:(0,o.A)(U,this).names};return e||this.clear(),t}load(){let{cache:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.A)(H,this,Z).call(this),(0,a.A)(H,this,X).call(this),(0,a.A)(H,this,q).call(this),(0,a.A)(H,this,Q).call(this);let t=(0,o.A)($,this).primaryMatrixName;null==t&&(t=(0,o.A)(V,this).names[0]);let n=v((0,o.A)(B,this),t,(0,o.A)(V,this).details[t],{forceInteger:!(0,o.A)($,this).isPrimaryNormalized}),s=d.nu(n,(0,o.A)(J,this),(0,o.A)($,this).featureTypeColumnName,null,"");if(s.cells=(0,o.A)(L,this),!(0,o.A)($,this).isPrimaryNormalized)for(const a of s.matrix.available()){let e=s.matrix.get(a);s.matrix.add(a,h.mM(e,{allowZeros:!0}))}let i=(0,o.A)($,this).reducedDimensionNames;null==i&&(i=(0,o.A)(U,this).names);let r={};if(i.length){let e=(0,o.A)(F,this).open("obsm");for(const t of i){let n=e.open(t,{load:!0}),s=n.shape,i=s[0],a=s[1],o=h.hg(i,a,n.values,{columnMajor:!1}),u=[];for(var l=0;l<a;l++){let e=l*i;u.push(o.slice(e,e+i))}r[t]=u}}return s.reduced_dimensions=r,e||this.clear(),s}}function K(){if(null!=(0,o.A)(B,this))return;let e=h.He((0,o.A)(j,this).content());(0,l.A)(B,this,e.path),(0,l.A)(T,this,e.flush),(0,l.A)(F,this,new h.CE((0,o.A)(B,this)))}function q(){null===(0,o.A)(V,this)&&((0,a.A)(H,this,K).call(this),(0,l.A)(V,this,A((0,o.A)(F,this),(0,o.A)(B,this))))}function Z(){if(null!==(0,o.A)(J,this))return;(0,a.A)(H,this,K).call(this);let e=w((0,o.A)(F,this));null==e&&((0,a.A)(H,this,q).call(this),e=new u.CP({},{numberOfRows:(0,o.A)(V,this).rows})),(0,l.A)(J,this,e)}function X(){if(null!==(0,o.A)(L,this))return;(0,a.A)(H,this,K).call(this);let e=_((0,o.A)(F,this));null===e&&((0,a.A)(H,this,q).call(this),e=new u.CP({},{numberOfRows:(0,o.A)(V,this).columns})),(0,l.A)(L,this,e)}function Q(){if(null!==(0,o.A)(U,this))return;(0,a.A)(H,this,K).call(this);let e=[];if("obsm"in(0,o.A)(F,this).children&&"Group"==(0,o.A)(F,this).children.obsm){let t=(0,o.A)(F,this).open("obsm");for(const[n,s]of Object.entries(t.children))"DataSet"==s&&e.push(n)}(0,l.A)(U,this,{names:e})}},7990:(e,t,n)=>{n.d(t,{$$:()=>w.$$,$Y:()=>a.$Y,$q:()=>S.$q,BB:()=>c.BB,CE:()=>c.CE,Cd:()=>j.Cd,Cx:()=>W.Cx,D0:()=>N.D,DA:()=>g.DA,D_:()=>f.W,G1:()=>h.G1,He:()=>L.H,Jp:()=>p.aN,K$:()=>m.K$,KB:()=>D.K,KR:()=>a.KR,K_:()=>g.K_,Kc:()=>_.K,Kn:()=>h.Kn,Kq:()=>W.Kq,LX:()=>l.L,Ls:()=>z.L,M2:()=>W.M2,M_:()=>o.M,O0:()=>O.O,OO:()=>y.O,Oi:()=>E.O,P_:()=>J.P,Qc:()=>T.Q,Qu:()=>F.Q,RJ:()=>b.RJ,RZ:()=>A.RZ,S$:()=>c.S$,So:()=>L.S,TA:()=>u.TA,Tv:()=>v.k,V0:()=>j.V0,VW:()=>m.VW,VZ:()=>r.VZ,Vn:()=>M.Vn,Wo:()=>m.Wo,X7:()=>h.X7,YA:()=>j.YA,YL:()=>x.YL,_b:()=>p._b,_r:()=>p._r,aI:()=>R.a,ac:()=>h.ac,dm:()=>c.dm,e2:()=>B.e,eg:()=>i.eg,f9:()=>C.f,fR:()=>a.fR,fh:()=>x.fh,hg:()=>V.h,jw:()=>S.jw,k:()=>A.k,k3:()=>i.k3,kT:()=>b.kT,kl:()=>i.kl,l6:()=>c.l6,m9:()=>c.m9,mM:()=>N.m,mg:()=>w.mg,nB:()=>k.n,nM:()=>u.nM,n_:()=>s.n_,pn:()=>o.p,pv:()=>h.pv,rS:()=>w.rS,rj:()=>P.rj,sU:()=>I.s,t9:()=>i.t9,tp:()=>j.tp,vD:()=>h.O0,vT:()=>a.vT,x6:()=>A.x6,xF:()=>j.xF,xS:()=>d.x,z4:()=>c.z4});var s=n(6524),i=n(7031),r=n(7537),a=n(902),l=n(2680),o=n(9274),h=n(7241),u=n(34),c=n(209),d=(n(8960),n(288)),f=n(3911),m=n(6077),A=n(5784),p=n(5090),w=n(6876),_=(n(3378),n(6273)),v=n(6617),y=n(3261),g=n(6218),b=n(886),x=n(988),E=n(6497),k=n(3988),N=n(5025),C=n(5936),D=(n(5581),n(7919)),S=n(4718),P=n(3315),O=(n(2668),n(9673)),M=n(614),R=n(6869),I=n(5503),z=n(1602),W=n(9841),j=n(3607),B=n(4985),T=n(7579),F=(n(2888),n(9723)),J=(n(3128),n(7778)),L=n(9846),V=n(9300)},8002:(e,t,n)=>{n.d(t,{Pm:()=>w,m0:()=>v});var s=n(9790),i=n(6562),r=n(5149),a=n(8458),l=n(4558),o=n(5660),h=n(6159),u=n(6164),c=new WeakMap,d=new WeakMap;class f{constructor(e,t){(0,r.A)(this,c,void 0),(0,r.A)(this,d,void 0),(0,l.A)(c,this,e),(0,l.A)(d,this,null)}async file(e){return null==(0,a.A)(d,this)&&(0,l.A)(d,this,await h.loadAsync((0,a.A)(c,this).buffer())),await(0,a.A)(d,this).file(e).async("uint8array")}async metadata(e){for(null==(0,a.A)(d,this)&&(0,l.A)(d,this,await h.loadAsync((0,a.A)(c,this).buffer()));;){e.endsWith(".json")||(e+=".json");let t=await(0,a.A)(d,this).file(e).async("string"),n=JSON.parse(t);if(!n.$schema.startsWith("redirection/"))return n;e=n.redirection.targets[0].location}}clear(){(0,l.A)(d,this,null)}}var m=new WeakMap,A=new WeakMap,p=new WeakSet;class w extends o.nP{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=null;"existingHandle"in n?(i=n.existingHandle,delete n.existingHandle):t instanceof u.V||(t=new u.V(t)),super(e,new f(t,i)),(0,s.A)(this,p),(0,r.A)(this,m,void 0),(0,r.A)(this,A,void 0),(0,l.A)(m,this,t),(0,l.A)(A,this,e)}static format(){return"ArtifactDB-zipped"}abbreviate(){return(0,i.A)(p,this,_).call(this,e=>({size:e.size(),name:e.name()}))}serialize(){return(0,i.A)(p,this,_).call(this,e=>e)}static unserialize(e,t){if(1!=e.length||"zip"!=e[0].type)throw new Error("expected exactly one file of type 'zip' for Zipped ArtifactDB unserialization");let n=t.datasetName;delete t.datasetName;let s=new w(n,e[0].file);return s.setOptions(s),s}}function _(e){let t=[{type:"zip",file:e((0,a.A)(m,this))}],n=this.options();return n.datasetName=(0,a.A)(A,this),{files:t,options:n}}class v extends o.ab{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=null;"existingHandle"in n?(s=n.existingHandle,delete n.existingHandle):t instanceof u.V||(t=new u.V(t)),super(e,new f(t,s))}}},8166:(e,t,n)=>{n.d(t,{Az:()=>s.Az,Ec:()=>o.E,Iy:()=>s.Iy,QR:()=>h.Q,b5:()=>u.b,hv:()=>a.h,iC:()=>s.iC,i_:()=>l.i,lU:()=>i.l,oc:()=>s.oc,uN:()=>s.uN,xD:()=>r.x,zs:()=>c.z});var s=n(6535),i=(n(4106),n(3726),n(5600)),r=n(4378),a=(n(2152),n(9318)),l=(n(1482),n(2983),n(3705)),o=(n(2777),n(7823)),h=(n(3825),n(7001)),u=n(3668),c=n(1642);n(8996)},8743:(e,t,n)=>{n.d(t,{B8:()=>h,Bm:()=>d,a4:()=>_,eg:()=>A,pz:()=>g});var s=n(9790),i=n(4467),r=n(6562),a=n(1430);class l{constructor(e){this._names=e,this._lookup=new Map}names(){return this._names}nameToIndexUncached(e){return this._lookup.has(e)?this._lookup.get(e):this._names.indexOf(e)}nameToIndex(e){let{error:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._lookup.has(e))return this._lookup.get(e);for(var n=this._lookup.size;n<this._names.length;n++){const t=this._names[n];if(!this._lookup.has(t)&&(this._lookup.set(t,n),this._names[n]==e))return n}if(t)throw new Error("no matching name for '"+e+"' in this "+this.constructor.className);return-1}indexToName(e){return this._names[e]}append(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.z(this,t);return t||(n._names=n._names.slice(),n._lookup=new Map),n._names.push(e),n}set(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.z(this,n);return n?s._lookup.size>e&&(s._lookup=new Map):(s._names=s._names.slice(),s._lookup=new Map),s._names[e]=t,s}delete(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.z(this,t);return t?n._lookup.size>e&&(n._lookup=new Map):(n._names=n._names.slice(),n._lookup=new Map),n._names.splice(e,1),n}_bioconductor_CLONE(e){let{deepCopy:t=!0}=e,n=new this.constructor;return n._names=a.k(this._names,t),n._lookup=a.k(this._lookup,t),n}}var o=new WeakSet;class h{constructor(e){let{names:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,s.A)(this,o),0==arguments.length)return this._values=[],void(this._names=null);if(e instanceof Array){if(null!==t){if(t.length!=e.length)throw new Error("'names' and 'values' should have the same length");for(const e of t)if("string"!=typeof e)throw new Error("'names' should be an array of strings");t=new l(t)}this._values=e,this._names=t}else if(e instanceof Map){let n=[];if(null==t){t=[];for(const[s,i]of e){if("string"!=typeof s)throw new Error("keys of 'values' should be strings");t.push(s),n.push(i)}}else{if(t.length!=e.size)throw new Error("size of 'values' should be equal to length of 'names'");for(const s of t){if("string"!=typeof s)throw new Error("'names' should be an array of strings");if(!e.has(s))throw new Error("missing name '"+s+"' in 'values'");n.push(e.get(s))}}this._values=n,this._names=new l(t)}else{let n=[];if(null==t){t=[];for(const[s,i]of Object.entries(e))t.push(s),n.push(i)}else{if(t.length!=Object.keys(e).length)throw new Error("size of 'values' should be equal to length of 'names'");for(const s of t){if("string"!=typeof s)throw new Error("'names' should be an array of strings");if(!(s in e))throw new Error("missing name '"+s+"' in 'values'");n.push(e[s])}}this._values=n,this._names=new l(t)}}names(){return null==this._names?null:this._names.names()}values(){return this._values}length(){return this._values.length}getByIndex(e){return(0,r.A)(o,this,u).call(this,e),this._values[e]}getByName(e){if(null===this._names)throw new Error("no available names in this "+this.constructor.className);let t=this._names.nameToIndex(e);return this._values[t]}get(e){return"number"==typeof e?this.getByIndex(e):this.getByName(e)}has(e){return this.nameToIndex(e)>=0}nameToIndex(e){return this._names.nameToIndex(e,{error:!1})}toArray(){return this._values}toMap(){if(null==this._names)throw new Error("no available names in this '"+this.constructor.className+"'");let e=new Map,t=this._names.names();for(var n=0;n<this._values.length;n++){const s=t[n];e.has(s)||e.set(s,this._values[n])}return e}toObject(){if(null==this._names)throw new Error("no available names in this '"+this.constructor.className+"'");let e={},t=this._names.names();for(var n=0;n<this._values.length;n++){const s=t[n];s in e||(e[s]=this._values[n])}return e}setByIndex(e,t){let{name:n=null,inPlace:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=a.z(this,s);if(s||(i._values=i._values.slice()),e<0||e>this._values.length)throw new Error(" index '"+String(e)+"' out of range for this "+this.constructor.className);if(e==i._values.length)if(i._values.push(t),null==n)null!=i._names&&(i._names=i._names.append("",{inPlace:s}));else{if("string"!=typeof n)throw new Error("'name' should be a string");if(null==i._names){const t=new Array(i._values.length).fill("");t[e]=n,i._names=new l(t)}else i._names=i._names.append(n,{inPlace:s})}else if(i._values[e]=t,null!==n)if(null===i._names){const t=new Array(i._values.length).fill("");t[e]=n,i._names=new l(t)}else i._names=i._names.set(e,n,{inPlace:s});return i}setByName(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.z(this,n);if(n||(s._values=s._values.slice()),null!==s._names){let i=s._names.nameToIndex(e,{error:!1});i<0?(s._values.push(t),s._names=s._names.append(e,{inPlace:n})):s._values[i]=t}else{const n=new Array(s._values.length).fill("");n.push(e),s._names=new l(n),s._values.push(t)}return s}set(e,t){let{name:n=null,inPlace:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"number"==typeof e?this.setByIndex(e,t,{name:n,inPlace:s}):this.setByName(e,t,{inPlace:s})}setNames(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.z(this,t);if(null!==e){if(e.length!=this._values.length)throw new Error("'names' and 'values' should have the same length");for(const t of e)if("string"!=typeof t)throw new Error("'names' should be an array of strings")}return n._names=new l(e),n}deleteByIndex(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.z(this,t);return t||(n._values=n._values.slice()),(0,r.A)(o,this,u).call(this,e),n._values.splice(e,1),null!==n._names&&(n._names=n._names.delete(e,{inPlace:t})),n}deleteByName(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.z(this,t);if(t||(n._values=n._values.slice()),null==n._names)throw new Error("no available names in this "+this.constructor.className);let s=this._names.nameToIndexUncached(e);if(s<0)throw new Error("no matching name for '"+e+"' in this "+this.constructor.className);return n._values.splice(s,1),null!==n._names&&(n._names=n._names.delete(s,{inPlace:t})),n}delete(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"number"==typeof e?this.deleteByIndex(e,{inPlace:t}):this.deleteByName(e,{inPlace:t})}sliceRange(e,t){let{inPlace:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.z(this,n);return s._values=s._values.slice(e,t),null!==this._names&&(s._names=new l(s._names.names().slice(e,t))),s}sliceIndices(e){let{inPlace:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],s=[];for(let a of e){if("string"==typeof a){if(null==this._names)throw new Error("no available names in this "+this.constructor.className);a=this._names.nameToIndex(a)}else(0,r.A)(o,this,u).call(this,a);s.push(this._values[a]),null!==this._names&&n.push(this._names.indexToName(a))}let i=a.z(this,t);return i._values=s,null!==this._names&&(i._names=new l(n)),i._lookup=new Map,i}[Symbol.iterator](){let e=0,t=this._values;return{next:function(){if(e<t.length){let n=t[e];return e++,{done:!1,value:n}}return{done:!0}},[Symbol.iterator](){return this}}}_bioconductor_LENGTH(){return this.length()}_bioconductor_SLICE(e,t){let{allowView:n=!1}=t,s=this.sliceIndices(e),i=new this.constructor;return i._values=s._values,i._names=s._names,i}_bioconductor_CLONE(e){let{deepCopy:t=!0}=e,n=new this.constructor;return n._values=a.k(this._values,t),n._names=a.k(this._names,t),n}_bioconductor_COMBINE(e){let t=this._values.slice(),n=null;null!==this._names&&(n=this.names().slice());for(let i of e){i instanceof h||(i=new h(i));const e=i.values();for(const n of e)t.push(n);const s=i.names();if(null===s){if(null!==n)for(const t of e)n.push("")}else{null===n&&(n=new Array(t.length-e.length).fill(""));for(const e of s)n.push(e)}}let s=new this.constructor;return s._values=t,s._names=new l(n),s}}function u(e){if(e<0||e>=this._values.length)throw new Error(" index '"+String(e)+"' out of range for this "+this.constructor.className)}(0,i.A)(h,"className","List");var c=new WeakSet;class d extends h{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,s.A)(this,c);else{super(e,t),(0,s.A)(this,c);for(const e of this._values)(0,r.A)(c,this,f).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,r.A)(c,this,f).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,r.A)(c,this,f).call(this,t),n)}}function f(e){if(null!==e&&!Number.isInteger(e))throw new Error("only integers or nulls can be stored in an IntegerList");return e}var m=new WeakSet;class A extends h{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,s.A)(this,m);else{super(e,t),(0,s.A)(this,m);for(const e of this._values)(0,r.A)(m,this,p).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,r.A)(m,this,p).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,r.A)(m,this,p).call(this,t),n)}}function p(e){if(null!==e&&"number"!==typeof e)throw new Error("only numbers or nulls can be stored in a NumberList");return e}var w=new WeakSet;class _ extends h{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,s.A)(this,w);else{super(e,t),(0,s.A)(this,w);for(const e of this._values)(0,r.A)(w,this,v).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,r.A)(w,this,v).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,r.A)(w,this,v).call(this,t),n)}}function v(e){if(null!==e&&"string"!==typeof e)throw new Error("only strings or nulls can be stored in a StringList");return e}var y=new WeakSet;class g extends h{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0==arguments.length)super(),(0,s.A)(this,y);else{super(e,t),(0,s.A)(this,y);for(const e of this._values)(0,r.A)(y,this,b).call(this,e)}}setByIndex(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByIndex(e,(0,r.A)(y,this,b).call(this,t),n)}setByName(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.setByName(e,(0,r.A)(y,this,b).call(this,t),n)}}function b(e){if(null!==e&&"boolean"!==typeof e)throw new Error("only booleans or nulls can be stored in a StringList");return e}},8829:(e,t,n)=>{n.d(t,{P4:()=>A,Ug:()=>z,qJ:()=>L});var s=n(9790),i=n(6562),r=n(4467),a=n(5149),l=n(8458),o=n(4558),h=n(9379),u=n(7990),c=n(3619),d=n(1276),f=n(141),m=n(2697);n(6292);const A="cell_labelling";var p=d.WR;function w(e){let t=p;return p=e,t}async function _(e,t){let n=e+"_"+t,s=await p("https://github.com/kanaverse/singlepp-references/releases/download/2023-04-28/"+n);return new f.VM(s,{name:n})}const v={};function y(e){if("prepared"in e){for(const t of Object.values(e.prepared))t.built.raw.free();delete e.prepared}}async function g(e){let t=await f.we(e.content(),{compression:"gz"}),n=[];for(const s of t){let e=null;""!==s&&(e=s.split("\t"),1==e.length&&(e=e[0])),n.push(e)}return n}async function b(e,t){let n="genes_"+t.toLowerCase()+".csv.gz";if(e in v){let s=v[e],i=s.genes;return t in i||(i[t]=await g(await _(e,n))),s}const s=["labels_fine.csv.gz","label_names_fine.csv.gz","markers_fine.gmt.gz","matrix.csv.gz",n];let i,r,a=await Promise.all(s.map(t=>_(e,t)));try{i=u.YA(a[3].buffer(),a[2].buffer(),a[0].buffer()),r={raw:i,labels:await f.we(a[1].content(),{compression:"gz"}),genes:{}},r.genes[t]=await g(a[4]),v[e]=r}catch(l){throw d.xr(i),l}return r}function x(){for(const[e,t]of Object.entries(v))t.raw.free(),delete v[e]}const E={9606:["BlueprintEncode","DatabaseImmuneCellExpression","HumanPrimaryCellAtlas","MonacoImmune","NovershternHematopoietic"],10090:["ImmGen","MouseRNAseq"]};function k(e,t,n){let s,i;try{let r=v[e],a=r.raw;if(!(n in r.genes))throw new Error("unknown gene type '"+n+"'");let l=r.genes[n];s=u.xF(t,a,l),i={loaded:r,built:{features:l,raw:s}}}catch(r){throw d.xr(s),r}return i}async function N(e,t,n,s,i,r,a,l,o){if(n!==a.guess_ids||d.PG(t,a.references)||!n&&(s!==a.species||i!==a.gene_id_column||r!==a.gene_id_type)){let a=s,h=i,c=r;if(n){let e=z.configureFeatureParameters(o());a=e.species,h=e.gene_id_column,c=e.gene_id_type}let f=new Set;for(const e of a)e in E&&E[e].forEach(e=>{f.add(e)});let m=l(),A=null==h?m.rowNames():m.column(h);e.gene_ids=A;let p={};if(null!==A){null==t&&(t=Array.from(f));for(const e of t)f.has(e)&&(await b(e,c),p[e]=k(e,A,c))}y(e),e.prepared=p;let w=Object.keys(p);if(w.length>1){let t=Object.values(p),n=t.map(e=>e.loaded.raw),s=t.map(e=>e.built.features),i=t.map(e=>e.built.raw);d.xr(e.integrated),e.integrated=u.V0(A,n,s,i)}else d.xr(e.integrated),delete e.integrated;return e.used_refs=w,!0}return!1}function C(e){return e.references=c.UC(e.references),e.species=c.UC(e.species),e}function D(e){let t=(0,h.A)({},e);return t.references=c.UC(t.references),t.species=c.UC(t.species),t}function S(e,t,n){let s=t.numberOfCells(),i=e.length,r=new Array(s);for(var a=0;a<s;a++){let s={},o=t.scoreForCell(a);for(var l=0;l<i;l++)s[e[l]]=o[l];r[a]={best:e[n[a]],all:s}}return r}function P(e,t){let n,s=e;if(e instanceof u.Cx){let r=e.numberOfGroups();if(null===t.gene_ids)s=null;else{let a=t.gene_ids.length;n=u.k3(r*a);for(var i=0;i<r;i++){let t=e.mean(i,{copy:!1});if(t.length!==a)throw new Error("unexpected number of genes in marker results");n.array().set(t,i*a)}s=u.VZ(a,r,n,{columnMajor:!0})}}else if(null!==t.gene_ids&&e.numberOfRows()!==t.gene_ids.length)throw new Error("unexpected number of genes in the input matrix");let r=t.prepared,a={per_reference:{}},l={};for(const[o,h]of Object.entries(r)){let e=u.Cd(s,h.built.raw);l[o]=e,a.per_reference[o]=S(h.loaded.labels,e,e.predicted({copy:!1}))}if("integrated"in t){let e=[];for(const s of t.used_refs)e.push(l[s]);let n=u.tp(s,e,t.integrated);a.integrated=S(t.used_refs,n,n.predicted({copy:!1})),n.free()}for(const o of Object.values(l))o.free();return d.xr(undefined),d.xr(n),a}function O(e,t,n){if(null===t)return P(e,n);let s,i=[];try{let r=d.wW([t]);i.push(r.arrays[0].ids);let a=e;if(null!==r.retain){let t=u._r(e,r.retain);i.push(t),a=t}let l=u.Qu(a,r.arrays[0].ids,{average:!0});i.push(l);let o=l.allSums({asTypedArray:!1});i.push(o);let h=u.VZ(a.numberOfRows(),l.numberOfGroups(),o,{columnMajor:!0});i.push(h),s=P(h,n),s.groups=r.arrays[0].levels}finally{i.forEach(d.xr)}return s}var M=new WeakMap,R=new WeakMap,I=new WeakMap;class z{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,a.A)(this,M,void 0),(0,a.A)(this,R,void 0),(0,a.A)(this,I,void 0),!(e instanceof m.Xj))throw new Error("'inputs' should be a State object from './inputs.js'");(0,o.A)(M,this,e),(0,o.A)(R,this,null===t?{}:t),(0,o.A)(I,this,null===n?{}:n),this.changed=!1}free(){y((0,l.A)(I,this))}valid(){return(0,l.A)(M,this).fetchCountMatrix().has("RNA")}fetchParameters(){let e=(0,h.A)({},(0,l.A)(R,this));return e.references=c.UC(e.references),e.species=c.UC(e.species),e}fetchNumberOfSharedFeatures(){let e={};for(const t of(0,l.A)(I,this).used_refs)e[t]=(0,l.A)(I,this).prepared[t].built.raw.numberOfFeatures();return e}static defaults(){return{references:null,guess_ids:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL"}}static configureFeatureParameters(e){let t=null,n={type:"symbol",species:"9606",confidence:0};if("row_names"in e){let t=e.row_names;t.confidence>n.confidence&&(n=t)}for(const[s,i]of Object.entries(e.columns))i.confidence>n.confidence&&(n=i,t=s);return{gene_id_column:t,species:[n.species],gene_id_type:n.type.toUpperCase()}}fetchParameters(){return D((0,l.A)(R,this))}static flush(){x()}static setDownload(e){return w(e)}async compute(e){"references"in(e=d.wn(e,z.defaults()))||(e.guess_ids=!0),this.changed=!1,this.valid()&&(this.changed=await N((0,l.A)(I,this),e.references,e.guess_ids,e.species,e.gene_id_column,e.gene_id_type,(0,l.A)(R,this),()=>(0,l.A)(M,this).fetchFeatureAnnotations().RNA,()=>(0,l.A)(M,this).guessRnaFeatureTypes())),(0,o.A)(R,this,C(e))}computeLabels(e){let{group:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return O(e,t,(0,l.A)(I,this))}}(0,r.A)(z,"availableReferences",E);var W=new WeakMap,j=new WeakMap,B=new WeakMap,T=new WeakMap,F=new WeakMap,J=new WeakSet;class L{constructor(e){(0,s.A)(this,J),(0,a.A)(this,W,void 0),(0,a.A)(this,j,void 0),(0,a.A)(this,B,void 0),(0,a.A)(this,T,void 0),(0,a.A)(this,F,void 0),(0,o.A)(W,this,{}),(0,o.A)(F,this,L.defaults()),(0,o.A)(B,this,e),(0,o.A)(j,this,{}),(0,o.A)(T,this,null)}free(){y((0,l.A)(j,this))}static defaults(){return{references:null,guess_ids:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL"}}fetchParameters(){return D((0,l.A)(F,this))}static flush(){x()}static setDownload(e){return w(e)}setParameters(e){e=d.wn(e,L.defaults()),(0,o.A)(F,this,C(e))}async ready(){await N((0,l.A)(j,this),(0,l.A)(F,this).references,(0,l.A)(F,this).guess_ids,(0,l.A)(F,this).species,(0,l.A)(F,this).gene_id_column,(0,l.A)(F,this).gene_id_type,(0,l.A)(W,this),()=>(0,l.A)(B,this),()=>(0,i.A)(J,this,V).call(this)),(0,o.A)(W,this,(0,l.A)(F,this))}computeLabels(e){let{group:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return O(e,t,(0,l.A)(j,this))}}function V(){return null==(0,l.A)(T,this)&&(0,o.A)(T,this,d.RA((0,l.A)(B,this))),(0,l.A)(T,this)}(0,r.A)(L,"availableReferences",E)},8960:(e,t,n)=>{n(209),n(6524),n(7031)},9215:(e,t,n)=>{n.d(t,{m:()=>i});var s=n(507);async function i(e,t,n,i){if(!await t.exists(e+"/OBJECT"))return{};if(i in n){let r=n[i];if(!1===r)return{};if(!0!==r){return r(e,await(0,s._i)(e,t),t,n)}}return(0,s.Ag)(e,null,t,n)}},9300:(e,t,n)=>{n.d(t,{h:()=>l});var s=n(45),i=n(7031),r=n(6524);const a=["columnMajor","asTypedArray","buffer"];function l(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{columnMajor:o=!0,asTypedArray:h=!0,buffer:u=null}=l,c=(0,s.A)(l,a);i.PI(c);let d=null,f=null;if(n.length!==e*t)throw new Error("'buffer' should have length equal to the product of 'numberOfRows' and 'numberOfColumns'");try{if(null===u)d=i.k3(n.length),u=d;else if(u.length!=n.length)throw new Error("'buffer' should have length equal to the product of 'numberOfRows' and 'numberOfColumns'");f=i.c(n,"Float64WasmArray"),r.T1(n=>n.transpose_matrix(e,t,f.offset,o,u.offset))}catch(m){throw i.t9(d),m}finally{i.t9(f)}return i.vV(u,null==d,h)}},9692:(e,t,n)=>{n.d(t,{Cr:()=>a,DI:()=>m,RS:()=>f,UE:()=>d,h_:()=>l,n$:()=>A});var s=n(7990),i=(n(1276),n(1559)),r=(e,t,n)=>null;var a={numberOfThreads:1};function l(e,t){var n=e.fetchIndex(),i={num_obs:n.numberOfCells()},r=null,a=null,l=null,o=null;try{r=s.jw(n,t),a=s.kl(r.numberOfCells()),l=s.kl(r.size()),o=s.k3(r.size()),r.serialize({runs:a,indices:l,distances:o}),i.size=r.size(),i.runs=a.array().slice(),i.indices=l.array().slice(),i.distances=o.array().slice()}finally{null!==r&&r.free(),null!==a&&a.free(),null!==l&&l.free(),null!==o&&o.free()}return i}const o=[],h=[];function u(e){return e.type}function c(e,t){"error"==u(t)?e.reject(t.error):e.resolve(t.data)}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=o[e],r=h[e];var a=r.counter,l=new Promise((e,t)=>{let n={resolve:e,reject:t};a in r.promises?(c(n,r.promises[a]),delete r.promises[a]):r.promises[a]=n});return r.counter++,t.id=a,i._z(s,t,n),l}function f(e,t){let n=o.length;o.push(e);let s={counter:0,promises:{}};return h.push(s),i.rq(e,e=>{var t=u(e.data);if(t.endsWith("_iter"))r(t.slice(0,-5),e.data.x,e.data.y,e.data.iteration);else{var n=e.data.id;n in s.promises?(c(s.promises[n],e.data),delete s.promises[n]):s.promises[n]=e.data}}),{worker_id:n,ready:d(n,{cmd:"INIT",scranOptions:t})}}async function m(e){await d(e,{cmd:"KILL"});let t=o[e];return o[e]=null,i.Qw(t)}function A(e,t,n){var s={cmd:"RUN",params:t},i=[];return null!==n&&(i=[n.runs.buffer,n.indices.buffer,n.distances.buffer],s.neighbors=n),d(e,s,i)}},9830:(e,t,n)=>{n.d(t,{fc:()=>X});n(7990);var s=n(2697),i=n(1653),r=n(5817),a=n(4935),l=n(4201),o=n(6292),h=n(3819),u=n(8833),c=n(5305),d=n(8042),f=n(9894),m=n(1520),A=n(4468),p=n(6629),w=n(5869),_=n(6302),v=n(1040),y=n(945),g=n(928),b=n(3571),x=n(7465),E=n(8829),k=n(2925),N=n(6747);const C=s.P4,D=i.P,S=r.P,P=a.P,O=l.P,M=o.P,R=h.P,I=u.P,z=c.P,W=d.P,j=f.P,B=m.P,T=A.P,F=p.P,J=w.P,L=g.P,V=b.P,U=v.P,$=y.P,H=_.P,G=x.P4,K=E.P4,q=k.P4,Z=N.P4;async function X(){return Q(new s.Xj)}function Q(e){let t={};t[C]=e,t[D]=new i.Z(t[C]),t[S]=new r.D(t[C]),t[P]=new a.d(t[C]);let n={RNA:t[D],ADT:t[S],CRISPR:t[P]};t[O]=new l._(t[C],n),t[M]=new o.A(t[D],t[O]),t[R]=new h.K(t[S],t[O]),t[I]=new u.S(t[P],t[O]),t[z]=new c.G(t[O],t[M]),t[W]=new d.N(t[O],t[M],t[z]),t[j]=new f.d(t[O],t[R]),t[B]=new m.v(t[O],t[I]);let s={RNA:t[W],ADT:t[j],CRISPR:t[B]};t[T]=new A.T(s),t[F]=new p.a(t[O],t[T]),t[J]=new w.Y(t[F]),t[L]=new g.s(t[J]),t[V]=new b.B(t[J]),t[U]=new v.d(t[F]),t[$]=new y.$(t[J]),t[H]=new _.j(t[$],t[U]);let X={RNA:t[M],ADT:t[R],CRISPR:t[I]};return t[G]=new x.Rr(t[O],X,t[H]),t[K]=new E.Ug(t[C]),t[Z]=new N.VX(t[C],t[O],t[M]),t[q]=new k.el(t[O],X),Promise.all([t[L].ready(),t[V].ready()]).then(e=>t)}}}]);
//# sourceMappingURL=522.44959ef0.chunk.js.map